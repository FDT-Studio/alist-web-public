import{b as E,aO as $,bu as Q,_ as m,bv as _,f as U,c as W,Q as H,p as I,bw as a,U as h,bx as R,by as N,n as T,ao as q}from"./index.d6b05f71.js";const z=(s,...n)=>{},v=new Map,L=(s,n)=>{v.set(s,n)},A=s=>{window.scroll({top:v.get(s)||0,behavior:"smooth"}),z("recoverScroll",s,v.get(s))};let y=!0,b;function D(s,n,l="replaceState"){let o=l==="location"?location.href:location.hash;if(!o.includes("?"))o=`${o}?${s}=${n}`;else if(!o.includes(s))o=`${o}&${s}=${n}`;else{const u=`(\\?|&|#)${s}([^&|^#]*)(&|$|#)`;o=o.replace(new RegExp(u),"$1"+s+"="+n+"$3")}l==="location"&&(location.href=o),l==="pushState"&&history.pushState({},"",o),l==="replaceState"&&history.replaceState({},"",o)}function F(s){for(var n=window.location.search.substring(1),l=n.split("&"),o=0;o<l.length;o++){var u=l[o].split("=");if(u[0]==s)return u[1]}return""}const S={};let i=1;const V=()=>i,B=()=>{const s=_();i=1,s.type==="pagination"&&D("page",1),console.log("resetGlobalPage",i)},K=()=>{const{pathname:s,to:n}=E(),[,l]=$(e=>Q(e,m())),o=_();o.type==="pagination"&&F("page")&&(i=parseInt(F("page")));const[,u]=$(e=>{const t={index:e==null?void 0:e.index,size:e==null?void 0:e.size};return U(e==null?void 0:e.path,m(),t.index,t.size,e==null?void 0:e.force,new W.CancelToken(function(c){b=c}))}),w=(e,t=!0,r=!1)=>{r&&(e=I(s(),e)),t?S[e]=!0:delete S[e]};let g=!1;const P=(e,t,r)=>{b==null||b(),g=t!=null?t:!1,p(""),S[e]?d(e,i,void 0,void 0,r):M(e)},M=async e=>{a.setState(h.FetchingObj);const t=await l(e);R(t,r=>{var c;a.setObj(r),a.setProvider(r.provider),r.is_dir?(w(e),d(e,i)):(a.setReadme(r.readme),a.setHeader(r.header),a.setRelated((c=r.related)!=null?c:[]),a.setRawUrl(r.raw_url),a.setState(h.File))},p)},d=async(e,t,r,c=!1,G)=>{r||(r=o.size),r!==void 0&&o.type==="all"&&(r=void 0),i=t!=null?t:1,a.setState(c?h.FetchingMore:h.FetchingObjs);const C=await u({path:e,index:t,size:r,force:G});R(C,f=>{var O;c?N(f.content):(a.setObjs((O=f.content)!=null?O:[]),a.setTotal(f.total)),a.setReadme(f.readme),a.setHeader(f.header),a.setWrite(f.write),a.setProvider(f.provider),a.setState(h.Folder),c&&(t!=null?t:1)>1||A(e)},p)},p=(e,t)=>{if(t===403)a.setState(h.NeedPassword),g&&T.error(e);else{if(y&&e.endsWith("object not found")){y=!1,n(s().replace(q().base_path,""));return}a.setErr(e)}},j=(e,t,r=!1)=>{d(s(),e,t,r)};return{handlePathChange:P,setPathAs:w,refresh:(e,t)=>{P(s(),e,t)},pageChange:j,loadMore:()=>{j(i+1,void 0,!0)},allLoaded:()=>i>=Math.ceil(H.total/o.size)}};export{B as a,A as b,D as c,V as g,L as r,K as u};
