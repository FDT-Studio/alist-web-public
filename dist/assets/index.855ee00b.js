import{as as x,D as O,b as A,bI as g,bN as k,o as Z,h as e,af as M,b1 as S,bE as X,bO as Y,bP as ee,bQ as te,bR as ne,H as U,a as re,r as oe,d as i,bS as se,aO as y,V as ae,bD as v,ac as le,bC as ie,S as w,I as C,bh as ce,bi as ue,bj as ge,bk as de,bl as pe,bm as he,bn as me,t as be,bo as we,bp as fe,bq as Se,bT as ke,aZ as Ie,ab as _e,B as z,bc as $e,bd as ye,bU as ve,ai as Ce,bx as D,n as f,b2 as xe}from"./index.fbab5f5b.js";import{p as Oe,c as Te}from"./index.71d4ddb0.js";import{s as Re,g as Le,a as Ee}from"./webauthn-json.browser-ponyfill.1c672167.js";const Fe=()=>{const d=x("sso_login_enabled"),I=O("sso_login_platform"),n=x("sso_compatibility_mode"),{searchParams:l,to:p}=A(),o=l.token;o!=null&&o!=""&&(g(o),p(decodeURIComponent(l.redirect||k||"/"),!0));function c(a){const r=a.data;r.token&&(g(r.token),p(decodeURIComponent(l.redirect||k||"/"),!0))}if(window.addEventListener("message",c),Z(()=>{window.removeEventListener("message",c)}),d){const a=()=>{const u=S.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=u;return}window.open(u,"authPopup","width=500,height=600")};let r;switch(I){case"Github":r=ne;break;case"Microsoft":r=Oe;break;case"Google":r=te;break;case"Dingtalk":r=ee;break;case"Twitter":r=Y;break;default:r=X}return e(M,{cursor:"pointer",boxSize:"$8",as:r,p:"$0_5",onclick:a})}},Ae=()=>{const d=O("logo").split(`
`),I=U(d[0],d.pop()),n=re(),l=oe(()=>`${n("login.login_to")} ${O("site_title")}`);Te(l);const p=U("white","$neutral1"),[o,c]=i(localStorage.getItem("username")||""),[a,r]=i(localStorage.getItem("password")||""),[u,T]=i(""),[R,L]=i(""),[h,N]=i(!1),[m,V]=se("remember-pwd","false"),[j,B]=y(async()=>S.post("/auth/login",{username:o(),password:a(),login_type:u(),otp_code:R()})),[,G]=y((t,s,b)=>S.post("/authn/webauthn_finish_login?username="+b,JSON.stringify(s),{headers:{session:t}})),[,H]=y(t=>S.get("/authn/webauthn_begin_login?username="+t)),{searchParams:E,to:F}=A(),q=x("webauthn_login_enabled"),J=async()=>{N(!h())},_=async()=>{if(h()){if(!Re()){f.error(n("users.webauthn_not_supported"));return}g(),m()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const t=await H(o());xe(t,async s=>{const b=Le(s.options),K=await Ee(b),W=await G(s.session,K,o());D(W,Q=>{f.success(n("login.success")),g(Q.token),F(decodeURIComponent(E.redirect||k||"/"),!0)})})}else{m()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",a()),localStorage.setItem("login_type",u())):(localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("login_type"));const t=await B();D(t,s=>{f.success(n("login.success")),localStorage.setItem("watermarkUsername",o()),g(s.token),F(decodeURIComponent(E.redirect||k||"/"),!0)},(s,b)=>{f.error(s)})}},[P,Pe]=i(!1),$=[{id:1,text:n("login.admin"),value:"admin"},{id:2,text:n("login.skunkgirl"),value:"skunkgirl"}];return T($[1].value),e(Ce,{zIndex:"1",w:"$full",h:"100vh",get children(){return e(ae,{get bgColor(){return p()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(v,{alignItems:"center",justifyContent:"space-around",get children(){return[e(le,{mr:"$2",boxSize:"$12",get src(){return I()}}),e(ie,{color:"$info9",fontSize:"$2xl",get children(){return l()}})]}}),e(w,{get when(){return!P()},get fallback(){return e(C,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return R()},onInput:t=>L(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&_()}})},get children(){return[e(ce,{get defaultValue(){return $[1].value},onChange:T,get children(){return[e(ue,{get children(){return[e(ge,{get children(){return n("login.select-tips")}}),e(de,{}),e(pe,{})]}}),e(he,{get children(){return e(me,{get children(){return e(be,{each:$,children:t=>e(we,{get value(){return t.value},get children(){return[e(fe,{get children(){return t.text}}),e(Se,{})]}})})}})}})]}}),e(C,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return o()},onInput:t=>c(t.currentTarget.value)}),e(w,{get when(){return!h()},get children(){return e(C,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return a()},onInput:t=>r(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&_()}})}}),e(v,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(ke,{get checked(){return m()==="true"},onChange:()=>V(m()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(Ie,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),e(_e,{w:"$full",spacing:"$2",get children(){return[e(w,{get when(){return!h()},get children(){return e(z,{colorScheme:"primary",w:"$full",onClick:()=>{P()?L(""):(c(""),r(""))},get children(){return n("login.clear")}})}}),e(z,{w:"$full",get loading(){return j()},onClick:_,get children(){return n("login.login")}})]}}),e(v,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e($e,{}),e(ye,{}),e(Fe,{}),e(w,{when:q,get children(){return e(M,{cursor:"pointer",boxSize:"$8",as:ve,p:"$0_5",onclick:J})}})]}})]}})}})};export{Ae as default};
