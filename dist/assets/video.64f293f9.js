import{cb as Ue,c6 as we,bI as tt,b as rt,W as it,cS as nt,Q as Ae,as as at,c9 as Me,cT as Ke,au as st,bN as ot,bO as lt,ax as ut,o as ft,d as dt,h as We,Y as ht,av as ct,p as vt,cU as mt}from"./index.5fae628c.js";import{O as gt,A as pt}from"./icon.57efa67e.js";import{c as Ge,A as Et,V as yt}from"./video_box.05ac4c83.js";import"./index.50fee122.js";import"./index.21ffcc5a.js";import"./Layout.fee22c89.js";import"./usePath.78dbe641.js";import"./index.19183197.js";import"./FolderTree.30812206.js";import"./index.efbb653c.js";var He={exports:{}};/*!
 * artplayer-plugin-danmuku.js v5.0.1
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(ye,_e){(function(j,P,D,A,R){var S=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof we<"u"?we:{},I=typeof S[A]=="function"&&S[A],b=I.cache||{},T=typeof Ge=="function"&&Ge.bind(ye);function c(l,d){if(!b[l]){if(!j[l]){var h=typeof S[A]=="function"&&S[A];if(!d&&h)return h(l,!0);if(I)return I(l,!0);if(T&&typeof l=="string")return T(l);var n=new Error("Cannot find module '"+l+"'");throw n.code="MODULE_NOT_FOUND",n}e.resolve=function(i){var r=j[l][1][i];return r!=null?r:i},e.cache={};var t=b[l]=new c.Module(l);j[l][0].call(t.exports,e,t,t.exports,this)}return b[l].exports;function e(i){var r=e.resolve(i);return r===!1?{}:c(r)}}c.isParcelRequire=!0,c.Module=function(l){this.id=l,this.bundle=c,this.exports={}},c.modules=j,c.cache=b,c.parent=I,c.register=function(l,d){j[l]=[function(h,n){n.exports=d},{}]},Object.defineProperty(c,"root",{get:function(){return S[A]}}),S[A]=c;for(var f=0;f<P.length;f++)c(P[f]);if(D){var p=c(D);ye.exports=p}})({bgm6t:[function(j,P,D){var A=j("@parcel/transformer-js/src/esmodule-helpers.js");A.defineInteropFlag(D);var R=j("./danmuku"),S=A.interopDefault(R),I=j("./setting"),b=A.interopDefault(I),T=j("./heatmap"),c=A.interopDefault(T);function f(p){return l=>{(function(h){const{version:n,utils:{errorHandle:t}}=h.constructor,e=n.split(".").map(Number);t(e[0]+e[1]/100>=5,`Artplayer.js@${n} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 Artplayer.js@5.x.x \u7248\u672C\u4EE5\u4E0A`)})(l);const d=new S.default(l,p);return(0,b.default)(l,d),p.heatmap&&!l.option.isLive&&(0,c.default)(l,d,p.heatmap),{name:"artplayerPluginDanmuku",emit:d.emit.bind(d),load:d.load.bind(d),config:d.config.bind(d),hide:d.hide.bind(d),show:d.show.bind(d),reset:d.reset.bind(d),get option(){return d.option},get isHide(){return d.isHide},get isStop(){return d.isStop}}}}D.default=f,f.env="production",f.version="5.0.1",f.build="2023-05-03 11:57:31",typeof window<"u"&&(window.artplayerPluginDanmuku=f)},{"./danmuku":"4ns48","./setting":"lO8OT","./heatmap":"8AxLD","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4ns48":[function(j,P,D){var A=j("@parcel/transformer-js/src/esmodule-helpers.js");A.defineInteropFlag(D);var R=j("./bilibili"),S=j("./getDanmuTop"),I=A.interopDefault(S);class b{constructor(c,f){const{constructor:p,template:l}=c;if(this.utils=p.utils,this.validator=p.validator,this.$danmuku=l.$danmuku,this.$player=l.$player,this.art=c,this.danmus=[],this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(f),this.option.useWorker)try{this.worker=new Worker(j("12ceab24749100d0"))}catch{}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),c.on("video:play",this.start),c.on("video:playing",this.start),c.on("video:pause",this.stop),c.on("video:waiting",this.stop),c.on("resize",this.reset),c.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",heatmap:!1,beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",heatmap:"object|boolean",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:c}=this.utils,f=this.option.margin[0],{clientHeight:p}=this.$player;return typeof f=="number"?c(f,0,p):typeof f=="string"&&f.endsWith("%")?c(p*(parseFloat(f)/100),0,p):b.option.margin[0]}get marginBottom(){const{clamp:c}=this.utils,f=this.option.margin[1],{clientHeight:p}=this.$player;return typeof f=="number"?c(f,0,p):typeof f=="string"&&f.endsWith("%")?c(p*(parseFloat(f)/100),0,p):b.option.margin[1]}filter(c,f){return this.queue.filter(p=>p.$state===c).map(f)}getLeft(c){const f=c.getBoundingClientRect();return this.isRotate?f.top:f.left}getRef(){const c=this.$refs.pop();if(c)return c;const f=document.createElement("div");return f.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,f}getReady(){const{currentTime:c}=this.art;return this.queue.filter(f=>f.$state==="ready"||f.$state==="wait"&&c+.1>=f.time&&f.time>=c-.1)}getEmits(){const c=[],{clientWidth:f}=this.$player,p=this.getLeft(this.$player);return this.filter("emit",l=>{const d=l.$ref.offsetTop,h=this.getLeft(l.$ref)-p,n=l.$ref.clientHeight,t=l.$ref.clientWidth,e=h+t,i=f-e,r=e/l.$restTime,o={};o.top=d,o.left=h,o.height=n,o.width=t,o.right=i,o.speed=r,o.distance=e,o.time=l.$restTime,o.mode=l.mode,c.push(o)}),c}getFontSize(c){const{clamp:f}=this.utils,{clientHeight:p}=this.$player;return typeof c=="number"?f(c,12,p):typeof c=="string"&&c.endsWith("%")?f(p*(parseFloat(c)/100),12,p):b.option.fontSize}postMessage(c={}){return new Promise(f=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)c.id=Date.now(),this.worker.postMessage(c),this.worker.onmessage=p=>{const{data:l}=p;l.id===c.id&&f(l)};else{const p=(0,I.default)(c);f({top:p})}})}async load(){try{typeof this.option.danmuku=="function"?this.danmus=await this.option.danmuku():typeof this.option.danmuku.then=="function"?this.danmus=await this.option.danmuku:typeof this.option.danmuku=="string"?this.danmus=await(0,R.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.danmus=this.option.danmuku,this.utils.errorHandle(Array.isArray(this.danmus),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",this.danmus),this.queue=[],this.$danmuku.innerText="",this.danmus.forEach(c=>this.emit(c))}catch(c){throw this.art.emit("artplayerPluginDanmuku:error",c),c}return this}config(c){const{clamp:f}=this.utils;return this.option=Object.assign({},b.option,this.option,c),this.validator(this.option,b.scheme),this.option.speed=f(this.option.speed,1,10),this.option.opacity=f(this.option.opacity,0,1),this.option.lockTime=f(Math.floor(this.option.lockTime),0,60),this.option.maxLength=f(this.option.maxLength,0,500),this.option.minWidth=f(this.option.minWidth,0,500),this.option.maxWidth=f(this.option.maxWidth,0,1/0),c.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(c){c.$state="wait",c.$ref&&(c.$ref.style.visibility="hidden",c.$ref.style.marginLeft="0px",c.$ref.style.transform="translateX(0px)",c.$ref.style.transition="transform 0s linear 0s",this.$refs.push(c.$ref),c.$ref=null)}continue(){const{clientWidth:c}=this.$player;return this.filter("stop",f=>{switch(f.$state="emit",f.$lastStartTime=Date.now(),f.mode){case 0:{const p=c+f.$ref.clientWidth;f.$ref.style.transform=`translateX(${-p}px)`,f.$ref.style.transition=`transform ${f.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:c}=this.$player;return this.filter("emit",f=>{switch(f.$state="stop",f.mode){case 0:{const p=c-(this.getLeft(f.$ref)-this.getLeft(this.$player));f.$ref.style.transform=`translateX(${-p}px)`,f.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(c=>this.makeWait(c)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",l=>{const d=(Date.now()-l.$lastStartTime)/1e3;l.$restTime-=d,l.$lastStartTime=Date.now(),l.$restTime<=0&&this.makeWait(l)});const c=this.getReady(),{clientWidth:f,clientHeight:p}=this.$player;for(let l=0;l<c.length;l++){const d=c[l];d.$ref=this.getRef(),d.$ref.innerText=d.text,this.$danmuku.appendChild(d.$ref),d.$ref.style.left=`${f}px`,d.$ref.style.opacity=this.option.opacity,d.$ref.style.fontSize=`${this.option.fontSize}px`,d.$ref.style.color=d.color,d.$ref.style.border=d.border?`1px solid ${d.color}`:null,d.$ref.style.backgroundColor=d.border?"rgb(0 0 0 / 50%)":null,d.$ref.style.marginLeft="0px",d.$lastStartTime=Date.now(),d.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const h={mode:d.mode,height:d.$ref.clientHeight,speed:(f+d.$ref.clientWidth)/d.$restTime},{top:n}=await this.postMessage({target:h,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:f,clientHeight:p,marginBottom:this.marginBottom,marginTop:this.marginTop});if(d.$ref)if(this.isStop||n===void 0)d.$state="ready",this.$refs.push(d.$ref),d.$ref=null;else switch(d.$state="emit",d.$ref.style.visibility="visible",d.mode){case 0:{d.$ref.style.top=`${n}px`;const t=f+d.$ref.clientWidth;d.$ref.style.transform=`translateX(${-t}px)`,d.$ref.style.transition=`transform ${d.$restTime}s linear 0s`;break}case 1:d.$ref.style.left="50%",d.$ref.style.top=`${n}px`,d.$ref.style.marginLeft=`-${d.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(c=>this.makeWait(c)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(c){return this.validator(c,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),c.text.trim()&&this.option.filter(c)?(c.time?c.time=this.utils.clamp(c.time,0,1/0):c.time=this.art.currentTime+.5,c.mode===void 0&&(c.mode=this.option.mode),c.color===void 0&&(c.color=this.option.color),this.queue.push({...c,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("resize",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}D.default=b},{"./bilibili":"f83sx","./getDanmuTop":"jPSuD","12ceab24749100d0":"fXq73","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f83sx:[function(j,P,D){var A=j("@parcel/transformer-js/src/esmodule-helpers.js");function R(b){switch(b){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function S(b){if(typeof b!="string")return[];const T=b.matchAll(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(T).map(c=>{const f=c.groups.p.split(",");return f.length>=8?{text:c.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(f[0]),mode:R(Number(f[1])),fontSize:Number(f[2]),color:`#${Number(f[3]).toString(16)}`,timestamp:Number(f[4]),pool:Number(f[5]),userID:f[6],rowID:Number(f[7])}:null}).filter(Boolean)}function I(b){return fetch(b).then(T=>T.text()).then(T=>S(T))}A.defineInteropFlag(D),A.export(D,"getMode",()=>R),A.export(D,"bilibiliDanmuParseFromXml",()=>S),A.export(D,"bilibiliDanmuParseFromUrl",()=>I)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(j,P,D){D.interopDefault=function(A){return A&&A.__esModule?A:{default:A}},D.defineInteropFlag=function(A){Object.defineProperty(A,"__esModule",{value:!0})},D.exportAll=function(A,R){return Object.keys(A).forEach(function(S){S==="default"||S==="__esModule"||R.hasOwnProperty(S)||Object.defineProperty(R,S,{enumerable:!0,get:function(){return A[S]}})}),R},D.export=function(A,R,S){Object.defineProperty(A,R,{enumerable:!0,get:S})}},{}],jPSuD:[function(j,P,D){j("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(D),D.default=function({target:A,emits:R,clientWidth:S,clientHeight:I,marginBottom:b,marginTop:T,antiOverlap:c}){const f=R.filter(l=>l.mode===A.mode&&l.top<=I-b).sort((l,d)=>l.top-d.top);if(f.length===0)return T;f.unshift({top:0,left:0,right:0,height:T,width:S,speed:0,distance:S}),f.push({top:I-b,left:0,right:0,height:b,width:S,speed:0,distance:S});for(let l=1;l<f.length;l+=1){const d=f[l],h=f[l-1],n=h.top+h.height;if(d.top-n>=A.height)return n}const p=[];for(let l=1;l<f.length-1;l+=1){const d=f[l];if(p.length){const h=p[p.length-1];h[0].top===d.top?h.push(d):p.push([d])}else p.push([d])}if(!c){switch(A.mode){case 0:p.sort((l,d)=>{const h=Math.min(...d.map(t=>t.right)),n=Math.min(...l.map(t=>t.right));return h*d.length-n*l.length});break;case 1:p.sort((l,d)=>{const h=Math.max(...d.map(n=>n.width));return Math.max(...l.map(n=>n.width))*l.length-h*d.length})}return p[0][0].top}switch(A.mode){case 0:{const l=p.find(d=>d.every(h=>S<h.distance?!1:A.speed<h.speed?!0:h.right/(A.speed-h.speed)>h.time));return l&&l[0]?l[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fXq73:[function(j,P,D){P.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],lO8OT:[function(j,P,D){var A=j("@parcel/transformer-js/src/esmodule-helpers.js");A.defineInteropFlag(D);var R=j("bundle-text:./style.less"),S=A.interopDefault(R),I=j("bundle-text:./img/danmu-on.svg"),b=A.interopDefault(I),T=j("bundle-text:./img/danmu-off.svg"),c=A.interopDefault(T),f=j("bundle-text:./img/danmu-config.svg"),p=A.interopDefault(f),l=j("bundle-text:./img/danmu-style.svg"),d=A.interopDefault(l);if(D.default=function(h,n){const{option:t}=n,{template:{$controlsCenter:e,$player:i},constructor:{SETTING_ITEM_WIDTH:r,utils:{removeClass:o,addClass:s,append:a,setStyle:u,tooltip:_,query:g,inverseClass:m,getIcon:y}}}=h;u(e,"display","flex");const v=y("danmu-on",b.default),E=y("danmu-off",c.default),x=y("danmu-config",p.default),L=y("danmu-style",d.default);(function(){const O=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map(V=>`<div class="art-danmuku-style-panel-color${t.color===V?" art-current":""}" data-color="${V}" style="background-color:${V}"></div>`),C=a(e,`<div class="art-danmuku-emitter" style="max-width: ${t.maxWidth?`${t.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${O.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${t.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),F=g(".art-danmuku-style",C),M=g(".art-danmuku-input",C),B=g(".art-danmuku-send",C),k=g(".art-danmuku-style-panel-inner",C),w=g(".art-danmuku-style-panel-modes",C),U=g(".art-danmuku-style-panel-colors",C),N=t.mount||a(i,'<div class="art-layer-danmuku-emitter"></div>');h.option.backdrop&&s(k,"art-backdrop-filter"),t.theme&&s(C,`art-danmuku-theme-${t.theme}`);let K=null,H=t.mode,z=t.color;function G(V){V<=0?(K=null,B.innerText="\u53D1\u9001",o(B,"art-disabled")):(B.innerText=V,K=setTimeout(()=>G(V-1),1e3))}function q(){const V={mode:H,color:z,border:!0,text:M.value.trim()};K===null&&t.beforeEmit(V)&&(M.value="",n.emit(V),s(B,"art-disabled"),G(t.lockTime),h.emit("artplayerPluginDanmuku:emit",V))}function Z(){e.clientWidth<t.minWidth?(a(N,C),u(N,"display","flex"),s(C,"art-danmuku-mount"),t.mount||u(i,"marginBottom","40px")):(a(e,C),u(N,"display","none"),o(C,"art-danmuku-mount"),t.mount||u(i,"marginBottom",null))}a(F,L),h.proxy(B,"click",q),h.proxy(M,"keypress",V=>{V.key==="Enter"&&(V.preventDefault(),q())}),h.proxy(w,"click",V=>{const{dataset:X}=V.target;X.mode&&(H=Number(X.mode),m(V.target,"art-current"))}),h.proxy(U,"click",V=>{const{dataset:X}=V.target;X.color&&(z=X.color,m(V.target,"art-current"))}),Z(),h.on("resize",()=>{h.isInput||Z()}),h.on("destroy",()=>{t.mount&&C.parentElement===t.mount&&t.mount.removeChild(C)})})(),h.controls.add({position:"right",name:"danmuku",click:function(){n.isHide?(n.show(),h.notice.show="\u5F39\u5E55\u663E\u793A",u(v,"display",null),u(E,"display","none")):(n.hide(),h.notice.show="\u5F39\u5E55\u9690\u85CF",u(v,"display","none"),u(E,"display",null))},mounted(O){a(O,v),a(O,E),_(O,"\u5F39\u5E55\u5F00\u5173"),u(E,"display","none"),h.on("artplayerPluginDanmuku:hide",()=>{u(v,"display","none"),u(E,"display",null)}),h.on("artplayerPluginDanmuku:show",()=>{u(v,"display",null),u(E,"display","none")})}}),h.setting.add({width:260,name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:x,selector:[{width:r,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(O){return n.config({speed:O.time}),O.html}},{width:r,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(O){return n.config({fontSize:O.fontSize}),O.html}},{width:r,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(O){return n.config({opacity:O.opacity}),O.html}},{width:r,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(O){return n.config({margin:O.margin}),O.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:t.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:t.antiOverlap,onSwitch:O=>(n.config({antiOverlap:!O.switch}),O.tooltip=O.switch?"\u5173\u95ED":"\u5F00\u542F",!O.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:t.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:t.synchronousPlayback,onSwitch:O=>(n.config({synchronousPlayback:!O.switch}),O.tooltip=O.switch?"\u5173\u95ED":"\u5F00\u542F",!O.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const h=document.createElement("style");h.id="artplayer-plugin-danmuku",h.textContent=S.default,document.head.appendChild(h)}},{"bundle-text:./style.less":"hViDo","bundle-text:./img/danmu-on.svg":"4KfW9","bundle-text:./img/danmu-off.svg":"9UR3U","bundle-text:./img/danmu-config.svg":"4MPCW","bundle-text:./img/danmu-style.svg":"7lV5Q","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hViDo:[function(j,P,D){P.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;background-color:#ffffff4d;border-radius:5px;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 5px 5px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],"4KfW9":[function(j,P,D){P.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],"9UR3U":[function(j,P,D){P.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"4MPCW":[function(j,P,D){P.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],"7lV5Q":[function(j,P,D){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}],"8AxLD":[function(j,P,D){j("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(D);const A={map:(R,S,I,b,T)=>(R-S)*(T-b)/(I-S)+b,range(R,S,I){const b=Math.round(R/I)*I;return Array.from({length:Math.floor((S-R)/I)},(T,c)=>c*I+b)}};D.default=function(R,S,I){const{query:b}=R.constructor.utils;R.controls.add({name:"heatmap",position:"top",html:"",style:{position:"absolute",top:"-100px",left:"0px",right:"0px",height:"100px",width:"100%",pointerEvents:"none"},mounted(T){let c=null,f=null;function p(){if(c=null,f=null,T.innerHTML="",!S.danmus.length||!R.duration)return;const l={w:T.offsetWidth,h:T.offsetHeight},d={xMin:0,xMax:l.w,yMin:0,yMax:128,scale:.25,opacity:.2,minHeight:Math.floor(.05*l.h),sampling:Math.floor(l.w/100),smoothing:.2,flattening:.2};typeof I=="object"&&Object.assign(d,I);const h=[],n=R.duration/l.w;for(let u=0;u<=l.w;u+=d.sampling){const _=S.danmus.filter(({time:g})=>g>u*n&&g<=(u+d.sampling)*n).length;h.push([u,_])}const t=h[h.length-1],e=t[0],i=t[1];e!==l.w&&h.push([l.w,i]);const r=h.map(u=>u[1]),o=(Math.min(...r)+Math.max(...r))/2;for(let u=0;u<h.length;u++){const _=h[u],g=_[1];_[1]=g*(g>o?1+d.scale:1-d.scale)+d.minHeight}const s=(u,_,g,m)=>{const y=((L,O)=>{const C=O[0]-L[0],F=O[1]-L[1];return{length:Math.sqrt(Math.pow(C,2)+Math.pow(F,2)),angle:Math.atan2(F,C)}})(_||u,g||u),v=A.map(Math.cos(y.angle)*d.flattening,0,1,1,0),E=y.angle*v+(m?Math.PI:0),x=y.length*d.smoothing;return[u[0]+Math.cos(E)*x,u[1]+Math.sin(E)*x]},a=h.map(u=>[A.map(u[0],d.xMin,d.xMax,0,l.w),A.map(u[1],d.yMin,d.yMax,l.h,0)]).reduce((u,_,g,m)=>g===0?`M ${m[m.length-1][0]},${l.h} L ${_[0]},${l.h} L ${_[0]},${_[1]}`:`${u} ${((y,v,E)=>{const x=s(E[v-1],E[v-2],y),L=s(y,E[v-1],E[v+1],!0),O=v===E.length-1?" z":"";return`C ${x[0]},${x[1]} ${L[0]},${L[1]} ${y[0]},${y[1]}${O}`})(_,g,m)}`,"");T.innerHTML=`<svg viewBox="0 0 ${l.w} ${l.h}"><defs><linearGradient id="heatmap-solids" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${d.opacity}" /><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${d.opacity}" id="heatmap-start" /><stop offset="0%" style="stop-color:var(--art-progress-color);stop-opacity:1" id="heatmap-stop" /><stop offset="100%" style="stop-color:var(--art-progress-color);stop-opacity:1" /></linearGradient></defs><path fill="url(#heatmap-solids)" d="${a}"></path></svg>`,c=b("#heatmap-start",T),f=b("#heatmap-stop",T),c.setAttribute("offset",100*R.played+"%"),f.setAttribute("offset",100*R.played+"%")}R.on("video:timeupdate",()=>{c&&f&&(c.setAttribute("offset",100*R.played+"%"),f.setAttribute("offset",100*R.played+"%"))}),R.on("setBar",(l,d)=>{c&&f&&l==="played"&&(c.setAttribute("offset",100*d+"%"),f.setAttribute("offset",100*d+"%"))}),R.on("ready",p),R.on("resize",p),R.on("artplayerPluginDanmuku:loaded",p)}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["bgm6t"],"bgm6t","parcelRequire4dc0")})(He);const _t=Ue(He.exports);var Ve={exports:{}};(function(ye,_e){var j=function(P){var D=!1;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const n=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));n instanceof WebAssembly.Module&&(D=new WebAssembly.Instance(n)instanceof WebAssembly.Instance)}}catch{}console.log("WebAssembly support detected: "+(D?"yes":"no"));var A=this;A.canvas=P.canvas,A.renderMode=P.renderMode||(P.lossyRender?"lossy":"wasm-blend"),A.libassMemoryLimit=P.libassMemoryLimit||0,A.libassGlyphLimit=P.libassGlyphLimit||0,A.targetFps=P.targetFps||24,A.prescaleFactor=P.prescaleFactor||1,A.prescaleHeightLimit=P.prescaleHeightLimit||1080,A.maxRenderHeight=P.maxRenderHeight||0,A.dropAllAnimations=P.dropAllAnimations||!1,A.isOurCanvas=!1,A.video=P.video,A.canvasParent=null,A.fonts=P.fonts||[],A.availableFonts=P.availableFonts||[],A.fallbackFont=P.fallbackFont||"default.woff2",A.lazyFileLoading=P.lazyFileLoading||!1,A.onReadyEvent=P.onReady,D?A.workerUrl=P.workerUrl||"subtitles-octopus-worker.js":A.workerUrl=P.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",A.subUrl=P.subUrl,A.subContent=P.subContent||null,A.onErrorEvent=P.onError,A.debug=P.debug||!1,A.lastRenderTime=0,A.pixelRatio=window.devicePixelRatio||1,A.timeOffset=P.timeOffset||0,A.hasAlphaBug=!1,function(){if(typeof ImageData.prototype.constructor=="function")try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1);return}catch{console.log("detected that ImageData is not constructable despite browser saying so")}var n=document.createElement("canvas"),t=n.getContext("2d");window.ImageData=function(){var e=0;if(arguments[0]instanceof Uint8ClampedArray)var i=arguments[e++];var r=arguments[e++],o=arguments[e],s=t.createImageData(r,o);return i&&s.data.set(i),s}}(),A.workerError=function(n){if(console.error("Worker error: ",n),A.onErrorEvent&&A.onErrorEvent(n),!A.debug)throw A.dispose(),new Error("Worker error: "+n)},A.init=function(){if(!window.Worker){A.workerError("worker not supported");return}A.worker||(A.worker=new Worker(A.workerUrl),A.worker.addEventListener("message",A.onWorkerMessage),A.worker.addEventListener("error",A.workerError)),A.workerActive=!1,A.createCanvas(),A.setVideo(P.video),A.setSubUrl(P.subUrl),A.worker.postMessage({target:"worker-init",width:A.canvas.width,height:A.canvas.height,URL:document.URL,currentScript:A.workerUrl,preMain:!0,renderMode:A.renderMode,subUrl:A.subUrl,subContent:A.subContent,fonts:A.fonts,availableFonts:A.availableFonts,fallbackFont:A.fallbackFont,lazyFileLoading:A.lazyFileLoading,debug:A.debug,targetFps:A.targetFps,libassMemoryLimit:A.libassMemoryLimit,libassGlyphLimit:A.libassGlyphLimit,dropAllAnimations:A.dropAllAnimations})},A.createCanvas=function(){A.canvas||(A.video?(A.isOurCanvas=!0,A.canvas=document.createElement("canvas"),A.canvas.className="libassjs-canvas",A.canvas.style.display="none",A.canvasParent=document.createElement("div"),A.canvasParent.className="libassjs-canvas-parent",A.canvasParent.appendChild(A.canvas),A.video.nextSibling?A.video.parentNode.insertBefore(A.canvasParent,A.video.nextSibling):A.video.parentNode.appendChild(A.canvasParent)):A.canvas||A.workerError("Don't know where to render: you should give video or canvas in options.")),A.ctx=A.canvas.getContext("2d"),A.bufferCanvas=document.createElement("canvas"),A.bufferCanvasCtx=A.bufferCanvas.getContext("2d"),A.bufferCanvas.width=1,A.bufferCanvas.height=1;var n=new Uint8ClampedArray([0,255,0,0]),t=new ImageData(n,1,1);A.bufferCanvasCtx.clearRect(0,0,1,1),A.ctx.clearRect(0,0,1,1);var e=A.ctx.getImageData(0,0,1,1).data;A.bufferCanvasCtx.putImageData(t,0,0),A.ctx.drawImage(A.bufferCanvas,0,0);var i=A.ctx.getImageData(0,0,1,1).data;A.hasAlphaBug=e[1]!=i[1],A.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")};function R(){A.setCurrentTime(A.video.currentTime+A.timeOffset)}function S(){A.setIsPaused(!1,A.video.currentTime+A.timeOffset)}function I(){A.setIsPaused(!0,A.video.currentTime+A.timeOffset)}function b(){A.video.removeEventListener("timeupdate",R,!1)}function T(){A.video.addEventListener("timeupdate",R,!1);var n=A.video.currentTime+A.timeOffset;A.setCurrentTime(n)}function c(){A.setRate(A.video.playbackRate)}function f(){A.setIsPaused(!0,A.video.currentTime+A.timeOffset)}function p(n){n.target.removeEventListener(n.type,p,!1),A.resize()}A.setVideo=function(n){A.video=n,A.video&&(A.video.addEventListener("timeupdate",R,!1),A.video.addEventListener("playing",S,!1),A.video.addEventListener("pause",I,!1),A.video.addEventListener("seeking",b,!1),A.video.addEventListener("seeked",T,!1),A.video.addEventListener("ratechange",c,!1),A.video.addEventListener("waiting",f,!1),document.addEventListener("fullscreenchange",A.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",A.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",A.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",A.resizeWithTimeout,!1),window.addEventListener("resize",A.resizeWithTimeout,!1),typeof ResizeObserver<"u"&&(A.ro=new ResizeObserver(A.resizeWithTimeout),A.ro.observe(A.video)),A.video.videoWidth>0?A.resize():A.video.addEventListener("loadedmetadata",p,!1))},A.getVideoPosition=function(){var n=A.video.videoWidth/A.video.videoHeight,t=A.video.offsetWidth,e=A.video.offsetHeight,i=t/e,r=t,o=e;i>n?r=Math.floor(e*n):o=Math.floor(t/n);var s=(t-r)/2,a=(e-o)/2;return{width:r,height:o,x:s,y:a}},A.setSubUrl=function(n){A.subUrl=n},A.renderFrameData=null;function l(){var n=A.renderFramesData,t=performance.now();A.ctx.clearRect(0,0,A.canvas.width,A.canvas.height);for(var e=0;e<n.canvases.length;e++){var i=n.canvases[e];A.bufferCanvas.width=i.w,A.bufferCanvas.height=i.h;var r=new Uint8ClampedArray(i.buffer);if(A.hasAlphaBug)for(var o=3;o<r.length;o=o+4)r[o]=r[o]>=1?r[o]:1;var s=new ImageData(r,i.w,i.h);A.bufferCanvasCtx.putImageData(s,0,0),A.ctx.drawImage(A.bufferCanvas,i.x,i.y)}if(A.debug){var a=Math.round(performance.now()-t),u=n.blendTime;console.log(typeof u<"u"?"render: "+Math.round(n.spentTime-u)+" ms, blend: "+Math.round(u)+" ms, draw: "+a+" ms; TOTAL="+Math.round(n.spentTime+a)+" ms":Math.round(n.spentTime)+" ms (+ "+a+" ms draw)"),A.renderStart=performance.now()}}function d(){var n=A.renderFramesData,t=performance.now();A.ctx.clearRect(0,0,A.canvas.width,A.canvas.height);for(var e=0;e<n.bitmaps.length;e++){var i=n.bitmaps[e];A.ctx.drawImage(i.bitmap,i.x,i.y)}if(A.debug){var r=Math.round(performance.now()-t);console.log(n.bitmaps.length+" bitmaps, libass: "+Math.round(n.libassTime)+"ms, decode: "+Math.round(n.decodeTime)+"ms, draw: "+r+"ms"),A.renderStart=performance.now()}}A.workerActive=!1,A.frameId=0,A.onWorkerMessage=function(n){A.workerActive||(A.workerActive=!0,A.onReadyEvent&&A.onReadyEvent());var t=n.data;switch(t.target){case"stdout":{console.log(t.content);break}case"console-log":{console.log.apply(console,JSON.parse(t.content));break}case"console-debug":{console.debug.apply(console,JSON.parse(t.content));break}case"console-info":{console.info.apply(console,JSON.parse(t.content));break}case"console-warn":{console.warn.apply(console,JSON.parse(t.content));break}case"console-error":{console.error.apply(console,JSON.parse(t.content));break}case"stderr":{console.error(t.content);break}case"window":{window[t.method]();break}case"canvas":{switch(t.op){case"getContext":{A.ctx=A.canvas.getContext(t.type,t.attributes);break}case"resize":{A.resize(t.width,t.height);break}case"renderCanvas":{A.lastRenderTime<t.time&&(A.lastRenderTime=t.time,A.renderFramesData=t,window.requestAnimationFrame(l));break}case"renderFastCanvas":{A.lastRenderTime<t.time&&(A.lastRenderTime=t.time,A.renderFramesData=t,window.requestAnimationFrame(d));break}case"setObjectProperty":{A.canvas[t.object][t.property]=t.value;break}default:throw"eh?"}break}case"tick":{A.frameId=t.id,A.worker.postMessage({target:"tock",id:A.frameId});break}case"custom":{if(A.onCustomMessage)A.onCustomMessage(n);else throw"Custom message received but client onCustomMessage not implemented.";break}case"setimmediate":{A.worker.postMessage({target:"setimmediate"});break}case"get-events":break;case"get-styles":break;case"ready":break;default:throw"what? "+t.target}};function h(n,t){var e=A.prescaleFactor<=0?1:A.prescaleFactor;if(t<=0||n<=0)n=0,t=0;else{var i=e<1?-1:1,r=t;i*r*e<=i*A.prescaleHeightLimit?r*=e:i*r<i*A.prescaleHeightLimit&&(r=A.prescaleHeightLimit),A.maxRenderHeight>0&&r>A.maxRenderHeight&&(r=A.maxRenderHeight),n*=r/t,t=r}return{width:n,height:t}}A.resize=function(n,t,e,i){var r=null;if(e=e||0,i=i||0,(!n||!t)&&A.video){r=A.getVideoPosition();var o=h(r.width*A.pixelRatio,r.height*A.pixelRatio);n=o.width,t=o.height;var s=A.canvasParent.getBoundingClientRect().top-A.video.getBoundingClientRect().top;e=r.y-s,i=r.x}if(!n||!t){A.video||console.error("width or height is 0. You should specify width & height for resize.");return}(A.canvas.width!=n||A.canvas.height!=t||A.canvas.style.top!=e||A.canvas.style.left!=i)&&(A.canvas.width=n,A.canvas.height=t,r!=null&&(A.canvasParent.style.position="relative",A.canvas.style.display="block",A.canvas.style.position="absolute",A.canvas.style.width=r.width+"px",A.canvas.style.height=r.height+"px",A.canvas.style.top=e+"px",A.canvas.style.left=i+"px",A.canvas.style.pointerEvents="none"),A.worker.postMessage({target:"canvas",width:A.canvas.width,height:A.canvas.height}))},A.resizeWithTimeout=function(){A.resize(),setTimeout(A.resize,100)},A.runBenchmark=function(){A.worker.postMessage({target:"runBenchmark"})},A.customMessage=function(n,t){t=t||{},A.worker.postMessage({target:"custom",userData:n,preMain:t.preMain})},A.setCurrentTime=function(n){A.worker.postMessage({target:"video",currentTime:n})},A.setTrackByUrl=function(n){A.worker.postMessage({target:"set-track-by-url",url:n})},A.setTrack=function(n){A.worker.postMessage({target:"set-track",content:n})},A.freeTrack=function(n){A.worker.postMessage({target:"free-track"})},A.render=A.setCurrentTime,A.setIsPaused=function(n,t){A.worker.postMessage({target:"video",isPaused:n,currentTime:t})},A.setRate=function(n){A.worker.postMessage({target:"video",rate:n})},A.dispose=function(){A.worker.postMessage({target:"destroy"}),A.worker.terminate(),A.worker.removeEventListener("message",A.onWorkerMessage),A.worker.removeEventListener("error",A.workerError),A.workerActive=!1,A.worker=null,A.video&&(A.video.removeEventListener("timeupdate",R,!1),A.video.removeEventListener("playing",S,!1),A.video.removeEventListener("pause",I,!1),A.video.removeEventListener("seeking",b,!1),A.video.removeEventListener("seeked",T,!1),A.video.removeEventListener("ratechange",c,!1),A.video.removeEventListener("waiting",f,!1),A.video.removeEventListener("loadedmetadata",p,!1),document.removeEventListener("fullscreenchange",A.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",A.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",A.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",A.resizeWithTimeout,!1),window.removeEventListener("resize",A.resizeWithTimeout,!1),A.video.parentNode.removeChild(A.canvasParent),A.video=null),A.ro&&(A.ro.disconnect(),A.ro=null),A.onCustomMessage=null,A.onErrorEvent=null,A.onReadyEvent=null},A.fetchFromWorker=function(n,t,e){try{var i=n.target,r=setTimeout(function(){s(Error("Error: Timeout while try to fetch "+i))},5e3),o=function(a){a.data.target==i&&(t(a.data),A.worker.removeEventListener("message",o),A.worker.removeEventListener("error",s),clearTimeout(r))},s=function(a){e(a),A.worker.removeEventListener("message",o),A.worker.removeEventListener("error",s),clearTimeout(r)};A.worker.addEventListener("message",o),A.worker.addEventListener("error",s),A.worker.postMessage(n)}catch(a){e(a)}},A.createEvent=function(n){A.worker.postMessage({target:"create-event",event:n})},A.getEvents=function(n,t){A.fetchFromWorker({target:"get-events"},function(e){n(e.events)},t)},A.setEvent=function(n,t){A.worker.postMessage({target:"set-event",event:n,index:t})},A.removeEvent=function(n){A.worker.postMessage({target:"remove-event",index:n})},A.createStyle=function(n){A.worker.postMessage({target:"create-style",style:n})},A.getStyles=function(n,t){A.fetchFromWorker({target:"get-styles"},function(e){n(e.styles)},t)},A.setStyle=function(n,t){A.worker.postMessage({target:"set-style",style:n,index:t})},A.removeStyle=function(n){A.worker.postMessage({target:"remove-style",index:n})},A.init()};typeof SubtitlesOctopusOnLoad=="function"&&SubtitlesOctopusOnLoad(),ye.exports&&(ye.exports=j)})(Ve);const xt=Ve.exports,Tt= window.__dynamic_base__+"/assets/subtitles-octopus-worker-legacy.b6ac3ec1.js",St= window.__dynamic_base__+"/assets/subtitles-octopus-worker.f95f2186.js",Lt= window.__dynamic_base__+"/assets/TimesNewRoman.d9fb32eb.ttf",At= window.__dynamic_base__+"/assets/SourceHanSansCN-Bold.b5627435.woff2";let Se=null;function ke(ye){Se.canvasParent&&(Se.canvasParent.style.display=ye?"block":"none")}function Dt(ye){return _e=>(Se=new xt({availableFonts:{"times new roman":Lt},fallbackFont:At,legacyWorkerUrl:Tt,workerUrl:St,video:_e.template.$video,...ye}),Se.canvasParent.className="artplayer-plugin-ass",Se.canvasParent.style.cssText=`
      position: absolute;
      width: 100%;
      height: 100%;
      user-select: none;
      pointer-events: none;
      z-index: 20;
    `,_e.on("artplayer-plugin-ass:switch",j=>{Se.freeTrack(),Se.setTrackByUrl(j),ke(!0)}),_e.on("subtitle",j=>ke(j)),_e.on("artplayer-plugin-ass:visible",j=>ke(j)),_e.on("subtitleOffset",j=>Se.timeOffset=j),_e.on("destroy",()=>Se.dispose()),{name:"artplayerPluginAss",instance:Se})}var ze={exports:{}};(function(ye,_e){(function(P,D){ye.exports=D()})(self,function(){return function(){var j={"./node_modules/es6-promise/dist/es6-promise.js":function(R,S,I){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(b,T){R.exports=T()})(this,function(){function b(W){var Y=typeof W;return W!==null&&(Y==="object"||Y==="function")}function T(W){return typeof W=="function"}var c=void 0;Array.isArray?c=Array.isArray:c=function(W){return Object.prototype.toString.call(W)==="[object Array]"};var f=c,p=0,l=void 0,d=void 0,h=function(Y,$){y[p]=Y,y[p+1]=$,p+=2,p===2&&(d?d(v):x())};function n(W){d=W}function t(W){h=W}var e=typeof window<"u"?window:void 0,i=e||{},r=i.MutationObserver||i.WebKitMutationObserver,o=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",s=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function a(){return function(){return process.nextTick(v)}}function u(){return typeof l<"u"?function(){l(v)}:m()}function _(){var W=0,Y=new r(v),$=document.createTextNode("");return Y.observe($,{characterData:!0}),function(){$.data=W=++W%2}}function g(){var W=new MessageChannel;return W.port1.onmessage=v,function(){return W.port2.postMessage(0)}}function m(){var W=setTimeout;return function(){return W(v,1)}}var y=new Array(1e3);function v(){for(var W=0;W<p;W+=2){var Y=y[W],$=y[W+1];Y($),y[W]=void 0,y[W+1]=void 0}p=0}function E(){try{var W=Function("return this")().require("vertx");return l=W.runOnLoop||W.runOnContext,u()}catch{return m()}}var x=void 0;o?x=a():r?x=_():s?x=g():e===void 0?x=E():x=m();function L(W,Y){var $=this,Q=new this.constructor(F);Q[C]===void 0&&ue(Q);var ee=$._state;if(ee){var te=arguments[ee-1];h(function(){return re(ee,Q,te,$._result)})}else X($,Q,W,Y);return Q}function O(W){var Y=this;if(W&&typeof W=="object"&&W.constructor===Y)return W;var $=new Y(F);return G($,W),$}var C=Math.random().toString(36).substring(2);function F(){}var M=void 0,B=1,k=2;function w(){return new TypeError("You cannot resolve a promise with itself")}function U(){return new TypeError("A promises callback cannot return that same promise.")}function N(W,Y,$,Q){try{W.call(Y,$,Q)}catch(ee){return ee}}function K(W,Y,$){h(function(Q){var ee=!1,te=N($,Y,function(le){ee||(ee=!0,Y!==le?G(Q,le):Z(Q,le))},function(le){ee||(ee=!0,V(Q,le))},"Settle: "+(Q._label||" unknown promise"));!ee&&te&&(ee=!0,V(Q,te))},W)}function H(W,Y){Y._state===B?Z(W,Y._result):Y._state===k?V(W,Y._result):X(Y,void 0,function($){return G(W,$)},function($){return V(W,$)})}function z(W,Y,$){Y.constructor===W.constructor&&$===L&&Y.constructor.resolve===O?H(W,Y):$===void 0?Z(W,Y):T($)?K(W,Y,$):Z(W,Y)}function G(W,Y){if(W===Y)V(W,w());else if(b(Y)){var $=void 0;try{$=Y.then}catch(Q){V(W,Q);return}z(W,Y,$)}else Z(W,Y)}function q(W){W._onerror&&W._onerror(W._result),J(W)}function Z(W,Y){W._state===M&&(W._result=Y,W._state=B,W._subscribers.length!==0&&h(J,W))}function V(W,Y){W._state===M&&(W._state=k,W._result=Y,h(q,W))}function X(W,Y,$,Q){var ee=W._subscribers,te=ee.length;W._onerror=null,ee[te]=Y,ee[te+B]=$,ee[te+k]=Q,te===0&&W._state&&h(J,W)}function J(W){var Y=W._subscribers,$=W._state;if(Y.length!==0){for(var Q=void 0,ee=void 0,te=W._result,le=0;le<Y.length;le+=3)Q=Y[le],ee=Y[le+$],Q?re($,Q,ee,te):ee(te);W._subscribers.length=0}}function re(W,Y,$,Q){var ee=T($),te=void 0,le=void 0,Ee=!0;if(ee){try{te=$(Q)}catch(he){Ee=!1,le=he}if(Y===te){V(Y,U());return}}else te=Q;Y._state!==M||(ee&&Ee?G(Y,te):Ee===!1?V(Y,le):W===B?Z(Y,te):W===k&&V(Y,te))}function ie(W,Y){try{Y(function(Q){G(W,Q)},function(Q){V(W,Q)})}catch($){V(W,$)}}var ne=0;function ae(){return ne++}function ue(W){W[C]=ne++,W._state=void 0,W._result=void 0,W._subscribers=[]}function oe(){return new Error("Array Methods must be provided an Array")}var se=function(){function W(Y,$){this._instanceConstructor=Y,this.promise=new Y(F),this.promise[C]||ue(this.promise),f($)?(this.length=$.length,this._remaining=$.length,this._result=new Array(this.length),this.length===0?Z(this.promise,this._result):(this.length=this.length||0,this._enumerate($),this._remaining===0&&Z(this.promise,this._result))):V(this.promise,oe())}return W.prototype._enumerate=function($){for(var Q=0;this._state===M&&Q<$.length;Q++)this._eachEntry($[Q],Q)},W.prototype._eachEntry=function($,Q){var ee=this._instanceConstructor,te=ee.resolve;if(te===O){var le=void 0,Ee=void 0,he=!1;try{le=$.then}catch(Te){he=!0,Ee=Te}if(le===L&&$._state!==M)this._settledAt($._state,Q,$._result);else if(typeof le!="function")this._remaining--,this._result[Q]=$;else if(ee===fe){var ge=new ee(F);he?V(ge,Ee):z(ge,$,le),this._willSettleAt(ge,Q)}else this._willSettleAt(new ee(function(Te){return Te($)}),Q)}else this._willSettleAt(te($),Q)},W.prototype._settledAt=function($,Q,ee){var te=this.promise;te._state===M&&(this._remaining--,$===k?V(te,ee):this._result[Q]=ee),this._remaining===0&&Z(te,this._result)},W.prototype._willSettleAt=function($,Q){var ee=this;X($,void 0,function(te){return ee._settledAt(B,Q,te)},function(te){return ee._settledAt(k,Q,te)})},W}();function de(W){return new se(this,W).promise}function ce(W){var Y=this;return f(W)?new Y(function($,Q){for(var ee=W.length,te=0;te<ee;te++)Y.resolve(W[te]).then($,Q)}):new Y(function($,Q){return Q(new TypeError("You must pass an array to race."))})}function pe(W){var Y=this,$=new Y(F);return V($,W),$}function ve(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function xe(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var fe=function(){function W(Y){this[C]=ae(),this._result=this._state=void 0,this._subscribers=[],F!==Y&&(typeof Y!="function"&&ve(),this instanceof W?ie(this,Y):xe())}return W.prototype.catch=function($){return this.then(null,$)},W.prototype.finally=function($){var Q=this,ee=Q.constructor;return T($)?Q.then(function(te){return ee.resolve($()).then(function(){return te})},function(te){return ee.resolve($()).then(function(){throw te})}):Q.then($,$)},W}();fe.prototype.then=L,fe.all=de,fe.race=ce,fe.resolve=O,fe.reject=pe,fe._setScheduler=n,fe._setAsap=t,fe._asap=h;function me(){var W=void 0;if(typeof I.g<"u")W=I.g;else if(typeof self<"u")W=self;else try{W=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var Y=W.Promise;if(Y){var $=null;try{$=Object.prototype.toString.call(Y.resolve())}catch{}if($==="[object Promise]"&&!Y.cast)return}W.Promise=fe}return fe.polyfill=me,fe.Promise=fe,fe})},"./node_modules/events/events.js":function(R){var S=typeof Reflect=="object"?Reflect:null,I=S&&typeof S.apply=="function"?S.apply:function(m,y,v){return Function.prototype.apply.call(m,y,v)},b;S&&typeof S.ownKeys=="function"?b=S.ownKeys:Object.getOwnPropertySymbols?b=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:b=function(m){return Object.getOwnPropertyNames(m)};function T(g){console&&console.warn&&console.warn(g)}var c=Number.isNaN||function(m){return m!==m};function f(){f.init.call(this)}R.exports=f,R.exports.once=a,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var p=10;function l(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(g){if(typeof g!="number"||g<0||c(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");p=g}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||c(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function d(g){return g._maxListeners===void 0?f.defaultMaxListeners:g._maxListeners}f.prototype.getMaxListeners=function(){return d(this)},f.prototype.emit=function(m){for(var y=[],v=1;v<arguments.length;v++)y.push(arguments[v]);var E=m==="error",x=this._events;if(x!==void 0)E=E&&x.error===void 0;else if(!E)return!1;if(E){var L;if(y.length>0&&(L=y[0]),L instanceof Error)throw L;var O=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw O.context=L,O}var C=x[m];if(C===void 0)return!1;if(typeof C=="function")I(C,this,y);else for(var F=C.length,M=r(C,F),v=0;v<F;++v)I(M[v],this,y);return!0};function h(g,m,y,v){var E,x,L;if(l(y),x=g._events,x===void 0?(x=g._events=Object.create(null),g._eventsCount=0):(x.newListener!==void 0&&(g.emit("newListener",m,y.listener?y.listener:y),x=g._events),L=x[m]),L===void 0)L=x[m]=y,++g._eventsCount;else if(typeof L=="function"?L=x[m]=v?[y,L]:[L,y]:v?L.unshift(y):L.push(y),E=d(g),E>0&&L.length>E&&!L.warned){L.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=g,O.type=m,O.count=L.length,T(O)}return g}f.prototype.addListener=function(m,y){return h(this,m,y,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(m,y){return h(this,m,y,!0)};function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(g,m,y){var v={fired:!1,wrapFn:void 0,target:g,type:m,listener:y},E=n.bind(v);return E.listener=y,v.wrapFn=E,E}f.prototype.once=function(m,y){return l(y),this.on(m,t(this,m,y)),this},f.prototype.prependOnceListener=function(m,y){return l(y),this.prependListener(m,t(this,m,y)),this},f.prototype.removeListener=function(m,y){var v,E,x,L,O;if(l(y),E=this._events,E===void 0)return this;if(v=E[m],v===void 0)return this;if(v===y||v.listener===y)--this._eventsCount===0?this._events=Object.create(null):(delete E[m],E.removeListener&&this.emit("removeListener",m,v.listener||y));else if(typeof v!="function"){for(x=-1,L=v.length-1;L>=0;L--)if(v[L]===y||v[L].listener===y){O=v[L].listener,x=L;break}if(x<0)return this;x===0?v.shift():o(v,x),v.length===1&&(E[m]=v[0]),E.removeListener!==void 0&&this.emit("removeListener",m,O||y)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(m){var y,v,E;if(v=this._events,v===void 0)return this;if(v.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):v[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete v[m]),this;if(arguments.length===0){var x=Object.keys(v),L;for(E=0;E<x.length;++E)L=x[E],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(y=v[m],typeof y=="function")this.removeListener(m,y);else if(y!==void 0)for(E=y.length-1;E>=0;E--)this.removeListener(m,y[E]);return this};function e(g,m,y){var v=g._events;if(v===void 0)return[];var E=v[m];return E===void 0?[]:typeof E=="function"?y?[E.listener||E]:[E]:y?s(E):r(E,E.length)}f.prototype.listeners=function(m){return e(this,m,!0)},f.prototype.rawListeners=function(m){return e(this,m,!1)},f.listenerCount=function(g,m){return typeof g.listenerCount=="function"?g.listenerCount(m):i.call(g,m)},f.prototype.listenerCount=i;function i(g){var m=this._events;if(m!==void 0){var y=m[g];if(typeof y=="function")return 1;if(y!==void 0)return y.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]};function r(g,m){for(var y=new Array(m),v=0;v<m;++v)y[v]=g[v];return y}function o(g,m){for(;m+1<g.length;m++)g[m]=g[m+1];g.pop()}function s(g){for(var m=new Array(g.length),y=0;y<m.length;++y)m[y]=g[y].listener||g[y];return m}function a(g,m){return new Promise(function(y,v){function E(L){g.removeListener(m,x),v(L)}function x(){typeof g.removeListener=="function"&&g.removeListener("error",E),y([].slice.call(arguments))}_(g,m,x,{once:!0}),m!=="error"&&u(g,E,{once:!0})})}function u(g,m,y){typeof g.on=="function"&&_(g,"error",m,y)}function _(g,m,y,v){if(typeof g.on=="function")v.once?g.once(m,y):g.on(m,y);else if(typeof g.addEventListener=="function")g.addEventListener(m,function E(x){v.once&&g.removeEventListener(m,E),y(x)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}},"./node_modules/webworkify-webpack/index.js":function(R,S,I){function b(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=n,e.c=t,e.i=function(r){return r},e.d=function(r,o,s){e.o(r,o)||Object.defineProperty(r,o,{configurable:!1,enumerable:!0,get:s})},e.r=function(r){Object.defineProperty(r,"__esModule",{value:!0})},e.n=function(r){var o=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(o,"a",o),o},e.o=function(r,o){return Object.prototype.hasOwnProperty.call(r,o)},e.p="/",e.oe=function(r){throw console.error(r),r};var i=e(e.s=ENTRY_MODULE);return i.default||i}var T="[\\.|\\-|\\+|\\w|/|@]+",c="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+T+").*?\\)";function f(n){return(n+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function p(n){return!isNaN(1*n)}function l(n,t,e){var i={};i[e]=[];var r=t.toString(),o=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return i;for(var s=o[1],a=new RegExp("(\\\\n|\\W)"+f(s)+c,"g"),u;u=a.exec(r);)u[3]!=="dll-reference"&&i[e].push(u[3]);for(a=new RegExp("\\("+f(s)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+c,"g");u=a.exec(r);)n[u[2]]||(i[e].push(u[1]),n[u[2]]=I(u[1]).m),i[u[2]]=i[u[2]]||[],i[u[2]].push(u[4]);for(var _=Object.keys(i),g=0;g<_.length;g++)for(var m=0;m<i[_[g]].length;m++)p(i[_[g]][m])&&(i[_[g]][m]=1*i[_[g]][m]);return i}function d(n){var t=Object.keys(n);return t.reduce(function(e,i){return e||n[i].length>0},!1)}function h(n,t){for(var e={main:[t]},i={main:[]},r={main:{}};d(e);)for(var o=Object.keys(e),s=0;s<o.length;s++){var a=o[s],u=e[a],_=u.pop();if(r[a]=r[a]||{},!(r[a][_]||!n[a][_])){r[a][_]=!0,i[a]=i[a]||[],i[a].push(_);for(var g=l(n,n[a][_],a),m=Object.keys(g),y=0;y<m.length;y++)e[m[y]]=e[m[y]]||[],e[m[y]]=e[m[y]].concat(g[m[y]])}}return i}R.exports=function(n,t){t=t||{};var e={main:I.m},i=t.all?{main:Object.keys(e.main)}:h(e,n),r="";Object.keys(i).filter(function(_){return _!=="main"}).forEach(function(_){for(var g=0;i[_][g];)g++;i[_].push(g),e[_][g]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+_+" = ("+b.toString().replace("ENTRY_MODULE",JSON.stringify(g))+")({"+i[_].map(function(m){return""+JSON.stringify(m)+": "+e[_][m].toString()}).join(",")+`});
`}),r=r+"new (("+b.toString().replace("ENTRY_MODULE",JSON.stringify(n))+")({"+i.main.map(function(_){return""+JSON.stringify(_)+": "+e.main[_].toString()}).join(",")+"}))(self);";var o=new window.Blob([r],{type:"text/javascript"});if(t.bare)return o;var s=window.URL||window.webkitURL||window.mozURL||window.msURL,a=s.createObjectURL(o),u=new window.Worker(a);return u.objectURL=a,u}},"./src/config.js":function(R,S,I){I.r(S),I.d(S,{defaultConfig:function(){return b},createDefaultConfig:function(){return T}});var b={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function T(){return Object.assign({},b)}},"./src/core/features.js":function(R,S,I){I.r(S);var b=I("./src/io/io-controller.js"),T=I("./src/config.js"),c=function(){function f(){}return f.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},f.supportNetworkStreamIO=function(){var p=new b.default({},(0,T.createDefaultConfig)()),l=p.loaderType;return p.destroy(),l=="fetch-stream-loader"||l=="xhr-moz-chunked-loader"},f.getNetworkLoaderTypeName=function(){var p=new b.default({},(0,T.createDefaultConfig)()),l=p.loaderType;return p.destroy(),l},f.supportNativeMediaPlayback=function(p){f.videoElement==null&&(f.videoElement=window.document.createElement("video"));var l=f.videoElement.canPlayType(p);return l==="probably"||l=="maybe"},f.getFeatureList=function(){var p={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return p.mseFlvPlayback=f.supportMSEH264Playback(),p.networkStreamIO=f.supportNetworkStreamIO(),p.networkLoaderName=f.getNetworkLoaderTypeName(),p.mseLiveFlvPlayback=p.mseFlvPlayback&&p.networkStreamIO,p.nativeMP4H264Playback=f.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),p.nativeWebmVP8Playback=f.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),p.nativeWebmVP9Playback=f.supportNativeMediaPlayback('video/webm; codecs="vp9"'),p},f}();S.default=c},"./src/core/media-info.js":function(R,S,I){I.r(S);var b=function(){function T(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return T.prototype.isComplete=function(){var c=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,f=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&c&&f},T.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},T.prototype.getNearestKeyframe=function(c){if(this.keyframesIndex==null)return null;var f=this.keyframesIndex,p=this._search(f.times,c);return{index:p,milliseconds:f.times[p],fileposition:f.filepositions[p]}},T.prototype._search=function(c,f){var p=0,l=c.length-1,d=0,h=0,n=l;for(f<c[0]&&(p=0,h=n+1);h<=n;)if(d=h+Math.floor((n-h)/2),d===l||f>=c[d]&&f<c[d+1]){p=d;break}else c[d]<f?h=d+1:n=d-1;return p},T}();S.default=b},"./src/core/media-segment-info.js":function(R,S,I){I.r(S),I.d(S,{SampleInfo:function(){return b},MediaSegmentInfo:function(){return T},IDRSampleList:function(){return c},MediaSegmentInfoList:function(){return f}});var b=function(){function p(l,d,h,n,t){this.dts=l,this.pts=d,this.duration=h,this.originalDts=n,this.isSyncPoint=t,this.fileposition=null}return p}(),T=function(){function p(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return p.prototype.appendSyncPoint=function(l){l.isSyncPoint=!0,this.syncPoints.push(l)},p}(),c=function(){function p(){this._list=[]}return p.prototype.clear=function(){this._list=[]},p.prototype.appendArray=function(l){var d=this._list;l.length!==0&&(d.length>0&&l[0].originalDts<d[d.length-1].originalDts&&this.clear(),Array.prototype.push.apply(d,l))},p.prototype.getLastSyncPointBeforeDts=function(l){if(this._list.length==0)return null;var d=this._list,h=0,n=d.length-1,t=0,e=0,i=n;for(l<d[0].dts&&(h=0,e=i+1);e<=i;)if(t=e+Math.floor((i-e)/2),t===n||l>=d[t].dts&&l<d[t+1].dts){h=t;break}else d[t].dts<l?e=t+1:i=t-1;return this._list[h]},p}(),f=function(){function p(l){this._type=l,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(p.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),p.prototype.isEmpty=function(){return this._list.length===0},p.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},p.prototype._searchNearestSegmentBefore=function(l){var d=this._list;if(d.length===0)return-2;var h=d.length-1,n=0,t=0,e=h,i=0;if(l<d[0].originalBeginDts)return i=-1,i;for(;t<=e;)if(n=t+Math.floor((e-t)/2),n===h||l>d[n].lastSample.originalDts&&l<d[n+1].originalBeginDts){i=n;break}else d[n].originalBeginDts<l?t=n+1:e=n-1;return i},p.prototype._searchNearestSegmentAfter=function(l){return this._searchNearestSegmentBefore(l)+1},p.prototype.append=function(l){var d=this._list,h=l,n=this._lastAppendLocation,t=0;n!==-1&&n<d.length&&h.originalBeginDts>=d[n].lastSample.originalDts&&(n===d.length-1||n<d.length-1&&h.originalBeginDts<d[n+1].originalBeginDts)?t=n+1:d.length>0&&(t=this._searchNearestSegmentBefore(h.originalBeginDts)+1),this._lastAppendLocation=t,this._list.splice(t,0,h)},p.prototype.getLastSegmentBefore=function(l){var d=this._searchNearestSegmentBefore(l);return d>=0?this._list[d]:null},p.prototype.getLastSampleBefore=function(l){var d=this.getLastSegmentBefore(l);return d!=null?d.lastSample:null},p.prototype.getLastSyncPointBefore=function(l){for(var d=this._searchNearestSegmentBefore(l),h=this._list[d].syncPoints;h.length===0&&d>0;)d--,h=this._list[d].syncPoints;return h.length>0?h[h.length-1]:null},p}()},"./src/core/mse-controller.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=I("./src/utils/logger.js"),f=I("./src/utils/browser.js"),p=I("./src/core/mse-events.js"),l=I("./src/core/media-segment-info.js"),d=I("./src/utils/exception.js"),h=function(){function n(t){this.TAG="MSEController",this._config=t,this._emitter=new(T()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new l.IDRSampleList}return n.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(t,e){this._emitter.addListener(t,e)},n.prototype.off=function(t,e){this._emitter.removeListener(t,e)},n.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new d.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},n.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var e in this._sourceBuffers){var i=this._pendingSegments[e];i.splice(0,i.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var r=this._sourceBuffers[e];if(r){if(t.readyState!=="closed"){try{t.removeSourceBuffer(r)}catch(o){c.default.e(this.TAG,o.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[e]=null,this._sourceBuffers[e]=null}}if(t.readyState==="open")try{t.endOfStream()}catch(o){c.default.e(this.TAG,o.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},n.prototype.appendInitSegment=function(t,e){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t),this._pendingSegments[t.type].push(t);return}var i=t,r=""+i.container;i.codec&&i.codec.length>0&&(r+=";codecs="+i.codec);var o=!1;if(c.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[i.type]=i,r!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])c.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+r);else{o=!0;try{var s=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(r);s.addEventListener("error",this.e.onSourceBufferError),s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(a){c.default.e(this.TAG,a.message),this._emitter.emit(p.default.ERROR,{code:a.code,msg:a.message});return}}this._mimeTypes[i.type]=r}e||this._pendingSegments[i.type].push(i),o||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),f.default.safari&&i.container==="audio/mpeg"&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())},n.prototype.appendMediaSegment=function(t){var e=t;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[e.type];i&&!i.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},n.prototype.seek=function(t){for(var e in this._sourceBuffers)if(!!this._sourceBuffers[e]){var i=this._sourceBuffers[e];if(this._mediaSource.readyState==="open")try{i.abort()}catch(_){c.default.e(this.TAG,_.message)}this._idrList.clear();var r=this._pendingSegments[e];if(r.splice(0,r.length),this._mediaSource.readyState!=="closed"){for(var o=0;o<i.buffered.length;o++){var s=i.buffered.start(o),a=i.buffered.end(o);this._pendingRemoveRanges[e].push({start:s,end:a})}if(i.updating||this._doRemoveRanges(),f.default.safari){var u=this._lastInitSegments[e];u&&(this._pendingSegments[e].push(u),i.updating||this._doAppendSegments())}}}},n.prototype.endOfStream=function(){var t=this._mediaSource,e=this._sourceBuffers;if(!t||t.readyState!=="open"){t&&t.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())},n.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},n.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var i=this._sourceBuffers[e];if(i){var r=i.buffered;if(r.length>=1&&t-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},n.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var i=this._sourceBuffers[e];if(i){for(var r=i.buffered,o=!1,s=0;s<r.length;s++){var a=r.start(s),u=r.end(s);if(a<=t&&t<u+3){if(t-a>=this._config.autoCleanupMaxBackwardDuration){o=!0;var _=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[e].push({start:a,end:_})}}else u<t&&(o=!0,this._pendingRemoveRanges[e].push({start:a,end:u}))}o&&!i.updating&&this._doRemoveRanges()}}},n.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var e=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(e)||i>e)&&(c.default.v(this.TAG,"Update MediaSource duration from "+e+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},n.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(!(!this._sourceBuffers[t]||this._sourceBuffers[t].updating))for(var e=this._sourceBuffers[t],i=this._pendingRemoveRanges[t];i.length&&!e.updating;){var r=i.shift();e.remove(r.start,r.end)}},n.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var e in t)if(!(!this._sourceBuffers[e]||this._sourceBuffers[e].updating)&&t[e].length>0){var i=t[e].shift();if(i.timestampOffset){var r=this._sourceBuffers[e].timestampOffset,o=i.timestampOffset/1e3,s=Math.abs(r-o);s>.1&&(c.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+o),this._sourceBuffers[e].timestampOffset=o),delete i.timestampOffset}if(!i.data||i.data.byteLength===0)continue;try{this._sourceBuffers[e].appendBuffer(i.data),this._isBufferFull=!1,e==="video"&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(a){this._pendingSegments[e].unshift(i),a.code===22?(this._isBufferFull||this._emitter.emit(p.default.BUFFER_FULL),this._isBufferFull=!0):(c.default.e(this.TAG,a.message),this._emitter.emit(p.default.ERROR,{code:a.code,msg:a.message}))}}},n.prototype._onSourceOpen=function(){if(c.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(p.default.SOURCE_OPEN)},n.prototype._onSourceEnded=function(){c.default.v(this.TAG,"MediaSource onSourceEnded")},n.prototype._onSourceClose=function(){c.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},n.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},n.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},n.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(p.default.UPDATE_END)},n.prototype._onSourceBufferError=function(t){c.default.e(this.TAG,"SourceBuffer Error: "+t)},n}();S.default=h},"./src/core/mse-events.js":function(R,S,I){I.r(S);var b={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};S.default=b},"./src/core/transmuxer.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=I("./node_modules/webworkify-webpack/index.js"),f=I.n(c),p=I("./src/utils/logger.js"),l=I("./src/utils/logging-control.js"),d=I("./src/core/transmuxing-controller.js"),h=I("./src/core/transmuxing-events.js"),n=I("./src/core/media-info.js"),t=function(){function e(i,r){if(this.TAG="Transmuxer",this._emitter=new(T()),r.enableWorker&&typeof Worker<"u")try{this._worker=f()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[i,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch{p.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new d.default(i,r)}else this._controller=new d.default(i,r);if(this._controller){var o=this._controller;o.on(h.default.IO_ERROR,this._onIOError.bind(this)),o.on(h.default.DEMUX_ERROR,this._onDemuxError.bind(this)),o.on(h.default.INIT_SEGMENT,this._onInitSegment.bind(this)),o.on(h.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),o.on(h.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),o.on(h.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),o.on(h.default.MEDIA_INFO,this._onMediaInfo.bind(this)),o.on(h.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),o.on(h.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),o.on(h.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),o.on(h.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(i,r){this._emitter.addListener(i,r)},e.prototype.off=function(i,r){this._emitter.removeListener(i,r)},e.prototype.hasWorker=function(){return this._worker!=null},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(i){this._worker?this._worker.postMessage({cmd:"seek",param:i}):this._controller.seek(i)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(i,r){var o=this;Promise.resolve().then(function(){o._emitter.emit(h.default.INIT_SEGMENT,i,r)})},e.prototype._onMediaSegment=function(i,r){var o=this;Promise.resolve().then(function(){o._emitter.emit(h.default.MEDIA_SEGMENT,i,r)})},e.prototype._onLoadingComplete=function(){var i=this;Promise.resolve().then(function(){i._emitter.emit(h.default.LOADING_COMPLETE)})},e.prototype._onRecoveredEarlyEof=function(){var i=this;Promise.resolve().then(function(){i._emitter.emit(h.default.RECOVERED_EARLY_EOF)})},e.prototype._onMediaInfo=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.MEDIA_INFO,i)})},e.prototype._onMetaDataArrived=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.METADATA_ARRIVED,i)})},e.prototype._onScriptDataArrived=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.SCRIPTDATA_ARRIVED,i)})},e.prototype._onStatisticsInfo=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.STATISTICS_INFO,i)})},e.prototype._onIOError=function(i,r){var o=this;Promise.resolve().then(function(){o._emitter.emit(h.default.IO_ERROR,i,r)})},e.prototype._onDemuxError=function(i,r){var o=this;Promise.resolve().then(function(){o._emitter.emit(h.default.DEMUX_ERROR,i,r)})},e.prototype._onRecommendSeekpoint=function(i){var r=this;Promise.resolve().then(function(){r._emitter.emit(h.default.RECOMMEND_SEEKPOINT,i)})},e.prototype._onLoggingConfigChanged=function(i){this._worker&&this._worker.postMessage({cmd:"logging_config",param:i})},e.prototype._onWorkerMessage=function(i){var r=i.data,o=r.data;if(r.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(r.msg){case h.default.INIT_SEGMENT:case h.default.MEDIA_SEGMENT:this._emitter.emit(r.msg,o.type,o.data);break;case h.default.LOADING_COMPLETE:case h.default.RECOVERED_EARLY_EOF:this._emitter.emit(r.msg);break;case h.default.MEDIA_INFO:Object.setPrototypeOf(o,n.default.prototype),this._emitter.emit(r.msg,o);break;case h.default.METADATA_ARRIVED:case h.default.SCRIPTDATA_ARRIVED:case h.default.STATISTICS_INFO:this._emitter.emit(r.msg,o);break;case h.default.IO_ERROR:case h.default.DEMUX_ERROR:this._emitter.emit(r.msg,o.type,o.info);break;case h.default.RECOMMEND_SEEKPOINT:this._emitter.emit(r.msg,o);break;case"logcat_callback":p.default.emitter.emit("log",o.type,o.logcat);break}},e}();S.default=t},"./src/core/transmuxing-controller.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=I("./src/utils/logger.js"),f=I("./src/utils/browser.js"),p=I("./src/core/media-info.js"),l=I("./src/demux/flv-demuxer.js"),d=I("./src/remux/mp4-remuxer.js"),h=I("./src/demux/demux-errors.js"),n=I("./src/io/io-controller.js"),t=I("./src/core/transmuxing-events.js"),e=function(){function i(r,o){this.TAG="TransmuxingController",this._emitter=new(T()),this._config=o,r.segments||(r.segments=[{duration:r.duration,filesize:r.filesize,url:r.url}]),typeof r.cors!="boolean"&&(r.cors=!0),typeof r.withCredentials!="boolean"&&(r.withCredentials=!1),this._mediaDataSource=r,this._currentSegmentIndex=0;var s=0;this._mediaDataSource.segments.forEach(function(a){a.timestampBase=s,s+=a.duration,a.cors=r.cors,a.withCredentials=r.withCredentials,o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy)}),!isNaN(s)&&this._mediaDataSource.duration!==s&&(this._mediaDataSource.duration=s),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return i.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},i.prototype.on=function(r,o){this._emitter.addListener(r,o)},i.prototype.off=function(r,o){this._emitter.removeListener(r,o)},i.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},i.prototype._loadSegment=function(r,o){this._currentSegmentIndex=r;var s=this._mediaDataSource.segments[r],a=this._ioctl=new n.default(s,this._config,r);a.onError=this._onIOException.bind(this),a.onSeeked=this._onIOSeeked.bind(this),a.onComplete=this._onIOComplete.bind(this),a.onRedirect=this._onIORedirect.bind(this),a.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),o?this._demuxer.bindDataSource(this._ioctl):a.onDataArrival=this._onInitChunkArrival.bind(this),a.open(o)},i.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},i.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},i.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},i.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},i.prototype.seek=function(r){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var o=this._searchSegmentIndexContains(r);if(o===this._currentSegmentIndex){var s=this._mediaInfo.segments[o];if(s==null)this._pendingSeekTime=r;else{var a=s.getNearestKeyframe(r);this._remuxer.seek(a.milliseconds),this._ioctl.seek(a.fileposition),this._pendingResolveSeekPoint=a.milliseconds}}else{var u=this._mediaInfo.segments[o];if(u==null)this._pendingSeekTime=r,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(o);else{var a=u.getNearestKeyframe(r);this._internalAbort(),this._remuxer.seek(r),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[o].timestampBase,this._loadSegment(o,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(o)}}this._enableStatisticsReporter()}},i.prototype._searchSegmentIndexContains=function(r){for(var o=this._mediaDataSource.segments,s=o.length-1,a=0;a<o.length;a++)if(r<o[a].timestampBase){s=a-1;break}return s},i.prototype._onInitChunkArrival=function(r,o){var s=this,a=null,u=0;if(o>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,u=this._demuxer.parseChunks(r,o);else if((a=l.default.probe(r)).match){this._demuxer=new l.default(a,this._config),this._remuxer||(this._remuxer=new d.default(this._config));var _=this._mediaDataSource;_.duration!=null&&!isNaN(_.duration)&&(this._demuxer.overridedDuration=_.duration),typeof _.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=_.hasAudio),typeof _.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=_.hasVideo),this._demuxer.timestampBase=_.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),u=this._demuxer.parseChunks(r,o)}else a=null,c.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){s._internalAbort()}),this._emitter.emit(t.default.DEMUX_ERROR,h.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),u=0;return u},i.prototype._onMediaInfo=function(r){var o=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},r),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,p.default.prototype));var s=Object.assign({},r);Object.setPrototypeOf(s,p.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=s,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var a=o._pendingSeekTime;o._pendingSeekTime=null,o.seek(a)})},i.prototype._onMetaDataArrived=function(r){this._emitter.emit(t.default.METADATA_ARRIVED,r)},i.prototype._onScriptDataArrived=function(r){this._emitter.emit(t.default.SCRIPTDATA_ARRIVED,r)},i.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},i.prototype._onIOComplete=function(r){var o=r,s=o+1;s<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(s)):(this._remuxer.flushStashedSamples(),this._emitter.emit(t.default.LOADING_COMPLETE),this._disableStatisticsReporter())},i.prototype._onIORedirect=function(r){var o=this._ioctl.extraData;this._mediaDataSource.segments[o].redirectedURL=r},i.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(t.default.RECOVERED_EARLY_EOF)},i.prototype._onIOException=function(r,o){c.default.e(this.TAG,"IOException: type = "+r+", code = "+o.code+", msg = "+o.msg),this._emitter.emit(t.default.IO_ERROR,r,o),this._disableStatisticsReporter()},i.prototype._onDemuxException=function(r,o){c.default.e(this.TAG,"DemuxException: type = "+r+", info = "+o),this._emitter.emit(t.default.DEMUX_ERROR,r,o)},i.prototype._onRemuxerInitSegmentArrival=function(r,o){this._emitter.emit(t.default.INIT_SEGMENT,r,o)},i.prototype._onRemuxerMediaSegmentArrival=function(r,o){if(this._pendingSeekTime==null&&(this._emitter.emit(t.default.MEDIA_SEGMENT,r,o),this._pendingResolveSeekPoint!=null&&r==="video")){var s=o.info.syncPoints,a=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,f.default.safari&&s.length>0&&s[0].originalDts===a&&(a=s[0].pts),this._emitter.emit(t.default.RECOMMEND_SEEKPOINT,a)}},i.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},i.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},i.prototype._reportSegmentMediaInfo=function(r){var o=this._mediaInfo.segments[r],s=Object.assign({},o);s.duration=this._mediaInfo.duration,s.segmentCount=this._mediaInfo.segmentCount,delete s.segments,delete s.keyframesIndex,this._emitter.emit(t.default.MEDIA_INFO,s)},i.prototype._reportStatisticsInfo=function(){var r={};r.url=this._ioctl.currentURL,r.hasRedirect=this._ioctl.hasRedirect,r.hasRedirect&&(r.redirectedURL=this._ioctl.currentRedirectedURL),r.speed=this._ioctl.currentSpeed,r.loaderType=this._ioctl.loaderType,r.currentSegmentIndex=this._currentSegmentIndex,r.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(t.default.STATISTICS_INFO,r)},i}();S.default=e},"./src/core/transmuxing-events.js":function(R,S,I){I.r(S);var b={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};S.default=b},"./src/core/transmuxing-worker.js":function(R,S,I){I.r(S);var b=I("./src/utils/logging-control.js"),T=I("./src/utils/polyfill.js"),c=I("./src/core/transmuxing-controller.js"),f=I("./src/core/transmuxing-events.js"),p=function(l){var d=null,h=m.bind(this);T.default.install(),l.addEventListener("message",function(y){switch(y.data.cmd){case"init":d=new c.default(y.data.param[0],y.data.param[1]),d.on(f.default.IO_ERROR,u.bind(this)),d.on(f.default.DEMUX_ERROR,_.bind(this)),d.on(f.default.INIT_SEGMENT,n.bind(this)),d.on(f.default.MEDIA_SEGMENT,t.bind(this)),d.on(f.default.LOADING_COMPLETE,e.bind(this)),d.on(f.default.RECOVERED_EARLY_EOF,i.bind(this)),d.on(f.default.MEDIA_INFO,r.bind(this)),d.on(f.default.METADATA_ARRIVED,o.bind(this)),d.on(f.default.SCRIPTDATA_ARRIVED,s.bind(this)),d.on(f.default.STATISTICS_INFO,a.bind(this)),d.on(f.default.RECOMMEND_SEEKPOINT,g.bind(this));break;case"destroy":d&&(d.destroy(),d=null),l.postMessage({msg:"destroyed"});break;case"start":d.start();break;case"stop":d.stop();break;case"seek":d.seek(y.data.param);break;case"pause":d.pause();break;case"resume":d.resume();break;case"logging_config":{var v=y.data.param;b.default.applyConfig(v),v.enableCallback===!0?b.default.addLogListener(h):b.default.removeLogListener(h);break}}});function n(y,v){var E={msg:f.default.INIT_SEGMENT,data:{type:y,data:v}};l.postMessage(E,[v.data])}function t(y,v){var E={msg:f.default.MEDIA_SEGMENT,data:{type:y,data:v}};l.postMessage(E,[v.data])}function e(){var y={msg:f.default.LOADING_COMPLETE};l.postMessage(y)}function i(){var y={msg:f.default.RECOVERED_EARLY_EOF};l.postMessage(y)}function r(y){var v={msg:f.default.MEDIA_INFO,data:y};l.postMessage(v)}function o(y){var v={msg:f.default.METADATA_ARRIVED,data:y};l.postMessage(v)}function s(y){var v={msg:f.default.SCRIPTDATA_ARRIVED,data:y};l.postMessage(v)}function a(y){var v={msg:f.default.STATISTICS_INFO,data:y};l.postMessage(v)}function u(y,v){l.postMessage({msg:f.default.IO_ERROR,data:{type:y,info:v}})}function _(y,v){l.postMessage({msg:f.default.DEMUX_ERROR,data:{type:y,info:v}})}function g(y){l.postMessage({msg:f.default.RECOMMEND_SEEKPOINT,data:y})}function m(y,v){l.postMessage({msg:"logcat_callback",data:{type:y,logcat:v}})}};S.default=p},"./src/demux/amf-parser.js":function(R,S,I){I.r(S);var b=I("./src/utils/logger.js"),T=I("./src/utils/utf8-conv.js"),c=I("./src/utils/exception.js"),f=function(){var l=new ArrayBuffer(2);return new DataView(l).setInt16(0,256,!0),new Int16Array(l)[0]===256}(),p=function(){function l(){}return l.parseScriptData=function(d,h,n){var t={};try{var e=l.parseValue(d,h,n),i=l.parseValue(d,h+e.size,n-e.size);t[e.data]=i.data}catch(r){b.default.e("AMF",r.toString())}return t},l.parseObject=function(d,h,n){if(n<3)throw new c.IllegalStateException("Data not enough when parse ScriptDataObject");var t=l.parseString(d,h,n),e=l.parseValue(d,h+t.size,n-t.size),i=e.objectEnd;return{data:{name:t.data,value:e.data},size:t.size+e.size,objectEnd:i}},l.parseVariable=function(d,h,n){return l.parseObject(d,h,n)},l.parseString=function(d,h,n){if(n<2)throw new c.IllegalStateException("Data not enough when parse String");var t=new DataView(d,h,n),e=t.getUint16(0,!f),i;return e>0?i=(0,T.default)(new Uint8Array(d,h+2,e)):i="",{data:i,size:2+e}},l.parseLongString=function(d,h,n){if(n<4)throw new c.IllegalStateException("Data not enough when parse LongString");var t=new DataView(d,h,n),e=t.getUint32(0,!f),i;return e>0?i=(0,T.default)(new Uint8Array(d,h+4,e)):i="",{data:i,size:4+e}},l.parseDate=function(d,h,n){if(n<10)throw new c.IllegalStateException("Data size invalid when parse Date");var t=new DataView(d,h,n),e=t.getFloat64(0,!f),i=t.getInt16(8,!f);return e+=i*60*1e3,{data:new Date(e),size:8+2}},l.parseValue=function(d,h,n){if(n<1)throw new c.IllegalStateException("Data not enough when parse Value");var t=new DataView(d,h,n),e=1,i=t.getUint8(0),r,o=!1;try{switch(i){case 0:r=t.getFloat64(1,!f),e+=8;break;case 1:{var s=t.getUint8(1);r=!!s,e+=1;break}case 2:{var a=l.parseString(d,h+1,n-1);r=a.data,e+=a.size;break}case 3:{r={};var u=0;for((t.getUint32(n-4,!f)&16777215)===9&&(u=3);e<n-4;){var _=l.parseObject(d,h+e,n-e-u);if(_.objectEnd)break;r[_.data.name]=_.data.value,e+=_.size}if(e<=n-3){var g=t.getUint32(e-1,!f)&16777215;g===9&&(e+=3)}break}case 8:{r={},e+=4;var u=0;for((t.getUint32(n-4,!f)&16777215)===9&&(u=3);e<n-8;){var m=l.parseVariable(d,h+e,n-e-u);if(m.objectEnd)break;r[m.data.name]=m.data.value,e+=m.size}if(e<=n-3){var g=t.getUint32(e-1,!f)&16777215;g===9&&(e+=3)}break}case 9:r=void 0,e=1,o=!0;break;case 10:{r=[];var y=t.getUint32(1,!f);e+=4;for(var v=0;v<y;v++){var E=l.parseValue(d,h+e,n-e);r.push(E.data),e+=E.size}break}case 11:{var x=l.parseDate(d,h+1,n-1);r=x.data,e+=x.size;break}case 12:{var L=l.parseString(d,h+1,n-1);r=L.data,e+=L.size;break}default:e=n,b.default.w("AMF","Unsupported AMF value type "+i)}}catch(O){b.default.e("AMF",O.toString())}return{data:r,size:e,objectEnd:o}},l}();S.default=p},"./src/demux/demux-errors.js":function(R,S,I){I.r(S);var b={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};S.default=b},"./src/demux/exp-golomb.js":function(R,S,I){I.r(S);var b=I("./src/utils/exception.js"),T=function(){function c(f){this.TAG="ExpGolomb",this._buffer=f,this._buffer_index=0,this._total_bytes=f.byteLength,this._total_bits=f.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return c.prototype.destroy=function(){this._buffer=null},c.prototype._fillCurrentWord=function(){var f=this._total_bytes-this._buffer_index;if(f<=0)throw new b.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var p=Math.min(4,f),l=new Uint8Array(4);l.set(this._buffer.subarray(this._buffer_index,this._buffer_index+p)),this._current_word=new DataView(l.buffer).getUint32(0,!1),this._buffer_index+=p,this._current_word_bits_left=p*8},c.prototype.readBits=function(f){if(f>32)throw new b.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(f<=this._current_word_bits_left){var p=this._current_word>>>32-f;return this._current_word<<=f,this._current_word_bits_left-=f,p}var l=this._current_word_bits_left?this._current_word:0;l=l>>>32-this._current_word_bits_left;var d=f-this._current_word_bits_left;this._fillCurrentWord();var h=Math.min(d,this._current_word_bits_left),n=this._current_word>>>32-h;return this._current_word<<=h,this._current_word_bits_left-=h,l=l<<h|n,l},c.prototype.readBool=function(){return this.readBits(1)===1},c.prototype.readByte=function(){return this.readBits(8)},c.prototype._skipLeadingZero=function(){var f;for(f=0;f<this._current_word_bits_left;f++)if((this._current_word&2147483648>>>f)!==0)return this._current_word<<=f,this._current_word_bits_left-=f,f;return this._fillCurrentWord(),f+this._skipLeadingZero()},c.prototype.readUEG=function(){var f=this._skipLeadingZero();return this.readBits(f+1)-1},c.prototype.readSEG=function(){var f=this.readUEG();return f&1?f+1>>>1:-1*(f>>>1)},c}();S.default=T},"./src/demux/flv-demuxer.js":function(R,S,I){I.r(S);var b=I("./src/utils/logger.js"),T=I("./src/demux/amf-parser.js"),c=I("./src/demux/sps-parser.js"),f=I("./src/demux/demux-errors.js"),p=I("./src/core/media-info.js"),l=I("./src/utils/exception.js");function d(n,t){return n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]}var h=function(){function n(t,e){this.TAG="FLVDemuxer",this._config=e,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new p.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256}()}return n.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},n.probe=function(t){var e=new Uint8Array(t),i={match:!1};if(e[0]!==70||e[1]!==76||e[2]!==86||e[3]!==1)return i;var r=(e[4]&4)>>>2!==0,o=(e[4]&1)!==0,s=d(e,5);return s<9?i:{match:!0,consumed:s,dataOffset:s,hasAudioTrack:r,hasVideoTrack:o}},n.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(n.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),n.prototype.resetMediaInfo=function(){this._mediaInfo=new p.default},n.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},n.prototype.parseChunks=function(t,e){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new l.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,r=this._littleEndian;if(e===0)if(t.byteLength>13){var o=n.probe(t);i=o.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,e+i!==this._dataOffset&&b.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var s=new DataView(t,i),a=s.getUint32(0,!r);a!==0&&b.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4}for(;i<t.byteLength;){this._dispatch=!0;var s=new DataView(t,i);if(i+11+4>t.byteLength)break;var u=s.getUint8(0),_=s.getUint32(0,!r)&16777215;if(i+11+_+4>t.byteLength)break;if(u!==8&&u!==9&&u!==18){b.default.w(this.TAG,"Unsupported tag type "+u+", skipped"),i+=11+_+4;continue}var g=s.getUint8(4),m=s.getUint8(5),y=s.getUint8(6),v=s.getUint8(7),E=y|m<<8|g<<16|v<<24,x=s.getUint32(7,!r)&16777215;x!==0&&b.default.w(this.TAG,"Meet tag which has StreamID != 0!");var L=i+11;switch(u){case 8:this._parseAudioData(t,L,_,E);break;case 9:this._parseVideoData(t,L,_,E,e+i);break;case 18:this._parseScriptData(t,L,_);break}var O=s.getUint32(11+_,!r);O!==11+_&&b.default.w(this.TAG,"Invalid PrevTagSize "+O),i+=11+_+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},n.prototype._parseScriptData=function(t,e,i){var r=T.default.parseScriptData(t,e,i);if(r.hasOwnProperty("onMetaData")){if(r.onMetaData==null||typeof r.onMetaData!="object"){b.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&b.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var o=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},o)),typeof o.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=o.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof o.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=o.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof o.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=o.audiodatarate),typeof o.videodatarate=="number"&&(this._mediaInfo.videoDataRate=o.videodatarate),typeof o.width=="number"&&(this._mediaInfo.width=o.width),typeof o.height=="number"&&(this._mediaInfo.height=o.height),typeof o.duration=="number"){if(!this._durationOverrided){var s=Math.floor(o.duration*this._timescale);this._duration=s,this._mediaInfo.duration=s}}else this._mediaInfo.duration=0;if(typeof o.framerate=="number"){var a=Math.floor(o.framerate*1e3);if(a>0){var u=a/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=u,this._referenceFrameRate.fps_num=a,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=u}}if(typeof o.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var _=o.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(_),o.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=o,b.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))},n.prototype._parseKeyframesIndex=function(t){for(var e=[],i=[],r=1;r<t.times.length;r++){var o=this._timestampBase+Math.floor(t.times[r]*1e3);e.push(o),i.push(t.filepositions[r])}return{times:e,filepositions:i}},n.prototype._parseAudioData=function(t,e,i,r){if(i<=1){b.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var o=new DataView(t,e,i),s=o.getUint8(0),a=s>>>4;if(a!==2&&a!==10){this._onError(f.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+a);return}var u=0,_=(s&12)>>>2;if(_>=0&&_<=4)u=this._flvSoundRateTable[_];else{this._onError(f.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+_);return}var g=s&1,m=this._audioMetadata,y=this._audioTrack;if(m||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),m=this._audioMetadata={},m.type="audio",m.id=y.id,m.timescale=this._timescale,m.duration=this._duration,m.audioSampleRate=u,m.channelCount=g===0?1:2),a===10){var v=this._parseAACAudioData(t,e+1,i-1);if(v==null)return;if(v.packetType===0){m.config&&b.default.w(this.TAG,"Found another AudioSpecificConfig!");var E=v.data;m.audioSampleRate=E.samplingRate,m.channelCount=E.channelCount,m.codec=E.codec,m.originalCodec=E.originalCodec,m.config=E.config,m.refSampleDuration=1024/m.audioSampleRate*m.timescale,b.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",m);var x=this._mediaInfo;x.audioCodec=m.originalCodec,x.audioSampleRate=m.audioSampleRate,x.audioChannelCount=m.channelCount,x.hasVideo?x.videoCodec!=null&&(x.mimeType='video/x-flv; codecs="'+x.videoCodec+","+x.audioCodec+'"'):x.mimeType='video/x-flv; codecs="'+x.audioCodec+'"',x.isComplete()&&this._onMediaInfo(x)}else if(v.packetType===1){var L=this._timestampBase+r,O={unit:v.data,length:v.data.byteLength,dts:L,pts:L};y.samples.push(O),y.length+=v.data.length}else b.default.e(this.TAG,"Flv: Unsupported AAC data type "+v.packetType)}else if(a===2){if(!m.codec){var E=this._parseMP3AudioData(t,e+1,i-1,!0);if(E==null)return;m.audioSampleRate=E.samplingRate,m.channelCount=E.channelCount,m.codec=E.codec,m.originalCodec=E.originalCodec,m.refSampleDuration=1152/m.audioSampleRate*m.timescale,b.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",m);var x=this._mediaInfo;x.audioCodec=m.codec,x.audioSampleRate=m.audioSampleRate,x.audioChannelCount=m.channelCount,x.audioDataRate=E.bitRate,x.hasVideo?x.videoCodec!=null&&(x.mimeType='video/x-flv; codecs="'+x.videoCodec+","+x.audioCodec+'"'):x.mimeType='video/x-flv; codecs="'+x.audioCodec+'"',x.isComplete()&&this._onMediaInfo(x)}var C=this._parseMP3AudioData(t,e+1,i-1,!1);if(C==null)return;var L=this._timestampBase+r,F={unit:C,length:C.byteLength,dts:L,pts:L};y.samples.push(F),y.length+=C.length}}},n.prototype._parseAACAudioData=function(t,e,i){if(i<=1){b.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var r={},o=new Uint8Array(t,e,i);return r.packetType=o[0],o[0]===0?r.data=this._parseAACAudioSpecificConfig(t,e+1,i-1):r.data=o.subarray(1),r},n.prototype._parseAACAudioSpecificConfig=function(t,e,i){var r=new Uint8Array(t,e,i),o=null,s=0,a=0,u=0,_=null;if(s=a=r[0]>>>3,u=(r[0]&7)<<1|r[1]>>>7,u<0||u>=this._mpegSamplingRates.length){this._onError(f.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var g=this._mpegSamplingRates[u],m=(r[1]&120)>>>3;if(m<0||m>=8){this._onError(f.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}s===5&&(_=(r[1]&7)<<1|r[2]>>>7,(r[2]&124)>>>2);var y=self.navigator.userAgent.toLowerCase();return y.indexOf("firefox")!==-1?u>=6?(s=5,o=new Array(4),_=u-3):(s=2,o=new Array(2),_=u):y.indexOf("android")!==-1?(s=2,o=new Array(2),_=u):(s=5,_=u,o=new Array(4),u>=6?_=u-3:m===1&&(s=2,o=new Array(2),_=u)),o[0]=s<<3,o[0]|=(u&15)>>>1,o[1]=(u&15)<<7,o[1]|=(m&15)<<3,s===5&&(o[1]|=(_&15)>>>1,o[2]=(_&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplingRate:g,channelCount:m,codec:"mp4a.40."+s,originalCodec:"mp4a.40."+a}},n.prototype._parseMP3AudioData=function(t,e,i,r){if(i<4){b.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var o=new Uint8Array(t,e,i),s=null;if(r){if(o[0]!==255)return;var a=o[1]>>>3&3,u=(o[1]&6)>>1,_=(o[2]&240)>>>4,g=(o[2]&12)>>>2,m=o[3]>>>6&3,y=m!==3?2:1,v=0,E=0,x="mp3";switch(a){case 0:v=this._mpegAudioV25SampleRateTable[g];break;case 2:v=this._mpegAudioV20SampleRateTable[g];break;case 3:v=this._mpegAudioV10SampleRateTable[g];break}switch(u){case 1:_<this._mpegAudioL3BitRateTable.length&&(E=this._mpegAudioL3BitRateTable[_]);break;case 2:_<this._mpegAudioL2BitRateTable.length&&(E=this._mpegAudioL2BitRateTable[_]);break;case 3:_<this._mpegAudioL1BitRateTable.length&&(E=this._mpegAudioL1BitRateTable[_]);break}s={bitRate:E,samplingRate:v,channelCount:y,codec:x,originalCodec:x}}else s=o;return s},n.prototype._parseVideoData=function(t,e,i,r,o){if(i<=1){b.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var s=new Uint8Array(t,e,i)[0],a=(s&240)>>>4,u=s&15;if(u!==7){this._onError(f.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+u);return}this._parseAVCVideoPacket(t,e+1,i-1,r,o,a)}},n.prototype._parseAVCVideoPacket=function(t,e,i,r,o,s){if(i<4){b.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var a=this._littleEndian,u=new DataView(t,e,i),_=u.getUint8(0),g=u.getUint32(0,!a)&16777215,m=g<<8>>8;if(_===0)this._parseAVCDecoderConfigurationRecord(t,e+4,i-4);else if(_===1)this._parseAVCVideoData(t,e+4,i-4,r,o,s,m);else if(_!==2){this._onError(f.default.FORMAT_ERROR,"Flv: Invalid video packet type "+_);return}},n.prototype._parseAVCDecoderConfigurationRecord=function(t,e,i){if(i<7){b.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var r=this._videoMetadata,o=this._videoTrack,s=this._littleEndian,a=new DataView(t,e,i);r?typeof r.avcc<"u"&&b.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=o.id,r.timescale=this._timescale,r.duration=this._duration);var u=a.getUint8(0),_=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),u!==1||_===0){this._onError(f.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(a.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(f.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var g=a.getUint8(5)&31;if(g===0){this._onError(f.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else g>1&&b.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+g);for(var m=6,y=0;y<g;y++){var v=a.getUint16(m,!s);if(m+=2,v!==0){var E=new Uint8Array(t,e+m,v);m+=v;var x=c.default.parseSPS(E);if(y===0){r.codecWidth=x.codec_size.width,r.codecHeight=x.codec_size.height,r.presentWidth=x.present_size.width,r.presentHeight=x.present_size.height,r.profile=x.profile_string,r.level=x.level_string,r.bitDepth=x.bit_depth,r.chromaFormat=x.chroma_format,r.sarRatio=x.sar_ratio,r.frameRate=x.frame_rate,(x.frame_rate.fixed===!1||x.frame_rate.fps_num===0||x.frame_rate.fps_den===0)&&(r.frameRate=this._referenceFrameRate);var L=r.frameRate.fps_den,O=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(L/O);for(var C=E.subarray(1,4),F="avc1.",M=0;M<3;M++){var B=C[M].toString(16);B.length<2&&(B="0"+B),F+=B}r.codec=F;var k=this._mediaInfo;k.width=r.codecWidth,k.height=r.codecHeight,k.fps=r.frameRate.fps,k.profile=r.profile,k.level=r.level,k.refFrames=x.ref_frames,k.chromaFormat=x.chroma_format_string,k.sarNum=r.sarRatio.width,k.sarDen=r.sarRatio.height,k.videoCodec=F,k.hasAudio?k.audioCodec!=null&&(k.mimeType='video/x-flv; codecs="'+k.videoCodec+","+k.audioCodec+'"'):k.mimeType='video/x-flv; codecs="'+k.videoCodec+'"',k.isComplete()&&this._onMediaInfo(k)}}}var w=a.getUint8(m);if(w===0){this._onError(f.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else w>1&&b.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+w);m++;for(var y=0;y<w;y++){var v=a.getUint16(m,!s);m+=2,v!==0&&(m+=v)}r.avcc=new Uint8Array(i),r.avcc.set(new Uint8Array(t,e,i),0),b.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)},n.prototype._parseAVCVideoData=function(t,e,i,r,o,s,a){for(var u=this._littleEndian,_=new DataView(t,e,i),g=[],m=0,y=0,v=this._naluLengthSize,E=this._timestampBase+r,x=s===1;y<i;){if(y+4>=i){b.default.w(this.TAG,"Malformed Nalu near timestamp "+E+", offset = "+y+", dataSize = "+i);break}var L=_.getUint32(y,!u);if(v===3&&(L>>>=8),L>i-v){b.default.w(this.TAG,"Malformed Nalus near timestamp "+E+", NaluSize > DataSize!");return}var O=_.getUint8(y+v)&31;O===5&&(x=!0);var C=new Uint8Array(t,e+y,v+L),F={type:O,data:C};g.push(F),m+=C.byteLength,y+=v+L}if(g.length){var M=this._videoTrack,B={units:g,length:m,isKeyframe:x,dts:E,cts:a,pts:E+a};x&&(B.fileposition=o),M.samples.push(B),M.length+=m}},n}();S.default=h},"./src/demux/sps-parser.js":function(R,S,I){I.r(S);var b=I("./src/demux/exp-golomb.js"),T=function(){function c(){}return c._ebsp2rbsp=function(f){for(var p=f,l=p.byteLength,d=new Uint8Array(l),h=0,n=0;n<l;n++)n>=2&&p[n]===3&&p[n-1]===0&&p[n-2]===0||(d[h]=p[n],h++);return new Uint8Array(d.buffer,0,h)},c.parseSPS=function(f){var p=c._ebsp2rbsp(f),l=new b.default(p);l.readByte();var d=l.readByte();l.readByte();var h=l.readByte();l.readUEG();var n=c.getProfileString(d),t=c.getLevelString(h),e=1,i=420,r=[0,420,422,444],o=8;if((d===100||d===110||d===122||d===244||d===44||d===83||d===86||d===118||d===128||d===138||d===144)&&(e=l.readUEG(),e===3&&l.readBits(1),e<=3&&(i=r[e]),o=l.readUEG()+8,l.readUEG(),l.readBits(1),l.readBool()))for(var s=e!==3?8:12,a=0;a<s;a++)l.readBool()&&(a<6?c._skipScalingList(l,16):c._skipScalingList(l,64));l.readUEG();var u=l.readUEG();if(u===0)l.readUEG();else if(u===1){l.readBits(1),l.readSEG(),l.readSEG();for(var _=l.readUEG(),a=0;a<_;a++)l.readSEG()}var g=l.readUEG();l.readBits(1);var m=l.readUEG(),y=l.readUEG(),v=l.readBits(1);v===0&&l.readBits(1),l.readBits(1);var E=0,x=0,L=0,O=0,C=l.readBool();C&&(E=l.readUEG(),x=l.readUEG(),L=l.readUEG(),O=l.readUEG());var F=1,M=1,B=0,k=!0,w=0,U=0,N=l.readBool();if(N){if(l.readBool()){var K=l.readByte(),H=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],z=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];K>0&&K<16?(F=H[K-1],M=z[K-1]):K===255&&(F=l.readByte()<<8|l.readByte(),M=l.readByte()<<8|l.readByte())}if(l.readBool()&&l.readBool(),l.readBool()&&(l.readBits(4),l.readBool()&&l.readBits(24)),l.readBool()&&(l.readUEG(),l.readUEG()),l.readBool()){var G=l.readBits(32),q=l.readBits(32);k=l.readBool(),w=q,U=G*2,B=w/U}}var Z=1;(F!==1||M!==1)&&(Z=F/M);var V=0,X=0;if(e===0)V=1,X=2-v;else{var J=e===3?1:2,re=e===1?2:1;V=J,X=re*(2-v)}var ie=(m+1)*16,ne=(2-v)*((y+1)*16);ie-=(E+x)*V,ne-=(L+O)*X;var ae=Math.ceil(ie*Z);return l.destroy(),l=null,{profile_string:n,level_string:t,bit_depth:o,ref_frames:g,chroma_format:i,chroma_format_string:c.getChromaFormatString(i),frame_rate:{fixed:k,fps:B,fps_den:U,fps_num:w},sar_ratio:{width:F,height:M},codec_size:{width:ie,height:ne},present_size:{width:ae,height:ne}}},c._skipScalingList=function(f,p){for(var l=8,d=8,h=0,n=0;n<p;n++)d!==0&&(h=f.readSEG(),d=(l+h+256)%256),l=d===0?l:d},c.getProfileString=function(f){switch(f){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},c.getLevelString=function(f){return(f/10).toFixed(1)},c.getChromaFormatString=function(f){switch(f){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},c}();S.default=T},"./src/flv.js":function(R,S,I){I.r(S);var b=I("./src/utils/polyfill.js"),T=I("./src/core/features.js"),c=I("./src/io/loader.js"),f=I("./src/player/flv-player.js"),p=I("./src/player/native-player.js"),l=I("./src/player/player-events.js"),d=I("./src/player/player-errors.js"),h=I("./src/utils/logging-control.js"),n=I("./src/utils/exception.js");b.default.install();function t(o,s){var a=o;if(a==null||typeof a!="object")throw new n.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!a.hasOwnProperty("type"))throw new n.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(a.type){case"flv":return new f.default(a,s);default:return new p.default(a,s)}}function e(){return T.default.supportMSEH264Playback()}function i(){return T.default.getFeatureList()}var r={};r.createPlayer=t,r.isSupported=e,r.getFeatureList=i,r.BaseLoader=c.BaseLoader,r.LoaderStatus=c.LoaderStatus,r.LoaderErrors=c.LoaderErrors,r.Events=l.default,r.ErrorTypes=d.ErrorTypes,r.ErrorDetails=d.ErrorDetails,r.FlvPlayer=f.default,r.NativePlayer=p.default,r.LoggingControl=h.default,Object.defineProperty(r,"version",{enumerable:!0,get:function(){return"1.6.2"}}),S.default=r},"./src/index.js":function(R,S,I){R.exports=I("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(R,S,I){I.r(S);var b=I("./src/utils/browser.js"),T=I("./src/io/loader.js"),c=I("./src/utils/exception.js"),f=function(){var l=function(d,h){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])},l(d,h)};return function(d,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");l(d,h);function n(){this.constructor=d}d.prototype=h===null?Object.create(h):(n.prototype=h.prototype,new n)}}(),p=function(l){f(d,l);function d(h,n){var t=l.call(this,"fetch-stream-loader")||this;return t.TAG="FetchStreamLoader",t._seekHandler=h,t._config=n,t._needStash=!0,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return d.isSupported=function(){try{var h=b.default.msedge&&b.default.version.minor>=15048,n=b.default.msedge?h:!0;return self.fetch&&self.ReadableStream&&n}catch{return!1}},d.prototype.destroy=function(){this.isWorking()&&this.abort(),l.prototype.destroy.call(this)},d.prototype.open=function(h,n){var t=this;this._dataSource=h,this._range=n;var e=h.url;this._config.reuseRedirectedURL&&h.redirectedURL!=null&&(e=h.redirectedURL);var i=this._seekHandler.getConfig(e,n),r=new self.Headers;if(typeof i.headers=="object"){var o=i.headers;for(var s in o)o.hasOwnProperty(s)&&r.append(s,o[s])}var a={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var s in this._config.headers)r.append(s,this._config.headers[s]);h.cors===!1&&(a.mode="same-origin"),h.withCredentials&&(a.credentials="include"),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,a.signal=this._abortController.signal),this._status=T.LoaderStatus.kConnecting,self.fetch(i.url,a).then(function(u){if(t._requestAbort){t._status=T.LoaderStatus.kIdle,u.body.cancel();return}if(u.ok&&u.status>=200&&u.status<=299){if(u.url!==i.url&&t._onURLRedirect){var _=t._seekHandler.removeURLParameters(u.url);t._onURLRedirect(_)}var g=u.headers.get("Content-Length");return g!=null&&(t._contentLength=parseInt(g),t._contentLength!==0&&t._onContentLengthKnown&&t._onContentLengthKnown(t._contentLength)),t._pump.call(t,u.body.getReader())}else if(t._status=T.LoaderStatus.kError,t._onError)t._onError(T.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:u.status,msg:u.statusText});else throw new c.RuntimeException("FetchStreamLoader: Http code invalid, "+u.status+" "+u.statusText)}).catch(function(u){if(!(t._abortController&&t._abortController.signal.aborted))if(t._status=T.LoaderStatus.kError,t._onError)t._onError(T.LoaderErrors.EXCEPTION,{code:-1,msg:u.message});else throw u})},d.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==T.LoaderStatus.kBuffering||!b.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},d.prototype._pump=function(h){var n=this;return h.read().then(function(t){if(t.done)if(n._contentLength!==null&&n._receivedLength<n._contentLength){n._status=T.LoaderStatus.kError;var e=T.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(n._onError)n._onError(e,i);else throw new c.RuntimeException(i.msg)}else n._status=T.LoaderStatus.kComplete,n._onComplete&&n._onComplete(n._range.from,n._range.from+n._receivedLength-1);else{if(n._abortController&&n._abortController.signal.aborted){n._status=T.LoaderStatus.kComplete;return}else if(n._requestAbort===!0)return n._status=T.LoaderStatus.kComplete,h.cancel();n._status=T.LoaderStatus.kBuffering;var r=t.value.buffer,o=n._range.from+n._receivedLength;n._receivedLength+=r.byteLength,n._onDataArrival&&n._onDataArrival(r,o,n._receivedLength),n._pump(h)}}).catch(function(t){if(n._abortController&&n._abortController.signal.aborted){n._status=T.LoaderStatus.kComplete;return}if(!(t.code===11&&b.default.msedge)){n._status=T.LoaderStatus.kError;var e=0,i=null;if((t.code===19||t.message==="network error")&&(n._contentLength===null||n._contentLength!==null&&n._receivedLength<n._contentLength)?(e=T.LoaderErrors.EARLY_EOF,i={code:t.code,msg:"Fetch stream meet Early-EOF"}):(e=T.LoaderErrors.EXCEPTION,i={code:t.code,msg:t.message}),n._onError)n._onError(e,i);else throw new c.RuntimeException(i.msg)}})},d}(T.BaseLoader);S.default=p},"./src/io/io-controller.js":function(R,S,I){I.r(S);var b=I("./src/utils/logger.js"),T=I("./src/io/speed-sampler.js"),c=I("./src/io/loader.js"),f=I("./src/io/fetch-stream-loader.js"),p=I("./src/io/xhr-moz-chunked-loader.js"),l=I("./src/io/xhr-range-loader.js"),d=I("./src/io/websocket-loader.js"),h=I("./src/io/range-seek-handler.js"),n=I("./src/io/param-seek-handler.js"),t=I("./src/utils/exception.js"),e=function(){function i(r,o,s){this.TAG="IOController",this._config=o,this._extraData=s,this._stashInitialSize=1024*384,o.stashInitialSize!=null&&o.stashInitialSize>0&&(this._stashInitialSize=o.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,o.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=r,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(r.url),this._refTotalLength=r.filesize?r.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new T.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return i.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},i.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},i.prototype.isPaused=function(){return this._paused},Object.defineProperty(i.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"extraData",{get:function(){return this._extraData},set:function(r){this._extraData=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(r){this._onDataArrival=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(r){this._onSeeked=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onError",{get:function(){return this._onError},set:function(r){this._onError=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onComplete",{get:function(){return this._onComplete},set:function(r){this._onComplete=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(r){this._onRedirect=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(r){this._onRecoveredEarlyEof=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentSpeed",{get:function(){return this._loaderClass===l.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),i.prototype._selectSeekHandler=function(){var r=this._config;if(r.seekType==="range")this._seekHandler=new h.default(this._config.rangeLoadZeroStart);else if(r.seekType==="param"){var o=r.seekParamStart||"bstart",s=r.seekParamEnd||"bend";this._seekHandler=new n.default(o,s)}else if(r.seekType==="custom"){if(typeof r.customSeekHandler!="function")throw new t.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new r.customSeekHandler}else throw new t.InvalidArgumentException("Invalid seekType in config: "+r.seekType)},i.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=d.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(p.default.isSupported())this._loaderClass=p.default;else if(l.default.isSupported())this._loaderClass=l.default;else throw new t.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},i.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},i.prototype.open=function(r){this._currentRange={from:0,to:-1},r&&(this._currentRange.from=r),this._speedSampler.reset(),r||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},i.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},i.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},i.prototype.resume=function(){if(this._paused){this._paused=!1;var r=this._resumeFrom;this._resumeFrom=0,this._internalSeek(r,!0)}},i.prototype.seek=function(r){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(r,!0)},i.prototype._internalSeek=function(r,o){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(o),this._loader.destroy(),this._loader=null;var s={from:r,to:-1};this._currentRange={from:s.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,s),this._onSeeked&&this._onSeeked()},i.prototype.updateUrl=function(r){if(!r||typeof r!="string"||r.length===0)throw new t.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=r},i.prototype._expandBuffer=function(r){for(var o=this._stashSize;o+1024*1024*1<r;)o*=2;if(o+=1024*1024*1,o!==this._bufferSize){var s=new ArrayBuffer(o);if(this._stashUsed>0){var a=new Uint8Array(this._stashBuffer,0,this._stashUsed),u=new Uint8Array(s,0,o);u.set(a,0)}this._stashBuffer=s,this._bufferSize=o}},i.prototype._normalizeSpeed=function(r){var o=this._speedNormalizeList,s=o.length-1,a=0,u=0,_=s;if(r<o[0])return o[0];for(;u<=_;){if(a=u+Math.floor((_-u)/2),a===s||r>=o[a]&&r<o[a+1])return o[a];o[a]<r?u=a+1:_=a-1}},i.prototype._adjustStashSize=function(r){var o=0;this._config.isLive||r<512?o=r:r>=512&&r<=1024?o=Math.floor(r*1.5):o=r*2,o>8192&&(o=8192);var s=o*1024+1024*1024*1;this._bufferSize<s&&this._expandBuffer(s),this._stashSize=o*1024},i.prototype._dispatchChunks=function(r,o){return this._currentRange.to=o+r.byteLength-1,this._onDataArrival(r,o)},i.prototype._onURLRedirect=function(r){this._redirectedURL=r,this._onRedirect&&this._onRedirect(r)},i.prototype._onContentLengthKnown=function(r){r&&this._fullRequestFlag&&(this._totalLength=r,this._fullRequestFlag=!1)},i.prototype._onLoaderChunkArrival=function(r,o,s){if(!this._onDataArrival)throw new t.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(r.byteLength);var a=this._speedSampler.lastSecondKBps;if(a!==0){var u=this._normalizeSpeed(a);this._speedNormalized!==u&&(this._speedNormalized=u,this._adjustStashSize(u))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=o),this._stashUsed+r.byteLength<=this._stashSize){var m=new Uint8Array(this._stashBuffer,0,this._stashSize);m.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var v=this._stashBuffer.slice(0,this._stashUsed),_=this._dispatchChunks(v,this._stashByteStart);if(_<v.byteLength){if(_>0){var y=new Uint8Array(v,_);m.set(y,0),this._stashUsed=y.byteLength,this._stashByteStart+=_}}else this._stashUsed=0,this._stashByteStart+=_;this._stashUsed+r.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+r.byteLength),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var _=this._dispatchChunks(r,o);if(_<r.byteLength){var g=r.byteLength-_;g>this._bufferSize&&(this._expandBuffer(g),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(r,_),0),this._stashUsed+=g,this._stashByteStart=o+_}}}else if(this._stashUsed===0){var _=this._dispatchChunks(r,o);if(_<r.byteLength){var g=r.byteLength-_;g>this._bufferSize&&this._expandBuffer(g);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(r,_),0),this._stashUsed+=g,this._stashByteStart=o+_}}else{this._stashUsed+r.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+r.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength;var _=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(_<this._stashUsed&&_>0){var y=new Uint8Array(this._stashBuffer,_);m.set(y,0)}this._stashUsed-=_,this._stashByteStart+=_}}},i.prototype._flushStashBuffer=function(r){if(this._stashUsed>0){var o=this._stashBuffer.slice(0,this._stashUsed),s=this._dispatchChunks(o,this._stashByteStart),a=o.byteLength-s;if(s<o.byteLength)if(r)b.default.w(this.TAG,a+" bytes unconsumed data remain when flush buffer, dropped");else{if(s>0){var u=new Uint8Array(this._stashBuffer,0,this._bufferSize),_=new Uint8Array(o,s);u.set(_,0),this._stashUsed=_.byteLength,this._stashByteStart+=s}return 0}return this._stashUsed=0,this._stashByteStart=0,a}return 0},i.prototype._onLoaderComplete=function(r,o){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},i.prototype._onLoaderError=function(r,o){switch(b.default.e(this.TAG,"Loader error, code = "+o.code+", msg = "+o.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,r=c.LoaderErrors.UNRECOVERABLE_EARLY_EOF),r){case c.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var s=this._currentRange.to+1;s<this._totalLength&&(b.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(s,!1));return}r=c.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case c.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case c.LoaderErrors.CONNECTING_TIMEOUT:case c.LoaderErrors.HTTP_STATUS_CODE_INVALID:case c.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(r,o);else throw new t.RuntimeException("IOException: "+o.msg)},i}();S.default=e},"./src/io/loader.js":function(R,S,I){I.r(S),I.d(S,{LoaderStatus:function(){return T},LoaderErrors:function(){return c},BaseLoader:function(){return f}});var b=I("./src/utils/exception.js"),T={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},c={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},f=function(){function p(l){this._type=l||"undefined",this._status=T.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return p.prototype.destroy=function(){this._status=T.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},p.prototype.isWorking=function(){return this._status===T.kConnecting||this._status===T.kBuffering},Object.defineProperty(p.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(l){this._onContentLengthKnown=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(l){this._onURLRedirect=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(l){this._onDataArrival=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onError",{get:function(){return this._onError},set:function(l){this._onError=l},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onComplete",{get:function(){return this._onComplete},set:function(l){this._onComplete=l},enumerable:!1,configurable:!0}),p.prototype.open=function(l,d){throw new b.NotImplementedException("Unimplemented abstract function!")},p.prototype.abort=function(){throw new b.NotImplementedException("Unimplemented abstract function!")},p}()},"./src/io/param-seek-handler.js":function(R,S,I){I.r(S);var b=function(){function T(c,f){this._startName=c,this._endName=f}return T.prototype.getConfig=function(c,f){var p=c;if(f.from!==0||f.to!==-1){var l=!0;p.indexOf("?")===-1&&(p+="?",l=!1),l&&(p+="&"),p+=this._startName+"="+f.from.toString(),f.to!==-1&&(p+="&"+this._endName+"="+f.to.toString())}return{url:p,headers:{}}},T.prototype.removeURLParameters=function(c){var f=c.split("?")[0],p=void 0,l=c.indexOf("?");l!==-1&&(p=c.substring(l+1));var d="";if(p!=null&&p.length>0)for(var h=p.split("&"),n=0;n<h.length;n++){var t=h[n].split("="),e=n>0;t[0]!==this._startName&&t[0]!==this._endName&&(e&&(d+="&"),d+=h[n])}return d.length===0?f:f+"?"+d},T}();S.default=b},"./src/io/range-seek-handler.js":function(R,S,I){I.r(S);var b=function(){function T(c){this._zeroStart=c||!1}return T.prototype.getConfig=function(c,f){var p={};if(f.from!==0||f.to!==-1){var l=void 0;f.to!==-1?l="bytes="+f.from.toString()+"-"+f.to.toString():l="bytes="+f.from.toString()+"-",p.Range=l}else this._zeroStart&&(p.Range="bytes=0-");return{url:c,headers:p}},T.prototype.removeURLParameters=function(c){return c},T}();S.default=b},"./src/io/speed-sampler.js":function(R,S,I){I.r(S);var b=function(){function T(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return T.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},T.prototype.addBytes=function(c){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=c,this._totalBytes+=c):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=c,this._totalBytes+=c):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=c,this._totalBytes+=c,this._lastCheckpoint=this._now())},Object.defineProperty(T.prototype,"currentKBps",{get:function(){this.addBytes(0);var c=(this._now()-this._lastCheckpoint)/1e3;return c==0&&(c=1),this._intervalBytes/c/1024},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"averageKBps",{get:function(){var c=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/c/1024},enumerable:!1,configurable:!0}),T}();S.default=b},"./src/io/websocket-loader.js":function(R,S,I){I.r(S);var b=I("./src/io/loader.js"),T=I("./src/utils/exception.js"),c=function(){var p=function(l,d){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,n){h.__proto__=n}||function(h,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(h[t]=n[t])},p(l,d)};return function(l,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");p(l,d);function h(){this.constructor=l}l.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}}(),f=function(p){c(l,p);function l(){var d=p.call(this,"websocket-loader")||this;return d.TAG="WebSocketLoader",d._needStash=!0,d._ws=null,d._requestAbort=!1,d._receivedLength=0,d}return l.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},l.prototype.destroy=function(){this._ws&&this.abort(),p.prototype.destroy.call(this)},l.prototype.open=function(d){try{var h=this._ws=new self.WebSocket(d.url);h.binaryType="arraybuffer",h.onopen=this._onWebSocketOpen.bind(this),h.onclose=this._onWebSocketClose.bind(this),h.onmessage=this._onWebSocketMessage.bind(this),h.onerror=this._onWebSocketError.bind(this),this._status=b.LoaderStatus.kConnecting}catch(t){this._status=b.LoaderStatus.kError;var n={code:t.code,msg:t.message};if(this._onError)this._onError(b.LoaderErrors.EXCEPTION,n);else throw new T.RuntimeException(n.msg)}},l.prototype.abort=function(){var d=this._ws;d&&(d.readyState===0||d.readyState===1)&&(this._requestAbort=!0,d.close()),this._ws=null,this._status=b.LoaderStatus.kComplete},l.prototype._onWebSocketOpen=function(d){this._status=b.LoaderStatus.kBuffering},l.prototype._onWebSocketClose=function(d){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=b.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},l.prototype._onWebSocketMessage=function(d){var h=this;if(d.data instanceof ArrayBuffer)this._dispatchArrayBuffer(d.data);else if(d.data instanceof Blob){var n=new FileReader;n.onload=function(){h._dispatchArrayBuffer(n.result)},n.readAsArrayBuffer(d.data)}else{this._status=b.LoaderStatus.kError;var t={code:-1,msg:"Unsupported WebSocket message type: "+d.data.constructor.name};if(this._onError)this._onError(b.LoaderErrors.EXCEPTION,t);else throw new T.RuntimeException(t.msg)}},l.prototype._dispatchArrayBuffer=function(d){var h=d,n=this._receivedLength;this._receivedLength+=h.byteLength,this._onDataArrival&&this._onDataArrival(h,n,this._receivedLength)},l.prototype._onWebSocketError=function(d){this._status=b.LoaderStatus.kError;var h={code:d.code,msg:d.message};if(this._onError)this._onError(b.LoaderErrors.EXCEPTION,h);else throw new T.RuntimeException(h.msg)},l}(b.BaseLoader);S.default=f},"./src/io/xhr-moz-chunked-loader.js":function(R,S,I){I.r(S);var b=I("./src/utils/logger.js"),T=I("./src/io/loader.js"),c=I("./src/utils/exception.js"),f=function(){var l=function(d,h){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])},l(d,h)};return function(d,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");l(d,h);function n(){this.constructor=d}d.prototype=h===null?Object.create(h):(n.prototype=h.prototype,new n)}}(),p=function(l){f(d,l);function d(h,n){var t=l.call(this,"xhr-moz-chunked-loader")||this;return t.TAG="MozChunkedLoader",t._seekHandler=h,t._config=n,t._needStash=!0,t._xhr=null,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return d.isSupported=function(){try{var h=new XMLHttpRequest;return h.open("GET","https://example.com",!0),h.responseType="moz-chunked-arraybuffer",h.responseType==="moz-chunked-arraybuffer"}catch(n){return b.default.w("MozChunkedLoader",n.message),!1}},d.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),l.prototype.destroy.call(this)},d.prototype.open=function(h,n){this._dataSource=h,this._range=n;var t=h.url;this._config.reuseRedirectedURL&&h.redirectedURL!=null&&(t=h.redirectedURL);var e=this._seekHandler.getConfig(t,n);this._requestURL=e.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",e.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),h.withCredentials&&(i.withCredentials=!0),typeof e.headers=="object"){var r=e.headers;for(var o in r)r.hasOwnProperty(o)&&i.setRequestHeader(o,r[o])}if(typeof this._config.headers=="object"){var r=this._config.headers;for(var o in r)r.hasOwnProperty(o)&&i.setRequestHeader(o,r[o])}this._status=T.LoaderStatus.kConnecting,i.send()},d.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=T.LoaderStatus.kComplete},d.prototype._onReadyStateChange=function(h){var n=h.target;if(n.readyState===2){if(n.responseURL!=null&&n.responseURL!==this._requestURL&&this._onURLRedirect){var t=this._seekHandler.removeURLParameters(n.responseURL);this._onURLRedirect(t)}if(n.status!==0&&(n.status<200||n.status>299))if(this._status=T.LoaderStatus.kError,this._onError)this._onError(T.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:n.status,msg:n.statusText});else throw new c.RuntimeException("MozChunkedLoader: Http code invalid, "+n.status+" "+n.statusText);else this._status=T.LoaderStatus.kBuffering}},d.prototype._onProgress=function(h){if(this._status!==T.LoaderStatus.kError){this._contentLength===null&&h.total!==null&&h.total!==0&&(this._contentLength=h.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var n=h.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength,this._onDataArrival&&this._onDataArrival(n,t,this._receivedLength)}},d.prototype._onLoadEnd=function(h){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===T.LoaderStatus.kError)return;this._status=T.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},d.prototype._onXhrError=function(h){this._status=T.LoaderStatus.kError;var n=0,t=null;if(this._contentLength&&h.loaded<this._contentLength?(n=T.LoaderErrors.EARLY_EOF,t={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(n=T.LoaderErrors.EXCEPTION,t={code:-1,msg:h.constructor.name+" "+h.type}),this._onError)this._onError(n,t);else throw new c.RuntimeException(t.msg)},d}(T.BaseLoader);S.default=p},"./src/io/xhr-range-loader.js":function(R,S,I){I.r(S);var b=I("./src/utils/logger.js"),T=I("./src/io/speed-sampler.js"),c=I("./src/io/loader.js"),f=I("./src/utils/exception.js"),p=function(){var d=function(h,n){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},d(h,n)};return function(h,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");d(h,n);function t(){this.constructor=h}h.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}}(),l=function(d){p(h,d);function h(n,t){var e=d.call(this,"xhr-range-loader")||this;return e.TAG="RangeLoader",e._seekHandler=n,e._config=t,e._needStash=!1,e._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],e._currentChunkSizeKB=384,e._currentSpeedNormalized=0,e._zeroSpeedChunkCount=0,e._xhr=null,e._speedSampler=new T.default,e._requestAbort=!1,e._waitForTotalLength=!1,e._totalLengthReceived=!1,e._currentRequestURL=null,e._currentRedirectedURL=null,e._currentRequestRange=null,e._totalLength=null,e._contentLength=null,e._receivedLength=0,e._lastTimeLoaded=0,e}return h.isSupported=function(){try{var n=new XMLHttpRequest;return n.open("GET","https://example.com",!0),n.responseType="arraybuffer",n.responseType==="arraybuffer"}catch(t){return b.default.w("RangeLoader",t.message),!1}},h.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),d.prototype.destroy.call(this)},Object.defineProperty(h.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),h.prototype.open=function(n,t){this._dataSource=n,this._range=t,this._status=c.LoaderStatus.kConnecting;var e=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(e=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!e?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},h.prototype._openSubRange=function(){var n=this._currentChunkSizeKB*1024,t=this._range.from+this._receivedLength,e=t+n;this._contentLength!=null&&e-this._range.from>=this._contentLength&&(e=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:e},this._internalOpen(this._dataSource,this._currentRequestRange)},h.prototype._internalOpen=function(n,t){this._lastTimeLoaded=0;var e=n.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?e=this._currentRedirectedURL:n.redirectedURL!=null&&(e=n.redirectedURL));var i=this._seekHandler.getConfig(e,t);this._currentRequestURL=i.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",i.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),n.withCredentials&&(r.withCredentials=!0),typeof i.headers=="object"){var o=i.headers;for(var s in o)o.hasOwnProperty(s)&&r.setRequestHeader(s,o[s])}if(typeof this._config.headers=="object"){var o=this._config.headers;for(var s in o)o.hasOwnProperty(s)&&r.setRequestHeader(s,o[s])}r.send()},h.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=c.LoaderStatus.kComplete},h.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},h.prototype._onReadyStateChange=function(n){var t=n.target;if(t.readyState===2){if(t.responseURL!=null){var e=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&e!==this._currentRedirectedURL&&(this._currentRedirectedURL=e,this._onURLRedirect&&this._onURLRedirect(e))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=c.LoaderStatus.kBuffering}else if(this._status=c.LoaderStatus.kError,this._onError)this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new f.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText)}},h.prototype._onProgress=function(n){if(this._status!==c.LoaderStatus.kError){if(this._contentLength===null){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var e=n.total;this._internalAbort(),e!=null&e!==0&&(this._totalLength=e)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=n.loaded-this._lastTimeLoaded;this._lastTimeLoaded=n.loaded,this._speedSampler.addBytes(i)}},h.prototype._normalizeSpeed=function(n){var t=this._chunkSizeKBList,e=t.length-1,i=0,r=0,o=e;if(n<t[0])return t[0];for(;r<=o;){if(i=r+Math.floor((o-r)/2),i===e||n>=t[i]&&n<t[i+1])return t[i];t[i]<n?r=i+1:o=i-1}},h.prototype._onLoad=function(n){if(this._status!==c.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(t===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),t!==0){var e=this._normalizeSpeed(t);this._currentSpeedNormalized!==e&&(this._currentSpeedNormalized=e,this._currentChunkSizeKB=e)}var i=n.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var o=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():o=!0,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),o&&(this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},h.prototype._onXhrError=function(n){this._status=c.LoaderStatus.kError;var t=0,e=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=c.LoaderErrors.EARLY_EOF,e={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=c.LoaderErrors.EXCEPTION,e={code:-1,msg:n.constructor.name+" "+n.type}),this._onError)this._onError(t,e);else throw new f.RuntimeException(e.msg)},h}(c.BaseLoader);S.default=l},"./src/player/flv-player.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=I("./src/utils/logger.js"),f=I("./src/utils/browser.js"),p=I("./src/player/player-events.js"),l=I("./src/core/transmuxer.js"),d=I("./src/core/transmuxing-events.js"),h=I("./src/core/mse-controller.js"),n=I("./src/core/mse-events.js"),t=I("./src/player/player-errors.js"),e=I("./src/config.js"),i=I("./src/utils/exception.js"),r=function(){function o(s,a){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(T()),this._config=(0,e.createDefaultConfig)(),typeof a=="object"&&Object.assign(this._config,a),s.type.toLowerCase()!=="flv")throw new i.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");s.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=s,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var u=f.default.chrome&&(f.default.version.major<50||f.default.version.major===50&&f.default.version.build<2661);this._alwaysSeekKeyframe=!!(u||f.default.msedge||f.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return o.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},o.prototype.on=function(s,a){var u=this;s===p.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){u._emitter.emit(p.default.MEDIA_INFO,u.mediaInfo)}):s===p.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){u._emitter.emit(p.default.STATISTICS_INFO,u.statisticsInfo)}),this._emitter.addListener(s,a)},o.prototype.off=function(s,a){this._emitter.removeListener(s,a)},o.prototype.attachMediaElement=function(s){var a=this;if(this._mediaElement=s,s.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),s.addEventListener("seeking",this.e.onvSeeking),s.addEventListener("canplay",this.e.onvCanPlay),s.addEventListener("stalled",this.e.onvStalled),s.addEventListener("progress",this.e.onvProgress),this._msectl=new h.default(this._config),this._msectl.on(n.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(n.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(n.default.SOURCE_OPEN,function(){a._mseSourceOpened=!0,a._hasPendingLoad&&(a._hasPendingLoad=!1,a.load())}),this._msectl.on(n.default.ERROR,function(u){a._emitter.emit(p.default.ERROR,t.ErrorTypes.MEDIA_ERROR,t.ErrorDetails.MEDIA_MSE_ERROR,u)}),this._msectl.attachMediaElement(s),this._pendingSeekTime!=null)try{s.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},o.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},o.prototype.load=function(){var s=this;if(!this._mediaElement)throw new i.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new i.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new l.default(this._mediaDataSource,this._config),this._transmuxer.on(d.default.INIT_SEGMENT,function(a,u){s._msectl.appendInitSegment(u)}),this._transmuxer.on(d.default.MEDIA_SEGMENT,function(a,u){if(s._msectl.appendMediaSegment(u),s._config.lazyLoad&&!s._config.isLive){var _=s._mediaElement.currentTime;u.info.endDts>=(_+s._config.lazyLoadMaxDuration)*1e3&&s._progressChecker==null&&(c.default.v(s.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),s._suspendTransmuxer())}}),this._transmuxer.on(d.default.LOADING_COMPLETE,function(){s._msectl.endOfStream(),s._emitter.emit(p.default.LOADING_COMPLETE)}),this._transmuxer.on(d.default.RECOVERED_EARLY_EOF,function(){s._emitter.emit(p.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(d.default.IO_ERROR,function(a,u){s._emitter.emit(p.default.ERROR,t.ErrorTypes.NETWORK_ERROR,a,u)}),this._transmuxer.on(d.default.DEMUX_ERROR,function(a,u){s._emitter.emit(p.default.ERROR,t.ErrorTypes.MEDIA_ERROR,a,{code:-1,msg:u})}),this._transmuxer.on(d.default.MEDIA_INFO,function(a){s._mediaInfo=a,s._emitter.emit(p.default.MEDIA_INFO,Object.assign({},a))}),this._transmuxer.on(d.default.METADATA_ARRIVED,function(a){s._emitter.emit(p.default.METADATA_ARRIVED,a)}),this._transmuxer.on(d.default.SCRIPTDATA_ARRIVED,function(a){s._emitter.emit(p.default.SCRIPTDATA_ARRIVED,a)}),this._transmuxer.on(d.default.STATISTICS_INFO,function(a){s._statisticsInfo=s._fillStatisticsInfo(a),s._emitter.emit(p.default.STATISTICS_INFO,Object.assign({},s._statisticsInfo))}),this._transmuxer.on(d.default.RECOMMEND_SEEKPOINT,function(a){s._mediaElement&&!s._config.accurateSeek&&(s._requestSetTime=!0,s._mediaElement.currentTime=a/1e3)}),this._transmuxer.open()}},o.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},o.prototype.play=function(){return this._mediaElement.play()},o.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(o.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(s){this._mediaElement.volume=s},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(s){this._mediaElement.muted=s},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(s){this._mediaElement?this._internalSeek(s):this._pendingSeekTime=s},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),o.prototype._fillStatisticsInfo=function(s){if(s.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return s;var a=!0,u=0,_=0;if(this._mediaElement.getVideoPlaybackQuality){var g=this._mediaElement.getVideoPlaybackQuality();u=g.totalVideoFrames,_=g.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(u=this._mediaElement.webkitDecodedFrameCount,_=this._mediaElement.webkitDroppedFrameCount):a=!1;return a&&(s.decodedFrames=u,s.droppedFrames=_),s},o.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var s=this._mediaElement.buffered,a=this._mediaElement.currentTime,u=0,_=0;_<s.length;_++){var g=s.start(_),m=s.end(_);if(g<=a&&a<m){u=m;break}}u>=a+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(c.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},o.prototype._onmseBufferFull=function(){c.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},o.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},o.prototype._checkProgressAndResume=function(){for(var s=this._mediaElement.currentTime,a=this._mediaElement.buffered,u=!1,_=0;_<a.length;_++){var g=a.start(_),m=a.end(_);if(s>=g&&s<m){s>=m-this._config.lazyLoadRecoverDuration&&(u=!0);break}}u&&(window.clearInterval(this._progressChecker),this._progressChecker=null,u&&(c.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},o.prototype._isTimepointBuffered=function(s){for(var a=this._mediaElement.buffered,u=0;u<a.length;u++){var _=a.start(u),g=a.end(u);if(s>=_&&s<g)return!0}return!1},o.prototype._internalSeek=function(s){var a=this._isTimepointBuffered(s),u=!1,_=0;if(s<1&&this._mediaElement.buffered.length>0){var g=this._mediaElement.buffered.start(0);(g<1&&s<g||f.default.safari)&&(u=!0,_=f.default.safari?.1:g)}if(u)this._requestSetTime=!0,this._mediaElement.currentTime=_;else if(a){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=s;else{var m=this._msectl.getNearestKeyframe(Math.floor(s*1e3));this._requestSetTime=!0,m!=null?this._mediaElement.currentTime=m.dts/1e3:this._mediaElement.currentTime=s}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(s),this._transmuxer.seek(Math.floor(s*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=s)},o.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var s=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(s)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(s),this._transmuxer.seek(Math.floor(s*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=s))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},o.prototype._checkAndResumeStuckPlayback=function(s){var a=this._mediaElement;if(s||!this._receivedCanPlay||a.readyState<2){var u=a.buffered;u.length>0&&a.currentTime<u.start(0)&&(c.default.w(this.TAG,"Playback seems stuck at "+a.currentTime+", seek to "+u.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=u.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},o.prototype._onvLoadedMetadata=function(s){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},o.prototype._onvSeeking=function(s){var a=this._mediaElement.currentTime,u=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(a<1&&u.length>0){var _=u.start(0);if(_<1&&a<_||f.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=f.default.safari?.1:_;return}}if(this._isTimepointBuffered(a)){if(this._alwaysSeekKeyframe){var g=this._msectl.getNearestKeyframe(Math.floor(a*1e3));g!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=g.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:a,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},o.prototype._onvCanPlay=function(s){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},o.prototype._onvStalled=function(s){this._checkAndResumeStuckPlayback(!0)},o.prototype._onvProgress=function(s){this._checkAndResumeStuckPlayback()},o}();S.default=r},"./src/player/native-player.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=I("./src/player/player-events.js"),f=I("./src/config.js"),p=I("./src/utils/exception.js"),l=function(){function d(h,n){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(T()),this._config=(0,f.createDefaultConfig)(),typeof n=="object"&&Object.assign(this._config,n),h.type.toLowerCase()==="flv")throw new p.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(h.hasOwnProperty("segments"))throw new p.InvalidArgumentException("NativePlayer("+h.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=h,this._mediaElement=null}return d.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(h,n){var t=this;h===c.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(c.default.MEDIA_INFO,t.mediaInfo)}):h===c.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(c.default.STATISTICS_INFO,t.statisticsInfo)}),this._emitter.addListener(h,n)},d.prototype.off=function(h,n){this._emitter.removeListener(h,n)},d.prototype.attachMediaElement=function(h){if(this._mediaElement=h,h.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{h.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},d.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},d.prototype.load=function(){if(!this._mediaElement)throw new p.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},d.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},d.prototype.play=function(){return this._mediaElement.play()},d.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(h){this._mediaElement.volume=h},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(h){this._mediaElement.muted=h},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(h){this._mediaElement?this._mediaElement.currentTime=h:this._pendingSeekTime=h},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"mediaInfo",{get:function(){var h=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",n={mimeType:h+this._mediaDataSource.type};return this._mediaElement&&(n.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(n.width=this._mediaElement.videoWidth,n.height=this._mediaElement.videoHeight)),n},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"statisticsInfo",{get:function(){var h={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return h;var n=!0,t=0,e=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();t=i.totalVideoFrames,e=i.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(t=this._mediaElement.webkitDecodedFrameCount,e=this._mediaElement.webkitDroppedFrameCount):n=!1;return n&&(h.decodedFrames=t,h.droppedFrames=e),h},enumerable:!1,configurable:!0}),d.prototype._onvLoadedMetadata=function(h){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(c.default.MEDIA_INFO,this.mediaInfo)},d.prototype._reportStatisticsInfo=function(){this._emitter.emit(c.default.STATISTICS_INFO,this.statisticsInfo)},d}();S.default=l},"./src/player/player-errors.js":function(R,S,I){I.r(S),I.d(S,{ErrorTypes:function(){return c},ErrorDetails:function(){return f}});var b=I("./src/io/loader.js"),T=I("./src/demux/demux-errors.js"),c={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},f={NETWORK_EXCEPTION:b.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:b.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:b.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:b.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:T.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:T.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:T.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(R,S,I){I.r(S);var b={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};S.default=b},"./src/remux/aac-silent.js":function(R,S,I){I.r(S);var b=function(){function T(){}return T.getSilentFrame=function(c,f){if(c==="mp4a.40.2"){if(f===1)return new Uint8Array([0,200,0,128,35,128]);if(f===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(f===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(f===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(f===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(f===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(f===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(f===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},T}();S.default=b},"./src/remux/mp4-generator.js":function(R,S,I){I.r(S);var b=function(){function T(){}return T.init=function(){T.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var c in T.types)T.types.hasOwnProperty(c)&&(T.types[c]=[c.charCodeAt(0),c.charCodeAt(1),c.charCodeAt(2),c.charCodeAt(3)]);var f=T.constants={};f.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),f.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),f.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),f.STSC=f.STCO=f.STTS,f.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),f.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),f.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),f.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),f.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},T.box=function(c){for(var f=8,p=null,l=Array.prototype.slice.call(arguments,1),d=l.length,h=0;h<d;h++)f+=l[h].byteLength;p=new Uint8Array(f),p[0]=f>>>24&255,p[1]=f>>>16&255,p[2]=f>>>8&255,p[3]=f&255,p.set(c,4);for(var n=8,h=0;h<d;h++)p.set(l[h],n),n+=l[h].byteLength;return p},T.generateInitSegment=function(c){var f=T.box(T.types.ftyp,T.constants.FTYP),p=T.moov(c),l=new Uint8Array(f.byteLength+p.byteLength);return l.set(f,0),l.set(p,f.byteLength),l},T.moov=function(c){var f=T.mvhd(c.timescale,c.duration),p=T.trak(c),l=T.mvex(c);return T.box(T.types.moov,f,p,l)},T.mvhd=function(c,f){return T.box(T.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,c&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},T.trak=function(c){return T.box(T.types.trak,T.tkhd(c),T.mdia(c))},T.tkhd=function(c){var f=c.id,p=c.duration,l=c.presentWidth,d=c.presentHeight;return T.box(T.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,l>>>8&255,l&255,0,0,d>>>8&255,d&255,0,0]))},T.mdia=function(c){return T.box(T.types.mdia,T.mdhd(c),T.hdlr(c),T.minf(c))},T.mdhd=function(c){var f=c.timescale,p=c.duration;return T.box(T.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,p>>>24&255,p>>>16&255,p>>>8&255,p&255,85,196,0,0]))},T.hdlr=function(c){var f=null;return c.type==="audio"?f=T.constants.HDLR_AUDIO:f=T.constants.HDLR_VIDEO,T.box(T.types.hdlr,f)},T.minf=function(c){var f=null;return c.type==="audio"?f=T.box(T.types.smhd,T.constants.SMHD):f=T.box(T.types.vmhd,T.constants.VMHD),T.box(T.types.minf,f,T.dinf(),T.stbl(c))},T.dinf=function(){var c=T.box(T.types.dinf,T.box(T.types.dref,T.constants.DREF));return c},T.stbl=function(c){var f=T.box(T.types.stbl,T.stsd(c),T.box(T.types.stts,T.constants.STTS),T.box(T.types.stsc,T.constants.STSC),T.box(T.types.stsz,T.constants.STSZ),T.box(T.types.stco,T.constants.STCO));return f},T.stsd=function(c){return c.type==="audio"?c.codec==="mp3"?T.box(T.types.stsd,T.constants.STSD_PREFIX,T.mp3(c)):T.box(T.types.stsd,T.constants.STSD_PREFIX,T.mp4a(c)):T.box(T.types.stsd,T.constants.STSD_PREFIX,T.avc1(c))},T.mp3=function(c){var f=c.channelCount,p=c.audioSampleRate,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,f,0,16,0,0,0,0,p>>>8&255,p&255,0,0]);return T.box(T.types[".mp3"],l)},T.mp4a=function(c){var f=c.channelCount,p=c.audioSampleRate,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,f,0,16,0,0,0,0,p>>>8&255,p&255,0,0]);return T.box(T.types.mp4a,l,T.esds(c))},T.esds=function(c){var f=c.config||[],p=f.length,l=new Uint8Array([0,0,0,0,3,23+p,0,1,0,4,15+p,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([p]).concat(f).concat([6,1,2]));return T.box(T.types.esds,l)},T.avc1=function(c){var f=c.avcc,p=c.codecWidth,l=c.codecHeight,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,p&255,l>>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return T.box(T.types.avc1,d,T.box(T.types.avcC,f))},T.mvex=function(c){return T.box(T.types.mvex,T.trex(c))},T.trex=function(c){var f=c.id,p=new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return T.box(T.types.trex,p)},T.moof=function(c,f){return T.box(T.types.moof,T.mfhd(c.sequenceNumber),T.traf(c,f))},T.mfhd=function(c){var f=new Uint8Array([0,0,0,0,c>>>24&255,c>>>16&255,c>>>8&255,c&255]);return T.box(T.types.mfhd,f)},T.traf=function(c,f){var p=c.id,l=T.box(T.types.tfhd,new Uint8Array([0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255])),d=T.box(T.types.tfdt,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255])),h=T.sdtp(c),n=T.trun(c,h.byteLength+16+16+8+16+8+8);return T.box(T.types.traf,l,d,n,h)},T.sdtp=function(c){for(var f=c.samples||[],p=f.length,l=new Uint8Array(4+p),d=0;d<p;d++){var h=f[d].flags;l[d+4]=h.isLeading<<6|h.dependsOn<<4|h.isDependedOn<<2|h.hasRedundancy}return T.box(T.types.sdtp,l)},T.trun=function(c,f){var p=c.samples||[],l=p.length,d=12+16*l,h=new Uint8Array(d);f+=8+d,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,l&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255],0);for(var n=0;n<l;n++){var t=p[n].duration,e=p[n].size,i=p[n].flags,r=p[n].cts;h.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.isNonSync,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*n)}return T.box(T.types.trun,h)},T.mdat=function(c){return T.box(T.types.mdat,c)},T}();b.init(),S.default=b},"./src/remux/mp4-remuxer.js":function(R,S,I){I.r(S);var b=I("./src/utils/logger.js"),T=I("./src/remux/mp4-generator.js"),c=I("./src/remux/aac-silent.js"),f=I("./src/utils/browser.js"),p=I("./src/core/media-segment-info.js"),l=I("./src/utils/exception.js"),d=function(){function h(n){this.TAG="MP4Remuxer",this._config=n,this._isLive=n.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new p.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new p.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(f.default.chrome&&(f.default.version.major<50||f.default.version.major===50&&f.default.version.build<2661)),this._fillSilentAfterSeek=f.default.msedge||f.default.msie,this._mp3UseMpegAudio=!f.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return h.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},h.prototype.bindDataSource=function(n){return n.onDataAvailable=this.remux.bind(this),n.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(h.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(n){this._onInitSegment=n},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(n){this._onMediaSegment=n},enumerable:!1,configurable:!0}),h.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},h.prototype.seek=function(n){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},h.prototype.remux=function(n,t){if(!this._onMediaSegment)throw new l.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(n,t),this._remuxVideo(t),this._remuxAudio(n)},h.prototype._onTrackMetadataReceived=function(n,t){var e=null,i="mp4",r=t.codec;if(n==="audio")this._audioMeta=t,t.codec==="mp3"&&this._mp3UseMpegAudio?(i="mpeg",r="",e=new Uint8Array):e=T.default.generateInitSegment(t);else if(n==="video")this._videoMeta=t,e=T.default.generateInitSegment(t);else return;if(!this._onInitSegment)throw new l.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(n,{type:n,data:e.buffer,codec:r,container:n+"/"+i,mediaDuration:t.duration})},h.prototype._calculateDtsBase=function(n,t){this._dtsBaseInited||(n.samples&&n.samples.length&&(this._audioDtsBase=n.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},h.prototype.flushStashedSamples=function(){var n=this._videoStashedLastSample,t=this._audioStashedLastSample,e={type:"video",id:1,sequenceNumber:0,samples:[],length:0};n!=null&&(e.samples.push(n),e.length=n.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};t!=null&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(e,!0),this._remuxAudio(i,!0)},h.prototype._remuxAudio=function(n,t){if(this._audioMeta!=null){var e=n,i=e.samples,r=void 0,o=-1,s=-1,a=this._audioMeta.refSampleDuration,u=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,_=this._dtsBaseInited&&this._audioNextDts===void 0,g=!1;if(!(!i||i.length===0)&&!(i.length===1&&!t)){var m=0,y=null,v=0;u?(m=0,v=e.length):(m=8,v=8+e.length);var E=null;if(i.length>1&&(E=i.pop(),v-=E.length),this._audioStashedLastSample!=null){var x=this._audioStashedLastSample;this._audioStashedLastSample=null,i.unshift(x),v+=x.length}E!=null&&(this._audioStashedLastSample=E);var L=i[0].dts-this._dtsBase;if(this._audioNextDts)r=L-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())r=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(g=!0);else{var O=this._audioSegmentInfoList.getLastSampleBefore(L);if(O!=null){var C=L-(O.originalDts+O.duration);C<=3&&(C=0);var F=O.dts+O.duration+C;r=L-F}else r=0}if(g){var M=L-r,B=this._videoSegmentInfoList.getLastSegmentBefore(L);if(B!=null&&B.beginDts<M){var k=c.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(k){var w=B.beginDts,U=M-B.beginDts;b.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+w+", duration: "+U),i.unshift({unit:k,dts:w,pts:w}),v+=k.byteLength}}else g=!1}for(var N=[],K=0;K<i.length;K++){var x=i[K],H=x.unit,z=x.dts-this._dtsBase,w=z,G=!1,q=null,Z=0;if(!(z<-.001)){if(this._audioMeta.codec!=="mp3"){var V=z,X=3;if(this._audioNextDts&&(V=this._audioNextDts),r=z-V,r<=-X*a){b.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+z+" ms ,curRefDts: "+V+" ms)  due to dtsCorrection: "+r+" ms overlap.");continue}else if(r>=X*a&&this._fillAudioTimestampGap&&!f.default.safari){G=!0;var J=Math.floor(r/a);b.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+z+" ms, curRefDts: "+V+" ms, ")+("dtsCorrection: "+Math.round(r)+" ms, generate: "+J+" frames")),w=Math.floor(V),Z=Math.floor(V+a)-w;var k=c.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);k==null&&(b.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),k=H),q=[];for(var re=0;re<J;re++){V=V+a;var ie=Math.floor(V),ne=Math.floor(V+a)-ie,ae={dts:ie,pts:ie,cts:0,unit:k,size:k.byteLength,duration:ne,originalDts:z,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};q.push(ae),v+=ae.size}this._audioNextDts=V+a}else w=Math.floor(V),Z=Math.floor(V+a)-w,this._audioNextDts=V+a}else{if(w=z-r,K!==i.length-1){var ue=i[K+1].dts-this._dtsBase-r;Z=ue-w}else if(E!=null){var ue=E.dts-this._dtsBase-r;Z=ue-w}else N.length>=1?Z=N[N.length-1].duration:Z=Math.floor(a);this._audioNextDts=w+Z}o===-1&&(o=w),N.push({dts:w,pts:w,cts:0,unit:x.unit,size:x.unit.byteLength,duration:Z,originalDts:z,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),G&&N.push.apply(N,q)}}if(N.length===0){e.samples=[],e.length=0;return}u?y=new Uint8Array(v):(y=new Uint8Array(v),y[0]=v>>>24&255,y[1]=v>>>16&255,y[2]=v>>>8&255,y[3]=v&255,y.set(T.default.types.mdat,4));for(var K=0;K<N.length;K++){var H=N[K].unit;y.set(H,m),m+=H.byteLength}var oe=N[N.length-1];s=oe.dts+oe.duration;var se=new p.MediaSegmentInfo;se.beginDts=o,se.endDts=s,se.beginPts=o,se.endPts=s,se.originalBeginDts=N[0].originalDts,se.originalEndDts=oe.originalDts+oe.duration,se.firstSample=new p.SampleInfo(N[0].dts,N[0].pts,N[0].duration,N[0].originalDts,!1),se.lastSample=new p.SampleInfo(oe.dts,oe.pts,oe.duration,oe.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(se),e.samples=N,e.sequenceNumber++;var de=null;u?de=new Uint8Array:de=T.default.moof(e,o),e.samples=[],e.length=0;var ce={type:"audio",data:this._mergeBoxes(de,y).buffer,sampleCount:N.length,info:se};u&&_&&(ce.timestampOffset=o),this._onMediaSegment("audio",ce)}}},h.prototype._remuxVideo=function(n,t){if(this._videoMeta!=null){var e=n,i=e.samples,r=void 0,o=-1,s=-1,a=-1,u=-1;if(!(!i||i.length===0)&&!(i.length===1&&!t)){var _=8,g=null,m=8+n.length,y=null;if(i.length>1&&(y=i.pop(),m-=y.length),this._videoStashedLastSample!=null){var v=this._videoStashedLastSample;this._videoStashedLastSample=null,i.unshift(v),m+=v.length}y!=null&&(this._videoStashedLastSample=y);var E=i[0].dts-this._dtsBase;if(this._videoNextDts)r=E-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())r=0;else{var x=this._videoSegmentInfoList.getLastSampleBefore(E);if(x!=null){var L=E-(x.originalDts+x.duration);L<=3&&(L=0);var O=x.dts+x.duration+L;r=E-O}else r=0}for(var C=new p.MediaSegmentInfo,F=[],M=0;M<i.length;M++){var v=i[M],B=v.dts-this._dtsBase,k=v.isKeyframe,w=B-r,U=v.cts,N=w+U;o===-1&&(o=w,a=N);var K=0;if(M!==i.length-1){var H=i[M+1].dts-this._dtsBase-r;K=H-w}else if(y!=null){var H=y.dts-this._dtsBase-r;K=H-w}else F.length>=1?K=F[F.length-1].duration:K=Math.floor(this._videoMeta.refSampleDuration);if(k){var z=new p.SampleInfo(w,N,K,v.dts,!0);z.fileposition=v.fileposition,C.appendSyncPoint(z)}F.push({dts:w,pts:N,cts:U,units:v.units,size:v.length,isKeyframe:k,duration:K,originalDts:B,flags:{isLeading:0,dependsOn:k?2:1,isDependedOn:k?1:0,hasRedundancy:0,isNonSync:k?0:1}})}g=new Uint8Array(m),g[0]=m>>>24&255,g[1]=m>>>16&255,g[2]=m>>>8&255,g[3]=m&255,g.set(T.default.types.mdat,4);for(var M=0;M<F.length;M++)for(var G=F[M].units;G.length;){var q=G.shift(),Z=q.data;g.set(Z,_),_+=Z.byteLength}var V=F[F.length-1];if(s=V.dts+V.duration,u=V.pts+V.duration,this._videoNextDts=s,C.beginDts=o,C.endDts=s,C.beginPts=a,C.endPts=u,C.originalBeginDts=F[0].originalDts,C.originalEndDts=V.originalDts+V.duration,C.firstSample=new p.SampleInfo(F[0].dts,F[0].pts,F[0].duration,F[0].originalDts,F[0].isKeyframe),C.lastSample=new p.SampleInfo(V.dts,V.pts,V.duration,V.originalDts,V.isKeyframe),this._isLive||this._videoSegmentInfoList.append(C),e.samples=F,e.sequenceNumber++,this._forceFirstIDR){var X=F[0].flags;X.dependsOn=2,X.isNonSync=0}var J=T.default.moof(e,o);e.samples=[],e.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(J,g).buffer,sampleCount:F.length,info:C})}}},h.prototype._mergeBoxes=function(n,t){var e=new Uint8Array(n.byteLength+t.byteLength);return e.set(n,0),e.set(t,n.byteLength),e},h}();S.default=d},"./src/utils/browser.js":function(R,S,I){I.r(S);var b={};function T(){var c=self.navigator.userAgent.toLowerCase(),f=/(edge)\/([\w.]+)/.exec(c)||/(opr)[\/]([\w.]+)/.exec(c)||/(chrome)[ \/]([\w.]+)/.exec(c)||/(iemobile)[\/]([\w.]+)/.exec(c)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(c)||[],p=/(ipad)/.exec(c)||/(ipod)/.exec(c)||/(windows phone)/.exec(c)||/(iphone)/.exec(c)||/(kindle)/.exec(c)||/(android)/.exec(c)||/(windows)/.exec(c)||/(mac)/.exec(c)||/(linux)/.exec(c)||/(cros)/.exec(c)||[],l={browser:f[5]||f[3]||f[1]||"",version:f[2]||f[4]||"0",majorVersion:f[4]||f[2]||"0",platform:p[0]||""},d={};if(l.browser){d[l.browser]=!0;var h=l.majorVersion.split(".");d.version={major:parseInt(l.majorVersion,10),string:l.version},h.length>1&&(d.version.minor=parseInt(h[1],10)),h.length>2&&(d.version.build=parseInt(h[2],10))}if(l.platform&&(d[l.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv||d.iemobile){d.rv&&delete d.rv;var n="msie";l.browser=n,d[n]=!0}if(d.edge){delete d.edge;var t="msedge";l.browser=t,d[t]=!0}if(d.opr){var e="opera";l.browser=e,d[e]=!0}if(d.safari&&d.android){var i="android";l.browser=i,d[i]=!0}d.name=l.browser,d.platform=l.platform;for(var r in b)b.hasOwnProperty(r)&&delete b[r];Object.assign(b,d)}T(),S.default=b},"./src/utils/exception.js":function(R,S,I){I.r(S),I.d(S,{RuntimeException:function(){return T},IllegalStateException:function(){return c},InvalidArgumentException:function(){return f},NotImplementedException:function(){return p}});var b=function(){var l=function(d,h){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])},l(d,h)};return function(d,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");l(d,h);function n(){this.constructor=d}d.prototype=h===null?Object.create(h):(n.prototype=h.prototype,new n)}}(),T=function(){function l(d){this._message=d}return Object.defineProperty(l.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),l.prototype.toString=function(){return this.name+": "+this.message},l}(),c=function(l){b(d,l);function d(h){return l.call(this,h)||this}return Object.defineProperty(d.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),d}(T),f=function(l){b(d,l);function d(h){return l.call(this,h)||this}return Object.defineProperty(d.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),d}(T),p=function(l){b(d,l);function d(h){return l.call(this,h)||this}return Object.defineProperty(d.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),d}(T)},"./src/utils/logger.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=function(){function f(){}return f.e=function(p,l){(!p||f.FORCE_GLOBAL_TAG)&&(p=f.GLOBAL_TAG);var d="["+p+"] > "+l;f.ENABLE_CALLBACK&&f.emitter.emit("log","error",d),f.ENABLE_ERROR&&(console.error?console.error(d):console.warn?console.warn(d):console.log(d))},f.i=function(p,l){(!p||f.FORCE_GLOBAL_TAG)&&(p=f.GLOBAL_TAG);var d="["+p+"] > "+l;f.ENABLE_CALLBACK&&f.emitter.emit("log","info",d),f.ENABLE_INFO&&(console.info?console.info(d):console.log(d))},f.w=function(p,l){(!p||f.FORCE_GLOBAL_TAG)&&(p=f.GLOBAL_TAG);var d="["+p+"] > "+l;f.ENABLE_CALLBACK&&f.emitter.emit("log","warn",d),f.ENABLE_WARN&&(console.warn?console.warn(d):console.log(d))},f.d=function(p,l){(!p||f.FORCE_GLOBAL_TAG)&&(p=f.GLOBAL_TAG);var d="["+p+"] > "+l;f.ENABLE_CALLBACK&&f.emitter.emit("log","debug",d),f.ENABLE_DEBUG&&(console.debug?console.debug(d):console.log(d))},f.v=function(p,l){(!p||f.FORCE_GLOBAL_TAG)&&(p=f.GLOBAL_TAG);var d="["+p+"] > "+l;f.ENABLE_CALLBACK&&f.emitter.emit("log","verbose",d),f.ENABLE_VERBOSE&&console.log(d)},f}();c.GLOBAL_TAG="flv.js",c.FORCE_GLOBAL_TAG=!1,c.ENABLE_ERROR=!0,c.ENABLE_INFO=!0,c.ENABLE_WARN=!0,c.ENABLE_DEBUG=!0,c.ENABLE_VERBOSE=!0,c.ENABLE_CALLBACK=!1,c.emitter=new(T()),S.default=c},"./src/utils/logging-control.js":function(R,S,I){I.r(S);var b=I("./node_modules/events/events.js"),T=I.n(b),c=I("./src/utils/logger.js"),f=function(){function p(){}return Object.defineProperty(p,"forceGlobalTag",{get:function(){return c.default.FORCE_GLOBAL_TAG},set:function(l){c.default.FORCE_GLOBAL_TAG=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"globalTag",{get:function(){return c.default.GLOBAL_TAG},set:function(l){c.default.GLOBAL_TAG=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableAll",{get:function(){return c.default.ENABLE_VERBOSE&&c.default.ENABLE_DEBUG&&c.default.ENABLE_INFO&&c.default.ENABLE_WARN&&c.default.ENABLE_ERROR},set:function(l){c.default.ENABLE_VERBOSE=l,c.default.ENABLE_DEBUG=l,c.default.ENABLE_INFO=l,c.default.ENABLE_WARN=l,c.default.ENABLE_ERROR=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableDebug",{get:function(){return c.default.ENABLE_DEBUG},set:function(l){c.default.ENABLE_DEBUG=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableVerbose",{get:function(){return c.default.ENABLE_VERBOSE},set:function(l){c.default.ENABLE_VERBOSE=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableInfo",{get:function(){return c.default.ENABLE_INFO},set:function(l){c.default.ENABLE_INFO=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableWarn",{get:function(){return c.default.ENABLE_WARN},set:function(l){c.default.ENABLE_WARN=l,p._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(p,"enableError",{get:function(){return c.default.ENABLE_ERROR},set:function(l){c.default.ENABLE_ERROR=l,p._notifyChange()},enumerable:!1,configurable:!0}),p.getConfig=function(){return{globalTag:c.default.GLOBAL_TAG,forceGlobalTag:c.default.FORCE_GLOBAL_TAG,enableVerbose:c.default.ENABLE_VERBOSE,enableDebug:c.default.ENABLE_DEBUG,enableInfo:c.default.ENABLE_INFO,enableWarn:c.default.ENABLE_WARN,enableError:c.default.ENABLE_ERROR,enableCallback:c.default.ENABLE_CALLBACK}},p.applyConfig=function(l){c.default.GLOBAL_TAG=l.globalTag,c.default.FORCE_GLOBAL_TAG=l.forceGlobalTag,c.default.ENABLE_VERBOSE=l.enableVerbose,c.default.ENABLE_DEBUG=l.enableDebug,c.default.ENABLE_INFO=l.enableInfo,c.default.ENABLE_WARN=l.enableWarn,c.default.ENABLE_ERROR=l.enableError,c.default.ENABLE_CALLBACK=l.enableCallback},p._notifyChange=function(){var l=p.emitter;if(l.listenerCount("change")>0){var d=p.getConfig();l.emit("change",d)}},p.registerListener=function(l){p.emitter.addListener("change",l)},p.removeListener=function(l){p.emitter.removeListener("change",l)},p.addLogListener=function(l){c.default.emitter.addListener("log",l),c.default.emitter.listenerCount("log")>0&&(c.default.ENABLE_CALLBACK=!0,p._notifyChange())},p.removeLogListener=function(l){c.default.emitter.removeListener("log",l),c.default.emitter.listenerCount("log")===0&&(c.default.ENABLE_CALLBACK=!1,p._notifyChange())},p}();f.emitter=new(T()),S.default=f},"./src/utils/polyfill.js":function(R,S,I){I.r(S);var b=function(){function T(){}return T.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(c,f){return c.__proto__=f,c},Object.assign=Object.assign||function(c){if(c==null)throw new TypeError("Cannot convert undefined or null to object");for(var f=Object(c),p=1;p<arguments.length;p++){var l=arguments[p];if(l!=null)for(var d in l)l.hasOwnProperty(d)&&(f[d]=l[d])}return f},typeof self.Promise!="function"&&I("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},T}();b.install(),S.default=b},"./src/utils/utf8-conv.js":function(R,S,I){I.r(S);function b(c,f,p){var l=c;if(f+p<l.length){for(;p--;)if((l[++f]&192)!==128)return!1;return!0}else return!1}function T(c){for(var f=[],p=c,l=0,d=c.length;l<d;){if(p[l]<128){f.push(String.fromCharCode(p[l])),++l;continue}else if(!(p[l]<192)){if(p[l]<224){if(b(p,l,1)){var h=(p[l]&31)<<6|p[l+1]&63;if(h>=128){f.push(String.fromCharCode(h&65535)),l+=2;continue}}}else if(p[l]<240){if(b(p,l,2)){var h=(p[l]&15)<<12|(p[l+1]&63)<<6|p[l+2]&63;if(h>=2048&&(h&63488)!==55296){f.push(String.fromCharCode(h&65535)),l+=3;continue}}}else if(p[l]<248&&b(p,l,3)){var h=(p[l]&7)<<18|(p[l+1]&63)<<12|(p[l+2]&63)<<6|p[l+3]&63;if(h>65536&&h<1114112){h-=65536,f.push(String.fromCharCode(h>>>10|55296)),f.push(String.fromCharCode(h&1023|56320)),l+=4;continue}}}f.push(String.fromCharCode(65533)),++l}return f.join("")}S.default=T}},P={};function D(R){var S=P[R];if(S!==void 0)return S.exports;var I=P[R]={exports:{}};return j[R].call(I.exports,I,I.exports,D),I.exports}D.m=j,function(){D.n=function(R){var S=R&&R.__esModule?function(){return R.default}:function(){return R};return D.d(S,{a:S}),S}}(),function(){D.d=function(R,S){for(var I in S)D.o(S,I)&&!D.o(R,I)&&Object.defineProperty(R,I,{enumerable:!0,get:S[I]})}}(),function(){D.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){D.o=function(R,S){return Object.prototype.hasOwnProperty.call(R,S)}}(),function(){D.r=function(R){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})}}();var A=D("./src/index.js");return A}()})})(ze);const Ot=Ue(ze.exports);var Ye={exports:{}};(function(ye,_e){typeof window<"u"&&function(P,D){ye.exports=D()}(we,function(){return function(j){var P={};function D(A){if(P[A])return P[A].exports;var R=P[A]={i:A,l:!1,exports:{}};return j[A].call(R.exports,R,R.exports,D),R.l=!0,R.exports}return D.m=j,D.c=P,D.d=function(A,R,S){D.o(A,R)||Object.defineProperty(A,R,{enumerable:!0,get:S})},D.r=function(A){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"__esModule",{value:!0})},D.t=function(A,R){if(R&1&&(A=D(A)),R&8||R&4&&typeof A=="object"&&A&&A.__esModule)return A;var S=Object.create(null);if(D.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:A}),R&2&&typeof A!="string")for(var I in A)D.d(S,I,function(b){return A[b]}.bind(null,I));return S},D.n=function(A){var R=A&&A.__esModule?function(){return A.default}:function(){return A};return D.d(R,"a",R),R},D.o=function(A,R){return Object.prototype.hasOwnProperty.call(A,R)},D.p="/dist/",D(D.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(j,P,D){var A=Object.prototype.hasOwnProperty,R="~";function S(){}Object.create&&(S.prototype=Object.create(null),new S().__proto__||(R=!1));function I(f,p,l){this.fn=f,this.context=p,this.once=l||!1}function b(f,p,l,d,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var n=new I(l,d||f,h),t=R?R+p:p;return f._events[t]?f._events[t].fn?f._events[t]=[f._events[t],n]:f._events[t].push(n):(f._events[t]=n,f._eventsCount++),f}function T(f,p){--f._eventsCount===0?f._events=new S:delete f._events[p]}function c(){this._events=new S,this._eventsCount=0}c.prototype.eventNames=function(){var p=[],l,d;if(this._eventsCount===0)return p;for(d in l=this._events)A.call(l,d)&&p.push(R?d.slice(1):d);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(l)):p},c.prototype.listeners=function(p){var l=R?R+p:p,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,n=d.length,t=new Array(n);h<n;h++)t[h]=d[h].fn;return t},c.prototype.listenerCount=function(p){var l=R?R+p:p,d=this._events[l];return d?d.fn?1:d.length:0},c.prototype.emit=function(p,l,d,h,n,t){var e=R?R+p:p;if(!this._events[e])return!1;var i=this._events[e],r=arguments.length,o,s;if(i.fn){switch(i.once&&this.removeListener(p,i.fn,void 0,!0),r){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,l),!0;case 3:return i.fn.call(i.context,l,d),!0;case 4:return i.fn.call(i.context,l,d,h),!0;case 5:return i.fn.call(i.context,l,d,h,n),!0;case 6:return i.fn.call(i.context,l,d,h,n,t),!0}for(s=1,o=new Array(r-1);s<r;s++)o[s-1]=arguments[s];i.fn.apply(i.context,o)}else{var a=i.length,u;for(s=0;s<a;s++)switch(i[s].once&&this.removeListener(p,i[s].fn,void 0,!0),r){case 1:i[s].fn.call(i[s].context);break;case 2:i[s].fn.call(i[s].context,l);break;case 3:i[s].fn.call(i[s].context,l,d);break;case 4:i[s].fn.call(i[s].context,l,d,h);break;default:if(!o)for(u=1,o=new Array(r-1);u<r;u++)o[u-1]=arguments[u];i[s].fn.apply(i[s].context,o)}}return!0},c.prototype.on=function(p,l,d){return b(this,p,l,d,!1)},c.prototype.once=function(p,l,d){return b(this,p,l,d,!0)},c.prototype.removeListener=function(p,l,d,h){var n=R?R+p:p;if(!this._events[n])return this;if(!l)return T(this,n),this;var t=this._events[n];if(t.fn)t.fn===l&&(!h||t.once)&&(!d||t.context===d)&&T(this,n);else{for(var e=0,i=[],r=t.length;e<r;e++)(t[e].fn!==l||h&&!t[e].once||d&&t[e].context!==d)&&i.push(t[e]);i.length?this._events[n]=i.length===1?i[0]:i:T(this,n)}return this},c.prototype.removeAllListeners=function(p){var l;return p?(l=R?R+p:p,this._events[l]&&T(this,l)):(this._events=new S,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=R,c.EventEmitter=c,j.exports=c},"./node_modules/url-toolkit/src/url-toolkit.js":function(j,P,D){(function(A){var R=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,S=/^(?=([^\/?#]*))\1([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,T={buildAbsoluteURL:function(c,f,p){if(p=p||{},c=c.trim(),f=f.trim(),!f){if(!p.alwaysNormalize)return c;var l=T.parseURL(c);if(!l)throw new Error("Error trying to parse base URL.");return l.path=T.normalizePath(l.path),T.buildURLFromParts(l)}var d=T.parseURL(f);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return p.alwaysNormalize?(d.path=T.normalizePath(d.path),T.buildURLFromParts(d)):f;var h=T.parseURL(c);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var n=S.exec(h.path);h.netLoc=n[1],h.path=n[2]}h.netLoc&&!h.path&&(h.path="/");var t={scheme:h.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(t.netLoc=h.netLoc,d.path[0]!=="/"))if(!d.path)t.path=h.path,d.params||(t.params=h.params,d.query||(t.query=h.query));else{var e=h.path,i=e.substring(0,e.lastIndexOf("/")+1)+d.path;t.path=T.normalizePath(i)}return t.path===null&&(t.path=p.alwaysNormalize?T.normalizePath(d.path):d.path),T.buildURLFromParts(t)},parseURL:function(c){var f=R.exec(c);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(I,"");c.length!==(c=c.replace(b,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};j.exports=T})()},"./node_modules/webworkify-webpack/index.js":function(j,P,D){function A(p){var l={};function d(n){if(l[n])return l[n].exports;var t=l[n]={i:n,l:!1,exports:{}};return p[n].call(t.exports,t,t.exports,d),t.l=!0,t.exports}d.m=p,d.c=l,d.i=function(n){return n},d.d=function(n,t,e){d.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:e})},d.r=function(n){Object.defineProperty(n,"__esModule",{value:!0})},d.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return d.d(t,"a",t),t},d.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},d.p="/",d.oe=function(n){throw console.error(n),n};var h=d(d.s=ENTRY_MODULE);return h.default||h}var R="[\\.|\\-|\\+|\\w|/|@]+",S="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+R+").*?\\)";function I(p){return(p+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function b(p){return!isNaN(1*p)}function T(p,l,d){var h={};h[d]=[];var n=l.toString(),t=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!t)return h;for(var e=t[1],i=new RegExp("(\\\\n|\\W)"+I(e)+S,"g"),r;r=i.exec(n);)r[3]!=="dll-reference"&&h[d].push(r[3]);for(i=new RegExp("\\("+I(e)+'\\("(dll-reference\\s('+R+'))"\\)\\)'+S,"g");r=i.exec(n);)p[r[2]]||(h[d].push(r[1]),p[r[2]]=D(r[1]).m),h[r[2]]=h[r[2]]||[],h[r[2]].push(r[4]);for(var o=Object.keys(h),s=0;s<o.length;s++)for(var a=0;a<h[o[s]].length;a++)b(h[o[s]][a])&&(h[o[s]][a]=1*h[o[s]][a]);return h}function c(p){var l=Object.keys(p);return l.reduce(function(d,h){return d||p[h].length>0},!1)}function f(p,l){for(var d={main:[l]},h={main:[]},n={main:{}};c(d);)for(var t=Object.keys(d),e=0;e<t.length;e++){var i=t[e],r=d[i],o=r.pop();if(n[i]=n[i]||{},!(n[i][o]||!p[i][o])){n[i][o]=!0,h[i]=h[i]||[],h[i].push(o);for(var s=T(p,p[i][o],i),a=Object.keys(s),u=0;u<a.length;u++)d[a[u]]=d[a[u]]||[],d[a[u]]=d[a[u]].concat(s[a[u]])}}return h}j.exports=function(p,l){l=l||{};var d={main:D.m},h=l.all?{main:Object.keys(d.main)}:f(d,p),n="";Object.keys(h).filter(function(o){return o!=="main"}).forEach(function(o){for(var s=0;h[o][s];)s++;h[o].push(s),d[o][s]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",n=n+"var "+o+" = ("+A.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+h[o].map(function(a){return""+JSON.stringify(a)+": "+d[o][a].toString()}).join(",")+`});
`}),n=n+"new (("+A.toString().replace("ENTRY_MODULE",JSON.stringify(p))+")({"+h.main.map(function(o){return""+JSON.stringify(o)+": "+d.main[o].toString()}).join(",")+"}))(self);";var t=new window.Blob([n],{type:"text/javascript"});if(l.bare)return t;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,i=e.createObjectURL(t),r=new window.Worker(i);return r.objectURL=i,r}},"./src/config.ts":function(j,P,D){D.r(P),D.d(P,"hlsDefaultConfig",function(){return u}),D.d(P,"mergeConfig",function(){return g}),D.d(P,"enableStreamingMode",function(){return m});var A=D("./src/controller/abr-controller.ts"),R=D("./src/controller/audio-stream-controller.ts"),S=D("./src/controller/audio-track-controller.ts"),I=D("./src/controller/subtitle-stream-controller.ts"),b=D("./src/controller/subtitle-track-controller.ts"),T=D("./src/controller/buffer-controller.ts"),c=D("./src/controller/timeline-controller.ts"),f=D("./src/controller/cap-level-controller.ts"),p=D("./src/controller/fps-controller.ts"),l=D("./src/controller/eme-controller.ts"),d=D("./src/controller/cmcd-controller.ts"),h=D("./src/utils/xhr-loader.ts"),n=D("./src/utils/fetch-loader.ts"),t=D("./src/utils/cues.ts"),e=D("./src/utils/mediakeys-helper.ts"),i=D("./src/utils/logger.ts");function r(){return r=Object.assign?Object.assign.bind():function(y){for(var v=1;v<arguments.length;v++){var E=arguments[v];for(var x in E)Object.prototype.hasOwnProperty.call(E,x)&&(y[x]=E[x])}return y},r.apply(this,arguments)}function o(y,v){var E=Object.keys(y);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(y);v&&(x=x.filter(function(L){return Object.getOwnPropertyDescriptor(y,L).enumerable})),E.push.apply(E,x)}return E}function s(y){for(var v=1;v<arguments.length;v++){var E=arguments[v]!=null?arguments[v]:{};v%2?o(Object(E),!0).forEach(function(x){a(y,x,E[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(E)):o(Object(E)).forEach(function(x){Object.defineProperty(y,x,Object.getOwnPropertyDescriptor(E,x))})}return y}function a(y,v,E){return v in y?Object.defineProperty(y,v,{value:E,enumerable:!0,configurable:!0,writable:!0}):y[v]=E,y}var u=s(s({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:h.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:A.default,bufferController:T.default,capLevelController:f.default,fpsController:p.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},_()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:b.default,timelineController:c.TimelineController,audioStreamController:R.default,audioTrackController:S.default,emeController:l.default,cmcdController:d.default});function _(){return{cueHandler:t.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function g(y,v){if((v.liveSyncDurationCount||v.liveMaxLatencyDurationCount)&&(v.liveSyncDuration||v.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(v.liveMaxLatencyDurationCount!==void 0&&(v.liveSyncDurationCount===void 0||v.liveMaxLatencyDurationCount<=v.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(v.liveMaxLatencyDuration!==void 0&&(v.liveSyncDuration===void 0||v.liveMaxLatencyDuration<=v.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return r({},y,v)}function m(y){var v=y.loader;if(v!==n.default&&v!==h.default)i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),y.progressive=!1;else{var E=Object(n.fetchSupported)();E&&(y.loader=n.default,y.progressive=!0,y.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(j,P,D){D.r(P);var A=D("./src/polyfills/number.ts"),R=D("./src/utils/ewma-bandwidth-estimator.ts"),S=D("./src/events.ts"),I=D("./src/utils/buffer-helper.ts"),b=D("./src/errors.ts"),T=D("./src/types/loader.ts"),c=D("./src/utils/logger.ts");function f(d,h){for(var n=0;n<h.length;n++){var t=h[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}}function p(d,h,n){return h&&f(d.prototype,h),n&&f(d,n),Object.defineProperty(d,"prototype",{writable:!1}),d}var l=function(){function d(n){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=n;var t=n.config;this.bwEstimator=new R.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var h=d.prototype;return h.registerListeners=function(){var t=this.hls;t.on(S.Events.FRAG_LOADING,this.onFragLoading,this),t.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(S.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var t=this.hls;t.off(S.Events.FRAG_LOADING,this.onFragLoading,this),t.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(S.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},h.onFragLoading=function(t,e){var i=e.frag;if(i.type===T.PlaylistLevelType.MAIN&&!this.timer){var r;this.fragCurrent=i,this.partCurrent=(r=e.part)!=null?r:null,this.timer=self.setInterval(this.onCheck,100)}},h.onLevelLoaded=function(t,e){var i=this.hls.config;e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},h._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,r=i.autoLevelEnabled,o=i.config,s=i.media;if(!(!t||!s)){var a=e?e.stats:t.stats,u=e?e.duration:t.duration;if(a.aborted){c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!r||s.paused||!s.playbackRate||!s.readyState)){var _=performance.now()-a.loading.start,g=Math.abs(s.playbackRate);if(!(_<=500*u/g)){var m=i.levels,y=i.minAutoLevel,v=m[t.level],E=a.total||Math.max(a.loaded,Math.round(u*v.maxBitrate/8)),x=Math.max(1,a.bwEstimate?a.bwEstimate/8:a.loaded*1e3/_),L=(E-a.loaded)/x,O=s.currentTime,C=(I.BufferHelper.bufferInfo(s,O,o.maxBufferHole).end-O)/g;if(!(C>=2*u/g||L<=C)){var F=Number.POSITIVE_INFINITY,M;for(M=t.level-1;M>y;M--){var B=m[M].maxBitrate;if(F=u*B/(8*.8*x),F<C)break}if(!(F>=L)){var k=this.bwEstimator.getEstimate();c.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+M+`
      Current BW estimate: `+(Object(A.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+L.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),i.nextLoadLevel=M,this.bwEstimator.sample(_,a.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),i.trigger(S.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a})}}}}}},h.onFragLoaded=function(t,e){var i=e.frag,r=e.part;if(i.type===T.PlaylistLevelType.MAIN&&Object(A.isFiniteNumber)(i.sn)){var o=r?r.stats:i.stats,s=r?r.duration:i.duration;if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[i.level],u=(a.loaded?a.loaded.bytes:0)+o.loaded,_=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:u,duration:_},a.realBitrate=Math.round(8*u/_)}if(i.bitrateTest){var g={stats:o,frag:i,part:r,id:i.type};this.onFragBuffered(S.Events.FRAG_BUFFERED,g),i.bitrateTest=!1}}},h.onFragBuffered=function(t,e){var i=e.frag,r=e.part,o=r?r.stats:i.stats;if(!o.aborted&&!(i.type!==T.PlaylistLevelType.MAIN||i.sn==="initSegment")){var s=o.parsing.end-o.loading.start;this.bwEstimator.sample(s,o.loaded),o.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},h.onError=function(t,e){switch(e.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},h.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},h.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,r=i.maxAutoLevel,o=i.config,s=i.minAutoLevel,a=i.media,u=e?e.duration:t?t.duration:0,_=a?a.currentTime:0,g=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,y=(I.BufferHelper.bufferInfo(a,_,o.maxBufferHole).end-_)/g,v=this.findBestLevel(m,s,r,y,o.abrBandWidthFactor,o.abrBandWidthUpFactor);if(v>=0)return v;c.logger.trace((y?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var E=u?Math.min(u,o.maxStarvationDelay):o.maxStarvationDelay,x=o.abrBandWidthFactor,L=o.abrBandWidthUpFactor;if(!y){var O=this.bitrateTestDelay;if(O){var C=u?Math.min(u,o.maxLoadingDelay):o.maxLoadingDelay;E=C-O,c.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*E)+" ms"),x=L=1}}return v=this.findBestLevel(m,s,r,y+E,x,L),Math.max(v,0)},h.findBestLevel=function(t,e,i,r,o,s){for(var a,u=this.fragCurrent,_=this.partCurrent,g=this.lastLoadedFragLevel,m=this.hls.levels,y=m[g],v=!!(y!=null&&(a=y.details)!==null&&a!==void 0&&a.live),E=y==null?void 0:y.codecSet,x=_?_.duration:u?u.duration:0,L=i;L>=e;L--){var O=m[L];if(!(!O||E&&O.codecSet!==E)){var C=O.details,F=(_?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||x,M=void 0;L<=g?M=o*t:M=s*t;var B=m[L].maxBitrate,k=B*F/M;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+L+"/"+Math.round(M)+"/"+B+"/"+F+"/"+r+"/"+k),M>B&&(!k||v&&!this.bitrateTestDelay||k<r))return L}}return-1},p(d,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&(!e||!e.canEstimate()))return t;var i=this.getNextABRAutoLevel();return t!==-1&&(i=Math.min(t,i)),i},set:function(t){this._nextAutoLevel=t}}]),d}();P.default=l},"./src/controller/audio-stream-controller.ts":function(j,P,D){D.r(P);var A=D("./src/polyfills/number.ts"),R=D("./src/controller/base-stream-controller.ts"),S=D("./src/events.ts"),I=D("./src/utils/buffer-helper.ts"),b=D("./src/controller/fragment-tracker.ts"),T=D("./src/types/level.ts"),c=D("./src/types/loader.ts"),f=D("./src/loader/fragment.ts"),p=D("./src/demux/chunk-cache.ts"),l=D("./src/demux/transmuxer-interface.ts"),d=D("./src/types/transmuxer.ts"),h=D("./src/controller/fragment-finders.ts"),n=D("./src/utils/discontinuities.ts"),t=D("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(a){for(var u=1;u<arguments.length;u++){var _=arguments[u];for(var g in _)Object.prototype.hasOwnProperty.call(_,g)&&(a[g]=_[g])}return a},e.apply(this,arguments)}function i(a,u){a.prototype=Object.create(u.prototype),a.prototype.constructor=a,r(a,u)}function r(a,u){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,m){return g.__proto__=m,g},r(a,u)}var o=100,s=function(a){i(u,a);function u(g,m){var y;return y=a.call(this,g,m,"[audio-stream-controller]")||this,y.videoBuffer=null,y.videoTrackCC=-1,y.waitingVideoCC=-1,y.audioSwitch=!1,y.trackId=-1,y.waitingData=null,y.mainDetails=null,y.bufferFlushed=!1,y.cachedTrackLoadedData=null,y._registerListeners(),y}var _=u.prototype;return _.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},_._registerListeners=function(){var m=this.hls;m.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.on(S.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),m.on(S.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),m.on(S.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),m.on(S.Events.ERROR,this.onError,this),m.on(S.Events.BUFFER_RESET,this.onBufferReset,this),m.on(S.Events.BUFFER_CREATED,this.onBufferCreated,this),m.on(S.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),m.on(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),m.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function(){var m=this.hls;m.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),m.off(S.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),m.off(S.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),m.off(S.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),m.off(S.Events.ERROR,this.onError,this),m.off(S.Events.BUFFER_RESET,this.onBufferReset,this),m.off(S.Events.BUFFER_CREATED,this.onBufferCreated,this),m.off(S.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),m.off(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),m.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onInitPtsFound=function(m,y){var v=y.frag,E=y.id,x=y.initPTS;if(E==="main"){var L=v.cc;this.initPTS[v.cc]=x,this.log("InitPTS for cc: "+L+" found from main: "+x),this.videoTrackCC=L,this.state===R.State.WAITING_INIT_PTS&&this.tick()}},_.startLoad=function(m){if(!this.levels){this.startPosition=m,this.state=R.State.STOPPED;return}var y=this.lastCurrentTime;this.stopLoad(),this.setInterval(o),this.fragLoadError=0,y>0&&m===-1?(this.log("Override startPosition with lastCurrentTime @"+y.toFixed(3)),m=y,this.state=R.State.IDLE):(this.loadedmetadata=!1,this.state=R.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=m,this.tick()},_.doTick=function(){switch(this.state){case R.State.IDLE:this.doTickIdle();break;case R.State.WAITING_TRACK:{var m,y=this.levels,v=this.trackId,E=y==null||(m=y[v])===null||m===void 0?void 0:m.details;if(E){if(this.waitForCdnTuneIn(E))break;this.state=R.State.WAITING_INIT_PTS}break}case R.State.FRAG_LOADING_WAITING_RETRY:{var x,L=performance.now(),O=this.retryDate;(!O||L>=O||(x=this.media)!==null&&x!==void 0&&x.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=R.State.IDLE);break}case R.State.WAITING_INIT_PTS:{var C=this.waitingData;if(C){var F=C.frag,M=C.part,B=C.cache,k=C.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=R.State.FRAG_LOADING;var w=B.flush(),U={frag:F,part:M,payload:w,networkDetails:null};this._handleFragmentLoadProgress(U),k&&a.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var N=this.getLoadPosition(),K=I.BufferHelper.bufferInfo(this.mediaBuffer,N,this.config.maxBufferHole),H=Object(h.fragmentWithinToleranceTest)(K.end,this.config.maxFragLookUpTolerance,F);H<0&&(this.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=R.State.IDLE}}this.onTickEnd()},_.clearWaitingFragment=function(){var m=this.waitingData;m&&(this.fragmentTracker.removeFragment(m.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=R.State.IDLE)},_.resetLoadingState=function(){this.clearWaitingFragment(),a.prototype.resetLoadingState.call(this)},_.onTickEnd=function(){var m=this.media;if(!(!m||!m.readyState)){var y=this.mediaBuffer?this.mediaBuffer:m,v=y.buffered;!this.loadedmetadata&&v.length&&(this.loadedmetadata=!0),this.lastCurrentTime=m.currentTime}},_.doTickIdle=function(){var m,y,v=this.hls,E=this.levels,x=this.media,L=this.trackId,O=v.config;if(!(!E||!E[L])&&!(!x&&(this.startFragRequested||!O.startFragPrefetch))){var C=E[L],F=C.details;if(!F||F.live&&this.levelLastLoaded!==L||this.waitForCdnTuneIn(F)){this.state=R.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,f.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO));var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.AUDIO);if(M!==null){var B=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,c.PlaylistLevelType.MAIN),k=M.len,w=this.getMaxBufferLength(B==null?void 0:B.len),U=this.audioSwitch;if(!(k>=w&&!U)){if(!U&&this._streamEnded(M,F)){v.trigger(S.Events.BUFFER_EOS,{type:"audio"}),this.state=R.State.ENDED;return}var N=F.fragments,K=N[0].start,H=M.end;if(U){var z=this.getLoadPosition();H=z,F.PTSKnown&&z<K&&(M.end>K||M.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),x.currentTime=K+.05)}if(!(B&&H>B.end+F.targetduration)&&!((!B||!B.len)&&M.len)){var G=this.getNextFragment(H,F);if(!G){this.bufferFlushed=!0;return}((m=G.decryptdata)===null||m===void 0?void 0:m.keyFormat)==="identity"&&!((y=G.decryptdata)!==null&&y!==void 0&&y.key)?this.loadKey(G,F):this.loadFragment(G,F,H)}}}}},_.getMaxBufferLength=function(m){var y=a.prototype.getMaxBufferLength.call(this);return m?Math.max(y,m):y},_.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},_.onAudioTracksUpdated=function(m,y){var v=y.audioTracks;this.resetTransmuxer(),this.levels=v.map(function(E){return new T.Level(E)})},_.onAudioTrackSwitching=function(m,y){var v=!!y.url;this.trackId=y.id;var E=this.fragCurrent;E!=null&&E.loader&&E.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),v?this.setInterval(o):this.resetTransmuxer(),v?(this.audioSwitch=!0,this.state=R.State.IDLE):this.state=R.State.STOPPED,this.tick()},_.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},_.onLevelLoaded=function(m,y){this.mainDetails=y.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(S.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},_.onAudioTrackLoaded=function(m,y){var v;if(this.mainDetails==null){this.cachedTrackLoadedData=y;return}var E=this.levels,x=y.details,L=y.id;if(!E){this.warn("Audio tracks were reset while loading level "+L);return}this.log("Track "+L+" loaded ["+x.startSN+","+x.endSN+"],duration:"+x.totalduration);var O=E[L],C=0;if(x.live||(v=O.details)!==null&&v!==void 0&&v.live){var F=this.mainDetails;if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed||!F)return;!O.details&&x.hasProgramDateTime&&F.hasProgramDateTime?(Object(n.alignMediaPlaylistByPDT)(x,F),C=x.fragments[0].start):C=this.alignPlaylists(x,O.details)}O.details=x,this.levelLastLoaded=L,!this.startFragRequested&&(this.mainDetails||!x.live)&&this.setStartPosition(O.details,C),this.state===R.State.WAITING_TRACK&&!this.waitForCdnTuneIn(x)&&(this.state=R.State.IDLE),this.tick()},_._handleFragmentLoadProgress=function(m){var y,v=m.frag,E=m.part,x=m.payload,L=this.config,O=this.trackId,C=this.levels;if(!C){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered");return}var F=C[O];console.assert(F,"Audio track is defined on fragment load progress");var M=F.details;console.assert(M,"Audio track details are defined on fragment load progress");var B=L.defaultAudioCodec||F.audioCodec||"mp4a.40.2",k=this.transmuxer;k||(k=this.transmuxer=new l.default(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[v.cc],U=(y=v.initSegment)===null||y===void 0?void 0:y.data;if(w!==void 0){var N=!1,K=E?E.index:-1,H=K!==-1,z=new d.ChunkMetadata(v.level,v.sn,v.stats.chunkCount,x.byteLength,K,H);k.push(x,U,B,"",v,E,M.totalduration,N,z,w)}else{this.log("Unknown video PTS for cc "+v.cc+", waiting for video PTS before demuxing audio frag "+v.sn+" of ["+M.startSN+" ,"+M.endSN+"],track "+O);var G=this.waitingData=this.waitingData||{frag:v,part:E,cache:new p.default,complete:!1},q=G.cache;q.push(new Uint8Array(x)),this.waitingVideoCC=this.videoTrackCC,this.state=R.State.WAITING_INIT_PTS}},_._handleFragmentLoadComplete=function(m){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,m)},_.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_.onBufferCreated=function(m,y){var v=y.tracks.audio;v&&(this.mediaBuffer=v.buffer),y.tracks.video&&(this.videoBuffer=y.tracks.video.buffer)},_.onFragBuffered=function(m,y){var v=y.frag,E=y.part;if(v.type===c.PlaylistLevelType.AUDIO){if(this.fragContextChanged(v)){this.warn("Fragment "+v.sn+(E?" p: "+E.index:"")+" of level "+v.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}v.sn!=="initSegment"&&(this.fragPrevious=v,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(S.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(v,E)}},_.onError=function(m,y){switch(y.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,y);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==R.State.ERROR&&this.state!==R.State.STOPPED&&(this.state=y.fatal?R.State.ERROR:R.State.IDLE,this.warn(y.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(y.parent==="audio"&&(this.state===R.State.PARSING||this.state===R.State.PARSED)){var v=!0,E=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO);E&&E.len>.5&&(v=!this.reduceMaxBufferLength(E.len)),v&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},_.onBufferFlushed=function(m,y){var v=y.type;v===f.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},_._handleTransmuxComplete=function(m){var y,v="audio",E=this.hls,x=m.remuxResult,L=m.chunkMeta,O=this.getCurrentContext(L);if(!O){this.warn("The loading context changed while buffering fragment "+L.sn+" of level "+L.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(L.level);return}var C=O.frag,F=O.part,M=O.level.details,B=x.audio,k=x.text,w=x.id3,U=x.initSegment;if(!(this.fragContextChanged(C)||!M)){if(this.state=R.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,C,L),E.trigger(S.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:v,tracks:U.tracks})),B){var N=B.startPTS,K=B.endPTS,H=B.startDTS,z=B.endDTS;F&&(F.elementaryStreams[f.ElementaryStreamTypes.AUDIO]={startPTS:N,endPTS:K,startDTS:H,endDTS:z}),C.setElementaryStreamInfo(f.ElementaryStreamTypes.AUDIO,N,K,H,z),this.bufferFragmentData(B,C,F,L)}if(w!=null&&(y=w.samples)!==null&&y!==void 0&&y.length){var G=e({id:v,frag:C,details:M},w);E.trigger(S.Events.FRAG_PARSING_METADATA,G)}if(k){var q=e({id:v,frag:C,details:M},k);E.trigger(S.Events.FRAG_PARSING_USERDATA,q)}}},_._bufferInitSegment=function(m,y,v){if(this.state===R.State.PARSING){m.video&&delete m.video;var E=m.audio;if(!!E){E.levelCodec=E.codec,E.id="audio",this.log("Init audio buffer, container:"+E.container+", codecs[parsed]=["+E.codec+"]"),this.hls.trigger(S.Events.BUFFER_CODECS,m);var x=E.initSegment;if(x!=null&&x.byteLength){var L={type:"audio",frag:y,part:null,chunkMeta:v,parent:y.type,data:x};this.hls.trigger(S.Events.BUFFER_APPENDING,L)}this.tick()}}},_.loadFragment=function(m,y,v){var E=this.fragmentTracker.getState(m);this.fragCurrent=m,(this.audioSwitch||E===b.FragmentState.NOT_LOADED||E===b.FragmentState.PARTIAL)&&(m.sn==="initSegment"?this._loadInitSegment(m):y.live&&!Object(A.isFiniteNumber)(this.initPTS[m.cc])?(this.log("Waiting for video PTS in continuity counter "+m.cc+" of live stream before loading audio fragment "+m.sn+" of level "+this.trackId),this.state=R.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,m,y,v)))},_.completeAudioSwitch=function(){var m=this.hls,y=this.media,v=this.trackId;y&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,m.trigger(S.Events.AUDIO_TRACK_SWITCHED,{id:v})},u}(R.default);P.default=s},"./src/controller/audio-track-controller.ts":function(j,P,D){D.r(P);var A=D("./src/events.ts"),R=D("./src/errors.ts"),S=D("./src/controller/base-playlist-controller.ts"),I=D("./src/types/loader.ts");function b(l,d){for(var h=0;h<d.length;h++){var n=d[h];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(l,n.key,n)}}function T(l,d,h){return d&&b(l.prototype,d),h&&b(l,h),Object.defineProperty(l,"prototype",{writable:!1}),l}function c(l,d){l.prototype=Object.create(d.prototype),l.prototype.constructor=l,f(l,d)}function f(l,d){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},f(l,d)}var p=function(l){c(d,l);function d(n){var t;return t=l.call(this,n,"[audio-track-controller]")||this,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}var h=d.prototype;return h.registerListeners=function(){var t=this.hls;t.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(A.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var t=this.hls;t.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(A.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,l.prototype.destroy.call(this)},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},h.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},h.onAudioTrackLoaded=function(t,e){var i=e.id,r=e.details,o=this.tracksInGroup[i];if(!o){this.warn("Invalid audio track id "+i);return}var s=o.details;o.details=e.details,this.log("audioTrack "+i+" loaded ["+r.startSN+"-"+r.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,e,s))},h.onLevelLoading=function(t,e){this.switchLevel(e.level)},h.onLevelSwitching=function(t,e){this.switchLevel(e.level)},h.switchLevel=function(t){var e=this.hls.levels[t];if(!!(e!=null&&e.audioGroupIds)){var i=e.audioGroupIds[e.urlId];if(this.groupId!==i){this.groupId=i;var r=this.tracks.filter(function(s){return!i||s.groupId===i});this.selectDefaultTrack&&!r.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var o={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(A.Events.AUDIO_TRACKS_UPDATED,o),this.selectInitialTrack()}}},h.onError=function(t,e){l.prototype.onError.call(this,t,e),!(e.fatal||!e.context)&&e.context.type===I.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},h.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var i=e[this.trackId];this.log("Now switching to audio-track index "+t);var r=e[t],o=r.id,s=r.groupId,a=s===void 0?"":s,u=r.name,_=r.type,g=r.url;if(this.trackId=t,this.trackName=u,this.selectDefaultTrack=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHING,{id:o,groupId:a,name:u,type:_,url:g}),!(r.details&&!r.details.live)){var m=this.switchParams(r.url,i==null?void 0:i.details);this.loadPlaylist(m)}},h.selectInitialTrack=function(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,i=this.findTrackId(e)||this.findTrackId();i!==-1?this.setAudioTrack(i):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},h.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},h.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var i=e.id,r=e.groupId,o=e.url;if(t)try{o=t.addDirectives(o)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+i),this.clearTimer(),this.hls.trigger(A.Events.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:r,deliveryDirectives:t||null})}},T(d,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),d}(S.default);P.default=p},"./src/controller/base-playlist-controller.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return T});var A=D("./src/polyfills/number.ts"),R=D("./src/types/level.ts"),S=D("./src/controller/level-helper.ts"),I=D("./src/utils/logger.ts"),b=D("./src/errors.ts"),T=function(){function c(p,l){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=I.logger.log.bind(I.logger,l+":"),this.warn=I.logger.warn.bind(I.logger,l+":"),this.hls=p}var f=c.prototype;return f.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},f.onError=function(l,d){d.fatal&&d.type===b.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},f.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},f.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},f.stopLoad=function(){this.canLoad=!1,this.clearTimer()},f.switchParams=function(l,d){var h=d==null?void 0:d.renditionReports;if(h)for(var n=0;n<h.length;n++){var t=h[n],e=""+t.URI;if(e===l.slice(-e.length)){var i=parseInt(t["LAST-MSN"]),r=parseInt(t["LAST-PART"]);if(d&&this.hls.config.lowLatencyMode){var o=Math.min(d.age-d.partTarget,d.targetduration);r!==void 0&&o>d.partTarget&&(r+=1)}if(Object(A.isFiniteNumber)(i))return new R.HlsUrlParameters(i,Object(A.isFiniteNumber)(r)?r:void 0,R.HlsSkip.No)}}},f.loadPlaylist=function(l){},f.shouldLoadTrack=function(l){return this.canLoad&&l&&!!l.url&&(!l.details||l.details.live)},f.playlistLoaded=function(l,d,h){var n=this,t=d.details,e=d.stats,i=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(t.advancedDateTime=Date.now()-i,t.live||h!=null&&h.live){if(t.reloaded(h),h&&this.log("live playlist "+l+" "+(t.advanced?"REFRESHED "+t.lastPartSn+"-"+t.lastPartIndex:"MISSED")),h&&t.fragments.length>0&&Object(S.mergeDetails)(h,t),!this.canLoad||!t.live)return;var r,o=void 0,s=void 0;if(t.canBlockReload&&t.endSN&&t.advanced){var a=this.hls.config.lowLatencyMode,u=t.lastPartSn,_=t.endSN,g=t.lastPartIndex,m=g!==-1,y=u===_,v=a?0:g;m?(o=y?_+1:u,s=y?v:g+1):o=_+1;var E=t.age,x=E+t.ageHeader,L=Math.min(x-t.partTarget,t.targetduration*1.5);if(L>0){if(h&&L>h.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+h.tuneInGoal+" to: "+L+" with playlist age: "+t.age),L=0;else{var O=Math.floor(L/t.targetduration);if(o+=O,s!==void 0){var C=Math.round(L%t.targetduration/t.partTarget);s+=C}this.log("CDN Tune-in age: "+t.ageHeader+"s last advanced "+E.toFixed(2)+"s goal: "+L+" skip sn "+O+" to part "+s)}t.tuneInGoal=L}if(r=this.getDeliveryDirectives(t,d.deliveryDirectives,o,s),a||!y){this.loadPlaylist(r);return}}else r=this.getDeliveryDirectives(t,d.deliveryDirectives,o,s);var F=Object(S.computeReloadInterval)(t,e);o!==void 0&&t.canBlockReload&&(F-=t.partTarget||1),this.log("reload live playlist "+l+" in "+Math.round(F)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(r)},F)}else this.clearTimer()},f.getDeliveryDirectives=function(l,d,h,n){var t=Object(R.getSkipValue)(l,h);return d!=null&&d.skip&&l.deltaUpdateFailed&&(h=d.msn,n=d.part,t=R.HlsSkip.No),new R.HlsUrlParameters(h,n,t)},f.retryLoadingOrFail=function(l){var d=this,h=this.hls.config,n=this.retryCount<h.levelLoadingMaxRetry;if(n){var t;if(this.retryCount++,l.details.indexOf("LoadTimeOut")>-1&&(t=l.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+l.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*h.levelLoadingRetryDelay,h.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return d.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+l.details+'"')}}else this.warn('cannot recover from error "'+l.details+'"'),this.clearTimer(),l.fatal=!0;return n},c}()},"./src/controller/base-stream-controller.ts":function(j,P,D){D.r(P),D.d(P,"State",function(){return _}),D.d(P,"default",function(){return g});var A=D("./src/polyfills/number.ts"),R=D("./src/task-loop.ts"),S=D("./src/controller/fragment-tracker.ts"),I=D("./src/utils/buffer-helper.ts"),b=D("./src/utils/logger.ts"),T=D("./src/events.ts"),c=D("./src/errors.ts"),f=D("./src/types/transmuxer.ts"),p=D("./src/utils/mp4-tools.ts"),l=D("./src/utils/discontinuities.ts"),d=D("./src/controller/fragment-finders.ts"),h=D("./src/controller/level-helper.ts"),n=D("./src/loader/fragment-loader.ts"),t=D("./src/crypt/decrypter.ts"),e=D("./src/utils/time-ranges.ts"),i=D("./src/types/loader.ts");function r(m,y){for(var v=0;v<y.length;v++){var E=y[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(m,E.key,E)}}function o(m,y,v){return y&&r(m.prototype,y),v&&r(m,v),Object.defineProperty(m,"prototype",{writable:!1}),m}function s(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function a(m,y){m.prototype=Object.create(y.prototype),m.prototype.constructor=m,u(m,y)}function u(m,y){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,x){return E.__proto__=x,E},u(m,y)}var _={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},g=function(m){a(y,m);function y(E,x,L){var O;return O=m.call(this)||this,O.hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=_.STOPPED,O.media=void 0,O.mediaBuffer=void 0,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=L,O.log=b.logger.log.bind(b.logger,L+":"),O.warn=b.logger.warn.bind(b.logger,L+":"),O.hls=E,O.fragmentLoader=new n.default(E.config),O.fragmentTracker=x,O.config=E.config,O.decrypter=new t.default(E,E.config),E.on(T.Events.KEY_LOADED,O.onKeyLoaded,s(O)),O}var v=y.prototype;return v.doTick=function(){this.onTickEnd()},v.onTickEnd=function(){},v.startLoad=function(x){},v.stopLoad=function(){this.fragmentLoader.abort();var x=this.fragCurrent;x&&this.fragmentTracker.removeFragment(x),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=_.STOPPED},v._streamEnded=function(x,L){var O=this.fragCurrent,C=this.fragmentTracker;if(!L.live&&O&&O.sn>=L.endSN&&!x.nextStart){var F=L.partList;if(F!=null&&F.length){var M=F[F.length-1],B=I.BufferHelper.isBuffered(this.media,M.start+M.duration/2);return B}var k=C.getState(O);return k===S.FragmentState.PARTIAL||k===S.FragmentState.OK}return!1},v.onMediaAttached=function(x,L){var O=this.media=this.mediaBuffer=L.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===_.STOPPED&&this.startLoad(C.startPosition)},v.onMediaDetaching=function(){var x=this.media;x!=null&&x.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),x&&(x.removeEventListener("seeking",this.onvseeking),x.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},v.onMediaSeeking=function(){var x=this.config,L=this.fragCurrent,O=this.media,C=this.mediaBuffer,F=this.state,M=O?O.currentTime:0,B=I.BufferHelper.bufferInfo(C||O,M,x.maxBufferHole);if(this.log("media seeking to "+(Object(A.isFiniteNumber)(M)?M.toFixed(3):M)+", state: "+F),F===_.ENDED)this.resetLoadingState();else if(L&&!B.len){var k=x.maxFragLookUpTolerance,w=L.start-k,U=L.start+L.duration+k,N=M>U;(M<w||N)&&(N&&L.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),L.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=M),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=M),this.tickImmediate()},v.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},v.onKeyLoaded=function(x,L){if(!(this.state!==_.KEY_LOADING||L.frag!==this.fragCurrent||!this.levels)){this.state=_.IDLE;var O=this.levels[L.frag.level].details;O&&this.loadFragment(L.frag,O,L.frag.start)}},v.onHandlerDestroying=function(){this.stopLoad(),m.prototype.onHandlerDestroying.call(this)},v.onHandlerDestroyed=function(){this.state=_.STOPPED,this.hls.off(T.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,m.prototype.onHandlerDestroyed.call(this)},v.loadKey=function(x,L){this.log("Loading key for "+x.sn+" of ["+L.startSN+"-"+L.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+x.level),this.state=_.KEY_LOADING,this.fragCurrent=x,this.hls.trigger(T.Events.KEY_LOADING,{frag:x})},v.loadFragment=function(x,L,O){this._loadFragForPlayback(x,L,O)},v._loadFragForPlayback=function(x,L,O){var C=this,F=function(B){if(C.fragContextChanged(x)){C.warn("Fragment "+x.sn+(B.part?" p: "+B.part.index:"")+" of level "+x.level+" was dropped during download."),C.fragmentTracker.removeFragment(x);return}x.stats.chunkCount++,C._handleFragmentLoadProgress(B)};this._doFragLoad(x,L,O,F).then(function(M){if(!!M){C.fragLoadError=0;var B=C.state;if(C.fragContextChanged(x)){(B===_.FRAG_LOADING||!C.fragCurrent&&B===_.PARSING)&&(C.fragmentTracker.removeFragment(x),C.state=_.IDLE);return}"payload"in M&&(C.log("Loaded fragment "+x.sn+" of level "+x.level),C.hls.trigger(T.Events.FRAG_LOADED,M)),C._handleFragmentLoadComplete(M)}}).catch(function(M){C.state!==_.STOPPED&&(C.warn(M),C.resetFragmentLoading(x))})},v.flushMainBuffer=function(x,L,O){if(O===void 0&&(O=null),!!(x-L)){var C={startOffset:x,endOffset:L,type:O};this.fragLoadError=0,this.hls.trigger(T.Events.BUFFER_FLUSHING,C)}},v._loadInitSegment=function(x){var L=this;this._doFragLoad(x).then(function(O){if(!O||L.fragContextChanged(x)||!L.levels)throw new Error("init load aborted");return O}).then(function(O){var C=L.hls,F=O.payload,M=x.decryptdata;if(F&&F.byteLength>0&&M&&M.key&&M.iv&&M.method==="AES-128"){var B=self.performance.now();return L.decrypter.webCryptoDecrypt(new Uint8Array(F),M.key.buffer,M.iv.buffer).then(function(k){var w=self.performance.now();return C.trigger(T.Events.FRAG_DECRYPTED,{frag:x,payload:k,stats:{tstart:B,tdecrypt:w}}),O.payload=k,O})}return O}).then(function(O){var C=L.fragCurrent,F=L.hls,M=L.levels;if(!M)throw new Error("init load aborted, missing levels");var B=M[x.level].details;console.assert(B,"Level details are defined when init segment is loaded");var k=x.stats;L.state=_.IDLE,L.fragLoadError=0,x.data=new Uint8Array(O.payload),k.parsing.start=k.buffering.start=self.performance.now(),k.parsing.end=k.buffering.end=self.performance.now(),O.frag===C&&F.trigger(T.Events.FRAG_BUFFERED,{stats:k,frag:C,part:null,id:x.type}),L.tick()}).catch(function(O){L.warn(O),L.resetFragmentLoading(x)})},v.fragContextChanged=function(x){var L=this.fragCurrent;return!x||!L||x.level!==L.level||x.sn!==L.sn||x.urlId!==L.urlId},v.fragBufferedComplete=function(x,L){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+x.type+" sn: "+x.sn+(L?" part: "+L.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+x.level+" "+e.default.toString(I.BufferHelper.getBuffered(O))),this.state=_.IDLE,this.tick()},v._handleFragmentLoadComplete=function(x){var L=this.transmuxer;if(!!L){var O=x.frag,C=x.part,F=x.partsLoaded,M=!F||F.length===0||F.some(function(k){return!k}),B=new f.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,C?C.index:-1,!M);L.flush(B)}},v._handleFragmentLoadProgress=function(x){},v._doFragLoad=function(x,L,O,C){var F=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(x.start,O||0),this.config.lowLatencyMode&&L){var M=L.partList;if(M&&C){O>x.end&&L.fragmentHint&&(x=L.fragmentHint);var B=this.getNextPart(M,x,O);if(B>-1){var k=M[B];return this.log("Loading part sn: "+x.sn+" p: "+k.index+" cc: "+x.cc+" of playlist ["+L.startSN+"-"+L.endSN+"] parts [0-"+B+"-"+(M.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+x.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=_.FRAG_LOADING,this.hls.trigger(T.Events.FRAG_LOADING,{frag:x,part:M[B],targetBufferTime:O}),this.doFragPartsLoad(x,M,B,C).catch(function(w){return F.handleFragLoadError(w)})}else if(!x.url||this.loadedEndOfParts(M,O))return Promise.resolve(null)}}return this.log("Loading fragment "+x.sn+" cc: "+x.cc+" "+(L?"of ["+L.startSN+"-"+L.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+x.level+", target: "+parseFloat(O.toFixed(3))),Object(A.isFiniteNumber)(x.sn)&&!this.bitrateTest&&(this.nextLoadPosition=x.start+x.duration),this.state=_.FRAG_LOADING,this.hls.trigger(T.Events.FRAG_LOADING,{frag:x,targetBufferTime:O}),this.fragmentLoader.load(x,C).catch(function(w){return F.handleFragLoadError(w)})},v.doFragPartsLoad=function(x,L,O,C){var F=this;return new Promise(function(M,B){var k=[],w=function U(N){var K=L[N];F.fragmentLoader.loadPart(x,K,C).then(function(H){k[K.index]=H;var z=H.part;F.hls.trigger(T.Events.FRAG_LOADED,H);var G=L[N+1];if(G&&G.fragment===x)U(N+1);else return M({frag:x,part:z,partsLoaded:k})}).catch(B)};w(O)})},v.handleFragLoadError=function(x){var L=x.data;return L&&L.details===c.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(L.frag,L.part):this.hls.trigger(T.Events.ERROR,L),null},v._handleTransmuxerFlush=function(x){var L=this.getCurrentContext(x);if(!L||this.state!==_.PARSING){this.fragCurrent||(this.state=_.IDLE);return}var O=L.frag,C=L.part,F=L.level,M=self.performance.now();O.stats.parsing.end=M,C&&(C.stats.parsing.end=M),this.updateLevelTiming(O,C,F,x.partial)},v.getCurrentContext=function(x){var L=this.levels,O=x.level,C=x.sn,F=x.part;if(!L||!L[O])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+O+". The current chunk will not be buffered."),null;var M=L[O],B=F>-1?Object(h.getPartWith)(M,C,F):null,k=B?B.fragment:Object(h.getFragmentWithSN)(M,C,this.fragCurrent);return k?{frag:k,part:B,level:M}:null},v.bufferFragmentData=function(x,L,O,C){if(!(!x||this.state!==_.PARSING)){var F=x.data1,M=x.data2,B=F;if(F&&M&&(B=Object(p.appendUint8Array)(F,M)),!(!B||!B.length)){var k={type:x.type,frag:L,part:O,chunkMeta:C,parent:L.type,data:B};this.hls.trigger(T.Events.BUFFER_APPENDING,k),x.dropped&&x.independent&&!O&&this.flushBufferGap(L)}}},v.flushBufferGap=function(x){var L=this.media;if(!!L){if(!I.BufferHelper.isBuffered(L,L.currentTime)){this.flushMainBuffer(0,x.start);return}var O=L.currentTime,C=I.BufferHelper.bufferInfo(L,O,0),F=x.duration,M=Math.min(this.config.maxFragLookUpTolerance*2,F*.25),B=Math.max(Math.min(x.start-M,C.end-M),O+M);x.start-B>M&&this.flushMainBuffer(B,x.start)}},v.getFwdBufferInfo=function(x,L){var O=this.config,C=this.getLoadPosition();if(!Object(A.isFiniteNumber)(C))return null;var F=I.BufferHelper.bufferInfo(x,C,O.maxBufferHole);if(F.len===0&&F.nextStart!==void 0){var M=this.fragmentTracker.getBufferedFrag(C,L);if(M&&F.nextStart<M.end)return I.BufferHelper.bufferInfo(x,C,Math.max(F.nextStart,O.maxBufferHole))}return F},v.getMaxBufferLength=function(x){var L=this.config,O;return x?O=Math.max(8*L.maxBufferSize/x,L.maxBufferLength):O=L.maxBufferLength,Math.min(O,L.maxMaxBufferLength)},v.reduceMaxBufferLength=function(x){var L=this.config,O=x||L.maxBufferLength;return L.maxMaxBufferLength>=O?(L.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+L.maxMaxBufferLength+"s"),!0):!1},v.getNextFragment=function(x,L){var O=L.fragments,C=O.length;if(!C)return null;var F=this.config,M=O[0].start,B;if(L.live){var k=F.initialLiveManifestSize;if(C<k)return this.warn("Not enough fragments to start playback (have: "+C+", need: "+k+")"),null;!L.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(B=this.getInitialLiveFragment(L,O),this.startPosition=B?this.hls.liveSyncPosition||B.start:x)}else x<=M&&(B=O[0]);if(!B){var w=F.lowLatencyMode?L.partEnd:L.fragmentEnd;B=this.getFragmentAtPosition(x,w,L)}return this.mapToInitFragWhenRequired(B)},v.mapToInitFragWhenRequired=function(x){return x!=null&&x.initSegment&&!(x!=null&&x.initSegment.data)&&!this.bitrateTest?x.initSegment:x},v.getNextPart=function(x,L,O){for(var C=-1,F=!1,M=!0,B=0,k=x.length;B<k;B++){var w=x[B];if(M=M&&!w.independent,C>-1&&O<w.start)break;var U=w.loaded;!U&&(F||w.independent||M)&&w.fragment===L&&(C=B),F=U}return C},v.loadedEndOfParts=function(x,L){var O=x[x.length-1];return O&&L>O.start&&O.loaded},v.getInitialLiveFragment=function(x,L){var O=this.fragPrevious,C=null;if(O){if(x.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),C=Object(d.findFragmentByPDT)(L,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var F=O.sn+1;if(F>=x.startSN&&F<=x.endSN){var M=L[F-x.startSN];O.cc===M.cc&&(C=M,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(d.findFragWithCC)(L,O.cc),C&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(C=this.getFragmentAtPosition(B,this.bitrateTest?x.fragmentEnd:x.edge,x))}return C},v.getFragmentAtPosition=function(x,L,O){var C=this.config,F=this.fragPrevious,M=O.fragments,B=O.endSN,k=O.fragmentHint,w=C.maxFragLookUpTolerance,U=!!(C.lowLatencyMode&&O.partList&&k);U&&k&&!this.bitrateTest&&(M=M.concat(k),B=k.sn);var N;if(x<L){var K=x>L-w?0:w;N=Object(d.findFragmentByPTS)(F,M,x,K)}else N=M[M.length-1];if(N){var H=N.sn-O.startSN,z=F&&N.level===F.level,G=M[H+1];F&&N.sn===F.sn&&!U&&z&&(N.sn<B&&this.fragmentTracker.getState(G)!==S.FragmentState.OK?(this.log("SN "+N.sn+" just loaded, load next one: "+G.sn),N=G):N=null)}return N},v.synchronizeToLiveEdge=function(x){var L=this.config,O=this.media;if(!!O){var C=this.hls.liveSyncPosition,F=O.currentTime,M=x.fragments[0].start,B=x.edge,k=F>=M-L.maxFragLookUpTolerance&&F<=B;if(C!==null&&O.duration>C&&(F<C||!k)){var w=L.liveMaxLatencyDuration!==void 0?L.liveMaxLatencyDuration:L.liveMaxLatencyDurationCount*x.targetduration;(!k&&O.readyState<4||F<B-w)&&(this.loadedmetadata||(this.nextLoadPosition=C),O.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+C.toFixed(3)),O.currentTime=C))}}},v.alignPlaylists=function(x,L){var O=this.levels,C=this.levelLastLoaded,F=this.fragPrevious,M=C!==null?O[C]:null,B=x.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var k=x.fragments[0].start,w=!L,U=x.alignedSliding&&Object(A.isFiniteNumber)(k);if(w||!U&&!k){Object(l.alignStream)(F,M,x);var N=x.fragments[0].start;return this.log("Live playlist sliding: "+N.toFixed(2)+" start-sn: "+(L?L.startSN:"na")+"->"+x.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+B),N}return k},v.waitForCdnTuneIn=function(x){var L=3;return x.live&&x.canBlockReload&&x.partTarget&&x.tuneInGoal>Math.max(x.partHoldBack,x.partTarget*L)},v.setStartPosition=function(x,L){var O=this.startPosition;if(O<L&&(O=-1),O===-1||this.lastCurrentTime===-1){var C=x.startTimeOffset;Object(A.isFiniteNumber)(C)?(O=L+C,C<0&&(O+=x.totalduration),O=Math.min(Math.max(L,O),L+x.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+O),this.startPosition=O):x.live?O=this.hls.liveSyncPosition||L:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},v.getLoadPosition=function(){var x=this.media,L=0;return this.loadedmetadata&&x?L=x.currentTime:this.nextLoadPosition&&(L=this.nextLoadPosition),L},v.handleFragLoadAborted=function(x,L){this.transmuxer&&x.sn!=="initSegment"&&x.stats.aborted&&(this.warn("Fragment "+x.sn+(L?" part"+L.index:"")+" of level "+x.level+" was aborted"),this.resetFragmentLoading(x))},v.resetFragmentLoading=function(x){(!this.fragCurrent||!this.fragContextChanged(x))&&(this.state=_.IDLE)},v.onFragmentOrKeyLoadError=function(x,L){if(!L.fatal){var O=L.frag;if(!(!O||O.type!==x)){var C=this.fragCurrent;console.assert(C&&O.sn===C.sn&&O.level===C.level&&O.urlId===C.urlId,"Frag load error must match current frag to retry");var F=this.config;if(this.fragLoadError+1<=F.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var M=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+x+" "+O.level+" failed to load, retrying in "+M+"ms"),this.retryDate=self.performance.now()+M,this.fragLoadError++,this.state=_.FRAG_LOADING_WAITING_RETRY}else L.levelRetry?(x===i.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=_.IDLE):(b.logger.error(L.details+" reaches max retry, redispatch as fatal ..."),L.fatal=!0,this.hls.stopLoad(),this.state=_.ERROR)}}},v.afterBufferFlushed=function(x,L,O){if(!!x){var C=I.BufferHelper.getBuffered(x);this.fragmentTracker.detectEvictedFragments(L,C,O),this.state===_.ENDED&&this.resetLoadingState()}},v.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=_.IDLE},v.resetLiveStartWhenNotLoaded=function(x){if(!this.loadedmetadata){this.startFragRequested=!1;var L=this.levels?this.levels[x].details:null;if(L!=null&&L.live)return this.startPosition=-1,this.setStartPosition(L,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},v.updateLevelTiming=function(x,L,O,C){var F=this,M=O.details;console.assert(!!M,"level.details must be defined");var B=Object.keys(x.elementaryStreams).reduce(function(k,w){var U=x.elementaryStreams[w];if(U){var N=U.endPTS-U.startPTS;if(N<=0)return F.warn("Could not parse fragment "+x.sn+" "+w+" duration reliably ("+N+")"),k||!1;var K=C?0:Object(h.updateFragPTSDTS)(M,x,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return F.hls.trigger(T.Events.LEVEL_PTS_UPDATED,{details:M,level:O,drift:K,type:w,frag:x,start:U.startPTS,end:U.endPTS}),!0}return k},!1);B||(this.warn("Found no media in fragment "+x.sn+" of level "+O.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=_.PARSED,this.hls.trigger(T.Events.FRAG_PARSED,{frag:x,part:L})},v.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},o(y,[{key:"state",get:function(){return this._state},set:function(x){var L=this._state;L!==x&&(this._state=x,this.log(L+"->"+x))}}]),y}(R.default)},"./src/controller/buffer-controller.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return d});var A=D("./src/polyfills/number.ts"),R=D("./src/events.ts"),S=D("./src/utils/logger.ts"),I=D("./src/errors.ts"),b=D("./src/utils/buffer-helper.ts"),T=D("./src/utils/mediasource-helper.ts"),c=D("./src/loader/fragment.ts"),f=D("./src/controller/buffer-operation-queue.ts"),p=Object(T.getMediaSource)(),l=/([ha]vc.)(?:\.[^.,]+)+/,d=function(){function h(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=e.hls,r=e.media,o=e.mediaSource;S.logger.log("[buffer-controller]: Media source opened"),r&&(e.updateMediaElementDuration(),i.trigger(R.Events.MEDIA_ATTACHED,{media:r})),o&&o.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){S.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){S.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var n=h.prototype;return n.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null},n.registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.Events.BUFFER_RESET,this.onBufferReset,this),e.on(R.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(R.Events.BUFFER_EOS,this.onBufferEos,this),e.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(R.Events.FRAG_PARSED,this.onFragParsed,this),e.on(R.Events.FRAG_CHANGED,this.onFragChanged,this)},n.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.Events.BUFFER_RESET,this.onBufferReset,this),e.off(R.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(R.Events.BUFFER_EOS,this.onBufferEos,this),e.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(R.Events.FRAG_PARSED,this.onFragParsed,this),e.off(R.Events.FRAG_CHANGED,this.onFragChanged,this)},n._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new f.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},n.onManifestParsed=function(e,i){var r=2;(i.audio&&!i.video||!i.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,S.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},n.onMediaAttaching=function(e,i){var r=this.media=i.media;if(r&&p){var o=this.mediaSource=new p;o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(o),this._objectUrl=r.src}},n.onMediaDetaching=function(){var e=this.media,i=this.mediaSource,r=this._objectUrl;if(i){if(S.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(o){S.logger.warn("[buffer-controller]: onMediaDetaching: "+o.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):S.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(R.Events.MEDIA_DETACHED,void 0)},n.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(i){var r=e.sourceBuffer[i];try{r&&(e.removeBufferListeners(i),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[i]=void 0)}catch(o){S.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",o)}}),this._initSourceBuffer()},n.onBufferCodecs=function(e,i){var r=this,o=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(s){if(o){var a=r.tracks[s];if(a&&typeof a.buffer.changeType=="function"){var u=i[s],_=u.id,g=u.codec,m=u.levelCodec,y=u.container,v=u.metadata,E=(a.levelCodec||a.codec).replace(l,"$1"),x=(m||g).replace(l,"$1");if(E!==x){var L=y+";codecs="+(m||g);r.appendChangeType(s,L),S.logger.log("[buffer-controller]: switching codec "+E+" to "+x),r.tracks[s]={buffer:a.buffer,codec:g,container:y,levelCodec:m,metadata:v,id:_}}}}else r.pendingTracks[s]=i[s]}),!o&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},n.appendChangeType=function(e,i){var r=this,o=this.operationQueue,s={execute:function(){var u=r.sourceBuffer[e];u&&(S.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+i),u.changeType(i)),o.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(u){S.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",u)}};o.append(s,e)},n.onBufferAppending=function(e,i){var r=this,o=this.hls,s=this.operationQueue,a=this.tracks,u=i.data,_=i.type,g=i.frag,m=i.part,y=i.chunkMeta,v=y.buffering[_],E=self.performance.now();v.start=E;var x=g.stats.buffering,L=m?m.stats.buffering:null;x.start===0&&(x.start=E),L&&L.start===0&&(L.start=E);var O=a.audio,C=_==="audio"&&y.id===1&&(O==null?void 0:O.container)==="audio/mpeg",F={execute:function(){if(v.executeStart=self.performance.now(),C){var B=r.sourceBuffer[_];if(B){var k=g.start-B.timestampOffset;Math.abs(k)>=.1&&(S.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+g.start+" (delta: "+k+") sn: "+g.sn+")"),B.timestampOffset=g.start)}}r.appendExecutor(u,_)},onStart:function(){},onComplete:function(){var B=self.performance.now();v.executeEnd=v.end=B,x.first===0&&(x.first=B),L&&L.first===0&&(L.first=B);var k=r.sourceBuffer,w={};for(var U in k)w[U]=b.BufferHelper.getBuffered(k[U]);r.appendError=0,r.hls.trigger(R.Events.BUFFER_APPENDED,{type:_,frag:g,part:m,chunkMeta:y,parent:g.type,timeRanges:w})},onError:function(B){S.logger.error("[buffer-controller]: Error encountered while trying to append to the "+_+" SourceBuffer",B);var k={type:I.ErrorTypes.MEDIA_ERROR,parent:g.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:B,fatal:!1};B.code===DOMException.QUOTA_EXCEEDED_ERR?k.details=I.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,k.details=I.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>o.config.appendErrorMaxRetry&&(S.logger.error("[buffer-controller]: Failed "+o.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),k.fatal=!0)),o.trigger(R.Events.ERROR,k)}};s.append(F,_)},n.onBufferFlushing=function(e,i){var r=this,o=this.operationQueue,s=function(u){return{execute:r.removeExecutor.bind(r,u,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(R.Events.BUFFER_FLUSHED,{type:u})},onError:function(g){S.logger.warn("[buffer-controller]: Failed to remove from "+u+" SourceBuffer",g)}}};i.type?o.append(s(i.type),i.type):this.getSourceBufferTypes().forEach(function(a){o.append(s(a),a)})},n.onFragParsed=function(e,i){var r=this,o=i.frag,s=i.part,a=[],u=s?s.elementaryStreams:o.elementaryStreams;u[c.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(u[c.ElementaryStreamTypes.AUDIO]&&a.push("audio"),u[c.ElementaryStreamTypes.VIDEO]&&a.push("video"));var _=function(){var m=self.performance.now();o.stats.buffering.end=m,s&&(s.stats.buffering.end=m);var y=s?s.stats:o.stats;r.hls.trigger(R.Events.FRAG_BUFFERED,{frag:o,part:s,stats:y,id:o.type})};a.length===0&&S.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+o.type+" level: "+o.level+" sn: "+o.sn),this.blockBuffers(_,a)},n.onFragChanged=function(e,i){this.flushBackBuffer()},n.onBufferEos=function(e,i){var r=this,o=this.getSourceBufferTypes().reduce(function(s,a){var u=r.sourceBuffer[a];return(!i.type||i.type===a)&&u&&!u.ended&&(u.ended=!0,S.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),s&&!!(!u||u.ended)},!0);o&&this.blockBuffers(function(){var s=r.mediaSource;!s||s.readyState!=="open"||s.endOfStream()})},n.onLevelUpdated=function(e,i){var r=i.details;!r.fragments.length||(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},n.flushBackBuffer=function(){var e=this.hls,i=this.details,r=this.media,o=this.sourceBuffer;if(!(!r||i===null)){var s=this.getSourceBufferTypes();if(!!s.length){var a=i.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(A.isFiniteNumber)(a)||a<0)){var u=r.currentTime,_=i.levelTargetDuration,g=Math.max(a,_),m=Math.floor(u/_)*_-g;s.forEach(function(y){var v=o[y];if(v){var E=b.BufferHelper.getBuffered(v);E.length>0&&m>E.start(0)&&(e.trigger(R.Events.BACK_BUFFER_REACHED,{bufferEnd:m}),i.live&&e.trigger(R.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:m}),e.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:m,type:y}))}})}}}},n.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,i=this.hls,r=this.media,o=this.mediaSource,s=e.fragments[0].start+e.totalduration,a=r.duration,u=Object(A.isFiniteNumber)(o.duration)?o.duration:0;e.live&&i.config.liveDurationInfinity?(S.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),o.duration=1/0,this.updateSeekableRange(e)):(s>u&&s>a||!Object(A.isFiniteNumber)(a))&&(S.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),o.duration=s)}},n.updateSeekableRange=function(e){var i=this.mediaSource,r=e.fragments,o=r.length;if(o&&e.live&&i!==null&&i!==void 0&&i.setLiveSeekableRange){var s=Math.max(0,r[0].start),a=Math.max(s,s+e.totalduration);i.setLiveSeekableRange(s,a)}},n.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,i=this.operationQueue,r=this.pendingTracks,o=Object.keys(r).length;if(o&&!e||o===2){this.createSourceBuffers(r),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(R.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(a){i.executeNext(a)})}},n.createSourceBuffers=function(e){var i=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var o=0;for(var s in e)if(!i[s]){var a=e[s];if(!a)throw Error("source buffer exists for track "+s+", however track does not");var u=a.levelCodec||a.codec,_=a.container+";codecs="+u;S.logger.log("[buffer-controller]: creating sourceBuffer("+_+")");try{var g=i[s]=r.addSourceBuffer(_),m=s;this.addBufferListener(m,"updatestart",this._onSBUpdateStart),this.addBufferListener(m,"updateend",this._onSBUpdateEnd),this.addBufferListener(m,"error",this._onSBUpdateError),this.tracks[s]={buffer:g,codec:u,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id},o++}catch(y){S.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+y.message),this.hls.trigger(R.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:y,mimeType:_})}}o&&this.hls.trigger(R.Events.BUFFER_CREATED,{tracks:this.tracks})},n._onSBUpdateStart=function(e){var i=this.operationQueue,r=i.current(e);r.onStart()},n._onSBUpdateEnd=function(e){var i=this.operationQueue,r=i.current(e);r.onComplete(),i.shiftAndExecuteNext(e)},n._onSBUpdateError=function(e,i){S.logger.error("[buffer-controller]: "+e+" SourceBuffer error",i),this.hls.trigger(R.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(i)},n.removeExecutor=function(e,i,r){var o=this.media,s=this.mediaSource,a=this.operationQueue,u=this.sourceBuffer,_=u[e];if(!o||!s||!_){S.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(e);return}var g=Object(A.isFiniteNumber)(o.duration)?o.duration:1/0,m=Object(A.isFiniteNumber)(s.duration)?s.duration:1/0,y=Math.max(0,i),v=Math.min(r,g,m);v>y?(S.logger.log("[buffer-controller]: Removing ["+y+","+v+"] from the "+e+" SourceBuffer"),console.assert(!_.updating,e+" sourceBuffer must not be updating"),_.remove(y,v)):a.shiftAndExecuteNext(e)},n.appendExecutor=function(e,i){var r=this.operationQueue,o=this.sourceBuffer,s=o[i];if(!s){S.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(i);return}s.ended=!1,console.assert(!s.updating,i+" sourceBuffer must not be updating"),s.appendBuffer(e)},n.blockBuffers=function(e,i){var r=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length){S.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var o=this.operationQueue,s=i.map(function(a){return o.appendBlocker(a)});Promise.all(s).then(function(){e(),i.forEach(function(a){var u=r.sourceBuffer[a];(!u||!u.updating)&&o.shiftAndExecuteNext(a)})})},n.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},n.addBufferListener=function(e,i,r){var o=this.sourceBuffer[e];if(!!o){var s=r.bind(this,e);this.listeners[e].push({event:i,listener:s}),o.addEventListener(i,s)}},n.removeBufferListeners=function(e){var i=this.sourceBuffer[e];!i||this.listeners[e].forEach(function(r){i.removeEventListener(r.event,r.listener)})},h}()},"./src/controller/buffer-operation-queue.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return R});var A=D("./src/utils/logger.ts"),R=function(){function S(b){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=b}var I=S.prototype;return I.append=function(T,c){var f=this.queues[c];f.push(T),f.length===1&&this.buffers[c]&&this.executeNext(c)},I.insertAbort=function(T,c){var f=this.queues[c];f.unshift(T),this.executeNext(c)},I.appendBlocker=function(T){var c,f=new Promise(function(l){c=l}),p={execute:c,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(p,T),f},I.executeNext=function(T){var c=this.buffers,f=this.queues,p=c[T],l=f[T];if(l.length){var d=l[0];try{d.execute()}catch(h){A.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),d.onError(h),(!p||!p.updating)&&(l.shift(),this.executeNext(T))}}},I.shiftAndExecuteNext=function(T){this.queues[T].shift(),this.executeNext(T)},I.current=function(T){return this.queues[T][0]},S}()},"./src/controller/cap-level-controller.ts":function(j,P,D){D.r(P);var A=D("./src/events.ts");function R(b,T){for(var c=0;c<T.length;c++){var f=T[c];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}}function S(b,T,c){return T&&R(b.prototype,T),c&&R(b,c),Object.defineProperty(b,"prototype",{writable:!1}),b}var I=function(){function b(c){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=c,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var T=b.prototype;return T.setStreamController=function(f){this.streamController=f},T.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},T.registerListeners=function(){var f=this.hls;f.on(A.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),f.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},T.unregisterListener=function(){var f=this.hls;f.off(A.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),f.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},T.onFpsDropLevelCapping=function(f,p){b.isLevelAllowed(p.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(p.droppedLevel)},T.onMediaAttaching=function(f,p){this.media=p.media instanceof HTMLVideoElement?p.media:null},T.onManifestParsed=function(f,p){var l=this.hls;this.restrictedLevels=[],this.firstLevel=p.firstLevel,l.config.capLevelToPlayerSize&&p.video&&this.startCapping()},T.onBufferCodecs=function(f,p){var l=this.hls;l.config.capLevelToPlayerSize&&p.video&&this.startCapping()},T.onMediaDetaching=function(){this.stopCapping()},T.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var f=this.hls.levels;if(f.length){var p=this.hls;p.autoLevelCapping=this.getMaxLevel(f.length-1),p.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=p.autoLevelCapping}}},T.getMaxLevel=function(f){var p=this,l=this.hls.levels;if(!l.length)return-1;var d=l.filter(function(h,n){return b.isLevelAllowed(n,p.restrictedLevels)&&n<=f});return this.clientRect=null,b.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},T.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},T.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},T.getDimensions=function(){if(this.clientRect)return this.clientRect;var f=this.media,p={width:0,height:0};if(f){var l=f.getBoundingClientRect();p.width=l.width,p.height=l.height,!p.width&&!p.height&&(p.width=l.right-l.left||f.width||0,p.height=l.bottom-l.top||f.height||0)}return this.clientRect=p,p},b.isLevelAllowed=function(f,p){return p===void 0&&(p=[]),p.indexOf(f)===-1},b.getMaxLevelByMediaSize=function(f,p,l){if(!f||!f.length)return-1;for(var d=function(i,r){return r?i.width!==r.width||i.height!==r.height:!0},h=f.length-1,n=0;n<f.length;n+=1){var t=f[n];if((t.width>=p||t.height>=l)&&d(t,f[n+1])){h=n;break}}return h},S(b,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var f=1;if(!this.hls.config.ignoreDevicePixelRatio)try{f=self.devicePixelRatio}catch{}return f}}]),b}();P.default=I},"./src/controller/cmcd-controller.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return d});var A=D("./src/events.ts"),R=D("./src/types/cmcd.ts"),S=D("./src/utils/buffer-helper.ts"),I=D("./src/utils/logger.ts");function b(h,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(h,e.key,e)}}function T(h,n,t){return n&&b(h.prototype,n),t&&b(h,t),Object.defineProperty(h,"prototype",{writable:!1}),h}function c(h,n){var t=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(t)return(t=t.call(h)).next.bind(t);if(Array.isArray(h)||(t=f(h))||n&&h&&typeof h.length=="number"){t&&(h=t);var e=0;return function(){return e>=h.length?{done:!0}:{done:!1,value:h[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f(h,n){if(!!h){if(typeof h=="string")return p(h,n);var t=Object.prototype.toString.call(h).slice(8,-1);if(t==="Object"&&h.constructor&&(t=h.constructor.name),t==="Map"||t==="Set")return Array.from(h);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return p(h,n)}}function p(h,n){(n==null||n>h.length)&&(n=h.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=h[t];return e}function l(){return l=Object.assign?Object.assign.bind():function(h){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])}return h},l.apply(this,arguments)}var d=function(){function h(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(o){try{e.apply(o,{ot:R.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(s){I.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(o){try{var s=o.frag,a=e.hls.levels[s.level],u=e.getObjectType(s),_={d:s.duration*1e3,ot:u};(u===R.CMCDObjectType.VIDEO||u===R.CMCDObjectType.AUDIO||u==R.CMCDObjectType.MUXED)&&(_.br=a.bitrate/1e3,_.tb=e.getTopBandwidth(u)/1e3,_.bl=e.getBufferLength(u)),e.apply(o,_)}catch(g){I.logger.warn("Could not generate segment CMCD data.",g)}},this.hls=t;var i=this.config=t.config,r=i.cmcd;r!=null&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||h.uuid(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.registerListeners())}var n=h.prototype;return n.registerListeners=function(){var e=this.hls;e.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this)},n.unregisterListeners=function(){var e=this.hls;e.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},n.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},n.onMediaAttached=function(e,i){this.media=i.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},n.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},n.onBufferCreated=function(e,i){var r,o;this.audioBuffer=(r=i.tracks.audio)===null||r===void 0?void 0:r.buffer,this.videoBuffer=(o=i.tracks.video)===null||o===void 0?void 0:o.buffer},n.createData=function(){var e;return{v:R.CMCDVersion,sf:R.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},n.apply=function(e,i){i===void 0&&(i={}),l(i,this.createData());var r=i.ot===R.CMCDObjectType.INIT||i.ot===R.CMCDObjectType.VIDEO||i.ot===R.CMCDObjectType.MUXED;if(this.starved&&r&&(i.bs=!0,i.su=!0,this.starved=!1),i.su==null&&(i.su=this.buffering),this.useHeaders){var o=h.toHeaders(i);if(!Object.keys(o).length)return;e.headers||(e.headers={}),l(e.headers,o)}else{var s=h.toQuery(i);if(!s)return;e.url=h.appendQueryToUri(e.url,s)}},n.getObjectType=function(e){var i=e.type;if(i==="subtitle")return R.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return R.CMCDObjectType.INIT;if(i==="audio")return R.CMCDObjectType.AUDIO;if(i==="main")return this.hls.audioTracks.length?R.CMCDObjectType.VIDEO:R.CMCDObjectType.MUXED},n.getTopBandwidth=function(e){var i=0,r,o=this.hls;if(e===R.CMCDObjectType.AUDIO)r=o.audioTracks;else{var s=o.maxAutoLevel,a=s>-1?s+1:o.levels.length;r=o.levels.slice(0,a)}for(var u=c(r),_;!(_=u()).done;){var g=_.value;g.bitrate>i&&(i=g.bitrate)}return i>0?i:NaN},n.getBufferLength=function(e){var i=this.hls.media,r=e===R.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!i)return NaN;var o=S.BufferHelper.bufferInfo(r,i.currentTime,this.config.maxBufferHole);return o.len*1e3},n.createPlaylistLoader=function(){var e=this.config.pLoader,i=this.applyPlaylistData,r=e||this.config.loader;return function(){function o(a){this.loader=void 0,this.loader=new r(a)}var s=o.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(u,_,g){i(u),this.loader.load(u,_,g)},T(o,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),o}()},n.createFragmentLoader=function(){var e=this.config.fLoader,i=this.applyFragmentData,r=e||this.config.loader;return function(){function o(a){this.loader=void 0,this.loader=new r(a)}var s=o.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(u,_,g){i(u),this.loader.load(u,_,g)},T(o,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),o}()},h.uuid=function(){var e=URL.createObjectURL(new Blob),i=e.toString();return URL.revokeObjectURL(e),i.slice(i.lastIndexOf("/")+1)},h.serialize=function(e){for(var i=[],r=function(C){return!Number.isNaN(C)&&C!=null&&C!==""&&C!==!1},o=function(C){return Math.round(C)},s=function(C){return o(C/100)*100},a=function(C){return encodeURIComponent(C)},u={br:o,d:o,bl:s,dl:s,mtp:s,nor:a,rtp:s,tb:o},_=Object.keys(e||{}).sort(),g=c(_),m;!(m=g()).done;){var y=m.value,v=e[y];if(!!r(v)&&!(y==="v"&&v===1)&&!(y=="pr"&&v===1)){var E=u[y];E&&(v=E(v));var x=typeof v,L=void 0;y==="ot"||y==="sf"||y==="st"?L=y+"="+v:x==="boolean"?L=y:x==="number"?L=y+"="+v:L=y+"="+JSON.stringify(v),i.push(L)}}return i.join(",")},h.toHeaders=function(e){for(var i=Object.keys(e),r={},o=["Object","Request","Session","Status"],s=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},u=0,_=i;u<_.length;u++){var g=_[u],m=a[g]!=null?a[g]:1;s[m][g]=e[g]}for(var y=0;y<s.length;y++){var v=h.serialize(s[y]);v&&(r["CMCD-"+o[y]]=v)}return r},h.toQuery=function(e){return"CMCD="+encodeURIComponent(h.serialize(e))},h.appendQueryToUri=function(e,i){if(!i)return e;var r=e.includes("?")?"&":"?";return""+e+r+i},h}()},"./src/controller/eme-controller.ts":function(j,P,D){D.r(P);var A=D("./src/events.ts"),R=D("./src/errors.ts"),S=D("./src/utils/logger.ts"),I=D("./src/utils/mediakeys-helper.ts");function b(d,h){for(var n=0;n<h.length;n++){var t=h[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}}function T(d,h,n){return h&&b(d.prototype,h),n&&b(d,n),Object.defineProperty(d,"prototype",{writable:!1}),d}var c=3,f=function(h,n,t){var e={audioCapabilities:[],videoCapabilities:[]};return h.forEach(function(i){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+i+'"',robustness:t.audioRobustness||""})}),n.forEach(function(i){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+i+'"',robustness:t.videoRobustness||""})}),[e]},p=function(h,n,t,e){switch(h){case I.KeySystems.WIDEVINE:return f(n,t,e);default:throw new Error("Unknown key-system: "+h)}},l=function(){function d(n){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=n,this._config=n.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var h=d.prototype;return h.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},h._registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this)},h._unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this)},h.getLicenseServerUrl=function(t){switch(t){case I.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},h._attemptKeySystemAccess=function(t,e,i){var r=this,o=p(t,e,i,this._drmSystemOptions);S.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,o);this.mediaKeysPromise=s.then(function(a){return r._onMediaKeySystemAccessObtained(t,a)}),s.catch(function(a){S.logger.error('Failed to obtain key-system "'+t+'" access:',a)})},h._onMediaKeySystemAccessObtained=function(t,e){var i=this;S.logger.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r);var o=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(s){return r.mediaKeys=s,S.logger.log('Media-keys created for key-system "'+t+'"'),i._onMediaKeysCreated(),s});return o.catch(function(s){S.logger.error("Failed to create media-keys:",s)}),o},h._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},h._onNewMediaKeySession=function(t){var e=this;S.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(i){e._onKeySessionMessage(t,i.message)},!1)},h._onKeySessionMessage=function(t,e){S.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(i){S.logger.log("Received license data (length: "+(i&&i.byteLength)+"), updating key-session"),t.update(i).catch(function(r){S.logger.warn("Updating key-session failed: "+r)})})},h.onMediaEncrypted=function(t){var e=this;if(S.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise){S.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var i=function(o){!e._media||(e._attemptSetMediaKeys(o),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(i).catch(i)},h._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){S.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}S.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},h._generateRequestWithPreferredKeySession=function(t,e){var i=this,r=this._mediaKeysList[0];if(!r){S.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(r.mediaKeysSessionInitialized){S.logger.warn("Key-Session already initialized but requested again");return}var o=r.mediaKeysSession;if(!o){S.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){S.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}S.logger.log('Generating key-session request for "'+t+'" init data type'),r.mediaKeysSessionInitialized=!0,o.generateRequest(t,e).then(function(){S.logger.debug("Key-session generation succeeded")}).catch(function(s){S.logger.error("Error generating key-session request:",s),i.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},h._createLicenseXhr=function(t,e,i){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,i);var o=this._licenseXhrSetup;if(o)try{o.call(this.hls,r,t),o=void 0}catch(s){S.logger.error(s)}try{r.readyState||r.open("POST",t,!0),o&&o.call(this.hls,r,t)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return r},h._onLicenseRequestReadyStageChange=function(t,e,i,r){switch(t.readyState){case 4:if(t.status===200){this._requestLicenseFailureCount=0,S.logger.log("License request succeeded");var o=t.response,s=this._licenseResponseCallback;if(s)try{o=s.call(this.hls,t,e)}catch(u){S.logger.error(u)}r(o)}else{if(S.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c){this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var a=c-this._requestLicenseFailureCount+1;S.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(i,r)}break}},h._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case I.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},h._requestLicense=function(t,e){S.logger.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i){S.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var r=this.getLicenseServerUrl(i.mediaKeySystemDomain),o=this._createLicenseXhr(r,t,e);S.logger.log("Sending license request to URL: "+r);var s=this._generateLicenseRequestChallenge(i,t);o.send(s)}catch(a){S.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.KEY_SYSTEM_ERROR,details:R.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},h.onMediaAttached=function(t,e){if(!!this._emeEnabled){var i=e.media;this._media=i,i.addEventListener("encrypted",this._onMediaEncrypted)}},h.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;!t||(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(i){if(i.mediaKeysSession)return i.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},h.onManifestParsed=function(t,e){if(!!this._emeEnabled){var i=e.levels.map(function(o){return o.audioCodec}).filter(function(o){return!!o}),r=e.levels.map(function(o){return o.videoCodec}).filter(function(o){return!!o});this._attemptKeySystemAccess(I.KeySystems.WIDEVINE,i,r)}},T(d,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),d}();P.default=l},"./src/controller/fps-controller.ts":function(j,P,D){D.r(P);var A=D("./src/events.ts"),R=D("./src/utils/logger.ts"),S=function(){function I(T){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=T,this.registerListeners()}var b=I.prototype;return b.setStreamController=function(c){this.streamController=c},b.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(c,f){var p=this.hls.config;if(p.capLevelOnFPSDrop){var l=f.media instanceof self.HTMLVideoElement?f.media:null;this.media=l,l&&typeof l.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),p.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(c,f,p){var l=performance.now();if(f){if(this.lastTime){var d=l-this.lastTime,h=p-this.lastDroppedFrames,n=f-this.lastDecodedFrames,t=1e3*h/d,e=this.hls;if(e.trigger(A.Events.FPS_DROP,{currentDropped:h,currentDecoded:n,totalDroppedFrames:p}),t>0&&h>e.config.fpsDroppedMonitoringThreshold*n){var i=e.currentLevel;R.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=i)&&(i=i-1,e.trigger(A.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:e.currentLevel}),e.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=l,this.lastDroppedFrames=p,this.lastDecodedFrames=f}},b.checkFPSInterval=function(){var c=this.media;if(c)if(this.isVideoPlaybackQualityAvailable){var f=c.getVideoPlaybackQuality();this.checkFPS(c,f.totalVideoFrames,f.droppedVideoFrames)}else this.checkFPS(c,c.webkitDecodedFrameCount,c.webkitDroppedFrameCount)},I}();P.default=S},"./src/controller/fragment-finders.ts":function(j,P,D){D.r(P),D.d(P,"findFragmentByPDT",function(){return S}),D.d(P,"findFragmentByPTS",function(){return I}),D.d(P,"fragmentWithinToleranceTest",function(){return b}),D.d(P,"pdtWithinToleranceTest",function(){return T}),D.d(P,"findFragWithCC",function(){return c});var A=D("./src/polyfills/number.ts"),R=D("./src/utils/binary-search.ts");function S(f,p,l){if(p===null||!Array.isArray(f)||!f.length||!Object(A.isFiniteNumber)(p))return null;var d=f[0].programDateTime;if(p<(d||0))return null;var h=f[f.length-1].endProgramDateTime;if(p>=(h||0))return null;l=l||0;for(var n=0;n<f.length;++n){var t=f[n];if(T(p,l,t))return t}return null}function I(f,p,l,d){l===void 0&&(l=0),d===void 0&&(d=0);var h=null;if(f?h=p[f.sn-p[0].sn+1]||null:l===0&&p[0].start===0&&(h=p[0]),h&&b(l,d,h)===0)return h;var n=R.default.search(p,b.bind(null,l,d));return n||h}function b(f,p,l){f===void 0&&(f=0),p===void 0&&(p=0);var d=Math.min(p,l.duration+(l.deltaPTS?l.deltaPTS:0));return l.start+l.duration-d<=f?1:l.start-d>f&&l.start?-1:0}function T(f,p,l){var d=Math.min(p,l.duration+(l.deltaPTS?l.deltaPTS:0))*1e3,h=l.endProgramDateTime||0;return h-d>f}function c(f,p){return R.default.search(f,function(l){return l.cc<p?1:l.cc>p?-1:0})}},"./src/controller/fragment-tracker.ts":function(j,P,D){D.r(P),D.d(P,"FragmentState",function(){return S}),D.d(P,"FragmentTracker",function(){return I});var A=D("./src/events.ts"),R=D("./src/types/loader.ts"),S;(function(c){c.NOT_LOADED="NOT_LOADED",c.APPENDING="APPENDING",c.PARTIAL="PARTIAL",c.OK="OK"})(S||(S={}));var I=function(){function c(p){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=p,this._registerListeners()}var f=c.prototype;return f._registerListeners=function(){var l=this.hls;l.on(A.Events.BUFFER_APPENDED,this.onBufferAppended,this),l.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(A.Events.FRAG_LOADED,this.onFragLoaded,this)},f._unregisterListeners=function(){var l=this.hls;l.off(A.Events.BUFFER_APPENDED,this.onBufferAppended,this),l.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(A.Events.FRAG_LOADED,this.onFragLoaded,this)},f.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},f.getAppendedFrag=function(l,d){if(d===R.PlaylistLevelType.MAIN){var h=this.activeFragment,n=this.activeParts;if(!h)return null;if(n)for(var t=n.length;t--;){var e=n[t],i=e?e.end:h.appendedPTS;if(e.start<=l&&i!==void 0&&l<=i)return t>9&&(this.activeParts=n.slice(t-9)),e}else if(h.start<=l&&h.appendedPTS!==void 0&&l<=h.appendedPTS)return h}return this.getBufferedFrag(l,d)},f.getBufferedFrag=function(l,d){for(var h=this.fragments,n=Object.keys(h),t=n.length;t--;){var e=h[n[t]];if((e==null?void 0:e.body.type)===d&&e.buffered){var i=e.body;if(i.start<=l&&l<=i.end)return i}}return null},f.detectEvictedFragments=function(l,d,h){var n=this;Object.keys(this.fragments).forEach(function(t){var e=n.fragments[t];if(!!e){if(!e.buffered){e.body.type===h&&n.removeFragment(e.body);return}var i=e.range[l];!i||i.time.some(function(r){var o=!n.isTimeBuffered(r.startPTS,r.endPTS,d);return o&&n.removeFragment(e.body),o})}})},f.detectPartialFragments=function(l){var d=this,h=this.timeRanges,n=l.frag,t=l.part;if(!(!h||n.sn==="initSegment")){var e=T(n),i=this.fragments[e];!i||(Object.keys(h).forEach(function(r){var o=n.elementaryStreams[r];if(!!o){var s=h[r],a=t!==null||o.partial===!0;i.range[r]=d.getBufferedTimes(n,t,a,s)}}),i.loaded=null,Object.keys(i.range).length?i.buffered=!0:this.removeFragment(i.body))}},f.fragBuffered=function(l){var d=T(l),h=this.fragments[d];h&&(h.loaded=null,h.buffered=!0)},f.getBufferedTimes=function(l,d,h,n){for(var t={time:[],partial:h},e=d?d.start:l.start,i=d?d.end:l.end,r=l.minEndPTS||i,o=l.maxStartPTS||e,s=0;s<n.length;s++){var a=n.start(s)-this.bufferPadding,u=n.end(s)+this.bufferPadding;if(o>=a&&r<=u){t.time.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(i,n.end(s))});break}else if(e<u&&i>a)t.partial=!0,t.time.push({startPTS:Math.max(e,n.start(s)),endPTS:Math.min(i,n.end(s))});else if(i<=a)break}return t},f.getPartialFragment=function(l){var d=null,h,n,t,e=0,i=this.bufferPadding,r=this.fragments;return Object.keys(r).forEach(function(o){var s=r[o];!s||b(s)&&(n=s.body.start-i,t=s.body.end+i,l>=n&&l<=t&&(h=Math.min(l-n,t-l),e<=h&&(d=s.body,e=h)))}),d},f.getState=function(l){var d=T(l),h=this.fragments[d];return h?h.buffered?b(h)?S.PARTIAL:S.OK:S.APPENDING:S.NOT_LOADED},f.isTimeBuffered=function(l,d,h){for(var n,t,e=0;e<h.length;e++){if(n=h.start(e)-this.bufferPadding,t=h.end(e)+this.bufferPadding,l>=n&&d<=t)return!0;if(d<=n)return!1}return!1},f.onFragLoaded=function(l,d){var h=d.frag,n=d.part;if(!(h.sn==="initSegment"||h.bitrateTest||n)){var t=T(h);this.fragments[t]={body:h,loaded:d,buffered:!1,range:Object.create(null)}}},f.onBufferAppended=function(l,d){var h=this,n=d.frag,t=d.part,e=d.timeRanges;if(n.type===R.PlaylistLevelType.MAIN)if(this.activeFragment=n,t){var i=this.activeParts;i||(this.activeParts=i=[]),i.push(t)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(r){var o=e[r];if(h.detectEvictedFragments(r,o),!t)for(var s=0;s<o.length;s++)n.appendedPTS=Math.max(o.end(s),n.appendedPTS||0)})},f.onFragBuffered=function(l,d){this.detectPartialFragments(d)},f.hasFragment=function(l){var d=T(l);return!!this.fragments[d]},f.removeFragmentsInRange=function(l,d,h){var n=this;Object.keys(this.fragments).forEach(function(t){var e=n.fragments[t];if(!!e&&e.buffered){var i=e.body;i.type===h&&i.start<d&&i.end>l&&n.removeFragment(i)}})},f.removeFragment=function(l){var d=T(l);l.stats.loaded=0,l.clearElementaryStreamInfo(),delete this.fragments[d]},f.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},c}();function b(c){var f,p;return c.buffered&&(((f=c.range.video)===null||f===void 0?void 0:f.partial)||((p=c.range.audio)===null||p===void 0?void 0:p.partial))}function T(c){return c.type+"_"+c.level+"_"+c.urlId+"_"+c.sn}},"./src/controller/gap-controller.ts":function(j,P,D){D.r(P),D.d(P,"STALL_MINIMUM_DURATION_MS",function(){return b}),D.d(P,"MAX_START_GAP_JUMP",function(){return T}),D.d(P,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return c}),D.d(P,"SKIP_BUFFER_RANGE_START",function(){return f}),D.d(P,"default",function(){return p});var A=D("./src/utils/buffer-helper.ts"),R=D("./src/errors.ts"),S=D("./src/events.ts"),I=D("./src/utils/logger.ts"),b=250,T=2,c=.1,f=.05,p=function(){function l(h,n,t,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=h,this.media=n,this.fragmentTracker=t,this.hls=e}var d=l.prototype;return d.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},d.poll=function(n,t){var e=this.config,i=this.media,r=this.stalled;if(i!==null){var o=i.currentTime,s=i.seeking,a=this.seeking&&!s,u=!this.seeking&&s;if(this.seeking=s,o!==n){if(this.moved=!0,r!==null){if(this.stallReported){var _=self.performance.now()-r;I.logger.warn("playback not stuck anymore @"+o+", after "+Math.round(_)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((u||a)&&(this.stalled=null),!(i.paused&&!s||i.ended||i.playbackRate===0||!A.BufferHelper.getBuffered(i).length)){var g=A.BufferHelper.bufferInfo(i,o,0),m=g.len>0,y=g.nextStart||0;if(!(!m&&!y)){if(s){var v=g.len>T,E=!y||t&&t.start<=o||y-o>T&&!this.fragmentTracker.getPartialFragment(o);if(v||E)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var x,L=Math.max(y,g.start||0)-o,O=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,C=O==null||(x=O.details)===null||x===void 0?void 0:x.live,F=C?O.details.targetduration*2:T;if(L>0&&L<=F){this._trySkipBufferHole(null);return}}var M=self.performance.now();if(r===null){this.stalled=M;return}var B=M-r;if(!(!s&&B>=b&&(this._reportStall(g),!this.media))){var k=A.BufferHelper.bufferInfo(i,o,e.maxBufferHole);this._tryFixBufferStall(k,B)}}}}},d._tryFixBufferStall=function(n,t){var e=this.config,i=this.fragmentTracker,r=this.media;if(r!==null){var o=r.currentTime,s=i.getPartialFragment(o);if(s){var a=this._trySkipBufferHole(s);if(a||!this.media)return}n.len>e.maxBufferHole&&t>e.highBufferWatchdogPeriod*1e3&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},d._reportStall=function(n){var t=this.hls,e=this.media,i=this.stallReported;!i&&e&&(this.stallReported=!0,I.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(n)+")"),t.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:n.len}))},d._trySkipBufferHole=function(n){var t=this.config,e=this.hls,i=this.media;if(i===null)return 0;for(var r=i.currentTime,o=0,s=A.BufferHelper.getBuffered(i),a=0;a<s.length;a++){var u=s.start(a);if(r+t.maxBufferHole>=o&&r<u){var _=Math.max(u+f,i.currentTime+c);return I.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+_),this.moved=!0,this.stalled=null,i.currentTime=_,n&&e.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+_,frag:n}),_}o=s.end(a)}return 0},d._tryNudgeBuffer=function(){var n=this.config,t=this.hls,e=this.media,i=this.nudgeRetry;if(e!==null){var r=e.currentTime;if(this.nudgeRetry++,i<n.nudgeMaxRetry){var o=r+(i+1)*n.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+r+" to "+o),e.currentTime=o,t.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+n.nudgeMaxRetry+" nudges"),t.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},l}()},"./src/controller/id3-track-controller.ts":function(j,P,D){D.r(P);var A=D("./src/polyfills/number.ts"),R=D("./src/events.ts"),S=D("./src/utils/texttrack-utils.ts"),I=D("./src/demux/id3.ts"),b=D("./src/loader/date-range.ts"),T=D("./src/types/demuxer.ts"),c=.25;function f(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function p(h,n){return h.getTime()/1e3-n}function l(h){return Uint8Array.from(h.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var d=function(){function h(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var n=h.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(e,i){this.media=i.media},n.onMediaDetaching=function(){!this.id3Track||(Object(S.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(e){var i=this.getID3Track(e.textTracks);return i.mode="hidden",i},n.getID3Track=function(e){if(!!this.media){for(var i=0;i<e.length;i++){var r=e[i];if(r.kind==="metadata"&&r.label==="id3")return Object(S.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(e,i){if(!!this.media){var r=this.hls.config,o=r.enableEmsgMetadataCues,s=r.enableID3MetadataCues;if(!(!o&&!s)){var a=i.frag,u=i.samples,_=i.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=_.edge||a.end,m=f(),y=!1,v={},E=0;E<u.length;E++){var x=u[E].type;if(!(x===T.MetadataSchema.emsg&&!o||!s)){var L=I.getID3Frames(u[E].data);if(L){var O=u[E].pts,C=g,F=C-O;F<=0&&(C=O+c);for(var M=0;M<L.length;M++){var B=L[M];if(!I.isTimeStampFrame(B)){var k=new m(O,C,"");k.value=B,x&&(k.type=x),this.id3Track.addCue(k),v[B.key]=null,y=!0}}}}}y&&this.updateId3CueEnds(v)}}},n.updateId3CueEnds=function(e){var i,r=(i=this.id3Track)===null||i===void 0?void 0:i.cues;if(r)for(var o=r.length;o--;){var s,a=r[o],u=(s=a.value)===null||s===void 0?void 0:s.key;if(u&&u in e){var _=e[u];_&&a.endTime!==_&&(a.endTime=_),e[u]=a.startTime}}},n.onBufferFlushing=function(e,i){var r=i.startOffset,o=i.endOffset,s=i.type,a=this.id3Track,u=this.hls;if(!!u){var _=u.config,g=_.enableEmsgMetadataCues,m=_.enableID3MetadataCues;if(a&&(g||m)){var y;s==="audio"?y=function(E){return E.type===T.MetadataSchema.audioId3&&m}:s==="video"?y=function(E){return E.type===T.MetadataSchema.emsg&&g}:y=function(E){return E.type===T.MetadataSchema.audioId3&&m||E.type===T.MetadataSchema.emsg&&g},Object(S.removeCuesInRange)(a,r,o,y)}}},n.onLevelUpdated=function(e,i){var r=this,o=i.details;if(!(!this.media||!o.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var s=this.dateRangeCuesAppended,a=this.id3Track,u=o.dateRanges,_=Object.keys(u);if(a)for(var g=Object.keys(s).filter(function(F){return!_.includes(F)}),m=function(M){var B=g[M];Object.keys(s[B].cues).forEach(function(k){a.removeCue(s[B].cues[k])}),delete s[B]},y=g.length;y--;)m(y);var v=o.fragments[o.fragments.length-1];if(!(_.length===0||!Object(A.isFiniteNumber)(v==null?void 0:v.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var E=v.programDateTime/1e3-v.start,x=o.edge||v.end,L=f(),O=function(M){var B=_[M],k=u[B],w=s[B],U=(w==null?void 0:w.cues)||{},N=(w==null?void 0:w.durationKnown)||!1,K=p(k.startDate,E),H=x,z=k.endDate;if(z)H=p(z,E),N=!0;else if(k.endOnNext&&!N){var G=_.reduce(function(re,ie){var ne=u[ie];return ne.class===k.class&&ne.id!==ie&&ne.startDate>k.startDate&&re.push(ne),re},[]).sort(function(re,ie){return re.startDate.getTime()-ie.startDate.getTime()})[0];G&&(H=p(G.startDate,E),N=!0)}for(var q=Object.keys(k.attr),Z=0;Z<q.length;Z++){var V=q[Z];if(!(V===b.DateRangeAttribute.ID||V===b.DateRangeAttribute.CLASS||V===b.DateRangeAttribute.START_DATE||V===b.DateRangeAttribute.DURATION||V===b.DateRangeAttribute.END_DATE||V===b.DateRangeAttribute.END_ON_NEXT)){var X=U[V];if(X)N&&!w.durationKnown&&(X.endTime=H);else{var J=k.attr[V];X=new L(K,H,""),(V===b.DateRangeAttribute.SCTE35_OUT||V===b.DateRangeAttribute.SCTE35_IN)&&(J=l(J)),X.value={key:V,data:J},X.type=T.MetadataSchema.dateRange,r.id3Track.addCue(X),U[V]=X}}}s[B]={cues:U,dateRange:k,durationKnown:N}},C=0;C<_.length;C++)O(C)}}},h}();P.default=d},"./src/controller/latency-controller.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return T});var A=D("./src/errors.ts"),R=D("./src/events.ts"),S=D("./src/utils/logger.ts");function I(c,f){for(var p=0;p<f.length;p++){var l=f[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(c,l.key,l)}}function b(c,f,p){return f&&I(c.prototype,f),p&&I(c,p),Object.defineProperty(c,"prototype",{writable:!1}),c}var T=function(){function c(p){var l=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return l.timeupdate()},this.hls=p,this.config=p.config,this.registerListeners()}var f=c.prototype;return f.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},f.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(R.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(R.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(R.Events.ERROR,this.onError)},f.onMediaAttached=function(l,d){this.media=d.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},f.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},f.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},f.onLevelUpdated=function(l,d){var h=d.details;this.levelDetails=h,h.advanced&&this.timeupdate(),!h.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},f.onError=function(l,d){d.details===A.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,S.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},f.timeupdate=function(){var l=this.media,d=this.levelDetails;if(!(!l||!d)){this.currentTime=l.currentTime;var h=this.computeLatency();if(h!==null){this._latency=h;var n=this.config,t=n.lowLatencyMode,e=n.maxLiveSyncPlaybackRate;if(!(!t||e===1)){var i=this.targetLatency;if(i!==null){var r=h-i,o=Math.min(this.maxLatency,i+d.targetduration),s=r<o;if(d.live&&s&&r>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,e)),u=Math.round(2/(1+Math.exp(-.75*r-this.edgeStalled))*20)/20;l.playbackRate=Math.min(a,Math.max(1,u))}else l.playbackRate!==1&&l.playbackRate!==0&&(l.playbackRate=1)}}}}},f.estimateLiveEdge=function(){var l=this.levelDetails;return l===null?null:l.edge+l.age},f.computeLatency=function(){var l=this.estimateLiveEdge();return l===null?null:l-this.currentTime},b(c,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var l=this.config,d=this.levelDetails;return l.liveMaxLatencyDuration!==void 0?l.liveMaxLatencyDuration:d?l.liveMaxLatencyDurationCount*d.targetduration:0}},{key:"targetLatency",get:function(){var l=this.levelDetails;if(l===null)return null;var d=l.holdBack,h=l.partHoldBack,n=l.targetduration,t=this.config,e=t.liveSyncDuration,i=t.liveSyncDurationCount,r=t.lowLatencyMode,o=this.hls.userConfig,s=r&&h||d;(o.liveSyncDuration||o.liveSyncDurationCount||s===0)&&(s=e!==void 0?e:i*n);var a=n,u=1;return s+Math.min(this.stallCount*u,a)}},{key:"liveSyncPosition",get:function(){var l=this.estimateLiveEdge(),d=this.targetLatency,h=this.levelDetails;if(l===null||d===null||h===null)return null;var n=h.edge,t=l-d-this.edgeStalled,e=n-h.totalduration,i=n-(this.config.lowLatencyMode&&h.partTarget||h.targetduration);return Math.min(Math.max(e,t),i)}},{key:"drift",get:function(){var l=this.levelDetails;return l===null?1:l.drift}},{key:"edgeStalled",get:function(){var l=this.levelDetails;if(l===null)return 0;var d=(this.config.lowLatencyMode&&l.partTarget||l.targetduration)*3;return Math.max(l.age-d,0)}},{key:"forwardBufferLength",get:function(){var l=this.media,d=this.levelDetails;if(!l||!d)return 0;var h=l.buffered.length;return(h?l.buffered.end(h-1):d.edge)-this.currentTime}}]),c}()},"./src/controller/level-controller.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return t});var A=D("./src/types/level.ts"),R=D("./src/events.ts"),S=D("./src/errors.ts"),I=D("./src/utils/codecs.ts"),b=D("./src/controller/level-helper.ts"),T=D("./src/controller/base-playlist-controller.ts"),c=D("./src/types/loader.ts");function f(){return f=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},f.apply(this,arguments)}function p(e,i){for(var r=0;r<i.length;r++){var o=i[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,i,r){return i&&p(e.prototype,i),r&&p(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,i){e.prototype=Object.create(i.prototype),e.prototype.constructor=e,h(e,i)}function h(e,i){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,s){return o.__proto__=s,o},h(e,i)}var n=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t=function(e){d(i,e);function i(o){var s;return s=e.call(this,o,"[level-controller]")||this,s._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}var r=i.prototype;return r._registerListeners=function(){var s=this.hls;s.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(R.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(R.Events.ERROR,this.onError,this)},r._unregisterListeners=function(){var s=this.hls;s.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(R.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(R.Events.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},r.startLoad=function(){var s=this._levels;s.forEach(function(a){a.loadError=0}),e.prototype.startLoad.call(this)},r.onManifestLoaded=function(s,a){var u=[],_=[],g=[],m,y={},v,E=!1,x=!1,L=!1;if(a.levels.forEach(function(M){var B=M.attrs;E=E||!!(M.width&&M.height),x=x||!!M.videoCodec,L=L||!!M.audioCodec,n&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var k=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;v=y[k],v?v.url.push(M.url):(v=new A.Level(M),y[k]=v,u.push(v)),B&&(B.AUDIO&&Object(b.addGroupId)(v,"audio",B.AUDIO),B.SUBTITLES&&Object(b.addGroupId)(v,"text",B.SUBTITLES))}),(E||x)&&L&&(u=u.filter(function(M){var B=M.videoCodec,k=M.width,w=M.height;return!!B||!!(k&&w)})),u=u.filter(function(M){var B=M.audioCodec,k=M.videoCodec;return(!B||Object(I.isCodecSupportedInMp4)(B,"audio"))&&(!k||Object(I.isCodecSupportedInMp4)(k,"video"))}),a.audioTracks&&(_=a.audioTracks.filter(function(M){return!M.audioCodec||Object(I.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(b.assignTrackIdsByGroup)(_)),a.subtitles&&(g=a.subtitles,Object(b.assignTrackIdsByGroup)(g)),u.length>0){m=u[0].bitrate,u.sort(function(M,B){return M.bitrate-B.bitrate}),this._levels=u;for(var O=0;O<u.length;O++)if(u[O].bitrate===m){this._firstLevel=O,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+m);break}var C=L&&!x,F={levels:u,audioTracks:_,subtitleTracks:g,firstLevel:this._firstLevel,stats:a.stats,audio:L,video:x,altAudio:!C&&_.some(function(M){return!!M.url})};this.hls.trigger(R.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(R.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(s,a){if(e.prototype.onError.call(this,s,a),!a.fatal){var u=a.context,_=this._levels[this.currentLevelIndex];if(u&&(u.type===c.PlaylistContextType.AUDIO_TRACK&&_.audioGroupIds&&u.groupId===_.audioGroupIds[_.urlId]||u.type===c.PlaylistContextType.SUBTITLE_TRACK&&_.textGroupIds&&u.groupId===_.textGroupIds[_.urlId])){this.redundantFailover(this.currentLevelIndex);return}var g=!1,m=!0,y;switch(a.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:case S.ErrorDetails.KEY_LOAD_ERROR:case S.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var v=this._levels[a.frag.level];v?(v.fragmentError++,v.fragmentError>this.hls.config.fragLoadingMaxRetry&&(y=a.frag.level)):y=a.frag.level}break;case S.ErrorDetails.LEVEL_LOAD_ERROR:case S.ErrorDetails.LEVEL_LOAD_TIMEOUT:u&&(u.deliveryDirectives&&(m=!1),y=u.level),g=!0;break;case S.ErrorDetails.REMUX_ALLOC_ERROR:y=a.level,g=!0;break}y!==void 0&&this.recoverLevel(a,y,g,m)}},r.recoverLevel=function(s,a,u,_){var g=s.details,m=this._levels[a];if(m.loadError++,u){var y=this.retryLoadingOrFail(s);if(y)s.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(_){var v=m.url.length;if(v>1&&m.loadError<v)s.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){var E=a===0?this._levels.length-1:a-1;this.currentLevelIndex!==E&&this._levels[E].loadError===0&&(this.warn(g+": switch to "+E),s.levelRetry=!0,this.hls.nextAutoLevel=E)}}},r.redundantFailover=function(s){var a=this._levels[s],u=a.url.length;if(u>1){var _=(a.urlId+1)%u;this.warn("Switching to redundant URL-id "+_),this._levels.forEach(function(g){g.urlId=_}),this.level=s}},r.onFragLoaded=function(s,a){var u=a.frag;if(u!==void 0&&u.type===c.PlaylistLevelType.MAIN){var _=this._levels[u.level];_!==void 0&&(_.fragmentError=0,_.loadError=0)}},r.onLevelLoaded=function(s,a){var u,_=a.level,g=a.details,m=this._levels[_];if(!m){var y;this.warn("Invalid level index "+_),(y=a.deliveryDirectives)!==null&&y!==void 0&&y.skip&&(g.deltaUpdateFailed=!0);return}_===this.currentLevelIndex?(m.fragmentError===0&&(m.loadError=0,this.retryCount=0),this.playlistLoaded(_,a,m.details)):(u=a.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(g.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(s,a){var u=this.hls.levels[this.currentLevelIndex];if(!!u&&u.audioGroupIds){for(var _=-1,g=this.hls.audioTracks[a.id].groupId,m=0;m<u.audioGroupIds.length;m++)if(u.audioGroupIds[m]===g){_=m;break}_!==u.urlId&&(u.urlId=_,this.startLoad())}},r.loadPlaylist=function(s){var a=this.currentLevelIndex,u=this._levels[a];if(this.canLoad&&u&&u.url.length>0){var _=u.urlId,g=u.url[_];if(s)try{g=s.addDirectives(g)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Attempt loading level index "+a+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+_+" "+g),this.clearTimer(),this.hls.trigger(R.Events.LEVEL_LOADING,{url:g,level:a,id:_,deliveryDirectives:s||null})}},r.removeLevel=function(s,a){var u=function(m,y){return y!==a},_=this._levels.filter(function(g,m){return m!==s?!0:g.url.length>1&&a!==void 0?(g.url=g.url.filter(u),g.audioGroupIds&&(g.audioGroupIds=g.audioGroupIds.filter(u)),g.textGroupIds&&(g.textGroupIds=g.textGroupIds.filter(u)),g.urlId=0,!0):!1}).map(function(g,m){var y=g.details;return y!=null&&y.fragments&&y.fragments.forEach(function(v){v.level=m}),g});this._levels=_,this.hls.trigger(R.Events.LEVELS_UPDATED,{levels:_})},l(i,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var a,u=this._levels;if(u.length!==0&&!(this.currentLevelIndex===s&&(a=u[s])!==null&&a!==void 0&&a.details)){if(s<0||s>=u.length){var _=s<0;if(this.hls.trigger(R.Events.ERROR,{type:S.ErrorTypes.OTHER_ERROR,details:S.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:_,reason:"invalid level idx"}),_)return;s=Math.min(s,u.length-1)}this.clearTimer();var g=this.currentLevelIndex,m=u[g],y=u[s];this.log("switching to level "+s+" from "+g),this.currentLevelIndex=s;var v=f({},y,{level:s,maxBitrate:y.maxBitrate,uri:y.uri,urlId:y.urlId});delete v._urlId,this.hls.trigger(R.Events.LEVEL_SWITCHING,v);var E=y.details;if(!E||E.live){var x=this.switchParams(y.uri,m==null?void 0:m.details);this.loadPlaylist(x)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}else return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),i}(T.default)},"./src/controller/level-helper.ts":function(j,P,D){D.r(P),D.d(P,"addGroupId",function(){return b}),D.d(P,"assignTrackIdsByGroup",function(){return T}),D.d(P,"updatePTS",function(){return c}),D.d(P,"updateFragPTSDTS",function(){return p}),D.d(P,"mergeDetails",function(){return l}),D.d(P,"mapPartIntersection",function(){return h}),D.d(P,"mapFragmentIntersection",function(){return n}),D.d(P,"adjustSliding",function(){return t}),D.d(P,"addSliding",function(){return e}),D.d(P,"computeReloadInterval",function(){return i}),D.d(P,"getFragmentWithSN",function(){return r}),D.d(P,"getPartWith",function(){return o});var A=D("./src/polyfills/number.ts"),R=D("./src/utils/logger.ts"),S=D("./src/loader/date-range.ts");function I(){return I=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var u=arguments[a];for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(s[_]=u[_])}return s},I.apply(this,arguments)}function b(s,a,u){switch(a){case"audio":s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds.push(u);break;case"text":s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds.push(u);break}}function T(s){var a={};s.forEach(function(u){var _=u.groupId||"";u.id=a[_]=a[_]||0,a[_]++})}function c(s,a,u){var _=s[a],g=s[u];f(_,g)}function f(s,a){var u=a.startPTS;if(Object(A.isFiniteNumber)(u)){var _=0,g;a.sn>s.sn?(_=u-s.start,g=s):(_=s.start-u,g=a),g.duration!==_&&(g.duration=_)}else if(a.sn>s.sn){var m=s.cc===a.cc;m&&s.minEndPTS?a.start=s.start+(s.minEndPTS-s.start):a.start=s.start+s.duration}else a.start=Math.max(s.start-a.duration,0)}function p(s,a,u,_,g,m){var y=_-u;y<=0&&(R.logger.warn("Fragment should have a positive duration",a),_=u+a.duration,m=g+a.duration);var v=u,E=_,x=a.startPTS,L=a.endPTS;if(Object(A.isFiniteNumber)(x)){var O=Math.abs(x-u);Object(A.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(O,a.deltaPTS):a.deltaPTS=O,v=Math.max(u,x),u=Math.min(u,x),g=Math.min(g,a.startDTS),E=Math.min(_,L),_=Math.max(_,L),m=Math.max(m,a.endDTS)}a.duration=_-u;var C=u-a.start;a.appendedPTS=_,a.start=a.startPTS=u,a.maxStartPTS=v,a.startDTS=g,a.endPTS=_,a.minEndPTS=E,a.endDTS=m;var F=a.sn;if(!s||F<s.startSN||F>s.endSN)return 0;var M,B=F-s.startSN,k=s.fragments;for(k[B]=a,M=B;M>0;M--)f(k[M],k[M-1]);for(M=B;M<k.length-1;M++)f(k[M],k[M+1]);return s.fragmentHint&&f(k[k.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,C}function l(s,a){for(var u=null,_=s.fragments,g=_.length-1;g>=0;g--){var m=_[g].initSegment;if(m){u=m;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var y=0,v;if(n(s,a,function(M,B){M.relurl&&(y=M.cc-B.cc),Object(A.isFiniteNumber)(M.startPTS)&&Object(A.isFiniteNumber)(M.endPTS)&&(B.start=B.startPTS=M.startPTS,B.startDTS=M.startDTS,B.appendedPTS=M.appendedPTS,B.maxStartPTS=M.maxStartPTS,B.endPTS=M.endPTS,B.endDTS=M.endDTS,B.minEndPTS=M.minEndPTS,B.duration=M.endPTS-M.startPTS,B.duration&&(v=B),a.PTSKnown=a.alignedSliding=!0),B.elementaryStreams=M.elementaryStreams,B.loader=M.loader,B.stats=M.stats,B.urlId=M.urlId,M.initSegment&&(B.initSegment=M.initSegment,u=M.initSegment)}),u){var E=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;E.forEach(function(M){var B;(!M.initSegment||M.initSegment.relurl===((B=u)===null||B===void 0?void 0:B.relurl))&&(M.initSegment=u)})}if(a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(M){return!M}),a.deltaUpdateFailed){R.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var x=a.skippedSegments;x--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=d(s.dateRanges,a.dateRanges,a.recentlyRemovedDateranges));var L=a.fragments;if(y){R.logger.warn("discontinuity sliding from playlist, take drift into account");for(var O=0;O<L.length;O++)L[O].cc+=y}a.skippedSegments&&(a.startCC=a.fragments[0].cc),h(s.partList,a.partList,function(M,B){B.elementaryStreams=M.elementaryStreams,B.stats=M.stats}),v?p(a,v,v.startPTS,v.endPTS,v.startDTS,v.endDTS):t(s,a),L.length&&(a.totalduration=a.edge-L[0].start),a.driftStartTime=s.driftStartTime,a.driftStart=s.driftStart;var C=a.advancedDateTime;if(a.advanced&&C){var F=a.edge;a.driftStart||(a.driftStartTime=C,a.driftStart=F),a.driftEndTime=C,a.driftEnd=F}else a.driftEndTime=s.driftEndTime,a.driftEnd=s.driftEnd,a.advancedDateTime=s.advancedDateTime}function d(s,a,u){var _=I({},s);return u&&u.forEach(function(g){delete _[g]}),Object.keys(a).forEach(function(g){var m=new S.DateRange(a[g].attr,_[g]);m.isValid?_[g]=m:R.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(a[g].attr)+'"')}),_}function h(s,a,u){if(s&&a)for(var _=0,g=0,m=s.length;g<=m;g++){var y=s[g],v=a[g+_];y&&v&&y.index===v.index&&y.fragment.sn===v.fragment.sn?u(y,v):_--}}function n(s,a,u){for(var _=a.skippedSegments,g=Math.max(s.startSN,a.startSN)-a.startSN,m=(s.fragmentHint?1:0)+(_?a.endSN:Math.min(s.endSN,a.endSN))-a.startSN,y=a.startSN-s.startSN,v=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,E=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,x=g;x<=m;x++){var L=E[y+x],O=v[x];_&&!O&&x<_&&(O=a.fragments[x]=L),L&&O&&u(L,O)}}function t(s,a){var u=a.startSN+a.skippedSegments-s.startSN,_=s.fragments;u<0||u>=_.length||e(a,_[u].start)}function e(s,a){if(a){for(var u=s.fragments,_=s.skippedSegments;_<u.length;_++)u[_].start+=a;s.fragmentHint&&(s.fragmentHint.start+=a)}}function i(s,a){var u=1e3*s.levelTargetDuration,_=u/2,g=s.age,m=g>0&&g<u*3,y=a.loading.end-a.loading.start,v,E=s.availabilityDelay;if(s.updated===!1)if(m){var x=333*s.misses;v=Math.max(Math.min(_,y*2),x),s.availabilityDelay=(s.availabilityDelay||0)+v}else v=_;else m?(E=Math.min(E||u/2,g),s.availabilityDelay=E,v=E+u-g):v=u-y;return Math.round(v)}function r(s,a,u){if(!s||!s.details)return null;var _=s.details,g=_.fragments[a-_.startSN];return g||(g=_.fragmentHint,g&&g.sn===a)?g:a<_.startSN&&u&&u.sn===a?u:null}function o(s,a,u){if(!s||!s.details)return null;var _=s.details.partList;if(_)for(var g=_.length;g--;){var m=_[g];if(m.index===u&&m.fragment.sn===a)return m}return null}},"./src/controller/stream-controller.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return o});var A=D("./src/polyfills/number.ts"),R=D("./src/controller/base-stream-controller.ts"),S=D("./src/is-supported.ts"),I=D("./src/events.ts"),b=D("./src/utils/buffer-helper.ts"),T=D("./src/controller/fragment-tracker.ts"),c=D("./src/types/loader.ts"),f=D("./src/loader/fragment.ts"),p=D("./src/demux/transmuxer-interface.ts"),l=D("./src/types/transmuxer.ts"),d=D("./src/controller/gap-controller.ts"),h=D("./src/errors.ts");function n(s,a){for(var u=0;u<a.length;u++){var _=a[u];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(s,_.key,_)}}function t(s,a,u){return a&&n(s.prototype,a),u&&n(s,u),Object.defineProperty(s,"prototype",{writable:!1}),s}function e(s,a){s.prototype=Object.create(a.prototype),s.prototype.constructor=s,i(s,a)}function i(s,a){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,g){return _.__proto__=g,_},i(s,a)}var r=100,o=function(s){e(a,s);function a(_,g){var m;return m=s.call(this,_,g,"[stream-controller]")||this,m.audioCodecSwap=!1,m.gapController=null,m.level=-1,m._forceStartLoad=!1,m.altAudio=!1,m.audioOnly=!1,m.fragPlaying=null,m.onvplaying=null,m.onvseeked=null,m.fragLastKbps=0,m.couldBacktrack=!1,m.backtrackFragment=null,m.audioCodecSwitch=!1,m.videoBuffer=null,m._registerListeners(),m}var u=a.prototype;return u._registerListeners=function(){var g=this.hls;g.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),g.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),g.on(I.Events.ERROR,this.onError,this),g.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),g.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),g.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),g.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),g.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),g.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var g=this.hls;g.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),g.off(I.Events.ERROR,this.onError,this),g.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),g.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),g.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),g.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),g.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),g.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},u.startLoad=function(g){if(this.levels){var m=this.lastCurrentTime,y=this.hls;if(this.stopLoad(),this.setInterval(r),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var v=y.startLevel;v===-1&&(y.config.testBandwidth?(v=0,this.bitrateTest=!0):v=y.nextAutoLevel),this.level=y.nextLoadLevel=v,this.loadedmetadata=!1}m>0&&g===-1&&(this.log("Override startPosition with lastCurrentTime @"+m.toFixed(3)),g=m),this.state=R.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=g,this.tick()}else this._forceStartLoad=!0,this.state=R.State.STOPPED},u.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},u.doTick=function(){switch(this.state){case R.State.IDLE:this.doTickIdle();break;case R.State.WAITING_LEVEL:{var g,m=this.levels,y=this.level,v=m==null||(g=m[y])===null||g===void 0?void 0:g.details;if(v&&(!v.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(v))break;this.state=R.State.IDLE;break}break}case R.State.FRAG_LOADING_WAITING_RETRY:{var E,x=self.performance.now(),L=this.retryDate;(!L||x>=L||(E=this.media)!==null&&E!==void 0&&E.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=R.State.IDLE)}break}this.onTickEnd()},u.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},u.doTickIdle=function(){var g,m,y=this.hls,v=this.levelLastLoaded,E=this.levels,x=this.media,L=y.config,O=y.nextLoadLevel;if(!(v===null||!x&&(this.startFragRequested||!L.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!E||!E[O])){var C=E[O];this.level=y.nextLoadLevel=O;var F=C.details;if(!F||this.state===R.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==O){this.state=R.State.WAITING_LEVEL;return}var M=this.getMainFwdBufferInfo();if(M!==null){var B=M.len,k=this.getMaxBufferLength(C.maxBitrate);if(!(B>=k)){if(this._streamEnded(M,F)){var w={};this.altAudio&&(w.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,w),this.state=R.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>M.end&&(this.backtrackFragment=null);var U=this.backtrackFragment?this.backtrackFragment.start:M.end,N=this.getNextFragment(U,F);if(this.couldBacktrack&&!this.fragPrevious&&N&&N.sn!=="initSegment"&&this.fragmentTracker.getState(N)!==T.FragmentState.OK){var K,H=((K=this.backtrackFragment)!=null?K:N).sn,z=H-F.startSN,G=F.fragments[z-1];G&&N.cc===G.cc&&(N=G,this.fragmentTracker.removeFragment(G))}else this.backtrackFragment&&M.len&&(this.backtrackFragment=null);if(N&&this.fragmentTracker.getState(N)===T.FragmentState.OK&&this.nextLoadPosition>U){var q=this.audioOnly&&!this.altAudio?f.ElementaryStreamTypes.AUDIO:f.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(x,q,c.PlaylistLevelType.MAIN),N=this.getNextFragment(this.nextLoadPosition,F)}!N||(N.initSegment&&!N.initSegment.data&&!this.bitrateTest&&(N=N.initSegment),((g=N.decryptdata)===null||g===void 0?void 0:g.keyFormat)==="identity"&&!((m=N.decryptdata)!==null&&m!==void 0&&m.key)?this.loadKey(N,F):this.loadFragment(N,F,U))}}}},u.loadFragment=function(g,m,y){var v,E=this.fragmentTracker.getState(g);this.fragCurrent=g,E===T.FragmentState.NOT_LOADED||E===T.FragmentState.PARTIAL?g.sn==="initSegment"?this._loadInitSegment(g):this.bitrateTest?(g.bitrateTest=!0,this.log("Fragment "+g.sn+" of level "+g.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(g)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,g,m,y)):E===T.FragmentState.APPENDING?this.reduceMaxBufferLength(g.duration)&&this.fragmentTracker.removeFragment(g):((v=this.media)===null||v===void 0?void 0:v.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},u.getAppendedFrag=function(g){var m=this.fragmentTracker.getAppendedFrag(g,c.PlaylistLevelType.MAIN);return m&&"fragment"in m?m.fragment:m},u.getBufferedFrag=function(g){return this.fragmentTracker.getBufferedFrag(g,c.PlaylistLevelType.MAIN)},u.followingBufferedFrag=function(g){return g?this.getBufferedFrag(g.end+.5):null},u.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},u.nextLevelSwitch=function(){var g=this.levels,m=this.media;if(m!=null&&m.readyState){var y,v=this.getAppendedFrag(m.currentTime);if(v&&v.start>1&&this.flushMainBuffer(0,v.start-1),!m.paused&&g){var E=this.hls.nextLoadLevel,x=g[E],L=this.fragLastKbps;L&&this.fragCurrent?y=this.fragCurrent.duration*x.maxBitrate/(1e3*L)+1:y=0}else y=0;var O=this.getBufferedFrag(m.currentTime+y);if(O){var C=this.followingBufferedFrag(O);if(C){this.abortCurrentFrag();var F=C.maxStartPTS?C.maxStartPTS:C.start,M=C.duration,B=Math.max(O.end,F+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,M*.5),M*.75));this.flushMainBuffer(B,Number.POSITIVE_INFINITY)}}}},u.abortCurrentFrag=function(){var g=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,g!=null&&g.loader&&g.loader.abort(),this.state){case R.State.KEY_LOADING:case R.State.FRAG_LOADING:case R.State.FRAG_LOADING_WAITING_RETRY:case R.State.PARSING:case R.State.PARSED:this.state=R.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},u.flushMainBuffer=function(g,m){s.prototype.flushMainBuffer.call(this,g,m,this.altAudio?"video":null)},u.onMediaAttached=function(g,m){s.prototype.onMediaAttached.call(this,g,m);var y=m.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),y.addEventListener("playing",this.onvplaying),y.addEventListener("seeked",this.onvseeked),this.gapController=new d.default(this.config,y,this.fragmentTracker,this.hls)},u.onMediaDetaching=function(){var g=this.media;g&&(g.removeEventListener("playing",this.onvplaying),g.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},u.onMediaPlaying=function(){this.tick()},u.onMediaSeeked=function(){var g=this.media,m=g?g.currentTime:null;Object(A.isFiniteNumber)(m)&&this.log("Media seeked to "+m.toFixed(3)),this.tick()},u.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},u.onManifestParsed=function(g,m){var y=!1,v=!1,E;m.levels.forEach(function(x){E=x.audioCodec,E&&(E.indexOf("mp4a.40.2")!==-1&&(y=!0),E.indexOf("mp4a.40.5")!==-1&&(v=!0))}),this.audioCodecSwitch=y&&v&&!Object(S.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=m.levels,this.startFragRequested=!1},u.onLevelLoading=function(g,m){var y=this.levels;if(!(!y||this.state!==R.State.IDLE)){var v=y[m.level];(!v.details||v.details.live&&this.levelLastLoaded!==m.level||this.waitForCdnTuneIn(v.details))&&(this.state=R.State.WAITING_LEVEL)}},u.onLevelLoaded=function(g,m){var y,v=this.levels,E=m.level,x=m.details,L=x.totalduration;if(!v){this.warn("Levels were reset while loading level "+E);return}this.log("Level "+E+" loaded ["+x.startSN+","+x.endSN+"], cc ["+x.startCC+", "+x.endCC+"] duration:"+L);var O=this.fragCurrent;O&&(this.state===R.State.FRAG_LOADING||this.state===R.State.FRAG_LOADING_WAITING_RETRY)&&O.level!==m.level&&O.loader&&(this.state=R.State.IDLE,this.backtrackFragment=null,O.loader.abort());var C=v[E],F=0;if(x.live||(y=C.details)!==null&&y!==void 0&&y.live){if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed)return;F=this.alignPlaylists(x,C.details)}if(C.details=x,this.levelLastLoaded=E,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:x,level:E}),this.state===R.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(x))return;this.state=R.State.IDLE}this.startFragRequested?x.live&&this.synchronizeToLiveEdge(x):this.setStartPosition(x,F),this.tick()},u._handleFragmentLoadProgress=function(g){var m,y=g.frag,v=g.part,E=g.payload,x=this.levels;if(!x){this.warn("Levels were reset while fragment load was in progress. Fragment "+y.sn+" of level "+y.level+" will not be buffered");return}var L=x[y.level],O=L.details;if(!O){this.warn("Dropping fragment "+y.sn+" of level "+y.level+" after level details were reset");return}var C=L.videoCodec,F=O.PTSKnown||!O.live,M=(m=y.initSegment)===null||m===void 0?void 0:m.data,B=this._getAudioCodec(L),k=this.transmuxer=this.transmuxer||new p.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),w=v?v.index:-1,U=w!==-1,N=new l.ChunkMetadata(y.level,y.sn,y.stats.chunkCount,E.byteLength,w,U),K=this.initPTS[y.cc];k.push(E,M,B,C,y,v,O.totalduration,F,N,K)},u.onAudioTrackSwitching=function(g,m){var y=this.altAudio,v=!!m.url,E=m.id;if(!v){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;x!=null&&x.loader&&(this.log("Switching to main audio track, cancel main fragment load"),x.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var L=this.hls;y&&L.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),L.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:E})}},u.onAudioTrackSwitched=function(g,m){var y=m.id,v=!!this.hls.audioTracks[y].url;if(v){var E=this.videoBuffer;E&&this.mediaBuffer!==E&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=E)}this.altAudio=v,this.tick()},u.onBufferCreated=function(g,m){var y=m.tracks,v,E,x=!1;for(var L in y){var O=y[L];if(O.id==="main"){if(E=L,v=O,L==="video"){var C=y[L];C&&(this.videoBuffer=C.buffer)}}else x=!0}x&&v?(this.log("Alternate track found, use "+E+".buffered to schedule main fragment loading"),this.mediaBuffer=v.buffer):this.mediaBuffer=this.media},u.onFragBuffered=function(g,m){var y=m.frag,v=m.part;if(!(y&&y.type!==c.PlaylistLevelType.MAIN)){if(this.fragContextChanged(y)){this.warn("Fragment "+y.sn+(v?" p: "+v.index:"")+" of level "+y.level+" finished buffering, but was aborted. state: "+this.state),this.state===R.State.PARSED&&(this.state=R.State.IDLE);return}var E=v?v.stats:y.stats;this.fragLastKbps=Math.round(8*E.total/(E.buffering.end-E.loading.first)),y.sn!=="initSegment"&&(this.fragPrevious=y),this.fragBufferedComplete(y,v)}},u.onError=function(g,m){switch(m.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,m);break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.State.ERROR&&(m.fatal?(this.warn(""+m.details),this.state=R.State.ERROR):!m.levelRetry&&this.state===R.State.WAITING_LEVEL&&(this.state=R.State.IDLE));break;case h.ErrorDetails.BUFFER_FULL_ERROR:if(m.parent==="main"&&(this.state===R.State.PARSING||this.state===R.State.PARSED)){var y=!0,v=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN);v&&v.len>.5&&(y=!this.reduceMaxBufferLength(v.len)),y&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},u.checkBuffer=function(){var g=this.media,m=this.gapController;if(!(!g||!m||!g.readyState)){var y=b.BufferHelper.getBuffered(g);if(!this.loadedmetadata&&y.length)this.loadedmetadata=!0,this.seekToStartPos();else{var v=this.state!==R.State.IDLE?this.fragCurrent:null;m.poll(this.lastCurrentTime,v)}this.lastCurrentTime=g.currentTime}},u.onFragLoadEmergencyAborted=function(){this.state=R.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},u.onBufferFlushed=function(g,m){var y=m.type;if(y!==f.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var v=(y===f.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(v,y,c.PlaylistLevelType.MAIN)}},u.onLevelsUpdated=function(g,m){this.levels=m.levels},u.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},u.seekToStartPos=function(){var g=this.media,m=g.currentTime,y=this.startPosition;if(y>=0&&m<y){if(g.seeking){this.log("could not seek to "+y+", already seeking at "+m);return}var v=b.BufferHelper.getBuffered(g),E=v.length?v.start(0):0,x=E-y;x>0&&(x<this.config.maxBufferHole||x<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+x+" to match buffer start"),y+=x,this.startPosition=y),this.log("seek to target start position "+y+" from current time "+m),g.currentTime=y}},u._getAudioCodec=function(g){var m=this.config.defaultAudioCodec||g.audioCodec;return this.audioCodecSwap&&m&&(this.log("Swapping audio codec"),m.indexOf("mp4a.40.5")!==-1?m="mp4a.40.2":m="mp4a.40.5"),m},u._loadBitrateTestFrag=function(g){var m=this;this._doFragLoad(g).then(function(y){var v=m.hls;if(!(!y||v.nextLoadLevel||m.fragContextChanged(g))){m.fragLoadError=0,m.state=R.State.IDLE,m.startFragRequested=!1,m.bitrateTest=!1;var E=g.stats;E.parsing.start=E.parsing.end=E.buffering.start=E.buffering.end=self.performance.now(),v.trigger(I.Events.FRAG_LOADED,y)}})},u._handleTransmuxComplete=function(g){var m,y="main",v=this.hls,E=g.remuxResult,x=g.chunkMeta,L=this.getCurrentContext(x);if(!L){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(x.level);return}var O=L.frag,C=L.part,F=L.level,M=E.video,B=E.text,k=E.id3,w=E.initSegment,U=F.details,N=this.altAudio?void 0:E.audio;if(!this.fragContextChanged(O)){if(this.state=R.State.PARSING,w){w.tracks&&(this._bufferInitSegment(F,w.tracks,O,x),v.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:y,tracks:w.tracks}));var K=w.initPTS,H=w.timescale;Object(A.isFiniteNumber)(K)&&(this.initPTS[O.cc]=K,v.trigger(I.Events.INIT_PTS_FOUND,{frag:O,id:y,initPTS:K,timescale:H}))}if(M&&E.independent!==!1){if(U){var z=M.startPTS,G=M.endPTS,q=M.startDTS,Z=M.endDTS;if(C)C.elementaryStreams[M.type]={startPTS:z,endPTS:G,startDTS:q,endDTS:Z};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){var V=this.getMainFwdBufferInfo(),X=(V?V.end:this.getLoadPosition())+this.config.maxBufferHole,J=M.firstKeyFramePTS?M.firstKeyFramePTS:z;if(X<J-this.config.maxBufferHole){this.backtrack(O);return}O.setElementaryStreamInfo(M.type,O.start,G,O.start,Z,!0)}O.setElementaryStreamInfo(M.type,z,G,q,Z),this.backtrackFragment&&(this.backtrackFragment=O),this.bufferFragmentData(M,O,C,x)}}else if(E.independent===!1){this.backtrack(O);return}if(N){var re=N.startPTS,ie=N.endPTS,ne=N.startDTS,ae=N.endDTS;C&&(C.elementaryStreams[f.ElementaryStreamTypes.AUDIO]={startPTS:re,endPTS:ie,startDTS:ne,endDTS:ae}),O.setElementaryStreamInfo(f.ElementaryStreamTypes.AUDIO,re,ie,ne,ae),this.bufferFragmentData(N,O,C,x)}if(U&&k!==null&&k!==void 0&&(m=k.samples)!==null&&m!==void 0&&m.length){var ue={id:y,frag:O,details:U,samples:k.samples};v.trigger(I.Events.FRAG_PARSING_METADATA,ue)}if(U&&B){var oe={id:y,frag:O,details:U,samples:B.samples};v.trigger(I.Events.FRAG_PARSING_USERDATA,oe)}}},u._bufferInitSegment=function(g,m,y,v){var E=this;if(this.state===R.State.PARSING){this.audioOnly=!!m.audio&&!m.video,this.altAudio&&!this.audioOnly&&delete m.audio;var x=m.audio,L=m.video,O=m.audiovideo;if(x){var C=g.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(C&&(C.indexOf("mp4a.40.5")!==-1?C="mp4a.40.2":C="mp4a.40.5"),x.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(C="mp4a.40.5")),F.indexOf("android")!==-1&&x.container!=="audio/mpeg"&&(C="mp4a.40.2",this.log("Android: force audio codec to "+C)),g.audioCodec&&g.audioCodec!==C&&this.log('Swapping manifest audio codec "'+g.audioCodec+'" for "'+C+'"'),x.levelCodec=C,x.id="main",this.log("Init audio buffer, container:"+x.container+", codecs[selected/level/parsed]=["+(C||"")+"/"+(g.audioCodec||"")+"/"+x.codec+"]")}L&&(L.levelCodec=g.videoCodec,L.id="main",this.log("Init video buffer, container:"+L.container+", codecs[level/parsed]=["+(g.videoCodec||"")+"/"+L.codec+"]")),O&&this.log("Init audiovideo buffer, container:"+O.container+", codecs[level/parsed]=["+(g.attrs.CODECS||"")+"/"+O.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,m),Object.keys(m).forEach(function(M){var B=m[M],k=B.initSegment;k!=null&&k.byteLength&&E.hls.trigger(I.Events.BUFFER_APPENDING,{type:M,data:k,frag:y,part:null,chunkMeta:v,parent:y.type})}),this.tick()}},u.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.MAIN)},u.backtrack=function(g){this.couldBacktrack=!0,this.backtrackFragment=g,this.resetTransmuxer(),this.flushBufferGap(g),this.fragmentTracker.removeFragment(g),this.fragPrevious=null,this.nextLoadPosition=g.start,this.state=R.State.IDLE},u.checkFragmentChanged=function(){var g=this.media,m=null;if(g&&g.readyState>1&&g.seeking===!1){var y=g.currentTime;if(b.BufferHelper.isBuffered(g,y)?m=this.getAppendedFrag(y):b.BufferHelper.isBuffered(g,y+.1)&&(m=this.getAppendedFrag(y+.1)),m){this.backtrackFragment=null;var v=this.fragPlaying,E=m.level;(!v||m.sn!==v.sn||v.level!==E||m.urlId!==v.urlId)&&(this.hls.trigger(I.Events.FRAG_CHANGED,{frag:m}),(!v||v.level!==E)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:E}),this.fragPlaying=m)}}},t(a,[{key:"nextLevel",get:function(){var g=this.nextBufferedFrag;return g?g.level:-1}},{key:"currentFrag",get:function(){var g=this.media;return g?this.fragPlaying||this.getAppendedFrag(g.currentTime):null}},{key:"currentProgramDateTime",get:function(){var g=this.media;if(g){var m=g.currentTime,y=this.currentFrag;if(y&&Object(A.isFiniteNumber)(m)&&Object(A.isFiniteNumber)(y.programDateTime)){var v=y.programDateTime+(m-y.start)*1e3;return new Date(v)}}return null}},{key:"currentLevel",get:function(){var g=this.currentFrag;return g?g.level:-1}},{key:"nextBufferedFrag",get:function(){var g=this.currentFrag;return g?this.followingBufferedFrag(g):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(R.default)},"./src/controller/subtitle-stream-controller.ts":function(j,P,D){D.r(P),D.d(P,"SubtitleStreamController",function(){return e});var A=D("./src/events.ts"),R=D("./src/utils/buffer-helper.ts"),S=D("./src/controller/fragment-finders.ts"),I=D("./src/utils/discontinuities.ts"),b=D("./src/controller/level-helper.ts"),T=D("./src/controller/fragment-tracker.ts"),c=D("./src/controller/base-stream-controller.ts"),f=D("./src/types/loader.ts"),p=D("./src/types/level.ts");function l(i,r){for(var o=0;o<r.length;o++){var s=r[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function d(i,r,o){return r&&l(i.prototype,r),o&&l(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function h(i,r){i.prototype=Object.create(r.prototype),i.prototype.constructor=i,n(i,r)}function n(i,r){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},n(i,r)}var t=500,e=function(i){h(r,i);function r(s,a){var u;return u=i.call(this,s,a,"[subtitle-stream-controller]")||this,u.levels=[],u.currentTrackId=-1,u.tracksBuffered=[],u.mainDetails=null,u._registerListeners(),u}var o=r.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var a=this.hls;a.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(A.Events.ERROR,this.onError,this),a.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(A.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(A.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},o._unregisterListeners=function(){var a=this.hls;a.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(A.Events.ERROR,this.onError,this),a.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(A.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(A.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},o.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(t),this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},o.onLevelLoaded=function(a,u){this.mainDetails=u.details},o.onSubtitleFragProcessed=function(a,u){var _=u.frag,g=u.success;if(this.fragPrevious=_,this.state=c.State.IDLE,!!g){var m=this.tracksBuffered[this.currentTrackId];if(!!m){for(var y,v=_.start,E=0;E<m.length;E++)if(v>=m[E].start&&v<=m[E].end){y=m[E];break}var x=_.start+_.duration;y?y.end=x:(y={start:v,end:x},m.push(y)),this.fragmentTracker.fragBuffered(_)}}},o.onBufferFlushing=function(a,u){var _=u.startOffset,g=u.endOffset;if(_===0&&g!==Number.POSITIVE_INFINITY){var m=this.currentTrackId,y=this.levels;if(!y.length||!y[m]||!y[m].details)return;var v=y[m].details,E=v.targetduration,x=g-E;if(x<=0)return;u.endOffsetSubtitles=Math.max(0,x),this.tracksBuffered.forEach(function(L){for(var O=0;O<L.length;){if(L[O].end<=x){L.shift();continue}else if(L[O].start<x)L[O].start=x;else break;O++}}),this.fragmentTracker.removeFragmentsInRange(_,x,f.PlaylistLevelType.SUBTITLE)}},o.onError=function(a,u){var _,g=u.frag;!g||g.type!==f.PlaylistLevelType.SUBTITLE||((_=this.fragCurrent)!==null&&_!==void 0&&_.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},o.onSubtitleTracksUpdated=function(a,u){var _=this,g=u.subtitleTracks;this.tracksBuffered=[],this.levels=g.map(function(m){return new p.Level(m)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(m){_.tracksBuffered[m.id]=[]}),this.mediaBuffer=null},o.onSubtitleTrackSwitch=function(a,u){if(this.currentTrackId=u.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var _=this.levels[this.currentTrackId];_!=null&&_.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,_&&this.setInterval(t)},o.onSubtitleTrackLoaded=function(a,u){var _,g=u.details,m=u.id,y=this.currentTrackId,v=this.levels;if(!!v.length){var E=v[y];if(!(m>=v.length||m!==y||!E)){if(this.mediaBuffer=this.mediaBufferTimeRanges,g.live||(_=E.details)!==null&&_!==void 0&&_.live){var x=this.mainDetails;if(g.deltaUpdateFailed||!x)return;var L=x.fragments[0];if(!E.details)g.hasProgramDateTime&&x.hasProgramDateTime?Object(I.alignMediaPlaylistByPDT)(g,x):L&&Object(b.addSliding)(g,L.start);else{var O=this.alignPlaylists(g,E.details);O===0&&L&&Object(b.addSliding)(g,L.start)}}if(E.details=g,this.levelLastLoaded=m,this.tick(),g.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE){var C=Object(S.findFragmentByPTS)(null,g.fragments,this.media.currentTime,0);C||(this.warn("Subtitle playlist not aligned with playback"),E.details=void 0)}}}},o._handleFragmentLoadComplete=function(a){var u=a.frag,_=a.payload,g=u.decryptdata,m=this.hls;if(!this.fragContextChanged(u)&&_&&_.byteLength>0&&g&&g.key&&g.iv&&g.method==="AES-128"){var y=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(_),g.key.buffer,g.iv.buffer).then(function(v){var E=performance.now();m.trigger(A.Events.FRAG_DECRYPTED,{frag:u,payload:v,stats:{tstart:y,tdecrypt:E}})})}},o.doTick=function(){if(!this.media){this.state=c.State.IDLE;return}if(this.state===c.State.IDLE){var a=this.currentTrackId,u=this.levels;if(!u.length||!u[a]||!u[a].details)return;var _=u[a].details,g=_.targetduration,m=this.config,y=this.media,v=R.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,y.currentTime-g,m.maxBufferHole),E=v.end,x=v.len,L=this.getMaxBufferLength()+g;if(x>L)return;console.assert(_,"Subtitle track details are defined on idle subtitle stream controller tick");var O=_.fragments,C=O.length,F=_.edge,M,B=this.fragPrevious;if(E<F){var k=m.maxFragLookUpTolerance;M=Object(S.findFragmentByPTS)(B,O,Math.max(O[0].start,E),k),!M&&B&&B.start<O[0].start&&(M=O[0])}else M=O[C-1];if(M=this.mapToInitFragWhenRequired(M),!M)return;M.encrypted?this.loadKey(M,_):this.fragmentTracker.getState(M)===T.FragmentState.NOT_LOADED&&this.loadFragment(M,_,E)}},o.loadFragment=function(a,u,_){this.fragCurrent=a,a.sn==="initSegment"?this._loadInitSegment(a):i.prototype.loadFragment.call(this,a,u,_)},d(r,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),r}(c.default)},"./src/controller/subtitle-track-controller.ts":function(j,P,D){D.r(P);var A=D("./src/events.ts"),R=D("./src/utils/texttrack-utils.ts"),S=D("./src/controller/base-playlist-controller.ts"),I=D("./src/types/loader.ts");function b(d,h){for(var n=0;n<h.length;n++){var t=h[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(d,t.key,t)}}function T(d,h,n){return h&&b(d.prototype,h),n&&b(d,n),Object.defineProperty(d,"prototype",{writable:!1}),d}function c(d,h){d.prototype=Object.create(h.prototype),d.prototype.constructor=d,f(d,h)}function f(d,h){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(d,h)}var p=function(d){c(h,d);function h(t){var e;return e=d.call(this,t,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var n=h.prototype;return n.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},n.registerListeners=function(){var e=this.hls;e.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.Events.ERROR,this.onError,this)},n.onMediaAttached=function(e,i){this.media=i.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},n.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},n.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=l(this.media.textTracks);e.forEach(function(i){Object(R.clearCurrentCues)(i)}),this.subtitleTrack=-1,this.media=null}},n.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},n.onManifestParsed=function(e,i){this.tracks=i.subtitleTracks},n.onSubtitleTrackLoaded=function(e,i){var r=i.id,o=i.details,s=this.trackId,a=this.tracksInGroup[s];if(!a){this.warn("Invalid subtitle track id "+r);return}var u=a.details;a.details=i.details,this.log("subtitle track "+r+" loaded ["+o.startSN+"-"+o.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,i,u))},n.onLevelLoading=function(e,i){this.switchLevel(i.level)},n.onLevelSwitching=function(e,i){this.switchLevel(i.level)},n.switchLevel=function(e){var i=this.hls.levels[e];if(!!(i!=null&&i.textGroupIds)){var r=i.textGroupIds[i.urlId];if(this.groupId!==r){var o=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(_){return!r||_.groupId===r});this.tracksInGroup=s;var a=this.findTrackId(o==null?void 0:o.name)||this.findTrackId();this.groupId=r;var u={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(A.Events.SUBTITLE_TRACKS_UPDATED,u),a!==-1&&this.setSubtitleTrack(a,o)}}},n.findTrackId=function(e){for(var i=this.tracksInGroup,r=0;r<i.length;r++){var o=i[r];if((!this.selectDefaultTrack||o.default)&&(!e||e===o.name))return o.id}return-1},n.onError=function(e,i){d.prototype.onError.call(this,e,i),!(i.fatal||!i.context)&&i.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},n.loadPlaylist=function(e){var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var r=i.id,o=i.groupId,s=i.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:o,deliveryDirectives:e||null})}},n.toggleTrackModes=function(e){var i=this,r=this.media,o=this.trackId;if(!!r){var s=l(r.textTracks),a=s.filter(function(g){return g.groupId===i.groupId});if(e===-1)[].slice.call(s).forEach(function(g){g.mode="disabled"});else{var u=a[o];u&&(u.mode="disabled")}var _=a[e];_&&(_.mode=this.subtitleDisplay?"showing":"hidden")}},n.setSubtitleTrack=function(e,i){var r,o=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(r=o[e])!==null&&r!==void 0&&r.details)||e<-1||e>=o.length)){this.clearTimer();var s=o[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,s){var a=s.id,u=s.groupId,_=u===void 0?"":u,g=s.name,m=s.type,y=s.url;this.hls.trigger(A.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:_,name:g,type:m,url:y});var v=this.switchParams(s.url,i==null?void 0:i.details);this.loadPlaylist(v)}else this.hls.trigger(A.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},n.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,i=l(this.media.textTracks),r=0;r<i.length;r++)if(i[r].mode==="hidden")e=r;else if(i[r].mode==="showing"){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},T(h,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,i)}}]),h}(S.default);function l(d){for(var h=[],n=0;n<d.length;n++){var t=d[n];t.kind==="subtitles"&&t.label&&h.push(d[n])}return h}P.default=p},"./src/controller/timeline-controller.ts":function(j,P,D){D.r(P),D.d(P,"TimelineController",function(){return d});var A=D("./src/polyfills/number.ts"),R=D("./src/events.ts"),S=D("./src/utils/cea-608-parser.ts"),I=D("./src/utils/output-filter.ts"),b=D("./src/utils/webvtt-parser.ts"),T=D("./src/utils/texttrack-utils.ts"),c=D("./src/utils/imsc1-ttml-parser.ts"),f=D("./src/utils/mp4-tools.ts"),p=D("./src/types/loader.ts"),l=D("./src/utils/logger.ts"),d=function(){function e(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=t(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var o=new I.default(this,"textTrack1"),s=new I.default(this,"textTrack2"),a=new I.default(this,"textTrack3"),u=new I.default(this,"textTrack4");this.cea608Parser1=new S.default(1,o,s),this.cea608Parser2=new S.default(3,a,u)}r.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(R.Events.FRAG_LOADING,this.onFragLoading,this),r.on(R.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(R.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(R.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(R.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(R.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var i=e.prototype;return i.destroy=function(){var o=this.hls;o.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.off(R.Events.FRAG_LOADING,this.onFragLoading,this),o.off(R.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(R.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),o.off(R.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),o.off(R.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),o.off(R.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),o.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},i.addCues=function(o,s,a,u,_){for(var g=!1,m=_.length;m--;){var y=_[m],v=n(y[0],y[1],s,a);if(v>=0&&(y[0]=Math.min(y[0],s),y[1]=Math.max(y[1],a),g=!0,v/(a-s)>.5))return}if(g||_.push([s,a]),this.config.renderTextTracksNatively){var E=this.captionsTracks[o];this.Cues.newCue(E,s,a,u)}else{var x=this.Cues.newCue(null,s,a,u);this.hls.trigger(R.Events.CUES_PARSED,{type:"captions",cues:x,track:o})}},i.onInitPtsFound=function(o,s){var a=this,u=s.frag,_=s.id,g=s.initPTS,m=s.timescale,y=this.unparsedVttFrags;_==="main"&&(this.initPTS[u.cc]=g,this.timescale[u.cc]=m),y.length&&(this.unparsedVttFrags=[],y.forEach(function(v){a.onFragLoaded(R.Events.FRAG_LOADED,v)}))},i.getExistingTrack=function(o){var s=this.media;if(s)for(var a=0;a<s.textTracks.length;a++){var u=s.textTracks[a];if(u[o])return u}return null},i.createCaptionsTrack=function(o){this.config.renderTextTracksNatively?this.createNativeTrack(o):this.createNonNativeTrack(o)},i.createNativeTrack=function(o){if(!this.captionsTracks[o]){var s=this.captionsProperties,a=this.captionsTracks,u=this.media,_=s[o],g=_.label,m=_.languageCode,y=this.getExistingTrack(o);if(y)a[o]=y,Object(T.clearCurrentCues)(a[o]),Object(T.sendAddTrackEvent)(a[o],u);else{var v=this.createTextTrack("captions",g,m);v&&(v[o]=!0,a[o]=v)}}},i.createNonNativeTrack=function(o){if(!this.nonNativeCaptionsTracks[o]){var s=this.captionsProperties[o];if(!!s){var a=s.label,u={_id:o,label:a,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[o]=u,this.hls.trigger(R.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[u]})}}},i.createTextTrack=function(o,s,a){var u=this.media;if(!!u)return u.addTextTrack(o,s,a)},i.onMediaAttaching=function(o,s){this.media=s.media,this._cleanTracks()},i.onMediaDetaching=function(){var o=this.captionsTracks;Object.keys(o).forEach(function(s){Object(T.clearCurrentCues)(o[s]),delete o[s]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=t(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},i._cleanTracks=function(){var o=this.media;if(!!o){var s=o.textTracks;if(s)for(var a=0;a<s.length;a++)Object(T.clearCurrentCues)(s[a])}},i.onSubtitleTracksUpdated=function(o,s){var a=this;this.textTracks=[];var u=s.subtitleTracks||[],_=u.some(function(v){return v.textCodec===c.IMSC1_CODEC});if(this.config.enableWebVTT||_&&this.config.enableIMSC1){var g=this.tracks&&u&&this.tracks.length===u.length;if(this.tracks=u||[],this.config.renderTextTracksNatively){var m=this.media?this.media.textTracks:[];this.tracks.forEach(function(v,E){var x;if(E<m.length){for(var L=null,O=0;O<m.length;O++)if(h(m[O],v)){L=m[O];break}L&&(x=L)}if(x)Object(T.clearCurrentCues)(x);else{var C=a._captionsOrSubtitlesFromCharacteristics(v);x=a.createTextTrack(C,v.name,v.lang),x&&(x.mode="disabled")}x&&(x.groupId=v.groupId,a.textTracks.push(x))})}else if(!g&&this.tracks&&this.tracks.length){var y=this.tracks.map(function(v){return{label:v.name,kind:v.type.toLowerCase(),default:v.default,subtitleTrack:v}});this.hls.trigger(R.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:y})}}},i._captionsOrSubtitlesFromCharacteristics=function(o){var s;if((s=o.attrs)!==null&&s!==void 0&&s.CHARACTERISTICS){var a=/transcribes-spoken-dialog/gi.test(o.attrs.CHARACTERISTICS),u=/describes-music-and-sound/gi.test(o.attrs.CHARACTERISTICS);if(a&&u)return"captions"}return"subtitles"},i.onManifestLoaded=function(o,s){var a=this;this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(function(u){var _=/(?:CC|SERVICE)([1-4])/.exec(u.instreamId);if(!!_){var g="textTrack"+_[1],m=a.captionsProperties[g];!m||(m.label=u.name,u.lang&&(m.languageCode=u.lang),m.media=u)}})},i.onFragLoading=function(o,s){var a=this.cea608Parser1,u=this.cea608Parser2,_=this.lastSn,g=this.lastPartIndex;if(!(!this.enabled||!(a&&u))&&s.frag.type===p.PlaylistLevelType.MAIN){var m,y,v=s.frag.sn,E=(m=s==null||(y=s.part)===null||y===void 0?void 0:y.index)!=null?m:-1;v===_+1||v===_&&E===g+1||(a.reset(),u.reset()),this.lastSn=v,this.lastPartIndex=E}},i.onFragLoaded=function(o,s){var a=s.frag,u=s.payload,_=this.initPTS,g=this.unparsedVttFrags;if(a.type===p.PlaylistLevelType.SUBTITLE)if(u.byteLength){if(!Object(A.isFiniteNumber)(_[a.cc])){g.push(s),_.length&&this.hls.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")});return}var m=a.decryptdata,y="stats"in s;if(m==null||m.key==null||m.method!=="AES-128"||y){var v=this.tracks[a.level],E=this.vttCCs;E[a.cc]||(E[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),v&&v.textCodec===c.IMSC1_CODEC?this._parseIMSC1(a,u):this._parseVTTs(a,u,E)}}else this.hls.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},i._parseIMSC1=function(o,s){var a=this,u=this.hls;Object(c.parseIMSC1)(s,this.initPTS[o.cc],this.timescale[o.cc],function(_){a._appendCues(_,o.level),u.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},function(_){l.logger.log("Failed to parse IMSC1: "+_),u.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:_})})},i._parseVTTs=function(o,s,a){var u,_=this,g=this.hls,m=(u=o.initSegment)!==null&&u!==void 0&&u.data?Object(f.appendUint8Array)(o.initSegment.data,new Uint8Array(s)):s;Object(b.parseWebVTT)(m,this.initPTS[o.cc],this.timescale[o.cc],a,o.cc,o.start,function(y){_._appendCues(y,o.level),g.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:o})},function(y){_._fallbackToIMSC1(o,s),l.logger.log("Failed to parse VTT cue: "+y),g.trigger(R.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:y})})},i._fallbackToIMSC1=function(o,s){var a=this,u=this.tracks[o.level];u.textCodec||Object(c.parseIMSC1)(s,this.initPTS[o.cc],this.timescale[o.cc],function(){u.textCodec=c.IMSC1_CODEC,a._parseIMSC1(o,s)},function(){u.textCodec="wvtt"})},i._appendCues=function(o,s){var a=this.hls;if(this.config.renderTextTracksNatively){var u=this.textTracks[s];if(!u||u.mode==="disabled")return;o.forEach(function(m){return Object(T.addCueToTrack)(u,m)})}else{var _=this.tracks[s];if(!_)return;var g=_.default?"default":"subtitles"+s;a.trigger(R.Events.CUES_PARSED,{type:"subtitles",cues:o,track:g})}},i.onFragDecrypted=function(o,s){var a=s.frag;if(a.type===p.PlaylistLevelType.SUBTITLE){if(!Object(A.isFiniteNumber)(this.initPTS[a.cc])){this.unparsedVttFrags.push(s);return}this.onFragLoaded(R.Events.FRAG_LOADED,s)}},i.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},i.onFragParsingUserdata=function(o,s){var a=this.cea608Parser1,u=this.cea608Parser2;if(!(!this.enabled||!(a&&u)))for(var _=0;_<s.samples.length;_++){var g=s.samples[_].bytes;if(g){var m=this.extractCea608Data(g);a.addData(s.samples[_].pts,m[0]),u.addData(s.samples[_].pts,m[1])}}},i.onBufferFlushing=function(o,s){var a=s.startOffset,u=s.endOffset,_=s.endOffsetSubtitles,g=s.type,m=this.media;if(!(!m||m.currentTime<u)){if(!g||g==="video"){var y=this.captionsTracks;Object.keys(y).forEach(function(E){return Object(T.removeCuesInRange)(y[E],a,u)})}if(this.config.renderTextTracksNatively&&a===0&&_!==void 0){var v=this.textTracks;Object.keys(v).forEach(function(E){return Object(T.removeCuesInRange)(v[E],a,_)})}}},i.extractCea608Data=function(o){for(var s=[[],[]],a=o[0]&31,u=2,_=0;_<a;_++){var g=o[u++],m=127&o[u++],y=127&o[u++];if(!(m===0&&y===0)){var v=(4&g)!==0;if(v){var E=3&g;(E===0||E===1)&&(s[E].push(m),s[E].push(y))}}}return s},e}();function h(e,i){return e&&e.label===i.name&&!(e.textTrack1||e.textTrack2)}function n(e,i,r,o){return Math.min(i,o)-Math.max(e,r)}function t(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return A});var A=function(){function R(I,b){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=b}var S=R.prototype;return S.decrypt=function(b,T){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},T,b)},R}()},"./src/crypt/aes-decryptor.ts":function(j,P,D){D.r(P),D.d(P,"removePadding",function(){return R}),D.d(P,"default",function(){return S});var A=D("./src/utils/typed-array.ts");function R(I){var b=I.byteLength,T=b&&new DataView(I.buffer).getUint8(b-1);return T?Object(A.sliceUint8)(I,0,b-T):I}var S=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var b=I.prototype;return b.uint8ArrayToUint32Array_=function(c){for(var f=new DataView(c),p=new Uint32Array(4),l=0;l<4;l++)p[l]=f.getUint32(l*4);return p},b.initTable=function(){var c=this.sBox,f=this.invSBox,p=this.subMix,l=p[0],d=p[1],h=p[2],n=p[3],t=this.invSubMix,e=t[0],i=t[1],r=t[2],o=t[3],s=new Uint32Array(256),a=0,u=0,_=0;for(_=0;_<256;_++)_<128?s[_]=_<<1:s[_]=_<<1^283;for(_=0;_<256;_++){var g=u^u<<1^u<<2^u<<3^u<<4;g=g>>>8^g&255^99,c[a]=g,f[g]=a;var m=s[a],y=s[m],v=s[y],E=s[g]*257^g*16843008;l[a]=E<<24|E>>>8,d[a]=E<<16|E>>>16,h[a]=E<<8|E>>>24,n[a]=E,E=v*16843009^y*65537^m*257^a*16843008,e[g]=E<<24|E>>>8,i[g]=E<<16|E>>>16,r[g]=E<<8|E>>>24,o[g]=E,a?(a=m^s[s[s[v^m]]],u^=s[s[u]]):a=u=1}},b.expandKey=function(c){for(var f=this.uint8ArrayToUint32Array_(c),p=!0,l=0;l<f.length&&p;)p=f[l]===this.key[l],l++;if(!p){this.key=f;var d=this.keySize=f.length;if(d!==4&&d!==6&&d!==8)throw new Error("Invalid aes key size="+d);var h=this.ksRows=(d+6+1)*4,n,t,e=this.keySchedule=new Uint32Array(h),i=this.invKeySchedule=new Uint32Array(h),r=this.sBox,o=this.rcon,s=this.invSubMix,a=s[0],u=s[1],_=s[2],g=s[3],m,y;for(n=0;n<h;n++){if(n<d){m=e[n]=f[n];continue}y=m,n%d===0?(y=y<<8|y>>>24,y=r[y>>>24]<<24|r[y>>>16&255]<<16|r[y>>>8&255]<<8|r[y&255],y^=o[n/d|0]<<24):d>6&&n%d===4&&(y=r[y>>>24]<<24|r[y>>>16&255]<<16|r[y>>>8&255]<<8|r[y&255]),e[n]=m=(e[n-d]^y)>>>0}for(t=0;t<h;t++)n=h-t,t&3?y=e[n]:y=e[n-4],t<4||n<=4?i[t]=y:i[t]=a[r[y>>>24]]^u[r[y>>>16&255]]^_[r[y>>>8&255]]^g[r[y&255]],i[t]=i[t]>>>0}},b.networkToHostOrderSwap=function(c){return c<<24|(c&65280)<<8|(c&16711680)>>8|c>>>24},b.decrypt=function(c,f,p){for(var l=this.keySize+6,d=this.invKeySchedule,h=this.invSBox,n=this.invSubMix,t=n[0],e=n[1],i=n[2],r=n[3],o=this.uint8ArrayToUint32Array_(p),s=o[0],a=o[1],u=o[2],_=o[3],g=new Int32Array(c),m=new Int32Array(g.length),y,v,E,x,L,O,C,F,M,B,k,w,U,N,K=this.networkToHostOrderSwap;f<g.length;){for(M=K(g[f]),B=K(g[f+1]),k=K(g[f+2]),w=K(g[f+3]),L=M^d[0],O=w^d[1],C=k^d[2],F=B^d[3],U=4,N=1;N<l;N++)y=t[L>>>24]^e[O>>16&255]^i[C>>8&255]^r[F&255]^d[U],v=t[O>>>24]^e[C>>16&255]^i[F>>8&255]^r[L&255]^d[U+1],E=t[C>>>24]^e[F>>16&255]^i[L>>8&255]^r[O&255]^d[U+2],x=t[F>>>24]^e[L>>16&255]^i[O>>8&255]^r[C&255]^d[U+3],L=y,O=v,C=E,F=x,U=U+4;y=h[L>>>24]<<24^h[O>>16&255]<<16^h[C>>8&255]<<8^h[F&255]^d[U],v=h[O>>>24]<<24^h[C>>16&255]<<16^h[F>>8&255]<<8^h[L&255]^d[U+1],E=h[C>>>24]<<24^h[F>>16&255]<<16^h[L>>8&255]<<8^h[O&255]^d[U+2],x=h[F>>>24]<<24^h[L>>16&255]<<16^h[O>>8&255]<<8^h[C&255]^d[U+3],m[f]=K(y^s),m[f+1]=K(x^a),m[f+2]=K(E^u),m[f+3]=K(v^_),s=M,a=B,u=k,_=w,f=f+4}return m.buffer},I}()},"./src/crypt/decrypter.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return f});var A=D("./src/crypt/aes-crypto.ts"),R=D("./src/crypt/fast-aes-key.ts"),S=D("./src/crypt/aes-decryptor.ts"),I=D("./src/utils/logger.ts"),b=D("./src/utils/mp4-tools.ts"),T=D("./src/utils/typed-array.ts"),c=16,f=function(){function p(d,h,n){var t=n===void 0?{}:n,e=t.removePKCS7Padding,i=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=d,this.config=h,this.removePKCS7Padding=i,i)try{var r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var l=p.prototype;return l.destroy=function(){this.observer=null},l.isSync=function(){return this.config.enableSoftwareAES},l.flush=function(){var h=this.currentResult;if(!h){this.reset();return}var n=new Uint8Array(h);return this.reset(),this.removePKCS7Padding?Object(S.removePadding)(n):n},l.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},l.decrypt=function(h,n,t,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(h),n,t);var i=this.flush();i&&e(i.buffer)}else this.webCryptoDecrypt(new Uint8Array(h),n,t).then(e)},l.softwareDecrypt=function(h,n,t){var e=this.currentIV,i=this.currentResult,r=this.remainderData;this.logOnce("JS AES decrypt"),r&&(h=Object(b.appendUint8Array)(r,h),this.remainderData=null);var o=this.getValidChunk(h);if(!o.length)return null;e&&(t=e);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new S.default),s.expandKey(n);var a=i;return this.currentResult=s.decrypt(o.buffer,0,t),this.currentIV=Object(T.sliceUint8)(o,-16).buffer,a||null},l.webCryptoDecrypt=function(h,n,t){var e=this,i=this.subtle;return(this.key!==n||!this.fastAesKey)&&(this.key=n,this.fastAesKey=new R.default(i,n)),this.fastAesKey.expandKey().then(function(r){if(!i)return Promise.reject(new Error("web crypto not initialized"));var o=new A.default(i,t);return o.decrypt(h.buffer,r)}).catch(function(r){return e.onWebCryptoError(r,h,n,t)})},l.onWebCryptoError=function(h,n,t,e){return I.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",h),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(n,t,e)},l.getValidChunk=function(h){var n=h,t=h.length-h.length%c;return t!==h.length&&(n=Object(T.sliceUint8)(h,0,t),this.remainderData=Object(T.sliceUint8)(h,t)),n},l.logOnce=function(h){!this.logEnabled||(I.logger.log("[decrypter.ts]: "+h),this.logEnabled=!1)},p}()},"./src/crypt/fast-aes-key.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return A});var A=function(){function R(I,b){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=b}var S=R.prototype;return S.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},R}()},"./src/demux/aacdemuxer.ts":function(j,P,D){D.r(P);var A=D("./src/demux/base-audio-demuxer.ts"),R=D("./src/demux/adts.ts"),S=D("./src/utils/logger.ts"),I=D("./src/demux/id3.ts");function b(f,p){f.prototype=Object.create(p.prototype),f.prototype.constructor=f,T(f,p)}function T(f,p){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,h){return d.__proto__=h,d},T(f,p)}var c=function(f){b(p,f);function p(d,h){var n;return n=f.call(this)||this,n.observer=void 0,n.config=void 0,n.observer=d,n.config=h,n}var l=p.prototype;return l.resetInitSegment=function(h,n,t,e){f.prototype.resetInitSegment.call(this,h,n,t,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:e,inputTimeScale:9e4,dropped:0}},p.probe=function(h){if(!h)return!1;for(var n=I.getID3Data(h,0)||[],t=n.length,e=h.length;t<e;t++)if(R.probe(h,t))return S.logger.log("ADTS sync word found !"),!0;return!1},l.canParse=function(h,n){return R.canParse(h,n)},l.appendFrame=function(h,n,t){R.initTrackConfig(h,this.observer,n,t,h.manifestCodec);var e=R.appendFrame(h,n,t,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},p}(A.default);c.minProbeByteLength=9,P.default=c},"./src/demux/adts.ts":function(j,P,D){D.r(P),D.d(P,"getAudioConfig",function(){return I}),D.d(P,"isHeaderPattern",function(){return b}),D.d(P,"getHeaderLength",function(){return T}),D.d(P,"getFullFrameLength",function(){return c}),D.d(P,"canGetFrameLength",function(){return f}),D.d(P,"isHeader",function(){return p}),D.d(P,"canParse",function(){return l}),D.d(P,"probe",function(){return d}),D.d(P,"initTrackConfig",function(){return h}),D.d(P,"getFrameDuration",function(){return n}),D.d(P,"parseFrameHeader",function(){return t}),D.d(P,"appendFrame",function(){return e});var A=D("./src/utils/logger.ts"),R=D("./src/errors.ts"),S=D("./src/events.ts");function I(i,r,o,s){var a,u,_,g,m=navigator.userAgent.toLowerCase(),y=s,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((r[o+2]&192)>>>6)+1;var E=(r[o+2]&60)>>>2;if(E>v.length-1){i.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+E});return}return _=(r[o+2]&1)<<2,_|=(r[o+3]&192)>>>6,A.logger.log("manifest codec:"+s+", ADTS type:"+a+", samplingIndex:"+E),/firefox/i.test(m)?E>=6?(a=5,g=new Array(4),u=E-3):(a=2,g=new Array(2),u=E):m.indexOf("android")!==-1?(a=2,g=new Array(2),u=E):(a=5,g=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&E>=6?u=E-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(E>=6&&_===1||/vivaldi/i.test(m))||!s&&_===1)&&(a=2,g=new Array(2)),u=E)),g[0]=a<<3,g[0]|=(E&14)>>1,g[1]|=(E&1)<<7,g[1]|=_<<3,a===5&&(g[1]|=(u&14)>>1,g[2]=(u&1)<<7,g[2]|=2<<2,g[3]=0),{config:g,samplerate:v[E],channelCount:_,codec:"mp4a.40."+a,manifestCodec:y}}function b(i,r){return i[r]===255&&(i[r+1]&246)===240}function T(i,r){return i[r+1]&1?7:9}function c(i,r){return(i[r+3]&3)<<11|i[r+4]<<3|(i[r+5]&224)>>>5}function f(i,r){return r+5<i.length}function p(i,r){return r+1<i.length&&b(i,r)}function l(i,r){return f(i,r)&&b(i,r)&&c(i,r)<=i.length-r}function d(i,r){if(p(i,r)){var o=T(i,r);if(r+o>=i.length)return!1;var s=c(i,r);if(s<=o)return!1;var a=r+s;return a===i.length||p(i,a)}return!1}function h(i,r,o,s,a){if(!i.samplerate){var u=I(r,o,s,a);if(!u)return;i.config=u.config,i.samplerate=u.samplerate,i.channelCount=u.channelCount,i.codec=u.codec,i.manifestCodec=u.manifestCodec,A.logger.log("parsed codec:"+i.codec+", rate:"+u.samplerate+", channels:"+u.channelCount)}}function n(i){return 1024*9e4/i}function t(i,r){var o=T(i,r);if(r+o<=i.length){var s=c(i,r)-o;if(s>0)return{headerLength:o,frameLength:s}}}function e(i,r,o,s,a){var u=n(i.samplerate),_=s+a*u,g=t(r,o),m;if(g){var y=g.frameLength,v=g.headerLength,E=v+y,x=Math.max(0,o+E-r.length);x?(m=new Uint8Array(E-v),m.set(r.subarray(o+v,r.length),0)):m=r.subarray(o+v,o+E);var L={unit:m,pts:_};return x||i.samples.push(L),{sample:L,length:E,missing:x}}var O=r.length-o;m=new Uint8Array(O),m.set(r.subarray(o,r.length),0);var C={unit:m,pts:_};return{sample:C,length:O,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(j,P,D){D.r(P),D.d(P,"initPTSFn",function(){return f});var A=D("./src/polyfills/number.ts"),R=D("./src/demux/id3.ts"),S=D("./src/types/demuxer.ts"),I=D("./src/demux/dummy-demuxed-track.ts"),b=D("./src/utils/mp4-tools.ts"),T=D("./src/utils/typed-array.ts"),c=function(){function p(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var l=p.prototype;return l.resetInitSegment=function(h,n,t,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},l.resetTimeStamp=function(h){this.initPTS=h,this.resetContiguity()},l.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},l.canParse=function(h,n){return!1},l.appendFrame=function(h,n,t){},l.demux=function(h,n){this.cachedData&&(h=Object(b.appendUint8Array)(this.cachedData,h),this.cachedData=null);var t=R.getID3Data(h,0),e=t?t.length:0,i,r,o=this._audioTrack,s=this._id3Track,a=t?R.getTimeStamp(t):void 0,u=h.length;for((this.basePTS===null||this.frameIndex===0&&Object(A.isFiniteNumber)(a))&&(this.basePTS=f(a,n,this.initPTS)),t&&t.length>0&&s.samples.push({pts:this.basePTS,dts:this.basePTS,data:t,type:S.MetadataSchema.audioId3}),r=this.basePTS;e<u;){if(this.canParse(h,e)){var _=this.appendFrame(o,h,e);_?(this.frameIndex++,r=_.sample.pts,e+=_.length,i=e):e=u}else R.canParse(h,e)?(t=R.getID3Data(h,e),s.samples.push({pts:r,dts:r,data:t,type:S.MetadataSchema.audioId3}),e+=t.length,i=e):e++;if(e===u&&i!==u){var g=Object(T.sliceUint8)(h,i);this.cachedData?this.cachedData=Object(b.appendUint8Array)(this.cachedData,g):this.cachedData=g}}return{audioTrack:o,videoTrack:Object(I.dummyTrack)(),id3Track:s,textTrack:Object(I.dummyTrack)()}},l.demuxSampleAes=function(h,n,t){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},l.flush=function(h){var n=this.cachedData;return n&&(this.cachedData=null,this.demux(n,0)),{audioTrack:this._audioTrack,videoTrack:Object(I.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(I.dummyTrack)()}},l.destroy=function(){},p}(),f=function(l,d,h){return Object(A.isFiniteNumber)(l)?l*90:d*9e4+(h||0)};P.default=c},"./src/demux/chunk-cache.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return A});var A=function(){function S(){this.chunks=[],this.dataLength=0}var I=S.prototype;return I.push=function(T){this.chunks.push(T),this.dataLength+=T.length},I.flush=function(){var T=this.chunks,c=this.dataLength,f;if(T.length)T.length===1?f=T[0]:f=R(T,c);else return new Uint8Array(0);return this.reset(),f},I.reset=function(){this.chunks.length=0,this.dataLength=0},S}();function R(S,I){for(var b=new Uint8Array(I),T=0,c=0;c<S.length;c++){var f=S[c];b.set(f,T),T+=f.length}return b}},"./src/demux/dummy-demuxed-track.ts":function(j,P,D){D.r(P),D.d(P,"dummyTrack",function(){return A});function A(R,S){return R===void 0&&(R=""),S===void 0&&(S=9e4),{type:R,id:-1,pid:-1,inputTimeScale:S,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(j,P,D){D.r(P);var A=D("./src/utils/logger.ts"),R=function(){function S(b){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}var I=S.prototype;return I.loadWord=function(){var T=this.data,c=this.bytesAvailable,f=T.byteLength-c,p=new Uint8Array(4),l=Math.min(4,c);if(l===0)throw new Error("no bytes available");p.set(T.subarray(f,f+l)),this.word=new DataView(p.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l},I.skipBits=function(T){var c;this.bitsAvailable>T?(this.word<<=T,this.bitsAvailable-=T):(T-=this.bitsAvailable,c=T>>3,T-=c>>3,this.bytesAvailable-=c,this.loadWord(),this.word<<=T,this.bitsAvailable-=T)},I.readBits=function(T){var c=Math.min(this.bitsAvailable,T),f=this.word>>>32-c;return T>32&&A.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=c,this.bitsAvailable>0?this.word<<=c:this.bytesAvailable>0&&this.loadWord(),c=T-c,c>0&&this.bitsAvailable?f<<c|this.readBits(c):f},I.skipLZ=function(){var T;for(T=0;T<this.bitsAvailable;++T)if((this.word&2147483648>>>T)!==0)return this.word<<=T,this.bitsAvailable-=T,T;return this.loadWord(),T+this.skipLZ()},I.skipUEG=function(){this.skipBits(1+this.skipLZ())},I.skipEG=function(){this.skipBits(1+this.skipLZ())},I.readUEG=function(){var T=this.skipLZ();return this.readBits(T+1)-1},I.readEG=function(){var T=this.readUEG();return 1&T?1+T>>>1:-1*(T>>>1)},I.readBoolean=function(){return this.readBits(1)===1},I.readUByte=function(){return this.readBits(8)},I.readUShort=function(){return this.readBits(16)},I.readUInt=function(){return this.readBits(32)},I.skipScalingList=function(T){for(var c=8,f=8,p,l=0;l<T;l++)f!==0&&(p=this.readEG(),f=(c+p+256)%256),c=f===0?c:f},I.readSPS=function(){var T=0,c=0,f=0,p=0,l,d,h,n=this.readUByte.bind(this),t=this.readBits.bind(this),e=this.readUEG.bind(this),i=this.readBoolean.bind(this),r=this.skipBits.bind(this),o=this.skipEG.bind(this),s=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);n();var u=n();if(t(5),r(3),n(),s(),u===100||u===110||u===122||u===244||u===44||u===83||u===86||u===118||u===128){var _=e();if(_===3&&r(1),s(),s(),r(1),i())for(d=_!==3?8:12,h=0;h<d;h++)i()&&(h<6?a(16):a(64))}s();var g=e();if(g===0)e();else if(g===1)for(r(1),o(),o(),l=e(),h=0;h<l;h++)o();s(),r(1);var m=e(),y=e(),v=t(1);v===0&&r(1),r(1),i()&&(T=e(),c=e(),f=e(),p=e());var E=[1,1];if(i()&&i()){var x=n();switch(x){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:{E=[n()<<8|n(),n()<<8|n()];break}}}return{width:Math.ceil((m+1)*16-T*2-c*2),height:(2-v)*(y+1)*16-(v?2:4)*(f+p),pixelRatio:E}},I.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},S}();P.default=R},"./src/demux/id3.ts":function(j,P,D){D.r(P),D.d(P,"isHeader",function(){return A}),D.d(P,"isFooter",function(){return R}),D.d(P,"getID3Data",function(){return S}),D.d(P,"canParse",function(){return b}),D.d(P,"getTimeStamp",function(){return T}),D.d(P,"isTimeStampFrame",function(){return c}),D.d(P,"getID3Frames",function(){return p}),D.d(P,"decodeFrame",function(){return l}),D.d(P,"utf8ArrayToStr",function(){return e}),D.d(P,"testables",function(){return i});var A=function(a,u){return u+10<=a.length&&a[u]===73&&a[u+1]===68&&a[u+2]===51&&a[u+3]<255&&a[u+4]<255&&a[u+6]<128&&a[u+7]<128&&a[u+8]<128&&a[u+9]<128},R=function(a,u){return u+10<=a.length&&a[u]===51&&a[u+1]===68&&a[u+2]===73&&a[u+3]<255&&a[u+4]<255&&a[u+6]<128&&a[u+7]<128&&a[u+8]<128&&a[u+9]<128},S=function(a,u){for(var _=u,g=0;A(a,u);){g+=10;var m=I(a,u+6);g+=m,R(a,u+10)&&(g+=10),u+=g}if(g>0)return a.subarray(_,_+g)},I=function(a,u){var _=0;return _=(a[u]&127)<<21,_|=(a[u+1]&127)<<14,_|=(a[u+2]&127)<<7,_|=a[u+3]&127,_},b=function(a,u){return A(a,u)&&I(a,u+6)+10<=a.length-u},T=function(a){for(var u=p(a),_=0;_<u.length;_++){var g=u[_];if(c(g))return t(g)}},c=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},f=function(a){var u=String.fromCharCode(a[0],a[1],a[2],a[3]),_=I(a,4),g=10;return{type:u,size:_,data:a.subarray(g,g+_)}},p=function(a){for(var u=0,_=[];A(a,u);){var g=I(a,u+6);u+=10;for(var m=u+g;u+8<m;){var y=f(a.subarray(u)),v=l(y);v&&_.push(v),u+=y.size+10}R(a,u)&&(u+=10)}return _},l=function(a){return a.type==="PRIV"?d(a):a.type[0]==="W"?n(a):h(a)},d=function(a){if(!(a.size<2)){var u=e(a.data,!0),_=new Uint8Array(a.data.subarray(u.length+1));return{key:a.type,info:u,data:_.buffer}}},h=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var u=1,_=e(a.data.subarray(u),!0);u+=_.length+1;var g=e(a.data.subarray(u));return{key:a.type,info:_,data:g}}var m=e(a.data.subarray(1));return{key:a.type,data:m}}},n=function(a){if(a.type==="WXXX"){if(a.size<2)return;var u=1,_=e(a.data.subarray(u),!0);u+=_.length+1;var g=e(a.data.subarray(u));return{key:a.type,info:_,data:g}}var m=e(a.data);return{key:a.type,data:m}},t=function(a){if(a.data.byteLength===8){var u=new Uint8Array(a.data),_=u[3]&1,g=(u[4]<<23)+(u[5]<<15)+(u[6]<<7)+u[7];return g/=45,_&&(g+=4772185884e-2),Math.round(g)}},e=function(a,u){u===void 0&&(u=!1);var _=o();if(_){var g=_.decode(a);if(u){var m=g.indexOf("\0");return m!==-1?g.substring(0,m):g}return g.replace(/\0/g,"")}for(var y=a.length,v,E,x,L="",O=0;O<y;){if(v=a[O++],v===0&&u)return L;if(v===0||v===3)continue;switch(v>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:L+=String.fromCharCode(v);break;case 12:case 13:E=a[O++],L+=String.fromCharCode((v&31)<<6|E&63);break;case 14:E=a[O++],x=a[O++],L+=String.fromCharCode((v&15)<<12|(E&63)<<6|(x&63)<<0);break}}return L},i={decodeTextFrame:h},r;function o(){return!r&&typeof self.TextDecoder<"u"&&(r=new self.TextDecoder("utf-8")),r}},"./src/demux/mp3demuxer.ts":function(j,P,D){D.r(P);var A=D("./src/demux/base-audio-demuxer.ts"),R=D("./src/demux/id3.ts"),S=D("./src/utils/logger.ts"),I=D("./src/demux/mpegaudio.ts");function b(f,p){f.prototype=Object.create(p.prototype),f.prototype.constructor=f,T(f,p)}function T(f,p){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,h){return d.__proto__=h,d},T(f,p)}var c=function(f){b(p,f);function p(){return f.apply(this,arguments)||this}var l=p.prototype;return l.resetInitSegment=function(h,n,t,e){f.prototype.resetInitSegment.call(this,h,n,t,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:e,inputTimeScale:9e4,dropped:0}},p.probe=function(h){if(!h)return!1;for(var n=R.getID3Data(h,0)||[],t=n.length,e=h.length;t<e;t++)if(I.probe(h,t))return S.logger.log("MPEG Audio sync word found !"),!0;return!1},l.canParse=function(h,n){return I.canParse(h,n)},l.appendFrame=function(h,n,t){if(this.basePTS!==null)return I.appendFrame(h,n,t,this.basePTS,this.frameIndex)},p}(A.default);c.minProbeByteLength=4,P.default=c},"./src/demux/mp4demuxer.ts":function(j,P,D){D.r(P);var A=D("./src/polyfills/number.ts"),R=D("./src/types/demuxer.ts"),S=D("./src/utils/mp4-tools.ts"),I=D("./src/demux/dummy-demuxed-track.ts"),b=/\/emsg[-/]ID3/i,T=function(){function c(p,l){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=l}var f=c.prototype;return f.resetTimeStamp=function(){},f.resetInitSegment=function(l,d,h,n){var t=Object(S.parseInitSegment)(l),e=this.videoTrack=Object(I.dummyTrack)("video",1),i=this.audioTrack=Object(I.dummyTrack)("audio",1),r=this.txtTrack=Object(I.dummyTrack)("text",1);if(this.id3Track=Object(I.dummyTrack)("id3",1),this.timeOffset=0,t.video){var o=t.video,s=o.id,a=o.timescale,u=o.codec;e.id=s,e.timescale=r.timescale=a,e.codec=u}if(t.audio){var _=t.audio,g=_.id,m=_.timescale,y=_.codec;i.id=g,i.timescale=m,i.codec=y}r.id=S.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=i.duration=n},f.resetContiguity=function(){},c.probe=function(l){return l=l.length>16384?l.subarray(0,16384):l,Object(S.findBox)(l,["moof"]).length>0},f.demux=function(l,d){this.timeOffset=d;var h=l,n=this.videoTrack,t=this.txtTrack;if(this.config.progressive){this.remainderData&&(h=Object(S.appendUint8Array)(this.remainderData,l));var e=Object(S.segmentValidRange)(h);this.remainderData=e.remainder,n.samples=e.valid||new Uint8Array}else n.samples=h;var i=this.extractID3Track(n,d);return t.samples=Object(S.parseSamples)(d,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:i,textTrack:this.txtTrack}},f.flush=function(){var l=this.timeOffset,d=this.videoTrack,h=this.txtTrack;d.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(d,this.timeOffset);return h.samples=Object(S.parseSamples)(l,d),{videoTrack:d,audioTrack:Object(I.dummyTrack)(),id3Track:n,textTrack:Object(I.dummyTrack)()}},f.extractID3Track=function(l,d){var h=this.id3Track;if(l.samples.length){var n=Object(S.findBox)(l.samples,["emsg"]);n&&n.forEach(function(t){var e=Object(S.parseEmsg)(t);if(b.test(e.schemeIdUri)){var i=Object(A.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:d+e.presentationTimeDelta/e.timeScale,r=e.payload;h.samples.push({data:r,len:r.byteLength,dts:i,pts:i,type:R.MetadataSchema.emsg})}})}return h},f.demuxSampleAes=function(l,d,h){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},f.destroy=function(){},c}();T.minProbeByteLength=1024,P.default=T},"./src/demux/mpegaudio.ts":function(j,P,D){D.r(P),D.d(P,"appendFrame",function(){return T}),D.d(P,"parseHeader",function(){return c}),D.d(P,"isHeaderPattern",function(){return f}),D.d(P,"isHeader",function(){return p}),D.d(P,"canParse",function(){return l}),D.d(P,"probe",function(){return d});var A=null,R=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],S=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],b=[0,1,1,4];function T(h,n,t,e,i){if(!(t+24>n.length)){var r=c(n,t);if(r&&t+r.frameLength<=n.length){var o=r.samplesPerFrame*9e4/r.sampleRate,s=e+i*o,a={unit:n.subarray(t,t+r.frameLength),pts:s,dts:s};return h.config=[],h.channelCount=r.channelCount,h.samplerate=r.sampleRate,h.samples.push(a),{sample:a,length:r.frameLength,missing:0}}}}function c(h,n){var t=h[n+1]>>3&3,e=h[n+1]>>1&3,i=h[n+2]>>4&15,r=h[n+2]>>2&3;if(t!==1&&i!==0&&i!==15&&r!==3){var o=h[n+2]>>1&1,s=h[n+3]>>6,a=t===3?3-e:e===3?3:4,u=R[a*14+i-1]*1e3,_=t===3?0:t===2?1:2,g=S[_*3+r],m=s===3?1:2,y=I[t][e],v=b[e],E=y*8*v,x=Math.floor(y*u/g+o)*v;if(A===null){var L=navigator.userAgent||"",O=L.match(/Chrome\/(\d+)/i);A=O?parseInt(O[1]):0}var C=!!A&&A<=87;return C&&e===2&&u>=224e3&&s===0&&(h[n+3]=h[n+3]|128),{sampleRate:g,channelCount:m,frameLength:x,samplesPerFrame:E}}}function f(h,n){return h[n]===255&&(h[n+1]&224)===224&&(h[n+1]&6)!==0}function p(h,n){return n+1<h.length&&f(h,n)}function l(h,n){var t=4;return f(h,n)&&t<=h.length-n}function d(h,n){if(n+1<h.length&&f(h,n)){var t=4,e=c(h,n),i=t;e!=null&&e.frameLength&&(i=e.frameLength);var r=n+i;return r===h.length||p(h,r)}return!1}},"./src/demux/sample-aes.ts":function(j,P,D){D.r(P);var A=D("./src/crypt/decrypter.ts"),R=D("./src/demux/tsdemuxer.ts"),S=function(){function I(T,c,f){this.keyData=void 0,this.decrypter=void 0,this.keyData=f,this.decrypter=new A.default(T,c,{removePKCS7Padding:!1})}var b=I.prototype;return b.decryptBuffer=function(c,f){this.decrypter.decrypt(c,this.keyData.key.buffer,this.keyData.iv.buffer,f)},b.decryptAacSample=function(c,f,p,l){var d=c[f].unit;if(!(d.length<=16)){var h=d.subarray(16,d.length-d.length%16),n=h.buffer.slice(h.byteOffset,h.byteOffset+h.length),t=this;this.decryptBuffer(n,function(e){var i=new Uint8Array(e);d.set(i,16),l||t.decryptAacSamples(c,f+1,p)})}},b.decryptAacSamples=function(c,f,p){for(;;f++){if(f>=c.length){p();return}if(!(c[f].unit.length<32)){var l=this.decrypter.isSync();if(this.decryptAacSample(c,f,p,l),!l)return}}},b.getAvcEncryptedData=function(c){for(var f=Math.floor((c.length-48)/160)*16+16,p=new Int8Array(f),l=0,d=32;d<c.length-16;d+=160,l+=16)p.set(c.subarray(d,d+16),l);return p},b.getAvcDecryptedUnit=function(c,f){for(var p=new Uint8Array(f),l=0,d=32;d<c.length-16;d+=160,l+=16)c.set(p.subarray(l,l+16),d);return c},b.decryptAvcSample=function(c,f,p,l,d,h){var n=Object(R.discardEPB)(d.data),t=this.getAvcEncryptedData(n),e=this;this.decryptBuffer(t.buffer,function(i){d.data=e.getAvcDecryptedUnit(n,i),h||e.decryptAvcSamples(c,f,p+1,l)})},b.decryptAvcSamples=function(c,f,p,l){if(c instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;f++,p=0){if(f>=c.length){l();return}for(var d=c[f].units;!(p>=d.length);p++){var h=d[p];if(!(h.data.length<=48||h.type!==1&&h.type!==5)){var n=this.decrypter.isSync();if(this.decryptAvcSample(c,f,p,l,h,n),!n)return}}}},I}();P.default=S},"./src/demux/transmuxer-interface.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return p});var A=D("./node_modules/webworkify-webpack/index.js"),R=D("./src/events.ts"),S=D("./src/demux/transmuxer.ts"),I=D("./src/utils/logger.ts"),b=D("./src/errors.ts"),T=D("./src/utils/mediasource-helper.ts"),c=D("./node_modules/eventemitter3/index.js"),f=Object(T.getMediaSource)()||{isTypeSupported:function(){return!1}},p=function(){function l(h,n,t,e){var i=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=h,this.id=n,this.onTransmuxComplete=t,this.onFlush=e;var r=h.config,o=function(g,m){m=m||{},m.frag=i.frag,m.id=i.id,h.trigger(g,m)};this.observer=new c.EventEmitter,this.observer.on(R.Events.FRAG_DECRYPTED,o),this.observer.on(R.Events.ERROR,o);var s={mp4:f.isTypeSupported("video/mp4"),mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(r.enableWorker&&typeof Worker<"u"){I.logger.log("demuxing in webworker");var u;try{u=this.worker=A("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),u.addEventListener("message",this.onwmsg),u.onerror=function(_){h.trigger(R.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(_.message+"  ("+_.filename+":"+_.lineno+")")})},u.postMessage({cmd:"init",typeSupported:s,vendor:a,id:n,config:JSON.stringify(r)})}catch(_){I.logger.warn("Error in worker:",_),I.logger.error("Error while initializing DemuxerWorker, fallback to inline"),u&&self.URL.revokeObjectURL(u.objectURL),this.transmuxer=new S.default(this.observer,s,r,a,n),this.worker=null}}else this.transmuxer=new S.default(this.observer,s,r,a,n)}var d=l.prototype;return d.destroy=function(){var n=this.worker;if(n)n.removeEventListener("message",this.onwmsg),n.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},d.push=function(n,t,e,i,r,o,s,a,u,_){var g,m,y=this;u.transmuxing.start=self.performance.now();var v=this.transmuxer,E=this.worker,x=o?o.start:r.start,L=r.decryptdata,O=this.frag,C=!(O&&r.cc===O.cc),F=!(O&&u.level===O.level),M=O?u.sn-O.sn:-1,B=this.part?u.part-this.part.index:-1,k=M===0&&u.id>1&&u.id===(O==null?void 0:O.stats.chunkCount),w=!F&&(M===1||M===0&&(B===1||k&&B<=0)),U=self.performance.now();(F||M||r.stats.parsing.start===0)&&(r.stats.parsing.start=U),o&&(B||!w)&&(o.stats.parsing.start=U);var N=!(O&&((g=r.initSegment)===null||g===void 0?void 0:g.url)===((m=O.initSegment)===null||m===void 0?void 0:m.url)),K=new S.TransmuxState(C,w,a,F,x,N);if(!w||C||N){I.logger.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+C+`
        trackSwitch: `+F+`
        contiguous: `+w+`
        accurateTimeOffset: `+a+`
        timeOffset: `+x+`
        initSegmentChange: `+N);var H=new S.TransmuxConfig(e,i,t,s,_);this.configureTransmuxer(H)}if(this.frag=r,this.part=o,E)E.postMessage({cmd:"demux",data:n,decryptdata:L,chunkMeta:u,state:K},n instanceof ArrayBuffer?[n]:[]);else if(v){var z=v.push(n,L,u,K);Object(S.isPromise)(z)?z.then(function(G){y.handleTransmuxComplete(G)}):this.handleTransmuxComplete(z)}},d.flush=function(n){var t=this;n.transmuxing.start=self.performance.now();var e=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:n});else if(e){var r=e.flush(n);Object(S.isPromise)(r)?r.then(function(o){t.handleFlushResult(o,n)}):this.handleFlushResult(r,n)}},d.handleFlushResult=function(n,t){var e=this;n.forEach(function(i){e.handleTransmuxComplete(i)}),this.onFlush(t)},d.onWorkerMessage=function(n){var t=n.data,e=this.hls;switch(t.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":I.logger[t.data.logType]&&I.logger[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,e.trigger(t.event,t.data);break}}},d.configureTransmuxer=function(n){var t=this.worker,e=this.transmuxer;t?t.postMessage({cmd:"configure",config:n}):e&&e.configure(n)},d.handleTransmuxComplete=function(n){n.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(n)},l}()},"./src/demux/transmuxer-worker.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return b});var A=D("./src/demux/transmuxer.ts"),R=D("./src/events.ts"),S=D("./src/utils/logger.ts"),I=D("./node_modules/eventemitter3/index.js");function b(l){var d=new I.EventEmitter,h=function(e,i){l.postMessage({event:e,data:i})};d.on(R.Events.FRAG_DECRYPTED,h),d.on(R.Events.ERROR,h);var n=function(){var e=function(o){var s=function(u){h("workerLog",{logType:o,message:u})};S.logger[o]=s};for(var i in S.logger)e(i)};l.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":{var i=JSON.parse(e.config);l.transmuxer=new A.default(d,e.typeSupported,i,e.vendor,e.id),Object(S.enableLogs)(i.debug),n(),h("init",null);break}case"configure":{l.transmuxer.configure(e.config);break}case"demux":{var r=l.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(A.isPromise)(r)?r.then(function(a){T(l,a)}):T(l,r);break}case"flush":{var o=e.chunkMeta,s=l.transmuxer.flush(o);Object(A.isPromise)(s)?s.then(function(a){f(l,a,o)}):f(l,s,o);break}}})}function T(l,d){if(p(d.remuxResult))return!1;var h=[],n=d.remuxResult,t=n.audio,e=n.video;return t&&c(h,t),e&&c(h,e),l.postMessage({event:"transmuxComplete",data:d},h),!0}function c(l,d){d.data1&&l.push(d.data1.buffer),d.data2&&l.push(d.data2.buffer)}function f(l,d,h){var n=d.reduce(function(t,e){return T(l,e)||t},!1);n||l.postMessage({event:"transmuxComplete",data:d[0]}),l.postMessage({event:"flush",data:h})}function p(l){return!l.audio&&!l.video&&!l.text&&!l.id3&&!l.initSegment}},"./src/demux/transmuxer.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return i}),D.d(P,"isPromise",function(){return s}),D.d(P,"TransmuxConfig",function(){return a}),D.d(P,"TransmuxState",function(){return u});var A=D("./src/events.ts"),R=D("./src/errors.ts"),S=D("./src/crypt/decrypter.ts"),I=D("./src/demux/aacdemuxer.ts"),b=D("./src/demux/mp4demuxer.ts"),T=D("./src/demux/tsdemuxer.ts"),c=D("./src/demux/mp3demuxer.ts"),f=D("./src/remux/mp4-remuxer.ts"),p=D("./src/remux/passthrough-remuxer.ts"),l=D("./src/demux/chunk-cache.ts"),d=D("./src/utils/mp4-tools.ts"),h=D("./src/utils/logger.ts"),n;try{n=self.performance.now.bind(self.performance)}catch{h.logger.debug("Unable to use Performance API on this environment"),n=self.Date.now}var t=[{demux:T.default,remux:f.default},{demux:b.default,remux:p.default},{demux:I.default,remux:f.default},{demux:c.default,remux:f.default}],e=1024;t.forEach(function(_){var g=_.demux;e=Math.max(e,g.minProbeByteLength)});var i=function(){function _(m,y,v,E,x){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new l.default,this.observer=m,this.typeSupported=y,this.config=v,this.vendor=E,this.id=x}var g=_.prototype;return g.configure=function(y){this.transmuxConfig=y,this.decrypter&&this.decrypter.reset()},g.push=function(y,v,E,x){var L=this,O=E.transmuxing;O.executeStart=n();var C=new Uint8Array(y),F=this.cache,M=this.config,B=this.currentTransmuxState,k=this.transmuxConfig;x&&(this.currentTransmuxState=x);var w=r(C,v);if(w&&w.method==="AES-128"){var U=this.getDecrypter();if(M.enableSoftwareAES){var N=U.softwareDecrypt(C,w.key.buffer,w.iv.buffer);if(!N)return O.executeEnd=n(),o(E);C=new Uint8Array(N)}else return this.decryptionPromise=U.webCryptoDecrypt(C,w.key.buffer,w.iv.buffer).then(function(se){var de=L.push(se,null,E);return L.decryptionPromise=null,de}),this.decryptionPromise}var K=x||B,H=K.contiguous,z=K.discontinuity,G=K.trackSwitch,q=K.accurateTimeOffset,Z=K.timeOffset,V=K.initSegmentChange,X=k.audioCodec,J=k.videoCodec,re=k.defaultInitPts,ie=k.duration,ne=k.initSegmentData;if((z||G||V)&&this.resetInitSegment(ne,X,J,ie),(z||V)&&this.resetInitialTimestamp(re),H||this.resetContiguity(),this.needsProbing(C,z,G)){if(F.dataLength){var ae=F.flush();C=Object(d.appendUint8Array)(ae,C)}this.configureTransmuxer(C,k)}var ue=this.transmux(C,w,Z,q,E),oe=this.currentTransmuxState;return oe.contiguous=!0,oe.discontinuity=!1,oe.trackSwitch=!1,O.executeEnd=n(),ue},g.flush=function(y){var v=this,E=y.transmuxing;E.executeStart=n();var x=this.decrypter,L=this.cache,O=this.currentTransmuxState,C=this.decryptionPromise;if(C)return C.then(function(){return v.flush(y)});var F=[],M=O.timeOffset;if(x){var B=x.flush();B&&F.push(this.push(B,null,y))}var k=L.dataLength;L.reset();var w=this.demuxer,U=this.remuxer;if(!w||!U)return k>=e&&this.observer.emit(A.Events.ERROR,A.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),E.executeEnd=n(),[o(y)];var N=w.flush(M);return s(N)?N.then(function(K){return v.flushRemux(F,K,y),F}):(this.flushRemux(F,N,y),F)},g.flushRemux=function(y,v,E){var x=v.audioTrack,L=v.videoTrack,O=v.id3Track,C=v.textTrack,F=this.currentTransmuxState,M=F.accurateTimeOffset,B=F.timeOffset;h.logger.log("[transmuxer.ts]: Flushed fragment "+E.sn+(E.part>-1?" p: "+E.part:"")+" of level "+E.level);var k=this.remuxer.remux(x,L,O,C,B,M,!0,this.id);y.push({remuxResult:k,chunkMeta:E}),E.transmuxing.executeEnd=n()},g.resetInitialTimestamp=function(y){var v=this.demuxer,E=this.remuxer;!v||!E||(v.resetTimeStamp(y),E.resetTimeStamp(y))},g.resetContiguity=function(){var y=this.demuxer,v=this.remuxer;!y||!v||(y.resetContiguity(),v.resetNextTimestamp())},g.resetInitSegment=function(y,v,E,x){var L=this.demuxer,O=this.remuxer;!L||!O||(L.resetInitSegment(y,v,E,x),O.resetInitSegment(y,v,E))},g.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},g.transmux=function(y,v,E,x,L){var O;return v&&v.method==="SAMPLE-AES"?O=this.transmuxSampleAes(y,v,E,x,L):O=this.transmuxUnencrypted(y,E,x,L),O},g.transmuxUnencrypted=function(y,v,E,x){var L=this.demuxer.demux(y,v,!1,!this.config.progressive),O=L.audioTrack,C=L.videoTrack,F=L.id3Track,M=L.textTrack,B=this.remuxer.remux(O,C,F,M,v,E,!1,this.id);return{remuxResult:B,chunkMeta:x}},g.transmuxSampleAes=function(y,v,E,x,L){var O=this;return this.demuxer.demuxSampleAes(y,v,E).then(function(C){var F=O.remuxer.remux(C.audioTrack,C.videoTrack,C.id3Track,C.textTrack,E,x,!1,O.id);return{remuxResult:F,chunkMeta:L}})},g.configureTransmuxer=function(y,v){for(var E=this.config,x=this.observer,L=this.typeSupported,O=this.vendor,C=v.audioCodec,F=v.defaultInitPts,M=v.duration,B=v.initSegmentData,k=v.videoCodec,w,U=0,N=t.length;U<N;U++)if(t[U].demux.probe(y)){w=t[U];break}w||(h.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),w={demux:b.default,remux:p.default});var K=this.demuxer,H=this.remuxer,z=w.remux,G=w.demux;(!H||!(H instanceof z))&&(this.remuxer=new z(x,E,L,O)),(!K||!(K instanceof G))&&(this.demuxer=new G(x,E,L),this.probe=G.probe),this.resetInitSegment(B,C,k,M),this.resetInitialTimestamp(F)},g.needsProbing=function(y,v,E){return!this.demuxer||!this.remuxer||v||E},g.getDecrypter=function(){var y=this.decrypter;return y||(y=this.decrypter=new S.default(this.observer,this.config)),y},_}();function r(_,g){var m=null;return _.byteLength>0&&g!=null&&g.key!=null&&g.iv!==null&&g.method!=null&&(m=g),m}var o=function(g){return{remuxResult:{},chunkMeta:g}};function s(_){return"then"in _&&_.then instanceof Function}var a=function(g,m,y,v,E){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=g,this.videoCodec=m,this.initSegmentData=y,this.duration=v,this.defaultInitPts=E},u=function(g,m,y,v,E,x){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=g,this.contiguous=m,this.accurateTimeOffset=y,this.trackSwitch=v,this.timeOffset=E,this.initSegmentChange=x}},"./src/demux/tsdemuxer.ts":function(j,P,D){D.r(P),D.d(P,"discardEPB",function(){return r});var A=D("./src/demux/adts.ts"),R=D("./src/demux/mpegaudio.ts"),S=D("./src/demux/exp-golomb.ts"),I=D("./src/demux/sample-aes.ts"),b=D("./src/events.ts"),T=D("./src/utils/mp4-tools.ts"),c=D("./src/utils/logger.ts"),f=D("./src/errors.ts"),p=D("./src/types/demuxer.ts");function l(){return l=Object.assign?Object.assign.bind():function(o){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(o[u]=a[u])}return o},l.apply(this,arguments)}var d=function(){function o(a,u,_){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=u,this.typeSupported=_}o.probe=function(u){var _=o.syncOffset(u);return _<0?!1:(_&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+_+", junk ahead ?"),!0)},o.syncOffset=function(u){for(var _=Math.min(1e3,u.length-564),g=0;g<_;){if(u[g]===71&&u[g+188]===71&&u[g+2*188]===71)return g;g++}return-1},o.createTrack=function(u,_){return{container:u==="video"||u==="audio"?"video/mp2t":void 0,type:u,id:T.RemuxerTrackIdConfig[u],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:u==="audio"?_:void 0}};var s=o.prototype;return s.resetInitSegment=function(u,_,g,m){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=o.createTrack("video"),this._audioTrack=o.createTrack("audio",m),this._id3Track=o.createTrack("id3"),this._txtTrack=o.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=_,this.videoCodec=g,this._duration=m},s.resetTimeStamp=function(){},s.resetContiguity=function(){var u=this._audioTrack,_=this._avcTrack,g=this._id3Track;u&&(u.pesData=null),_&&(_.pesData=null),g&&(g.pesData=null),this.aacOverFlow=null},s.demux=function(u,_,g,m){g===void 0&&(g=!1),m===void 0&&(m=!1),g||(this.sampleAes=null);var y,v=this._avcTrack,E=this._audioTrack,x=this._id3Track,L=this._txtTrack,O=v.pid,C=v.pesData,F=E.pid,M=x.pid,B=E.pesData,k=x.pesData,w=!1,U=this.pmtParsed,N=this._pmtId,K=u.length;if(this.remainderData&&(u=Object(T.appendUint8Array)(this.remainderData,u),K=u.length,this.remainderData=null),K<188&&!m)return this.remainderData=u,{audioTrack:E,videoTrack:v,id3Track:x,textTrack:L};var H=Math.max(0,o.syncOffset(u));K-=(K+H)%188,K<u.byteLength&&!m&&(this.remainderData=new Uint8Array(u.buffer,K,u.buffer.byteLength-K));for(var z=0,G=H;G<K;G+=188)if(u[G]===71){var q=!!(u[G+1]&64),Z=((u[G+1]&31)<<8)+u[G+2],V=(u[G+3]&48)>>4,X=void 0;if(V>1){if(X=G+5+u[G+4],X===G+188)continue}else X=G+4;switch(Z){case O:q&&(C&&(y=e(C))&&this.parseAVCPES(v,L,y,!1),C={data:[],size:0}),C&&(C.data.push(u.subarray(X,G+188)),C.size+=G+188-X);break;case F:if(q){if(B&&(y=e(B)))switch(E.segmentCodec){case"aac":this.parseAACPES(E,y);break;case"mp3":this.parseMPEGPES(E,y);break}B={data:[],size:0}}B&&(B.data.push(u.subarray(X,G+188)),B.size+=G+188-X);break;case M:q&&(k&&(y=e(k))&&this.parseID3PES(x,y),k={data:[],size:0}),k&&(k.data.push(u.subarray(X,G+188)),k.size+=G+188-X);break;case 0:q&&(X+=u[X]+1),N=this._pmtId=n(u,X);break;case N:{q&&(X+=u[X]+1);var J=t(u,X,this.typeSupported,g);O=J.avc,O>0&&(v.pid=O),F=J.audio,F>0&&(E.pid=F,E.segmentCodec=J.segmentCodec),M=J.id3,M>0&&(x.pid=M),w&&!U&&(c.logger.log("reparse from beginning"),w=!1,G=H-188),U=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=!0;break}}else z++;z>0&&this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+z+" TS packet/s that do not start with 0x47"}),v.pesData=C,E.pesData=B,x.pesData=k;var re={audioTrack:E,videoTrack:v,id3Track:x,textTrack:L};return m&&this.extractRemainingSamples(re),re},s.flush=function(){var u=this.remainderData;this.remainderData=null;var _;return u?_=this.demux(u,-1,!1,!0):_={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(_),this.sampleAes?this.decrypt(_,this.sampleAes):_},s.extractRemainingSamples=function(u){var _=u.audioTrack,g=u.videoTrack,m=u.id3Track,y=u.textTrack,v=g.pesData,E=_.pesData,x=m.pesData,L;if(v&&(L=e(v))?(this.parseAVCPES(g,y,L,!0),g.pesData=null):g.pesData=v,E&&(L=e(E))){switch(_.segmentCodec){case"aac":this.parseAACPES(_,L);break;case"mp3":this.parseMPEGPES(_,L);break}_.pesData=null}else E!=null&&E.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),_.pesData=E;x&&(L=e(x))?(this.parseID3PES(m,L),m.pesData=null):m.pesData=x},s.demuxSampleAes=function(u,_,g){var m=this.demux(u,g,!0,!this.config.progressive),y=this.sampleAes=new I.default(this.observer,this.config,_);return this.decrypt(m,y)},s.decrypt=function(u,_){return new Promise(function(g){var m=u.audioTrack,y=u.videoTrack;m.samples&&m.segmentCodec==="aac"?_.decryptAacSamples(m.samples,0,function(){y.samples?_.decryptAvcSamples(y.samples,0,0,function(){g(u)}):g(u)}):y.samples&&_.decryptAvcSamples(y.samples,0,0,function(){g(u)})})},s.destroy=function(){this._duration=0},s.parseAVCPES=function(u,_,g,m){var y=this,v=this.parseAVCNALu(u,g.data),E=this.avcSample,x,L=!1;g.data=null,E&&v.length&&!u.audFound&&(i(E,u),E=this.avcSample=h(!1,g.pts,g.dts,"")),v.forEach(function(O){switch(O.type){case 1:{x=!0,E||(E=y.avcSample=h(!0,g.pts,g.dts,"")),E.frame=!0;var C=O.data;if(L&&C.length>4){var F=new S.default(C).readSliceType();(F===2||F===4||F===7||F===9)&&(E.key=!0)}break}case 5:x=!0,E||(E=y.avcSample=h(!0,g.pts,g.dts,"")),E.key=!0,E.frame=!0;break;case 6:{x=!0,Object(T.parseSEIMessageFromNALu)(r(O.data),g.pts,_.samples);break}case 7:if(x=!0,L=!0,!u.sps){var M=new S.default(O.data),B=M.readSPS();u.width=B.width,u.height=B.height,u.pixelRatio=B.pixelRatio,u.sps=[O.data],u.duration=y._duration;for(var k=O.data.subarray(1,4),w="avc1.",U=0;U<3;U++){var N=k[U].toString(16);N.length<2&&(N="0"+N),w+=N}u.codec=w}break;case 8:x=!0,u.pps||(u.pps=[O.data]);break;case 9:x=!1,u.audFound=!0,E&&i(E,u),E=y.avcSample=h(!1,g.pts,g.dts,"");break;case 12:x=!0;break;default:x=!1,E&&(E.debug+="unknown NAL "+O.type+" ");break}if(E&&x){var K=E.units;K.push(O)}}),m&&E&&(i(E,u),this.avcSample=null)},s.getLastNalUnit=function(u){var _,g=this.avcSample,m;if((!g||g.units.length===0)&&(g=u[u.length-1]),(_=g)!==null&&_!==void 0&&_.units){var y=g.units;m=y[y.length-1]}return m},s.parseAVCNALu=function(u,_){var g=_.byteLength,m=u.naluState||0,y=m,v=[],E=0,x,L,O,C=-1,F=0;for(m===-1&&(C=0,F=_[0]&31,m=0,E=1);E<g;){if(x=_[E++],!m){m=x?0:1;continue}if(m===1){m=x?0:2;continue}if(!x)m=3;else if(x===1){if(C>=0){var M={data:_.subarray(C,E-m-1),type:F};v.push(M)}else{var B=this.getLastNalUnit(u.samples);if(B&&(y&&E<=4-y&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-y)),L=E-m-1,L>0)){var k=new Uint8Array(B.data.byteLength+L);k.set(B.data,0),k.set(_.subarray(0,L),B.data.byteLength),B.data=k,B.state=0}}E<g?(O=_[E]&31,C=E,F=O,m=0):m=-1}else m=0}if(C>=0&&m>=0){var w={data:_.subarray(C,g),type:F,state:m};v.push(w)}if(v.length===0){var U=this.getLastNalUnit(u.samples);if(U){var N=new Uint8Array(U.data.byteLength+_.byteLength);N.set(U.data,0),N.set(_,U.data.byteLength),U.data=N}}return u.naluState=m,v},s.parseAACPES=function(u,_){var g=0,m=this.aacOverFlow,y=_.data;if(m){this.aacOverFlow=null;var v=m.missing,E=m.sample.unit.byteLength;if(v===-1){var x=new Uint8Array(E+y.byteLength);x.set(m.sample.unit,0),x.set(y,E),y=x}else{var L=E-v;m.sample.unit.set(y.subarray(0,v),L),u.samples.push(m.sample),g=m.missing}}var O,C;for(O=g,C=y.length;O<C-1&&!A.isHeader(y,O);O++);if(O!==g){var F,M;if(O<C-1?(F="AAC PES did not start with ADTS header,offset:"+O,M=!1):(F="no ADTS header found in AAC PES",M=!0),c.logger.warn("parsing error:"+F),this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:M,reason:F}),M)return}A.initTrackConfig(u,this.observer,y,O,this.audioCodec);var B;if(_.pts!==void 0)B=_.pts;else if(m){var k=A.getFrameDuration(u.samplerate);B=m.sample.pts+k}else{c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var w=0,U;O<C;)if(U=A.appendFrame(u,y,O,B,w),O+=U.length,U.missing){this.aacOverFlow=U;break}else for(w++;O<C-1&&!A.isHeader(y,O);O++);},s.parseMPEGPES=function(u,_){var g=_.data,m=g.length,y=0,v=0,E=_.pts;if(E===void 0){c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;v<m;)if(R.isHeader(g,v)){var x=R.appendFrame(u,g,v,E,y);if(x)v+=x.length,y++;else break}else v++},s.parseID3PES=function(u,_){if(_.pts===void 0){c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var g=l({},_,{type:this._avcTrack?p.MetadataSchema.emsg:p.MetadataSchema.audioId3});u.samples.push(g)},o}();d.minProbeByteLength=188;function h(o,s,a,u){return{key:o,frame:!1,pts:s,dts:a,units:[],debug:u,length:0}}function n(o,s){return(o[s+10]&31)<<8|o[s+11]}function t(o,s,a,u){var _={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},g=(o[s+1]&15)<<8|o[s+2],m=s+3+g-4,y=(o[s+10]&15)<<8|o[s+11];for(s+=12+y;s<m;){var v=(o[s+1]&31)<<8|o[s+2];switch(o[s]){case 207:if(!u){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:_.audio===-1&&(_.audio=v);break;case 21:_.id3===-1&&(_.id3=v);break;case 219:if(!u){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:_.avc===-1&&(_.avc=v);break;case 3:case 4:a.mpeg!==!0&&a.mp3!==!0?c.logger.log("MPEG audio found, not supported in this browser"):_.audio===-1&&(_.audio=v,_.segmentCodec="mp3");break;case 36:c.logger.warn("Unsupported HEVC stream type found");break}s+=((o[s+3]&15)<<8|o[s+4])+5}return _}function e(o){var s=0,a,u,_,g,m,y=o.data;if(!o||o.size===0)return null;for(;y[0].length<19&&y.length>1;){var v=new Uint8Array(y[0].length+y[1].length);v.set(y[0]),v.set(y[1],y[0].length),y[0]=v,y.splice(1,1)}a=y[0];var E=(a[0]<<16)+(a[1]<<8)+a[2];if(E===1){if(u=(a[4]<<8)+a[5],u&&u>o.size-6)return null;var x=a[7];x&192&&(g=(a[9]&14)*536870912+(a[10]&255)*4194304+(a[11]&254)*16384+(a[12]&255)*128+(a[13]&254)/2,x&64?(m=(a[14]&14)*536870912+(a[15]&255)*4194304+(a[16]&254)*16384+(a[17]&255)*128+(a[18]&254)/2,g-m>60*9e4&&(c.logger.warn(Math.round((g-m)/9e4)+"s delta between PTS and DTS, align them"),g=m)):m=g),_=a[8];var L=_+9;if(o.size<=L)return null;o.size-=L;for(var O=new Uint8Array(o.size),C=0,F=y.length;C<F;C++){a=y[C];var M=a.byteLength;if(L)if(L>M){L-=M;continue}else a=a.subarray(L),M-=L,L=0;O.set(a,s),s+=M}return u&&(u-=_+3),{data:O,pts:g,dts:m,len:u}}return null}function i(o,s){if(o.units.length&&o.frame){if(o.pts===void 0){var a=s.samples,u=a.length;if(u){var _=a[u-1];o.pts=_.pts,o.dts=_.dts}else{s.dropped++;return}}s.samples.push(o)}o.debug.length&&c.logger.log(o.pts+"/"+o.dts+":"+o.debug)}function r(o){for(var s=o.byteLength,a=[],u=1;u<s-2;)o[u]===0&&o[u+1]===0&&o[u+2]===3?(a.push(u+2),u+=2):u++;if(a.length===0)return o;var _=s-a.length,g=new Uint8Array(_),m=0;for(u=0;u<_;m++,u++)m===a[0]&&(m++,a.shift()),g[u]=o[m];return g}P.default=d},"./src/errors.ts":function(j,P,D){D.r(P),D.d(P,"ErrorTypes",function(){return A}),D.d(P,"ErrorDetails",function(){return R});var A;(function(S){S.NETWORK_ERROR="networkError",S.MEDIA_ERROR="mediaError",S.KEY_SYSTEM_ERROR="keySystemError",S.MUX_ERROR="muxError",S.OTHER_ERROR="otherError"})(A||(A={}));var R;(function(S){S.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",S.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",S.KEY_SYSTEM_NO_SESSION="keySystemNoSession",S.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",S.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",S.MANIFEST_LOAD_ERROR="manifestLoadError",S.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",S.MANIFEST_PARSING_ERROR="manifestParsingError",S.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",S.LEVEL_EMPTY_ERROR="levelEmptyError",S.LEVEL_LOAD_ERROR="levelLoadError",S.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",S.LEVEL_SWITCH_ERROR="levelSwitchError",S.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",S.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",S.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",S.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",S.FRAG_LOAD_ERROR="fragLoadError",S.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",S.FRAG_DECRYPT_ERROR="fragDecryptError",S.FRAG_PARSING_ERROR="fragParsingError",S.REMUX_ALLOC_ERROR="remuxAllocError",S.KEY_LOAD_ERROR="keyLoadError",S.KEY_LOAD_TIMEOUT="keyLoadTimeOut",S.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",S.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",S.BUFFER_APPEND_ERROR="bufferAppendError",S.BUFFER_APPENDING_ERROR="bufferAppendingError",S.BUFFER_STALLED_ERROR="bufferStalledError",S.BUFFER_FULL_ERROR="bufferFullError",S.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",S.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",S.INTERNAL_EXCEPTION="internalException",S.INTERNAL_ABORTED="aborted",S.UNKNOWN="unknown"})(R||(R={}))},"./src/events.ts":function(j,P,D){D.r(P),D.d(P,"Events",function(){return A});var A;(function(R){R.MEDIA_ATTACHING="hlsMediaAttaching",R.MEDIA_ATTACHED="hlsMediaAttached",R.MEDIA_DETACHING="hlsMediaDetaching",R.MEDIA_DETACHED="hlsMediaDetached",R.BUFFER_RESET="hlsBufferReset",R.BUFFER_CODECS="hlsBufferCodecs",R.BUFFER_CREATED="hlsBufferCreated",R.BUFFER_APPENDING="hlsBufferAppending",R.BUFFER_APPENDED="hlsBufferAppended",R.BUFFER_EOS="hlsBufferEos",R.BUFFER_FLUSHING="hlsBufferFlushing",R.BUFFER_FLUSHED="hlsBufferFlushed",R.MANIFEST_LOADING="hlsManifestLoading",R.MANIFEST_LOADED="hlsManifestLoaded",R.MANIFEST_PARSED="hlsManifestParsed",R.LEVEL_SWITCHING="hlsLevelSwitching",R.LEVEL_SWITCHED="hlsLevelSwitched",R.LEVEL_LOADING="hlsLevelLoading",R.LEVEL_LOADED="hlsLevelLoaded",R.LEVEL_UPDATED="hlsLevelUpdated",R.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",R.LEVELS_UPDATED="hlsLevelsUpdated",R.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",R.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",R.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",R.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",R.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",R.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",R.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",R.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",R.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",R.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",R.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",R.CUES_PARSED="hlsCuesParsed",R.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",R.INIT_PTS_FOUND="hlsInitPtsFound",R.FRAG_LOADING="hlsFragLoading",R.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",R.FRAG_LOADED="hlsFragLoaded",R.FRAG_DECRYPTED="hlsFragDecrypted",R.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",R.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",R.FRAG_PARSING_METADATA="hlsFragParsingMetadata",R.FRAG_PARSED="hlsFragParsed",R.FRAG_BUFFERED="hlsFragBuffered",R.FRAG_CHANGED="hlsFragChanged",R.FPS_DROP="hlsFpsDrop",R.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",R.ERROR="hlsError",R.DESTROYING="hlsDestroying",R.KEY_LOADING="hlsKeyLoading",R.KEY_LOADED="hlsKeyLoaded",R.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",R.BACK_BUFFER_REACHED="hlsBackBufferReached"})(A||(A={}))},"./src/hls.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return r});var A=D("./node_modules/url-toolkit/src/url-toolkit.js"),R=D("./src/loader/playlist-loader.ts"),S=D("./src/loader/key-loader.ts"),I=D("./src/controller/id3-track-controller.ts"),b=D("./src/controller/latency-controller.ts"),T=D("./src/controller/level-controller.ts"),c=D("./src/controller/fragment-tracker.ts"),f=D("./src/controller/stream-controller.ts"),p=D("./src/is-supported.ts"),l=D("./src/utils/logger.ts"),d=D("./src/config.ts"),h=D("./node_modules/eventemitter3/index.js"),n=D("./src/events.ts"),t=D("./src/errors.ts");function e(o,s){for(var a=0;a<s.length;a++){var u=s[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,u.key,u)}}function i(o,s,a){return s&&e(o.prototype,s),a&&e(o,a),Object.defineProperty(o,"prototype",{writable:!1}),o}var r=function(){o.isSupported=function(){return Object(p.isSupported)()};function o(a){a===void 0&&(a={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new h.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var u=this.config=Object(d.mergeConfig)(o.DefaultConfig,a);this.userConfig=a,Object(l.enableLogs)(u.debug),this._autoLevelCapping=-1,u.progressive&&Object(d.enableStreamingMode)(u);var _=u.abrController,g=u.bufferController,m=u.capLevelController,y=u.fpsController,v=this.abrController=new _(this),E=this.bufferController=new g(this),x=this.capLevelController=new m(this),L=new y(this),O=new R.default(this),C=new S.default(this),F=new I.default(this),M=this.levelController=new T.default(this),B=new c.FragmentTracker(this),k=this.streamController=new f.default(this,B);x.setStreamController(k),L.setStreamController(k);var w=[M,k];this.networkControllers=w;var U=[O,C,v,E,x,L,F,B];this.audioTrackController=this.createController(u.audioTrackController,null,w),this.createController(u.audioStreamController,B,w),this.subtitleTrackController=this.createController(u.subtitleTrackController,null,w),this.createController(u.subtitleStreamController,B,w),this.createController(u.timelineController,null,U),this.emeController=this.createController(u.emeController,null,U),this.cmcdController=this.createController(u.cmcdController,null,U),this.latencyController=this.createController(b.default,null,U),this.coreComponents=U}var s=o.prototype;return s.createController=function(u,_,g){if(u){var m=_?new u(this,_):new u(this);return g&&g.push(m),m}return null},s.on=function(u,_,g){g===void 0&&(g=this),this._emitter.on(u,_,g)},s.once=function(u,_,g){g===void 0&&(g=this),this._emitter.once(u,_,g)},s.removeAllListeners=function(u){this._emitter.removeAllListeners(u)},s.off=function(u,_,g,m){g===void 0&&(g=this),this._emitter.off(u,_,g,m)},s.listeners=function(u){return this._emitter.listeners(u)},s.emit=function(u,_,g){return this._emitter.emit(u,_,g)},s.trigger=function(u,_){if(this.config.debug)return this.emit(u,u,_);try{return this.emit(u,u,_)}catch(g){l.logger.error("An internal error happened while handling event "+u+'. Error message: "'+g.message+'". Here is a stacktrace:',g),this.trigger(n.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:u,error:g})}return!1},s.listenerCount=function(u){return this._emitter.listenerCount(u)},s.destroy=function(){l.logger.log("destroy"),this.trigger(n.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(u){return u.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(u){return u.destroy()}),this.coreComponents.length=0},s.attachMedia=function(u){l.logger.log("attachMedia"),this._media=u,this.trigger(n.Events.MEDIA_ATTACHING,{media:u})},s.detachMedia=function(){l.logger.log("detachMedia"),this.trigger(n.Events.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(u){this.stopLoad();var _=this.media,g=this.url,m=this.url=A.buildAbsoluteURL(self.location.href,u,{alwaysNormalize:!0});l.logger.log("loadSource:"+m),_&&g&&g!==m&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(_)),this.trigger(n.Events.MANIFEST_LOADING,{url:u})},s.startLoad=function(u){u===void 0&&(u=-1),l.logger.log("startLoad("+u+")"),this.networkControllers.forEach(function(_){_.startLoad(u)})},s.stopLoad=function(){l.logger.log("stopLoad"),this.networkControllers.forEach(function(u){u.stopLoad()})},s.swapAudioCodec=function(){l.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){l.logger.log("recoverMediaError");var u=this._media;this.detachMedia(),u&&this.attachMedia(u)},s.removeLevel=function(u,_){_===void 0&&(_=0),this.levelController.removeLevel(u,_)},i(o,[{key:"levels",get:function(){var u=this.levelController.levels;return u||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(u){l.logger.log("set currentLevel:"+u),this.loadLevel=u,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(u){l.logger.log("set nextLevel:"+u),this.levelController.manualLevel=u,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(u){l.logger.log("set loadLevel:"+u),this.levelController.manualLevel=u}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(u){this.levelController.nextLoadLevel=u}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(u){l.logger.log("set firstLevel:"+u),this.levelController.firstLevel=u}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(u){l.logger.log("set startLevel:"+u),u!==-1&&(u=Math.max(u,this.minAutoLevel)),this.levelController.startLevel=u}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(u){var _=!!u;_!==this.config.capLevelToPlayerSize&&(_?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=_)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(u){this._autoLevelCapping!==u&&(l.logger.log("set autoLevelCapping:"+u),this._autoLevelCapping=u)}},{key:"bandwidthEstimate",get:function(){var u=this.abrController.bwEstimator;return u?u.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var u=this.levels,_=this.config.minAutoBitrate;if(!u)return 0;for(var g=u.length,m=0;m<g;m++)if(u[m].maxBitrate>=_)return m;return 0}},{key:"maxAutoLevel",get:function(){var u=this.levels,_=this.autoLevelCapping,g;return _===-1&&u&&u.length?g=u.length-1:g=_,g}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(u){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,u)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var u=this.audioTrackController;return u?u.audioTracks:[]}},{key:"audioTrack",get:function(){var u=this.audioTrackController;return u?u.audioTrack:-1},set:function(u){var _=this.audioTrackController;_&&(_.audioTrack=u)}},{key:"subtitleTracks",get:function(){var u=this.subtitleTrackController;return u?u.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var u=this.subtitleTrackController;return u?u.subtitleTrack:-1},set:function(u){var _=this.subtitleTrackController;_&&(_.subtitleTrack=u)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var u=this.subtitleTrackController;return u?u.subtitleDisplay:!1},set:function(u){var _=this.subtitleTrackController;_&&(_.subtitleDisplay=u)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(u){this.config.lowLatencyMode=u}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return n.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return o.defaultConfig?o.defaultConfig:d.hlsDefaultConfig},set:function(u){o.defaultConfig=u}}]),o}();r.defaultConfig=void 0},"./src/is-supported.ts":function(j,P,D){D.r(P),D.d(P,"isSupported",function(){return S}),D.d(P,"changeTypeSupported",function(){return I});var A=D("./src/utils/mediasource-helper.ts");function R(){return self.SourceBuffer||self.WebKitSourceBuffer}function S(){var b=Object(A.getMediaSource)();if(!b)return!1;var T=R(),c=b&&typeof b.isTypeSupported=="function"&&b.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),f=!T||T.prototype&&typeof T.prototype.appendBuffer=="function"&&typeof T.prototype.remove=="function";return!!c&&!!f}function I(){var b,T=R();return typeof(T==null||(b=T.prototype)===null||b===void 0?void 0:b.changeType)=="function"}},"./src/loader/date-range.ts":function(j,P,D){D.r(P),D.d(P,"DateRangeAttribute",function(){return c}),D.d(P,"DateRange",function(){return f});var A=D("./src/polyfills/number.ts"),R=D("./src/utils/attr-list.ts"),S=D("./src/utils/logger.ts");function I(){return I=Object.assign?Object.assign.bind():function(p){for(var l=1;l<arguments.length;l++){var d=arguments[l];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(p[h]=d[h])}return p},I.apply(this,arguments)}function b(p,l){for(var d=0;d<l.length;d++){var h=l[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(p,h.key,h)}}function T(p,l,d){return l&&b(p.prototype,l),d&&b(p,d),Object.defineProperty(p,"prototype",{writable:!1}),p}var c;(function(p){p.ID="ID",p.CLASS="CLASS",p.START_DATE="START-DATE",p.DURATION="DURATION",p.END_DATE="END-DATE",p.END_ON_NEXT="END-ON-NEXT",p.PLANNED_DURATION="PLANNED-DURATION",p.SCTE35_OUT="SCTE35-OUT",p.SCTE35_IN="SCTE35-IN"})(c||(c={}));var f=function(){function p(l,d){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,d){var h=d.attr;for(var n in h)if(Object.prototype.hasOwnProperty.call(l,n)&&l[n]!==h[n]){S.logger.warn('DATERANGE tag attribute: "'+n+'" does not match for tags with ID: "'+l.ID+'"'),this._badValueForSameId=n;break}l=I(new R.AttrList({}),h,l)}if(this.attr=l,this._startDate=new Date(l[c.START_DATE]),c.END_DATE in this.attr){var t=new Date(this.attr[c.END_DATE]);Object(A.isFiniteNumber)(t.getTime())&&(this._endDate=t)}}return T(p,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var d=this.duration;return d!==null?new Date(this._startDate.getTime()+d*1e3):null}},{key:"duration",get:function(){if(c.DURATION in this.attr){var d=this.attr.decimalFloatingPoint(c.DURATION);if(Object(A.isFiniteNumber)(d))return d}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return c.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(c.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(c.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(A.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),p}()},"./src/loader/fragment-loader.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return d}),D.d(P,"LoadError",function(){return n});var A=D("./src/polyfills/number.ts"),R=D("./src/errors.ts");function S(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,f(t,e)}function I(t){var e=typeof Map=="function"?new Map:void 0;return I=function(r){if(r===null||!c(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return b(r,arguments,p(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),f(o,r)},I(t)}function b(t,e,i){return T()?b=Reflect.construct.bind():b=function(o,s,a){var u=[null];u.push.apply(u,s);var _=Function.bind.apply(o,u),g=new _;return a&&f(g,a.prototype),g},b.apply(null,arguments)}function T(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},f(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},p(t)}var l=Math.pow(2,17),d=function(){function t(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(r,o){var s=this,a=r.url;if(!a)return Promise.reject(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var u=this.config,_=u.fLoader,g=u.loader;return new Promise(function(m,y){s.loader&&s.loader.destroy();var v=s.loader=r.loader=_?new _(u):new g(u),E=h(r),x={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:r.sn==="initSegment"?1/0:l};r.stats=v.stats,v.load(E,x,{onSuccess:function(O,C,F,M){s.resetLoader(r,v),m({frag:r,part:null,payload:O.data,networkDetails:M})},onError:function(O,C,F){s.resetLoader(r,v),y(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:O,networkDetails:F}))},onAbort:function(O,C,F){s.resetLoader(r,v),y(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,networkDetails:F}))},onTimeout:function(O,C,F){s.resetLoader(r,v),y(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,networkDetails:F}))},onProgress:function(O,C,F,M){o&&o({frag:r,part:null,payload:F,networkDetails:M})}})})},e.loadPart=function(r,o,s){var a=this;this.abort();var u=this.config,_=u.fLoader,g=u.loader;return new Promise(function(m,y){a.loader&&a.loader.destroy();var v=a.loader=r.loader=_?new _(u):new g(u),E=h(r,o),x={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:l};o.stats=v.stats,v.load(E,x,{onSuccess:function(O,C,F,M){a.resetLoader(r,v),a.updateStatsFromPart(r,o);var B={frag:r,part:o,payload:O.data,networkDetails:M};s(B),m(B)},onError:function(O,C,F){a.resetLoader(r,v),y(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:o,response:O,networkDetails:F}))},onAbort:function(O,C,F){r.stats.aborted=o.stats.aborted,a.resetLoader(r,v),y(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,part:o,networkDetails:F}))},onTimeout:function(O,C,F){a.resetLoader(r,v),y(new n({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:o,networkDetails:F}))}})})},e.updateStatsFromPart=function(r,o){var s=r.stats,a=o.stats,u=a.total;if(s.loaded+=a.loaded,u){var _=Math.round(r.duration/o.duration),g=Math.min(Math.round(s.loaded/u),_),m=_-g,y=m*Math.round(s.loaded/g);s.total=s.loaded+y}else s.total=Math.max(s.loaded,s.total);var v=s.loading,E=a.loading;v.start?v.first+=E.first-E.start:(v.start=E.start,v.first=E.first),v.end=E.end},e.resetLoader=function(r,o){r.loader=null,this.loader===o&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),o.destroy()},t}();function h(t,e){e===void 0&&(e=null);var i=e||t,r={frag:t,part:e,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},o=i.byteRangeStartOffset,s=i.byteRangeEndOffset;return Object(A.isFiniteNumber)(o)&&Object(A.isFiniteNumber)(s)&&(r.rangeStart=o,r.rangeEnd=s),r}var n=function(t){S(e,t);function e(i){for(var r,o=arguments.length,s=new Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];return r=t.call.apply(t,[this].concat(s))||this,r.data=void 0,r.data=i,r}return e}(I(Error))},"./src/loader/fragment.ts":function(j,P,D){D.r(P),D.d(P,"ElementaryStreamTypes",function(){return l}),D.d(P,"BaseSegment",function(){return d}),D.d(P,"Fragment",function(){return h}),D.d(P,"Part",function(){return n});var A=D("./src/polyfills/number.ts"),R=D("./node_modules/url-toolkit/src/url-toolkit.js"),S=D("./src/utils/logger.ts"),I=D("./src/loader/level-key.ts"),b=D("./src/loader/load-stats.ts");function T(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},c(t,e)}function f(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e,i){return e&&f(t.prototype,e),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var l;(function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"})(l||(l={}));var d=function(){function t(i){var r;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(r={},r[l.AUDIO]=null,r[l.VIDEO]=null,r[l.AUDIOVIDEO]=null,r),this.baseurl=i}var e=t.prototype;return e.setByteRange=function(r,o){var s=r.split("@",2),a=[];s.length===1?a[0]=o?o.byteRangeEndOffset:0:a[0]=parseInt(s[1]),a[1]=parseInt(s[0])+a[0],this._byteRange=a},p(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(R.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}]),t}(),h=function(t){T(e,t);function e(r,o){var s;return s=t.call(this,o)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new b.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=r,s}var i=e.prototype;return i.createInitializationVector=function(o){for(var s=new Uint8Array(16),a=12;a<16;a++)s[a]=o>>8*(15-a)&255;return s},i.setDecryptDataFromLevelKey=function(o,s){var a=o;return(o==null?void 0:o.method)==="AES-128"&&o.uri&&!o.iv&&(a=I.LevelKey.fromURI(o.uri),a.method=o.method,a.iv=this.createInitializationVector(s),a.keyFormat="identity"),a},i.setElementaryStreamInfo=function(o,s,a,u,_,g){g===void 0&&(g=!1);var m=this.elementaryStreams,y=m[o];if(!y){m[o]={startPTS:s,endPTS:a,startDTS:u,endDTS:_,partial:g};return}y.startPTS=Math.min(y.startPTS,s),y.endPTS=Math.max(y.endPTS,a),y.startDTS=Math.min(y.startDTS,u),y.endDTS=Math.max(y.endDTS,_)},i.clearElementaryStreamInfo=function(){var o=this.elementaryStreams;o[l.AUDIO]=null,o[l.VIDEO]=null,o[l.AUDIOVIDEO]=null},p(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var o=this.sn;typeof o!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&S.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),o=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,o)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(A.isFiniteNumber)(this.programDateTime))return null;var o=Object(A.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+o*1e3}},{key:"encrypted",get:function(){var o;return!!((o=this.decryptdata)!==null&&o!==void 0&&o.keyFormat&&this.decryptdata.uri)}}]),e}(d),n=function(t){T(e,t);function e(i,r,o,s,a){var u;u=t.call(this,o)||this,u.fragOffset=0,u.duration=0,u.gap=!1,u.independent=!1,u.relurl=void 0,u.fragment=void 0,u.index=void 0,u.stats=new b.LoadStats,u.duration=i.decimalFloatingPoint("DURATION"),u.gap=i.bool("GAP"),u.independent=i.bool("INDEPENDENT"),u.relurl=i.enumeratedString("URI"),u.fragment=r,u.index=s;var _=i.enumeratedString("BYTERANGE");return _&&u.setByteRange(_,a),a&&(u.fragOffset=a.fragOffset+a.duration),u}return p(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}]),e}(d)},"./src/loader/key-loader.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return I});var A=D("./src/events.ts"),R=D("./src/errors.ts"),S=D("./src/utils/logger.ts"),I=function(){function b(c){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=c,this._registerListeners()}var T=b.prototype;return T._registerListeners=function(){this.hls.on(A.Events.KEY_LOADING,this.onKeyLoading,this)},T._unregisterListeners=function(){this.hls.off(A.Events.KEY_LOADING,this.onKeyLoading)},T.destroy=function(){this._unregisterListeners();for(var f in this.loaders){var p=this.loaders[f];p&&p.destroy()}this.loaders={}},T.onKeyLoading=function(f,p){var l=p.frag,d=l.type,h=this.loaders[d];if(!l.decryptdata){S.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var n=l.decryptdata.uri;if(n!==this.decrypturl||this.decryptkey===null){var t=this.hls.config;if(h&&(S.logger.warn("abort previous key loader for type:"+d),h.abort()),!n){S.logger.warn("key uri is falsy");return}var e=t.loader,i=l.loader=this.loaders[d]=new e(t);this.decrypturl=n,this.decryptkey=null;var r={url:n,frag:l,responseType:"arraybuffer"},o={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(r,o,s)}else this.decryptkey&&(l.decryptdata.key=this.decryptkey,this.hls.trigger(A.Events.KEY_LOADED,{frag:l}))},T.loadsuccess=function(f,p,l){var d=l.frag;if(!d.decryptdata){S.logger.error("after key load, decryptdata unset");return}this.decryptkey=d.decryptdata.key=new Uint8Array(f.data),d.loader=null,delete this.loaders[d.type],this.hls.trigger(A.Events.KEY_LOADED,{frag:d})},T.loaderror=function(f,p){var l=p.frag,d=l.loader;d&&d.abort(),delete this.loaders[l.type],this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:l,response:f})},T.loadtimeout=function(f,p){var l=p.frag,d=l.loader;d&&d.abort(),delete this.loaders[l.type],this.hls.trigger(A.Events.ERROR,{type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:l})},b}()},"./src/loader/level-details.ts":function(j,P,D){D.r(P),D.d(P,"LevelDetails",function(){return b});var A=D("./src/polyfills/number.ts");function R(T,c){for(var f=0;f<c.length;f++){var p=c[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(T,p.key,p)}}function S(T,c,f){return c&&R(T.prototype,c),f&&R(T,f),Object.defineProperty(T,"prototype",{writable:!1}),T}var I=10,b=function(){function T(f){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=f}var c=T.prototype;return c.reloaded=function(p){if(!p){this.advanced=!0,this.updated=!0;return}var l=this.lastPartSn-p.lastPartSn,d=this.lastPartIndex-p.lastPartIndex;this.updated=this.endSN!==p.endSN||!!d||!!l,this.advanced=this.endSN>p.endSN||l>0||l===0&&d>0,this.updated||this.advanced?this.misses=Math.floor(p.misses*.6):this.misses=p.misses+1,this.availabilityDelay=p.availabilityDelay},S(T,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(A.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||I}},{key:"drift",get:function(){var p=this.driftEndTime-this.driftStartTime;if(p>0){var l=this.driftEnd-this.driftStart;return l*1e3/p}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var p;return(p=this.fragments)!==null&&p!==void 0&&p.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var p;return(p=this.partList)!==null&&p!==void 0&&p.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),T}()},"./src/loader/level-key.ts":function(j,P,D){D.r(P),D.d(P,"LevelKey",function(){return I});var A=D("./node_modules/url-toolkit/src/url-toolkit.js");function R(b,T){for(var c=0;c<T.length;c++){var f=T[c];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}}function S(b,T,c){return T&&R(b.prototype,T),c&&R(b,c),Object.defineProperty(b,"prototype",{writable:!1}),b}var I=function(){b.fromURL=function(c,f){return new b(c,f)},b.fromURI=function(c){return new b(c)};function b(T,c){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,c?this._uri=Object(A.buildAbsoluteURL)(T,c,{alwaysNormalize:!0}):this._uri=T}return S(b,[{key:"uri",get:function(){return this._uri}}]),b}()},"./src/loader/load-stats.ts":function(j,P,D){D.r(P),D.d(P,"LoadStats",function(){return A});var A=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return i});var A=D("./src/polyfills/number.ts"),R=D("./node_modules/url-toolkit/src/url-toolkit.js"),S=D("./src/loader/date-range.ts"),I=D("./src/loader/fragment.ts"),b=D("./src/loader/level-details.ts"),T=D("./src/loader/level-key.ts"),c=D("./src/utils/attr-list.ts"),f=D("./src/utils/logger.ts"),p=D("./src/utils/codecs.ts"),l=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,d=/#EXT-X-MEDIA:(.*)/g,h=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),n=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),t=/\.(mp4|m4s|m4v|m4a)$/i;function e(_){var g,m;return t.test((g=(m=R.parseURL(_))===null||m===void 0?void 0:m.path)!=null?g:"")}var i=function(){function _(){}return _.findGroup=function(m,y){for(var v=0;v<m.length;v++){var E=m[v];if(E.id===y)return E}},_.convertAVC1ToAVCOTI=function(m){var y=m.split(".");if(y.length>2){var v=y.shift()+".";return v+=parseInt(y.shift()).toString(16),v+=("000"+parseInt(y.shift()).toString(16)).slice(-4),v}return m},_.resolve=function(m,y){return R.buildAbsoluteURL(y,m,{alwaysNormalize:!0})},_.parseMasterPlaylist=function(m,y){var v=[],E={},x=!1;l.lastIndex=0;for(var L;(L=l.exec(m))!=null;)if(L[1]){var O=new c.AttrList(L[1]),C={attrs:O,bitrate:O.decimalInteger("AVERAGE-BANDWIDTH")||O.decimalInteger("BANDWIDTH"),name:O.NAME,url:_.resolve(L[2],y)},F=O.decimalResolution("RESOLUTION");F&&(C.width=F.width,C.height=F.height),r((O.CODECS||"").split(/[ ,]+/).filter(function(B){return B}),C),C.videoCodec&&C.videoCodec.indexOf("avc1")!==-1&&(C.videoCodec=_.convertAVC1ToAVCOTI(C.videoCodec)),v.push(C)}else if(L[3]){var M=new c.AttrList(L[3]);M["DATA-ID"]&&(x=!0,E[M["DATA-ID"]]=M)}return{levels:v,sessionData:x?E:null}},_.parseMasterPlaylistMedia=function(m,y,v,E){E===void 0&&(E=[]);var x,L=[],O=0;for(d.lastIndex=0;(x=d.exec(m))!==null;){var C=new c.AttrList(x[1]);if(C.TYPE===v){var F={attrs:C,bitrate:0,id:O++,groupId:C["GROUP-ID"],instreamId:C["INSTREAM-ID"],name:C.NAME||C.LANGUAGE||"",type:v,default:C.bool("DEFAULT"),autoselect:C.bool("AUTOSELECT"),forced:C.bool("FORCED"),lang:C.LANGUAGE,url:C.URI?_.resolve(C.URI,y):""};if(E.length){var M=_.findGroup(E,F.groupId)||E[0];o(F,M,"audioCodec"),o(F,M,"textCodec")}L.push(F)}}return L},_.parseLevelPlaylist=function(m,y,v,E,x){var L=new b.LevelDetails(y),O=L.fragments,C=null,F=0,M=0,B=0,k=0,w=null,U=new I.Fragment(E,y),N,K,H,z=-1,G=!1;for(h.lastIndex=0,L.m3u8=m;(N=h.exec(m))!==null;){G&&(G=!1,U=new I.Fragment(E,y),U.start=B,U.sn=F,U.cc=k,U.level=v,C&&(U.initSegment=C,U.rawProgramDateTime=C.rawProgramDateTime,C.rawProgramDateTime=null));var q=N[1];if(q){U.duration=parseFloat(q);var Z=(" "+N[2]).slice(1);U.title=Z||null,U.tagList.push(Z?["INF",q,Z]:["INF",q])}else if(N[3])Object(A.isFiniteNumber)(U.duration)&&(U.start=B,H&&(U.levelkey=H),U.sn=F,U.level=v,U.cc=k,U.urlId=x,O.push(U),U.relurl=(" "+N[3]).slice(1),a(U,w),w=U,B+=U.duration,F++,M=0,G=!0);else if(N[4]){var V=(" "+N[4]).slice(1);w?U.setByteRange(V,w):U.setByteRange(V)}else if(N[5])U.rawProgramDateTime=(" "+N[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),z===-1&&(z=O.length);else{if(N=N[0].match(n),!N){f.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<N.length&&!(typeof N[K]<"u");K++);var X=(" "+N[K]).slice(1),J=(" "+N[K+1]).slice(1),re=N[K+2]?(" "+N[K+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":L.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":F=L.startSN=parseInt(J);break;case"SKIP":{var ie=new c.AttrList(J),ne=ie.decimalInteger("SKIPPED-SEGMENTS");if(Object(A.isFiniteNumber)(ne)){L.skippedSegments=ne;for(var ae=ne;ae--;)O.unshift(null);F+=ne}var ue=ie.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(L.recentlyRemovedDateranges=ue.split("	"));break}case"TARGETDURATION":L.targetduration=parseFloat(J);break;case"VERSION":L.version=parseInt(J);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(J||re)&&U.tagList.push(re?[J,re]:[J]);break;case"DISCONTINUITY":k++,U.tagList.push(["DIS"]);break;case"GAP":U.tagList.push([X]);break;case"BITRATE":U.tagList.push([X,J]);break;case"DATERANGE":{var oe=new c.AttrList(J),se=new S.DateRange(oe,L.dateRanges[oe.ID]);se.isValid||L.skippedSegments?L.dateRanges[se.id]=se:f.logger.warn('Ignoring invalid DATERANGE tag: "'+J+'"'),U.tagList.push(["EXT-X-DATERANGE",J]);break}case"DISCONTINUITY-SEQUENCE":k=parseInt(J);break;case"KEY":{var de,ce=new c.AttrList(J),pe=ce.enumeratedString("METHOD"),ve=ce.URI,xe=ce.hexadecimalInteger("IV"),fe=ce.enumeratedString("KEYFORMATVERSIONS"),me=ce.enumeratedString("KEYID"),W=(de=ce.enumeratedString("KEYFORMAT"))!=null?de:"identity",Y=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Y.indexOf(W)>-1){f.logger.warn("Keyformat "+W+" is not supported from the manifest");continue}else if(W!=="identity")continue;pe&&(H=T.LevelKey.fromURL(y,ve),ve&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(pe)>=0&&(H.method=pe,H.keyFormat=W,me&&(H.keyID=me),fe&&(H.keyFormatVersions=fe),H.iv=xe));break}case"START":{var $=new c.AttrList(J),Q=$.decimalFloatingPoint("TIME-OFFSET");Object(A.isFiniteNumber)(Q)&&(L.startTimeOffset=Q);break}case"MAP":{var ee=new c.AttrList(J);if(U.duration){var te=new I.Fragment(E,y);u(te,ee,v,H),C=te,U.initSegment=C,C.rawProgramDateTime&&!U.rawProgramDateTime&&(U.rawProgramDateTime=C.rawProgramDateTime)}else u(U,ee,v,H),C=U,G=!0;break}case"SERVER-CONTROL":{var le=new c.AttrList(J);L.canBlockReload=le.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=le.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&le.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=le.optionalFloat("PART-HOLD-BACK",0),L.holdBack=le.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ee=new c.AttrList(J);L.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{var he=L.partList;he||(he=L.partList=[]);var ge=M>0?he[he.length-1]:void 0,Te=M++,De=new I.Part(new c.AttrList(J),U,y,Te,ge);he.push(De),U.duration+=De.duration;break}case"PRELOAD-HINT":{var Oe=new c.AttrList(J);L.preloadHint=Oe;break}case"RENDITION-REPORT":{var Le=new c.AttrList(J);L.renditionReports=L.renditionReports||[],L.renditionReports.push(Le);break}default:f.logger.warn("line parsed but not handled: "+N);break}}}w&&!w.relurl?(O.pop(),B-=w.duration,L.partList&&(L.fragmentHint=w)):L.partList&&(a(U,w),U.cc=k,L.fragmentHint=U);var Ie=O.length,Ce=O[0],Re=O[Ie-1];if(B+=L.skippedSegments*L.targetduration,B>0&&Ie&&Re){L.averagetargetduration=B/Ie;var Pe=Re.sn;L.endSN=Pe!=="initSegment"?Pe:0,Ce&&(L.startCC=Ce.cc,Ce.initSegment||L.fragments.every(function(be){return be.relurl&&e(be.relurl)})&&(f.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new I.Fragment(E,y),U.relurl=Re.relurl,U.level=v,U.sn="initSegment",Ce.initSegment=U,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(B+=L.fragmentHint.duration),L.totalduration=B,L.endCC=k,z>0&&s(O,z),L},_}();function r(_,g){["video","audio","text"].forEach(function(m){var y=_.filter(function(E){return Object(p.isCodecType)(E,m)});if(y.length){var v=y.filter(function(E){return E.lastIndexOf("avc1",0)===0||E.lastIndexOf("mp4a",0)===0});g[m+"Codec"]=v.length>0?v[0]:y[0],_=_.filter(function(E){return y.indexOf(E)===-1})}}),g.unknownCodecs=_}function o(_,g,m){var y=g[m];y&&(_[m]=y)}function s(_,g){for(var m=_[g],y=g;y--;){var v=_[y];if(!v)return;v.programDateTime=m.programDateTime-v.duration*1e3,m=v}}function a(_,g){_.rawProgramDateTime?_.programDateTime=Date.parse(_.rawProgramDateTime):g!=null&&g.programDateTime&&(_.programDateTime=g.endProgramDateTime),Object(A.isFiniteNumber)(_.programDateTime)||(_.programDateTime=null,_.rawProgramDateTime=null)}function u(_,g,m,y){_.relurl=g.URI,g.BYTERANGE&&_.setByteRange(g.BYTERANGE),_.level=m,_.sn="initSegment",y&&(_.levelkey=y),_.initSegment=null}},"./src/loader/playlist-loader.ts":function(j,P,D){D.r(P);var A=D("./src/polyfills/number.ts"),R=D("./src/events.ts"),S=D("./src/errors.ts"),I=D("./src/utils/logger.ts"),b=D("./src/utils/mp4-tools.ts"),T=D("./src/loader/m3u8-parser.ts"),c=D("./src/types/loader.ts"),f=D("./src/utils/attr-list.ts");function p(h){var n=h.type;switch(n){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}function l(h,n){var t=h.url;return(t===void 0||t.indexOf("data:")===0)&&(t=n.url),t}var d=function(){function h(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var n=h.prototype;return n.registerListeners=function(){var e=this.hls;e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(R.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(R.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.createInternalLoader=function(e){var i=this.hls.config,r=i.pLoader,o=i.loader,s=r||o,a=new s(i);return e.loader=a,this.loaders[e.type]=a,a},n.getInternalLoader=function(e){return this.loaders[e.type]},n.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},n.destroyInternalLoaders=function(){for(var e in this.loaders){var i=this.loaders[e];i&&i.destroy(),this.resetInternalLoader(e)}},n.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},n.onManifestLoading=function(e,i){var r=i.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},n.onLevelLoading=function(e,i){var r=i.id,o=i.level,s=i.url,a=i.deliveryDirectives;this.load({id:r,groupId:null,level:o,responseType:"text",type:c.PlaylistContextType.LEVEL,url:s,deliveryDirectives:a})},n.onAudioTrackLoading=function(e,i){var r=i.id,o=i.groupId,s=i.url,a=i.deliveryDirectives;this.load({id:r,groupId:o,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:a})},n.onSubtitleTrackLoading=function(e,i){var r=i.id,o=i.groupId,s=i.url,a=i.deliveryDirectives;this.load({id:r,groupId:o,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:a})},n.load=function(e){var i,r=this.hls.config,o=this.getInternalLoader(e);if(o){var s=o.context;if(s&&s.url===e.url){I.logger.trace("[playlist-loader]: playlist request ongoing");return}I.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),o.abort()}var a,u,_,g;switch(e.type){case c.PlaylistContextType.MANIFEST:a=r.manifestLoadingMaxRetry,u=r.manifestLoadingTimeOut,_=r.manifestLoadingRetryDelay,g=r.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:a=0,u=r.levelLoadingTimeOut;break;default:a=r.levelLoadingMaxRetry,u=r.levelLoadingTimeOut,_=r.levelLoadingRetryDelay,g=r.levelLoadingMaxRetryTimeout;break}if(o=this.createInternalLoader(e),(i=e.deliveryDirectives)!==null&&i!==void 0&&i.part){var m;if(e.type===c.PlaylistContextType.LEVEL&&e.level!==null?m=this.hls.levels[e.level].details:e.type===c.PlaylistContextType.AUDIO_TRACK&&e.id!==null?m=this.hls.audioTracks[e.id].details:e.type===c.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(m=this.hls.subtitleTracks[e.id].details),m){var y=m.partTarget,v=m.targetduration;y&&v&&(u=Math.min(Math.max(y*3,v*.8)*1e3,u))}}var E={timeout:u,maxRetry:a,retryDelay:_,maxRetryDelay:g,highWaterMark:0},x={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};o.load(e,E,x)},n.loadsuccess=function(e,i,r,o){if(o===void 0&&(o=null),r.isSidxRequest){this.handleSidxRequest(e,r),this.handlePlaylistLoaded(e,i,r,o);return}this.resetInternalLoader(r.type);var s=e.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,r,"no EXTM3U delimiter",o);return}i.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,i,r,o):this.handleMasterPlaylist(e,i,r,o)},n.loaderror=function(e,i,r){r===void 0&&(r=null),this.handleNetworkError(i,r,!1,e)},n.loadtimeout=function(e,i,r){r===void 0&&(r=null),this.handleNetworkError(i,r,!0)},n.handleMasterPlaylist=function(e,i,r,o){var s=this.hls,a=e.data,u=l(e,r),_=T.default.parseMasterPlaylist(a,u),g=_.levels,m=_.sessionData;if(!g.length){this.handleManifestParsingError(e,r,"no level found in manifest",o);return}var y=g.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),v=g.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),E=T.default.parseMasterPlaylistMedia(a,u,"AUDIO",y),x=T.default.parseMasterPlaylistMedia(a,u,"SUBTITLES",v),L=T.default.parseMasterPlaylistMedia(a,u,"CLOSED-CAPTIONS");if(E.length){var O=E.some(function(C){return!C.url});!O&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new f.AttrList({}),bitrate:0,url:""}))}s.trigger(R.Events.MANIFEST_LOADED,{levels:g,audioTracks:E,subtitles:x,captions:L,url:u,stats:i,networkDetails:o,sessionData:m})},n.handleTrackOrLevelPlaylist=function(e,i,r,o){var s=this.hls,a=r.id,u=r.level,_=r.type,g=l(e,r),m=Object(A.isFiniteNumber)(a)?a:0,y=Object(A.isFiniteNumber)(u)?u:m,v=p(r),E=T.default.parseLevelPlaylist(e.data,g,y,v,m);if(!E.fragments.length){s.trigger(R.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:g,reason:"no fragments found in level",level:typeof r.level=="number"?r.level:void 0});return}if(_===c.PlaylistContextType.MANIFEST){var x={attrs:new f.AttrList({}),bitrate:0,details:E,name:"",url:g};s.trigger(R.Events.MANIFEST_LOADED,{levels:[x],audioTracks:[],url:g,stats:i,networkDetails:o,sessionData:null})}if(i.parsing.end=performance.now(),E.needSidxRanges){var L,O=(L=E.fragments[0].initSegment)===null||L===void 0?void 0:L.url;this.load({url:O,isSidxRequest:!0,type:_,level:u,levelDetails:E,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}r.levelDetails=E,this.handlePlaylistLoaded(e,i,r,o)},n.handleSidxRequest=function(e,i){var r=new Uint8Array(e.data),o=Object(b.findBox)(r,["sidx"])[0];if(!!o){var s=Object(b.parseSegmentIndex)(o);if(!!s){var a=s.references,u=i.levelDetails;a.forEach(function(_,g){var m=_.info,y=u.fragments[g];if(y.byteRange.length===0&&y.setByteRange(String(1+m.end-m.start)+"@"+String(m.start)),y.initSegment){var v=Object(b.findBox)(r,["moov"])[0],E=v?v.length:null;y.initSegment.setByteRange(String(E)+"@0")}})}}},n.handleManifestParsingError=function(e,i,r,o){this.hls.trigger(R.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:i.type===c.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:i,networkDetails:o})},n.handleNetworkError=function(e,i,r,o){r===void 0&&(r=!1),I.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=S.ErrorDetails.UNKNOWN,a=!1,u=this.getInternalLoader(e);switch(e.type){case c.PlaylistContextType.MANIFEST:s=r?S.ErrorDetails.MANIFEST_LOAD_TIMEOUT:S.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case c.PlaylistContextType.LEVEL:s=r?S.ErrorDetails.LEVEL_LOAD_TIMEOUT:S.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case c.PlaylistContextType.AUDIO_TRACK:s=r?S.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:s=r?S.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:S.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1;break}u&&this.resetInternalLoader(e.type);var _={type:S.ErrorTypes.NETWORK_ERROR,details:s,fatal:a,url:e.url,loader:u,context:e,networkDetails:i};o&&(_.response=o),this.hls.trigger(R.Events.ERROR,_)},n.handlePlaylistLoaded=function(e,i,r,o){var s=r.type,a=r.level,u=r.id,_=r.groupId,g=r.loader,m=r.levelDetails,y=r.deliveryDirectives;if(!(m!=null&&m.targetduration)){this.handleManifestParsingError(e,r,"invalid target duration",o);return}if(!!g)switch(m.live&&(g.getCacheAge&&(m.ageHeader=g.getCacheAge()||0),(!g.getCacheAge||isNaN(m.ageHeader))&&(m.ageHeader=0)),s){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(R.Events.LEVEL_LOADED,{details:m,level:a||0,id:u||0,stats:i,networkDetails:o,deliveryDirectives:y});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(R.Events.AUDIO_TRACK_LOADED,{details:m,id:u||0,groupId:_||"",stats:i,networkDetails:o,deliveryDirectives:y});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADED,{details:m,id:u||0,groupId:_||"",stats:i,networkDetails:o,deliveryDirectives:y});break}},h}();P.default=d},"./src/polyfills/number.ts":function(j,P,D){D.r(P),D.d(P,"isFiniteNumber",function(){return A}),D.d(P,"MAX_SAFE_INTEGER",function(){return R});var A=Number.isFinite||function(S){return typeof S=="number"&&isFinite(S)},R=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(j,P,D){D.r(P);var A=function(){function R(){}return R.getSilentFrame=function(I,b){switch(I){case"mp4a.40.2":if(b===1)return new Uint8Array([0,200,0,128,35,128]);if(b===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(b===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(b===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(b===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(b===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(b===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},R}();P.default=A},"./src/remux/mp4-generator.ts":function(j,P,D){D.r(P);var A=Math.pow(2,32)-1,R=function(){function S(){}return S.init=function(){S.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in S.types)S.types.hasOwnProperty(b)&&(S.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var T=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),c=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);S.HDLR_TYPES={video:T,audio:c};var f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),p=new Uint8Array([0,0,0,0,0,0,0,0]);S.STTS=S.STSC=S.STCO=p,S.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),S.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),S.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),S.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var l=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);S.FTYP=S.box(S.types.ftyp,l,h,l,d),S.DINF=S.box(S.types.dinf,S.box(S.types.dref,f))},S.box=function(b){for(var T=8,c=arguments.length,f=new Array(c>1?c-1:0),p=1;p<c;p++)f[p-1]=arguments[p];for(var l=f.length,d=l;l--;)T+=f[l].byteLength;var h=new Uint8Array(T);for(h[0]=T>>24&255,h[1]=T>>16&255,h[2]=T>>8&255,h[3]=T&255,h.set(b,4),l=0,T=8;l<d;l++)h.set(f[l],T),T+=f[l].byteLength;return h},S.hdlr=function(b){return S.box(S.types.hdlr,S.HDLR_TYPES[b])},S.mdat=function(b){return S.box(S.types.mdat,b)},S.mdhd=function(b,T){T*=b;var c=Math.floor(T/(A+1)),f=Math.floor(T%(A+1));return S.box(S.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,c>>24,c>>16&255,c>>8&255,c&255,f>>24,f>>16&255,f>>8&255,f&255,85,196,0,0]))},S.mdia=function(b){return S.box(S.types.mdia,S.mdhd(b.timescale,b.duration),S.hdlr(b.type),S.minf(b))},S.mfhd=function(b){return S.box(S.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255]))},S.minf=function(b){return b.type==="audio"?S.box(S.types.minf,S.box(S.types.smhd,S.SMHD),S.DINF,S.stbl(b)):S.box(S.types.minf,S.box(S.types.vmhd,S.VMHD),S.DINF,S.stbl(b))},S.moof=function(b,T,c){return S.box(S.types.moof,S.mfhd(b),S.traf(c,T))},S.moov=function(b){for(var T=b.length,c=[];T--;)c[T]=S.trak(b[T]);return S.box.apply(null,[S.types.moov,S.mvhd(b[0].timescale,b[0].duration)].concat(c).concat(S.mvex(b)))},S.mvex=function(b){for(var T=b.length,c=[];T--;)c[T]=S.trex(b[T]);return S.box.apply(null,[S.types.mvex].concat(c))},S.mvhd=function(b,T){T*=b;var c=Math.floor(T/(A+1)),f=Math.floor(T%(A+1)),p=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,c>>24,c>>16&255,c>>8&255,c&255,f>>24,f>>16&255,f>>8&255,f&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return S.box(S.types.mvhd,p)},S.sdtp=function(b){var T=b.samples||[],c=new Uint8Array(4+T.length),f,p;for(f=0;f<T.length;f++)p=T[f].flags,c[f+4]=p.dependsOn<<4|p.isDependedOn<<2|p.hasRedundancy;return S.box(S.types.sdtp,c)},S.stbl=function(b){return S.box(S.types.stbl,S.stsd(b),S.box(S.types.stts,S.STTS),S.box(S.types.stsc,S.STSC),S.box(S.types.stsz,S.STSZ),S.box(S.types.stco,S.STCO))},S.avc1=function(b){var T=[],c=[],f,p,l;for(f=0;f<b.sps.length;f++)p=b.sps[f],l=p.byteLength,T.push(l>>>8&255),T.push(l&255),T=T.concat(Array.prototype.slice.call(p));for(f=0;f<b.pps.length;f++)p=b.pps[f],l=p.byteLength,c.push(l>>>8&255),c.push(l&255),c=c.concat(Array.prototype.slice.call(p));var d=S.box(S.types.avcC,new Uint8Array([1,T[3],T[4],T[5],255,224|b.sps.length].concat(T).concat([b.pps.length]).concat(c))),h=b.width,n=b.height,t=b.pixelRatio[0],e=b.pixelRatio[1];return S.box(S.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,n>>8&255,n&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,S.box(S.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),S.box(S.types.pasp,new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255,e>>24,e>>16&255,e>>8&255,e&255])))},S.esds=function(b){var T=b.config.length;return new Uint8Array([0,0,0,0,3,23+T,0,1,0,4,15+T,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([T]).concat(b.config).concat([6,1,2]))},S.mp4a=function(b){var T=b.samplerate;return S.box(S.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,T>>8&255,T&255,0,0]),S.box(S.types.esds,S.esds(b)))},S.mp3=function(b){var T=b.samplerate;return S.box(S.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,T>>8&255,T&255,0,0]))},S.stsd=function(b){return b.type==="audio"?b.segmentCodec==="mp3"&&b.codec==="mp3"?S.box(S.types.stsd,S.STSD,S.mp3(b)):S.box(S.types.stsd,S.STSD,S.mp4a(b)):S.box(S.types.stsd,S.STSD,S.avc1(b))},S.tkhd=function(b){var T=b.id,c=b.duration*b.timescale,f=b.width,p=b.height,l=Math.floor(c/(A+1)),d=Math.floor(c%(A+1));return S.box(S.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,T>>24&255,T>>16&255,T>>8&255,T&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,f>>8&255,f&255,0,0,p>>8&255,p&255,0,0]))},S.traf=function(b,T){var c=S.sdtp(b),f=b.id,p=Math.floor(T/(A+1)),l=Math.floor(T%(A+1));return S.box(S.types.traf,S.box(S.types.tfhd,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,f&255])),S.box(S.types.tfdt,new Uint8Array([1,0,0,0,p>>24,p>>16&255,p>>8&255,p&255,l>>24,l>>16&255,l>>8&255,l&255])),S.trun(b,c.length+16+20+8+16+8+8),c)},S.trak=function(b){return b.duration=b.duration||4294967295,S.box(S.types.trak,S.tkhd(b),S.mdia(b))},S.trex=function(b){var T=b.id;return S.box(S.types.trex,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},S.trun=function(b,T){var c=b.samples||[],f=c.length,p=12+16*f,l=new Uint8Array(p),d,h,n,t,e,i;for(T+=8+p,l.set([0,0,15,1,f>>>24&255,f>>>16&255,f>>>8&255,f&255,T>>>24&255,T>>>16&255,T>>>8&255,T&255],0),d=0;d<f;d++)h=c[d],n=h.duration,t=h.size,e=h.flags,i=h.cts,l.set([n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,i>>>24&255,i>>>16&255,i>>>8&255,i&255],12+16*d);return S.box(S.types.trun,l)},S.initSegment=function(b){S.types||S.init();var T=S.moov(b),c=new Uint8Array(S.FTYP.byteLength+T.byteLength);return c.set(S.FTYP),c.set(T,S.FTYP.byteLength),c},S}();R.types=void 0,R.HDLR_TYPES=void 0,R.STTS=void 0,R.STSC=void 0,R.STCO=void 0,R.STSZ=void 0,R.VMHD=void 0,R.SMHD=void 0,R.STSD=void 0,R.FTYP=void 0,R.DINF=void 0,P.default=R},"./src/remux/mp4-remuxer.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return i}),D.d(P,"normalizePts",function(){return r}),D.d(P,"flushTextTrackMetadataCueSamples",function(){return s}),D.d(P,"flushTextTrackUserdataCueSamples",function(){return a});var A=D("./src/polyfills/number.ts"),R=D("./src/remux/aac-helper.ts"),S=D("./src/remux/mp4-generator.ts"),I=D("./src/events.ts"),b=D("./src/errors.ts"),T=D("./src/utils/logger.ts"),c=D("./src/types/loader.ts"),f=D("./src/utils/timescale-conversion.ts");function p(){return p=Object.assign?Object.assign.bind():function(g){for(var m=1;m<arguments.length;m++){var y=arguments[m];for(var v in y)Object.prototype.hasOwnProperty.call(y,v)&&(g[v]=y[v])}return g},p.apply(this,arguments)}var l=10*1e3,d=1024,h=1152,n=null,t=null,e=!1,i=function(){function g(y,v,E,x){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=y,this.config=v,this.typeSupported=E,this.ISGenerated=!1,n===null){var L=navigator.userAgent||"",O=L.match(/Chrome\/(\d+)/i);n=O?parseInt(O[1]):0}if(t===null){var C=navigator.userAgent.match(/Safari\/(\d+)/i);t=C?parseInt(C[1]):0}e=!(!!n&&n>=75||!!t&&t>=600)}var m=g.prototype;return m.destroy=function(){},m.resetTimeStamp=function(v){T.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=v},m.resetNextTimestamp=function(){T.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},m.resetInitSegment=function(){T.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},m.getVideoStartPts=function(v){var E=!1,x=v.reduce(function(L,O){var C=O.pts-L;return C<-4294967296?(E=!0,r(L,O.pts)):C>0?L:O.pts},v[0].pts);return E&&T.logger.debug("PTS rollover detected"),x},m.remux=function(v,E,x,L,O,C,F,M){var B,k,w,U,N,K,H=O,z=O,G=v.pid>-1,q=E.pid>-1,Z=E.samples.length,V=v.samples.length>0,X=F&&Z>0||Z>1,J=(!G||V)&&(!q||X)||this.ISGenerated||F;if(J){this.ISGenerated||(w=this.generateIS(v,E,O));var re=this.isVideoContiguous,ie=-1,ne;if(X&&(ie=o(E.samples),!re&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,ie>0){T.logger.warn("[mp4-remuxer]: Dropped "+ie+" out of "+Z+" video samples due to a missing keyframe");var ae=this.getVideoStartPts(E.samples);E.samples=E.samples.slice(ie),E.dropped+=ie,z+=(E.samples[0].pts-ae)/E.inputTimeScale,ne=z}else ie===-1&&(T.logger.warn("[mp4-remuxer]: No keyframe found out of "+Z+" video samples"),K=!1);if(this.ISGenerated){if(V&&X){var ue=this.getVideoStartPts(E.samples),oe=r(v.samples[0].pts,ue)-ue,se=oe/E.inputTimeScale;H+=Math.max(0,se),z+=Math.max(0,-se)}if(V){if(v.samplerate||(T.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),w=this.generateIS(v,E,O)),k=this.remuxAudio(v,H,this.isAudioContiguous,C,q||X||M===c.PlaylistLevelType.AUDIO?z:void 0),X){var de=k?k.endPTS-k.startPTS:0;E.inputTimeScale||(T.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),w=this.generateIS(v,E,O)),B=this.remuxVideo(E,z,re,de)}}else X&&(B=this.remuxVideo(E,z,re,0));B&&(B.firstKeyFrame=ie,B.independent=ie!==-1,B.firstKeyFramePTS=ne)}}return this.ISGenerated&&(x.samples.length&&(N=s(x,O,this._initPTS,this._initDTS)),L.samples.length&&(U=a(L,O,this._initPTS))),{audio:k,video:B,initSegment:w,independent:K,text:U,id3:N}},m.generateIS=function(v,E,x){var L=v.samples,O=E.samples,C=this.typeSupported,F={},M=!Object(A.isFiniteNumber)(this._initPTS),B="audio/mp4",k,w,U;if(M&&(k=w=1/0),v.config&&L.length){switch(v.timescale=v.samplerate,v.segmentCodec){case"mp3":C.mpeg?(B="audio/mpeg",v.codec=""):C.mp3&&(v.codec="mp3");break}F.audio={id:"audio",container:B,codec:v.codec,initSegment:v.segmentCodec==="mp3"&&C.mpeg?new Uint8Array(0):S.default.initSegment([v]),metadata:{channelCount:v.channelCount}},M&&(U=v.inputTimeScale,k=w=L[0].pts-Math.round(U*x))}if(E.sps&&E.pps&&O.length&&(E.timescale=E.inputTimeScale,F.video={id:"main",container:"video/mp4",codec:E.codec,initSegment:S.default.initSegment([E]),metadata:{width:E.width,height:E.height}},M)){U=E.inputTimeScale;var N=this.getVideoStartPts(O),K=Math.round(U*x);w=Math.min(w,r(O[0].dts,N)-K),k=Math.min(k,N-K)}if(Object.keys(F).length)return this.ISGenerated=!0,M&&(this._initPTS=k,this._initDTS=w),{tracks:F,initPTS:k,timescale:U}},m.remuxVideo=function(v,E,x,L){var O=v.inputTimeScale,C=v.samples,F=[],M=C.length,B=this._initPTS,k=this.nextAvcDts,w=8,U=this.videoSampleDuration,N,K,H=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,G=0,q=!1;if(!x||k===null){var Z=E*O,V=C[0].pts-r(C[0].dts,C[0].pts);k=Z-V}for(var X=0;X<M;X++){var J=C[X];if(J.pts=r(J.pts-B,k),J.dts=r(J.dts-B,k),J.dts>J.pts){var re=18e3;G=Math.max(Math.min(G,J.pts-J.dts),-1*re)}J.dts<C[X>0?X-1:X].dts&&(q=!0)}q&&C.sort(function(Be,je){var qe=Be.dts-je.dts,et=Be.pts-je.pts;return qe||et}),N=C[0].dts,K=C[C.length-1].dts;var ie=K-N,ne=ie?Math.round(ie/(M-1)):U||v.inputTimeScale/30;if(G<0){if(G<ne*-2){T.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(f.toMsFromMpegTsClock)(-ne,!0)+" ms");for(var ae=G,ue=0;ue<M;ue++)C[ue].dts=ae=Math.max(ae,C[ue].pts-ne),C[ue].pts=Math.max(ae,C[ue].pts)}else{T.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(f.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var oe=0;oe<M;oe++)C[oe].dts=C[oe].dts+G}N=C[0].dts}if(x){var se=N-k,de=se>ne,ce=se<-1;if(de||ce){de?T.logger.warn("AVC: "+Object(f.toMsFromMpegTsClock)(se,!0)+" ms ("+se+"dts) hole between fragments detected, filling it"):T.logger.warn("AVC: "+Object(f.toMsFromMpegTsClock)(-se,!0)+" ms ("+se+"dts) overlapping between fragments detected"),N=k;var pe=C[0].pts-se;C[0].dts=N,C[0].pts=pe,T.logger.log("Video: First PTS/DTS adjusted: "+Object(f.toMsFromMpegTsClock)(pe,!0)+"/"+Object(f.toMsFromMpegTsClock)(N,!0)+", delta: "+Object(f.toMsFromMpegTsClock)(se,!0)+" ms")}}e&&(N=Math.max(0,N));for(var ve=0,xe=0,fe=0;fe<M;fe++){for(var me=C[fe],W=me.units,Y=W.length,$=0,Q=0;Q<Y;Q++)$+=W[Q].data.length;xe+=$,ve+=Y,me.length=$,me.dts=Math.max(me.dts,N),me.pts=Math.max(me.pts,me.dts,0),H=Math.min(me.pts,H),z=Math.max(me.pts,z)}K=C[M-1].dts;var ee=xe+4*ve+8,te;try{te=new Uint8Array(ee)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:b.ErrorTypes.MUX_ERROR,details:b.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ee,reason:"fail allocating video mdat "+ee});return}var le=new DataView(te.buffer);le.setUint32(0,ee),te.set(S.default.types.mdat,4);for(var Ee=!1,he=0;he<M;he++){for(var ge=C[he],Te=ge.units,De=0,Oe=0,Le=Te.length;Oe<Le;Oe++){var Ie=Te[Oe],Ce=Ie.data,Re=Ie.data.byteLength;le.setUint32(w,Re),w+=4,te.set(Ce,w),w+=Re,De+=4+Re}if(he<M-1)U=C[he+1].dts-ge.dts;else{var Pe=this.config,be=he>0?ge.dts-C[he-1].dts:ne;if(Pe.stretchShortVideoTrack&&this.nextAudioPts!==null){var $e=Math.floor(Pe.maxBufferHole*O),Fe=(L?H+L*O:this.nextAudioPts)-ge.pts;Fe>$e?(U=Fe-be,U<0?U=be:Ee=!0,T.logger.log("[mp4-remuxer]: It is approximately "+Fe/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=be}else U=be}var Xe=Math.round(ge.pts-ge.dts);F.push(new u(ge.key,U,De,Xe))}if(F.length&&n&&n<70){var Ne=F[0].flags;Ne.dependsOn=2,Ne.isNonSync=0}console.assert(U!==null,"mp4SampleDuration must be computed"),U=Ee||!U?ne:U,this.nextAvcDts=k=K+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var Qe=S.default.moof(v.sequenceNumber++,N,p({},v,{samples:F})),Je="video",Ze={data1:Qe,data2:te,startPTS:H/O,endPTS:(z+U)/O,startDTS:N/O,endDTS:k/O,type:Je,hasAudio:!1,hasVideo:!0,nb:F.length,dropped:v.dropped};return v.samples=[],v.dropped=0,console.assert(te.length,"MDAT length must not be zero"),Ze},m.remuxAudio=function(v,E,x,L,O){var C=v.inputTimeScale,F=v.samplerate?v.samplerate:C,M=C/F,B=v.segmentCodec==="aac"?d:h,k=B*M,w=this._initPTS,U=v.segmentCodec==="mp3"&&this.typeSupported.mpeg,N=[],K=O!==void 0,H=v.samples,z=U?0:8,G=this.nextAudioPts||-1,q=E*C;if(this.isAudioContiguous=x=x||H.length&&G>0&&(L&&Math.abs(q-G)<9e3||Math.abs(r(H[0].pts-w,q)-G)<20*k),H.forEach(function(Le){Le.pts=r(Le.pts-w,q)}),!x||G<0){if(H=H.filter(function(Le){return Le.pts>=0}),!H.length)return;O===0?G=0:L&&!K?G=Math.max(0,q):G=H[0].pts}if(v.segmentCodec==="aac")for(var Z=this.config.maxAudioFramesDrift,V=0,X=G;V<H.length;V++){var J=H[V],re=J.pts,ie=re-X,ne=Math.abs(1e3*ie/C);if(ie<=-Z*k&&K)V===0&&(T.logger.warn("Audio frame @ "+(re/C).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ie/C)+" ms."),this.nextAudioPts=G=X=re);else if(ie>=Z*k&&ne<l&&K){var ae=Math.round(ie/k);X=re-ae*k,X<0&&(ae--,X+=k),V===0&&(this.nextAudioPts=G=X),T.logger.warn("[mp4-remuxer]: Injecting "+ae+" audio frame @ "+(X/C).toFixed(3)+"s due to "+Math.round(1e3*ie/C)+" ms gap.");for(var ue=0;ue<ae;ue++){var oe=Math.max(X,0),se=R.default.getSilentFrame(v.manifestCodec||v.codec,v.channelCount);se||(T.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),se=J.unit.subarray()),H.splice(V,0,{unit:se,pts:oe}),X+=k,V++}}J.pts=X,X+=k}for(var de=null,ce=null,pe,ve=0,xe=H.length;xe--;)ve+=H[xe].unit.byteLength;for(var fe=0,me=H.length;fe<me;fe++){var W=H[fe],Y=W.unit,$=W.pts;if(ce!==null){var Q=N[fe-1];Q.duration=Math.round(($-ce)/M)}else if(x&&v.segmentCodec==="aac"&&($=G),de=$,ve>0){ve+=z;try{pe=new Uint8Array(ve)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:b.ErrorTypes.MUX_ERROR,details:b.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ve,reason:"fail allocating audio mdat "+ve});return}if(!U){var ee=new DataView(pe.buffer);ee.setUint32(0,ve),pe.set(S.default.types.mdat,4)}}else return;pe.set(Y,z);var te=Y.byteLength;z+=te,N.push(new u(!0,B,te,0)),ce=$}var le=N.length;if(!!le){var Ee=N[N.length-1];this.nextAudioPts=G=ce+M*Ee.duration;var he=U?new Uint8Array(0):S.default.moof(v.sequenceNumber++,de/M,p({},v,{samples:N}));v.samples=[];var ge=de/C,Te=G/C,De="audio",Oe={data1:he,data2:pe,startPTS:ge,endPTS:Te,startDTS:ge,endDTS:Te,type:De,hasAudio:!0,hasVideo:!1,nb:le};return this.isAudioContiguous=!0,console.assert(pe.length,"MDAT length must not be zero"),Oe}},m.remuxEmptyAudio=function(v,E,x,L){var O=v.inputTimeScale,C=v.samplerate?v.samplerate:O,F=O/C,M=this.nextAudioPts,B=(M!==null?M:L.startDTS*O)+this._initDTS,k=L.endDTS*O+this._initDTS,w=F*d,U=Math.ceil((k-B)/w),N=R.default.getSilentFrame(v.manifestCodec||v.codec,v.channelCount);if(T.logger.warn("[mp4-remuxer]: remux empty Audio"),!N){T.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],H=0;H<U;H++){var z=B+H*w;K.push({unit:N,pts:z,dts:z})}return v.samples=K,this.remuxAudio(v,E,x,!1)},g}();function r(g,m){var y;if(m===null)return g;for(m<g?y=-8589934592:y=8589934592;Math.abs(g-m)>4294967296;)g+=y;return g}function o(g){for(var m=0;m<g.length;m++)if(g[m].key)return m;return-1}function s(g,m,y,v){var E=g.samples.length;if(!!E){for(var x=g.inputTimeScale,L=0;L<E;L++){var O=g.samples[L];O.pts=r(O.pts-y,m*x)/x,O.dts=r(O.dts-v,m*x)/x}var C=g.samples;return g.samples=[],{samples:C}}}function a(g,m,y){var v=g.samples.length;if(!!v){for(var E=g.inputTimeScale,x=0;x<v;x++){var L=g.samples[x];L.pts=r(L.pts-y,m*E)/E}g.samples.sort(function(C,F){return C.pts-F.pts});var O=g.samples;return g.samples=[],{samples:O}}}var u=function(m,y,v,E){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=y,this.size=v,this.cts=E,this.flags=new _(m)},_=function(m){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=m?2:1,this.isNonSync=m?0:1}},"./src/remux/passthrough-remuxer.ts":function(j,P,D){D.r(P);var A=D("./src/polyfills/number.ts"),R=D("./src/remux/mp4-remuxer.ts"),S=D("./src/utils/mp4-tools.ts"),I=D("./src/loader/fragment.ts"),b=D("./src/utils/logger.ts"),T=function(){function p(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var l=p.prototype;return l.destroy=function(){},l.resetTimeStamp=function(h){this.initPTS=h,this.lastEndDTS=null},l.resetNextTimestamp=function(){this.lastEndDTS=null},l.resetInitSegment=function(h,n,t){this.audioCodec=n,this.videoCodec=t,this.generateInitSegment(h),this.emitInitSegment=!0},l.generateInitSegment=function(h){var n=this.audioCodec,t=this.videoCodec;if(!h||!h.byteLength){this.initTracks=void 0,this.initData=void 0;return}var e=this.initData=Object(S.parseInitSegment)(h);n||(n=f(e.audio,I.ElementaryStreamTypes.AUDIO)),t||(t=f(e.video,I.ElementaryStreamTypes.VIDEO));var i={};e.audio&&e.video?i.audiovideo={container:"video/mp4",codec:n+","+t,initSegment:h,id:"main"}:e.audio?i.audio={container:"audio/mp4",codec:n,initSegment:h,id:"audio"}:e.video?i.video={container:"video/mp4",codec:t,initSegment:h,id:"main"}:b.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},l.remux=function(h,n,t,e,i){var r,o=this.initPTS,s=this.lastEndDTS,a={audio:void 0,video:void 0,text:e,id3:t,initSegment:void 0};Object(A.isFiniteNumber)(s)||(s=this.lastEndDTS=i||0);var u=n.samples;if(!u||!u.length)return a;var _={initPTS:void 0,timescale:1},g=this.initData;if((!g||!g.length)&&(this.generateInitSegment(u),g=this.initData),!g||!g.length)return b.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),a;this.emitInitSegment&&(_.tracks=this.initTracks,this.emitInitSegment=!1),Object(A.isFiniteNumber)(o)||(this.initPTS=_.initPTS=o=c(g,u,s));var m=Object(S.getDuration)(u,g),y=s,v=m+y;Object(S.offsetStartDTS)(g,u,o),m>0?this.lastEndDTS=v:(b.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var E=!!g.audio,x=!!g.video,L="";E&&(L+="audio"),x&&(L+="video");var O={data1:u,startPTS:y,startDTS:y,endPTS:v,endDTS:v,type:L,hasAudio:E,hasVideo:x,nb:1,dropped:0};a.audio=O.type==="audio"?O:void 0,a.video=O.type!=="audio"?O:void 0,a.initSegment=_;var C=(r=this.initPTS)!=null?r:0;return a.id3=Object(R.flushTextTrackMetadataCueSamples)(t,i,C,C),e.samples.length&&(a.text=Object(R.flushTextTrackUserdataCueSamples)(e,i,C)),a},p}(),c=function(l,d,h){return Object(S.getStartDTS)(l,d)-h};function f(p,l){var d=p==null?void 0:p.codec;return d&&d.length>4?d:d==="hvc1"||d==="hev1"?"hvc1.1.c.L120.90":d==="av01"?"av01.0.04M.08":d==="avc1"||l===I.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}P.default=T},"./src/task-loop.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return A});var A=function(){function R(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var S=R.prototype;return S.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},S.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},S.onHandlerDestroyed=function(){},S.hasInterval=function(){return!!this._tickInterval},S.hasNextTick=function(){return!!this._tickTimer},S.setInterval=function(b){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,b),!0)},S.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},S.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},S.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},S.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},S.doTick=function(){},R}()},"./src/types/cmcd.ts":function(j,P,D){D.r(P),D.d(P,"CMCDVersion",function(){return A}),D.d(P,"CMCDObjectType",function(){return R}),D.d(P,"CMCDStreamingFormat",function(){return S}),D.d(P,"CMCDStreamType",function(){return I});var A=1,R;(function(b){b.MANIFEST="m",b.AUDIO="a",b.VIDEO="v",b.MUXED="av",b.INIT="i",b.CAPTION="c",b.TIMED_TEXT="tt",b.KEY="k",b.OTHER="o"})(R||(R={}));var S;(function(b){b.DASH="d",b.HLS="h",b.SMOOTH="s",b.OTHER="o"})(S||(S={}));var I;(function(b){b.VOD="v",b.LIVE="l"})(I||(I={}))},"./src/types/demuxer.ts":function(j,P,D){D.r(P),D.d(P,"MetadataSchema",function(){return A});var A;(function(R){R.audioId3="org.id3",R.dateRange="com.apple.quicktime.HLS",R.emsg="https://aomedia.org/emsg/ID3"})(A||(A={}))},"./src/types/level.ts":function(j,P,D){D.r(P),D.d(P,"HlsSkip",function(){return S}),D.d(P,"getSkipValue",function(){return I}),D.d(P,"HlsUrlParameters",function(){return b}),D.d(P,"Level",function(){return T});function A(c,f){for(var p=0;p<f.length;p++){var l=f[p];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(c,l.key,l)}}function R(c,f,p){return f&&A(c.prototype,f),p&&A(c,p),Object.defineProperty(c,"prototype",{writable:!1}),c}var S;(function(c){c.No="",c.Yes="YES",c.v2="v2"})(S||(S={}));function I(c,f){var p=c.canSkipUntil,l=c.canSkipDateRanges,d=c.endSN,h=f!==void 0?f-d:0;return p&&h<p?l?S.v2:S.Yes:S.No}var b=function(){function c(p,l,d){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=p,this.part=l,this.skip=d}var f=c.prototype;return f.addDirectives=function(l){var d=new self.URL(l);return this.msn!==void 0&&d.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&d.searchParams.set("_HLS_part",this.part.toString()),this.skip&&d.searchParams.set("_HLS_skip",this.skip),d.toString()},c}(),T=function(){function c(f){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[f.url],this.attrs=f.attrs,this.bitrate=f.bitrate,f.details&&(this.details=f.details),this.id=f.id||0,this.name=f.name,this.width=f.width||0,this.height=f.height||0,this.audioCodec=f.audioCodec,this.videoCodec=f.videoCodec,this.unknownCodecs=f.unknownCodecs,this.codecSet=[f.videoCodec,f.audioCodec].filter(function(p){return p}).join(",").replace(/\.[^.,]+/g,"")}return R(c,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(p){var l=p%this.url.length;this._urlId!==l&&(this.details=void 0,this._urlId=l)}}]),c}()},"./src/types/loader.ts":function(j,P,D){D.r(P),D.d(P,"PlaylistContextType",function(){return A}),D.d(P,"PlaylistLevelType",function(){return R});var A;(function(S){S.MANIFEST="manifest",S.LEVEL="level",S.AUDIO_TRACK="audioTrack",S.SUBTITLE_TRACK="subtitleTrack"})(A||(A={}));var R;(function(S){S.MAIN="main",S.AUDIO="audio",S.SUBTITLE="subtitle"})(R||(R={}))},"./src/types/transmuxer.ts":function(j,P,D){D.r(P),D.d(P,"ChunkMetadata",function(){return A});var A=function(I,b,T,c,f,p){c===void 0&&(c=0),f===void 0&&(f=-1),p===void 0&&(p=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=R(),this.buffering={audio:R(),video:R(),audiovideo:R()},this.level=I,this.sn=b,this.id=T,this.size=c,this.part=f,this.partial=p};function R(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(j,P,D){D.r(P),D.d(P,"AttrList",function(){return S});var A=/^(\d+)x(\d+)$/,R=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function I(T){typeof T=="string"&&(T=I.parseAttrList(T));for(var c in T)T.hasOwnProperty(c)&&(this[c]=T[c])}var b=I.prototype;return b.decimalInteger=function(c){var f=parseInt(this[c],10);return f>Number.MAX_SAFE_INTEGER?1/0:f},b.hexadecimalInteger=function(c){if(this[c]){var f=(this[c]||"0x").slice(2);f=(f.length&1?"0":"")+f;for(var p=new Uint8Array(f.length/2),l=0;l<f.length/2;l++)p[l]=parseInt(f.slice(l*2,l*2+2),16);return p}else return null},b.hexadecimalIntegerAsNumber=function(c){var f=parseInt(this[c],16);return f>Number.MAX_SAFE_INTEGER?1/0:f},b.decimalFloatingPoint=function(c){return parseFloat(this[c])},b.optionalFloat=function(c,f){var p=this[c];return p?parseFloat(p):f},b.enumeratedString=function(c){return this[c]},b.bool=function(c){return this[c]==="YES"},b.decimalResolution=function(c){var f=A.exec(this[c]);if(f!==null)return{width:parseInt(f[1],10),height:parseInt(f[2],10)}},I.parseAttrList=function(c){var f,p={},l='"';for(R.lastIndex=0;(f=R.exec(c))!==null;){var d=f[2];d.indexOf(l)===0&&d.lastIndexOf(l)===d.length-1&&(d=d.slice(1,-1)),p[f[1]]=d}return p},I}()},"./src/utils/binary-search.ts":function(j,P,D){D.r(P);var A={search:function(S,I){for(var b=0,T=S.length-1,c=null,f=null;b<=T;){c=(b+T)/2|0,f=S[c];var p=I(f);if(p>0)b=c+1;else if(p<0)T=c-1;else return f}return null}};P.default=A},"./src/utils/buffer-helper.ts":function(j,P,D){D.r(P),D.d(P,"BufferHelper",function(){return S});var A=D("./src/utils/logger.ts"),R={length:0,start:function(){return 0},end:function(){return 0}},S=function(){function I(){}return I.isBuffered=function(T,c){try{if(T){for(var f=I.getBuffered(T),p=0;p<f.length;p++)if(c>=f.start(p)&&c<=f.end(p))return!0}}catch{}return!1},I.bufferInfo=function(T,c,f){try{if(T){var p=I.getBuffered(T),l=[],d;for(d=0;d<p.length;d++)l.push({start:p.start(d),end:p.end(d)});return this.bufferedInfo(l,c,f)}}catch{}return{len:0,start:c,end:c,nextStart:void 0}},I.bufferedInfo=function(T,c,f){c=Math.max(0,c),T.sort(function(a,u){var _=a.start-u.start;return _||u.end-a.end});var p=[];if(f)for(var l=0;l<T.length;l++){var d=p.length;if(d){var h=p[d-1].end;T[l].start-h<f?T[l].end>h&&(p[d-1].end=T[l].end):p.push(T[l])}else p.push(T[l])}else p=T;for(var n=0,t,e=c,i=c,r=0;r<p.length;r++){var o=p[r].start,s=p[r].end;if(c+f>=o&&c<s)e=o,i=s,n=i-c;else if(c+f<o){t=o;break}}return{len:n,start:e||0,end:i||0,nextStart:t}},I.getBuffered=function(T){try{return T.buffered}catch(c){return A.logger.log("failed to get media.buffered",c),R}},I}()},"./src/utils/cea-608-parser.ts":function(j,P,D){D.r(P),D.d(P,"Row",function(){return i}),D.d(P,"CaptionScreen",function(){return r});var A=D("./src/utils/logger.ts"),R={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},S=function(m){var y=m;return R.hasOwnProperty(m)&&(y=R[m]),String.fromCharCode(y)},I=15,b=100,T={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],d;(function(g){g[g.ERROR=0]="ERROR",g[g.TEXT=1]="TEXT",g[g.WARNING=2]="WARNING",g[g.INFO=2]="INFO",g[g.DEBUG=3]="DEBUG",g[g.DATA=3]="DATA"})(d||(d={}));var h=function(){function g(){this.time=null,this.verboseLevel=d.ERROR}var m=g.prototype;return m.log=function(v,E){this.verboseLevel>=v&&A.logger.log(this.time+" ["+v+"] "+E)},g}(),n=function(m){for(var y=[],v=0;v<m.length;v++)y.push(m[v].toString(16));return y},t=function(){function g(y,v,E,x,L){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=y||"white",this.underline=v||!1,this.italics=E||!1,this.background=x||"black",this.flash=L||!1}var m=g.prototype;return m.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},m.setStyles=function(v){for(var E=["foreground","underline","italics","background","flash"],x=0;x<E.length;x++){var L=E[x];v.hasOwnProperty(L)&&(this[L]=v[L])}},m.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},m.equals=function(v){return this.foreground===v.foreground&&this.underline===v.underline&&this.italics===v.italics&&this.background===v.background&&this.flash===v.flash},m.copy=function(v){this.foreground=v.foreground,this.underline=v.underline,this.italics=v.italics,this.background=v.background,this.flash=v.flash},m.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),e=function(){function g(y,v,E,x,L,O){this.uchar=void 0,this.penState=void 0,this.uchar=y||" ",this.penState=new t(v,E,x,L,O)}var m=g.prototype;return m.reset=function(){this.uchar=" ",this.penState.reset()},m.setChar=function(v,E){this.uchar=v,this.penState.copy(E)},m.setPenState=function(v){this.penState.copy(v)},m.equals=function(v){return this.uchar===v.uchar&&this.penState.equals(v.penState)},m.copy=function(v){this.uchar=v.uchar,this.penState.copy(v.penState)},m.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),i=function(){function g(y){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var v=0;v<b;v++)this.chars.push(new e);this.logger=y,this.pos=0,this.currPenState=new t}var m=g.prototype;return m.equals=function(v){for(var E=!0,x=0;x<b;x++)if(!this.chars[x].equals(v.chars[x])){E=!1;break}return E},m.copy=function(v){for(var E=0;E<b;E++)this.chars[E].copy(v.chars[E])},m.isEmpty=function(){for(var v=!0,E=0;E<b;E++)if(!this.chars[E].isEmpty()){v=!1;break}return v},m.setCursor=function(v){this.pos!==v&&(this.pos=v),this.pos<0?(this.logger.log(d.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>b&&(this.logger.log(d.DEBUG,"Too large cursor position "+this.pos),this.pos=b)},m.moveCursor=function(v){var E=this.pos+v;if(v>1)for(var x=this.pos+1;x<E+1;x++)this.chars[x].setPenState(this.currPenState);this.setCursor(E)},m.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},m.insertChar=function(v){v>=144&&this.backSpace();var E=S(v);if(this.pos>=b){this.logger.log(d.ERROR,"Cannot insert "+v.toString(16)+" ("+E+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(E,this.currPenState),this.moveCursor(1)},m.clearFromPos=function(v){var E;for(E=v;E<b;E++)this.chars[E].reset()},m.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},m.clearToEndOfRow=function(){this.clearFromPos(this.pos)},m.getTextString=function(){for(var v=[],E=!0,x=0;x<b;x++){var L=this.chars[x].uchar;L!==" "&&(E=!1),v.push(L)}return E?"":v.join("")},m.setPenStyles=function(v){this.currPenState.setStyles(v);var E=this.chars[this.pos];E.setPenState(this.currPenState)},g}(),r=function(){function g(y){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var v=0;v<I;v++)this.rows.push(new i(y));this.logger=y,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var m=g.prototype;return m.reset=function(){for(var v=0;v<I;v++)this.rows[v].clear();this.currRow=I-1},m.equals=function(v){for(var E=!0,x=0;x<I;x++)if(!this.rows[x].equals(v.rows[x])){E=!1;break}return E},m.copy=function(v){for(var E=0;E<I;E++)this.rows[E].copy(v.rows[E])},m.isEmpty=function(){for(var v=!0,E=0;E<I;E++)if(!this.rows[E].isEmpty()){v=!1;break}return v},m.backSpace=function(){var v=this.rows[this.currRow];v.backSpace()},m.clearToEndOfRow=function(){var v=this.rows[this.currRow];v.clearToEndOfRow()},m.insertChar=function(v){var E=this.rows[this.currRow];E.insertChar(v)},m.setPen=function(v){var E=this.rows[this.currRow];E.setPenStyles(v)},m.moveCursor=function(v){var E=this.rows[this.currRow];E.moveCursor(v)},m.setCursor=function(v){this.logger.log(d.INFO,"setCursor: "+v);var E=this.rows[this.currRow];E.setCursor(v)},m.setPAC=function(v){this.logger.log(d.INFO,"pacData = "+JSON.stringify(v));var E=v.row-1;if(this.nrRollUpRows&&E<this.nrRollUpRows-1&&(E=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==E){for(var x=0;x<I;x++)this.rows[x].clear();var L=this.currRow+1-this.nrRollUpRows,O=this.lastOutputScreen;if(O){var C=O.rows[L].cueStartTime,F=this.logger.time;if(C&&F!==null&&C<F)for(var M=0;M<this.nrRollUpRows;M++)this.rows[E-this.nrRollUpRows+M+1].copy(O.rows[L+M])}}this.currRow=E;var B=this.rows[this.currRow];if(v.indent!==null){var k=v.indent,w=Math.max(k-1,0);B.setCursor(v.indent),v.color=B.chars[w].penState.foreground}var U={foreground:v.color,underline:v.underline,italics:v.italics,background:"black",flash:!1};this.setPen(U)},m.setBkgData=function(v){this.logger.log(d.INFO,"bkgData = "+JSON.stringify(v)),this.backSpace(),this.setPen(v),this.insertChar(32)},m.setRollUpRows=function(v){this.nrRollUpRows=v},m.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(d.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(d.TEXT,this.getDisplayText());var v=this.currRow+1-this.nrRollUpRows,E=this.rows.splice(v,1)[0];E.clear(),this.rows.splice(this.currRow,0,E),this.logger.log(d.INFO,"Rolling up")},m.getDisplayText=function(v){v=v||!1;for(var E=[],x="",L=-1,O=0;O<I;O++){var C=this.rows[O].getTextString();C&&(L=O+1,v?E.push("Row "+L+": '"+C+"'"):E.push(C.trim()))}return E.length>0&&(v?x="["+E.join(" | ")+"]":x=E.join(`
`)),x},m.getTextAndFormat=function(){return this.rows},g}(),o=function(){function g(y,v,E){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=y,this.outputFilter=v,this.mode=null,this.verbose=0,this.displayedMemory=new r(E),this.nonDisplayedMemory=new r(E),this.lastOutputScreen=new r(E),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=E}var m=g.prototype;return m.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},m.getHandler=function(){return this.outputFilter},m.setHandler=function(v){this.outputFilter=v},m.setPAC=function(v){this.writeScreen.setPAC(v)},m.setBkgData=function(v){this.writeScreen.setBkgData(v)},m.setMode=function(v){v!==this.mode&&(this.mode=v,this.logger.log(d.INFO,"MODE="+v),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=v)},m.insertChars=function(v){for(var E=0;E<v.length;E++)this.writeScreen.insertChar(v[E]);var x=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(d.INFO,x+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(d.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},m.ccRCL=function(){this.logger.log(d.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},m.ccBS=function(){this.logger.log(d.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},m.ccAOF=function(){},m.ccAON=function(){},m.ccDER=function(){this.logger.log(d.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},m.ccRU=function(v){this.logger.log(d.INFO,"RU("+v+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(v)},m.ccFON=function(){this.logger.log(d.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},m.ccRDC=function(){this.logger.log(d.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},m.ccTR=function(){this.logger.log(d.INFO,"TR"),this.setMode("MODE_TEXT")},m.ccRTD=function(){this.logger.log(d.INFO,"RTD"),this.setMode("MODE_TEXT")},m.ccEDM=function(){this.logger.log(d.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},m.ccCR=function(){this.logger.log(d.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},m.ccENM=function(){this.logger.log(d.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},m.ccEOC=function(){if(this.logger.log(d.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var v=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=v,this.writeScreen=this.nonDisplayedMemory,this.logger.log(d.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},m.ccTO=function(v){this.logger.log(d.INFO,"TO("+v+") - Tab Offset"),this.writeScreen.moveCursor(v)},m.ccMIDROW=function(v){var E={flash:!1};if(E.underline=v%2===1,E.italics=v>=46,E.italics)E.foreground="white";else{var x=Math.floor(v/2)-16,L=["white","green","blue","cyan","red","yellow","magenta"];E.foreground=L[x]}this.logger.log(d.INFO,"MIDROW: "+JSON.stringify(E)),this.writeScreen.setPen(E)},m.outputDataUpdate=function(v){v===void 0&&(v=!1);var E=this.logger.time;E!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=E:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,E,this.lastOutputScreen),v&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:E),this.lastOutputScreen.copy(this.displayedMemory))},m.cueSplitAtTime=function(v){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,v,this.displayedMemory),this.cueStartTime=v))},g}(),s=function(){function g(y,v,E){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var x=new h;this.channels=[null,new o(y,v,x),new o(y+1,E,x)],this.cmdHistory=_(),this.logger=x}var m=g.prototype;return m.getHandler=function(v){return this.channels[v].getHandler()},m.setHandler=function(v,E){this.channels[v].setHandler(E)},m.addData=function(v,E){var x,L,O,C=!1;this.logger.time=v;for(var F=0;F<E.length;F+=2)if(L=E[F]&127,O=E[F+1]&127,!(L===0&&O===0)){if(this.logger.log(d.DATA,"["+n([E[F],E[F+1]])+"] -> ("+n([L,O])+")"),x=this.parseCmd(L,O),x||(x=this.parseMidrow(L,O)),x||(x=this.parsePAC(L,O)),x||(x=this.parseBackgroundAttributes(L,O)),!x&&(C=this.parseChars(L,O),C)){var M=this.currentChannel;if(M&&M>0){var B=this.channels[M];B.insertChars(C)}else this.logger.log(d.WARNING,"No channel found yet. TEXT-MODE?")}!x&&!C&&this.logger.log(d.WARNING,"Couldn't parse cleaned data "+n([L,O])+" orig: "+n([E[F],E[F+1]]))}},m.parseCmd=function(v,E){var x=this.cmdHistory,L=(v===20||v===28||v===21||v===29)&&E>=32&&E<=47,O=(v===23||v===31)&&E>=33&&E<=35;if(!(L||O))return!1;if(u(v,E,x))return a(null,null,x),this.logger.log(d.DEBUG,"Repeated command ("+n([v,E])+") is dropped"),!0;var C=v===20||v===21||v===23?1:2,F=this.channels[C];return v===20||v===21||v===28||v===29?E===32?F.ccRCL():E===33?F.ccBS():E===34?F.ccAOF():E===35?F.ccAON():E===36?F.ccDER():E===37?F.ccRU(2):E===38?F.ccRU(3):E===39?F.ccRU(4):E===40?F.ccFON():E===41?F.ccRDC():E===42?F.ccTR():E===43?F.ccRTD():E===44?F.ccEDM():E===45?F.ccCR():E===46?F.ccENM():E===47&&F.ccEOC():F.ccTO(E-32),a(v,E,x),this.currentChannel=C,!0},m.parseMidrow=function(v,E){var x=0;if((v===17||v===25)&&E>=32&&E<=47){if(v===17?x=1:x=2,x!==this.currentChannel)return this.logger.log(d.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[x];return L?(L.ccMIDROW(E),this.logger.log(d.DEBUG,"MIDROW ("+n([v,E])+")"),!0):!1}return!1},m.parsePAC=function(v,E){var x,L=this.cmdHistory,O=(v>=17&&v<=23||v>=25&&v<=31)&&E>=64&&E<=127,C=(v===16||v===24)&&E>=64&&E<=95;if(!(O||C))return!1;if(u(v,E,L))return a(null,null,L),!0;var F=v<=23?1:2;E>=64&&E<=95?x=F===1?T[v]:f[v]:x=F===1?c[v]:p[v];var M=this.channels[F];return M?(M.setPAC(this.interpretPAC(x,E)),a(v,E,L),this.currentChannel=F,!0):!1},m.interpretPAC=function(v,E){var x,L={color:null,italics:!1,indent:null,underline:!1,row:v};return E>95?x=E-96:x=E-64,L.underline=(x&1)===1,x<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(x/2)]:x<=15?(L.italics=!0,L.color="white"):L.indent=Math.floor((x-16)/2)*4,L},m.parseChars=function(v,E){var x,L=null,O=null;if(v>=25?(x=2,O=v-8):(x=1,O=v),O>=17&&O<=19){var C;O===17?C=E+80:O===18?C=E+112:C=E+144,this.logger.log(d.INFO,"Special char '"+S(C)+"' in channel "+x),L=[C]}else v>=32&&v<=127&&(L=E===0?[v]:[v,E]);if(L){var F=n(L);this.logger.log(d.DEBUG,"Char codes =  "+F.join(",")),a(v,E,this.cmdHistory)}return L},m.parseBackgroundAttributes=function(v,E){var x=(v===16||v===24)&&E>=32&&E<=47,L=(v===23||v===31)&&E>=45&&E<=47;if(!(x||L))return!1;var O,C={};v===16||v===24?(O=Math.floor((E-32)/2),C.background=l[O],E%2===1&&(C.background=C.background+"_semi")):E===45?C.background="transparent":(C.foreground="black",E===47&&(C.underline=!0));var F=v<=23?1:2,M=this.channels[F];return M.setBkgData(C),a(v,E,this.cmdHistory),!0},m.reset=function(){for(var v=0;v<Object.keys(this.channels).length;v++){var E=this.channels[v];E&&E.reset()}this.cmdHistory=_()},m.cueSplitAtTime=function(v){for(var E=0;E<this.channels.length;E++){var x=this.channels[E];x&&x.cueSplitAtTime(v)}},g}();function a(g,m,y){y.a=g,y.b=m}function u(g,m,y){return y.a===g&&y.b===m}function _(){return{a:null,b:null}}P.default=s},"./src/utils/codecs.ts":function(j,P,D){D.r(P),D.d(P,"isCodecType",function(){return R}),D.d(P,"isCodecSupportedInMp4",function(){return S});var A={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function R(I,b){var T=A[b];return!!T&&T[I.slice(0,4)]===!0}function S(I,b){return MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":function(j,P,D){D.r(P);var A=D("./src/utils/vttparser.ts"),R=D("./src/utils/webvtt-parser.ts"),S=D("./src/utils/texttrack-utils.ts"),I=/\s/,b={newCue:function(c,f,p,l){for(var d=[],h,n,t,e,i,r=self.VTTCue||self.TextTrackCue,o=0;o<l.rows.length;o++)if(h=l.rows[o],t=!0,e=0,i="",!h.isEmpty()){for(var s=0;s<h.chars.length;s++)I.test(h.chars[s].uchar)&&t?e++:(i+=h.chars[s].uchar,t=!1);h.cueStartTime=f,f===p&&(p+=1e-4),e>=16?e--:e++;var a=Object(A.fixLineBreaks)(i.trim()),u=Object(R.generateCueId)(f,p,a);(!c||!c.cues||!c.cues.getCueById(u))&&(n=new r(f,p,a),n.id=u,n.line=o+1,n.align="left",n.position=10+Math.min(80,Math.floor(e*8/32)*10),d.push(n))}return c&&d.length&&(d.sort(function(_,g){return _.line==="auto"||g.line==="auto"?0:_.line>8&&g.line>8?g.line-_.line:_.line-g.line}),d.forEach(function(_){return Object(S.addCueToTrack)(c,_)})),d}};P.default=b},"./src/utils/discontinuities.ts":function(j,P,D){D.r(P),D.d(P,"findFirstFragWithCC",function(){return I}),D.d(P,"shouldAlignOnDiscontinuities",function(){return b}),D.d(P,"findDiscontinuousReferenceFrag",function(){return T}),D.d(P,"adjustSlidingStart",function(){return f}),D.d(P,"alignStream",function(){return p}),D.d(P,"alignPDT",function(){return d}),D.d(P,"alignFragmentByPDTDelta",function(){return h}),D.d(P,"alignMediaPlaylistByPDT",function(){return n});var A=D("./src/polyfills/number.ts"),R=D("./src/utils/logger.ts"),S=D("./src/controller/level-helper.ts");function I(t,e){for(var i=null,r=0,o=t.length;r<o;r++){var s=t[r];if(s&&s.cc===e){i=s;break}}return i}function b(t,e,i){return!!(e.details&&(i.endCC>i.startCC||t&&t.cc<i.startCC))}function T(t,e){var i=t.fragments,r=e.fragments;if(!r.length||!i.length){R.logger.log("No fragments to align");return}var o=I(i,r[0].cc);if(!o||o&&!o.startPTS){R.logger.log("No frag in previous level to align on");return}return o}function c(t,e){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function f(t,e){for(var i=e.fragments,r=0,o=i.length;r<o;r++)c(i[r],t);e.fragmentHint&&c(e.fragmentHint,t),e.alignedSliding=!0}function p(t,e,i){!e||(l(t,i,e),!i.alignedSliding&&e.details&&d(i,e.details),!i.alignedSliding&&e.details&&!i.skippedSegments&&Object(S.adjustSliding)(e.details,i))}function l(t,e,i){if(b(t,i,e)){var r=T(i.details,e);r&&Object(A.isFiniteNumber)(r.start)&&(R.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),f(r.start,e))}}function d(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var i=e.fragments[0].programDateTime,r=t.fragments[0].programDateTime,o=(r-i)/1e3+e.fragments[0].start;o&&Object(A.isFiniteNumber)(o)&&(R.logger.log("Adjusting PTS using programDateTime delta "+(r-i)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),f(o,t))}}function h(t,e){var i=t.programDateTime;if(!!i){var r=(i-e)/1e3;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function n(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var i=e.fragments[0].programDateTime,r=e.fragments[0].start,o=i-r*1e3;t.fragments.forEach(function(s){h(s,o)}),t.fragmentHint&&h(t.fragmentHint,o),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(j,P,D){D.r(P);var A=D("./src/utils/ewma.ts"),R=function(){function S(b,T,c){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=c,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new A.default(b),this.fast_=new A.default(T)}var I=S.prototype;return I.update=function(T,c){var f=this.slow_,p=this.fast_;this.slow_.halfLife!==T&&(this.slow_=new A.default(T,f.getEstimate(),f.getTotalWeight())),this.fast_.halfLife!==c&&(this.fast_=new A.default(c,p.getEstimate(),p.getTotalWeight()))},I.sample=function(T,c){T=Math.max(T,this.minDelayMs_);var f=8*c,p=T/1e3,l=f/p;this.fast_.sample(p,l),this.slow_.sample(p,l)},I.canEstimate=function(){var T=this.fast_;return T&&T.getTotalWeight()>=this.minWeight_},I.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},I.destroy=function(){},S}();P.default=R},"./src/utils/ewma.ts":function(j,P,D){D.r(P);var A=function(){function R(I,b,T){b===void 0&&(b=0),T===void 0&&(T=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=I,this.alpha_=I?Math.exp(Math.log(.5)/I):0,this.estimate_=b,this.totalWeight_=T}var S=R.prototype;return S.sample=function(b,T){var c=Math.pow(this.alpha_,b);this.estimate_=T*(1-c)+c*this.estimate_,this.totalWeight_+=b},S.getTotalWeight=function(){return this.totalWeight_},S.getEstimate=function(){if(this.alpha_){var b=1-Math.pow(this.alpha_,this.totalWeight_);if(b)return this.estimate_/b}return this.estimate_},R}();P.default=A},"./src/utils/fetch-loader.ts":function(j,P,D){D.r(P),D.d(P,"fetchSupported",function(){return h});var A=D("./src/polyfills/number.ts"),R=D("./src/loader/load-stats.ts"),S=D("./src/demux/chunk-cache.ts");function I(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,p(r,o)}function b(r){var o=typeof Map=="function"?new Map:void 0;return b=function(a){if(a===null||!f(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o<"u"){if(o.has(a))return o.get(a);o.set(a,u)}function u(){return T(a,arguments,l(this).constructor)}return u.prototype=Object.create(a.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),p(u,a)},b(r)}function T(r,o,s){return c()?T=Reflect.construct.bind():T=function(u,_,g){var m=[null];m.push.apply(m,_);var y=Function.bind.apply(u,m),v=new y;return g&&p(v,g.prototype),v},T.apply(null,arguments)}function c(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function f(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function p(r,o){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,u){return a.__proto__=u,a},p(r,o)}function l(r){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},l(r)}function d(){return d=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var s=arguments[o];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},d.apply(this,arguments)}function h(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var n=function(){function r(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||e,this.controller=new self.AbortController,this.stats=new R.LoadStats}var o=r.prototype;return o.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},o.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},o.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},o.load=function(a,u,_){var g=this,m=this.stats;if(m.loading.start)throw new Error("Loader can only be used once.");m.loading.start=self.performance.now();var y=t(a,this.controller.signal),v=_.onProgress,E=a.responseType==="arraybuffer",x=E?"byteLength":"length";this.context=a,this.config=u,this.callbacks=_,this.request=this.fetchSetup(a,y),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){g.abortInternal(),_.onTimeout(m,a,g.response)},u.timeout),self.fetch(this.request).then(function(L){if(g.response=g.loader=L,!L.ok){var O=L.status,C=L.statusText;throw new i(C||"fetch, bad network response",O,L)}return m.loading.first=Math.max(self.performance.now(),m.loading.start),m.total=parseInt(L.headers.get("Content-Length")||"0"),v&&Object(A.isFiniteNumber)(u.highWaterMark)?g.loadProgressively(L,m,a,u.highWaterMark,v):E?L.arrayBuffer():L.text()}).then(function(L){var O=g.response;self.clearTimeout(g.requestTimeout),m.loading.end=Math.max(self.performance.now(),m.loading.first),m.loaded=m.total=L[x];var C={url:O.url,data:L};v&&!Object(A.isFiniteNumber)(u.highWaterMark)&&v(m,a,L,O),_.onSuccess(C,m,a,O)}).catch(function(L){if(self.clearTimeout(g.requestTimeout),!m.aborted){var O=L&&L.code||0,C=L?L.message:null;_.onError({code:O,text:C},a,L?L.details:null)}})},o.getCacheAge=function(){var a=null;if(this.response){var u=this.response.headers.get("age");a=u?parseFloat(u):null}return a},o.loadProgressively=function(a,u,_,g,m){g===void 0&&(g=0);var y=new S.default,v=a.body.getReader(),E=function x(){return v.read().then(function(L){if(L.done)return y.dataLength&&m(u,_,y.flush(),a),Promise.resolve(new ArrayBuffer(0));var O=L.value,C=O.length;return u.loaded+=C,C<g||y.dataLength?(y.push(O),y.dataLength>=g&&m(u,_,y.flush(),a)):m(u,_,O,a),x()}).catch(function(){return Promise.reject()})};return E()},r}();function t(r,o){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:o,headers:new self.Headers(d({},r.headers))};return r.rangeEnd&&s.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),s}function e(r,o){return new self.Request(r.url,o)}var i=function(r){I(o,r);function o(s,a,u){var _;return _=r.call(this,s)||this,_.code=void 0,_.details=void 0,_.code=a,_.details=u,_}return o}(b(Error));P.default=n},"./src/utils/imsc1-ttml-parser.ts":function(j,P,D){D.r(P),D.d(P,"IMSC1_CODEC",function(){return f}),D.d(P,"parseIMSC1",function(){return h});var A=D("./src/utils/mp4-tools.ts"),R=D("./src/utils/vttparser.ts"),S=D("./src/utils/vttcue.ts"),I=D("./src/demux/id3.ts"),b=D("./src/utils/timescale-conversion.ts"),T=D("./src/utils/webvtt-parser.ts");function c(){return c=Object.assign?Object.assign.bind():function(g){for(var m=1;m<arguments.length;m++){var y=arguments[m];for(var v in y)Object.prototype.hasOwnProperty.call(y,v)&&(g[v]=y[v])}return g},c.apply(this,arguments)}var f="stpp.ttml.im1t",p=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,l=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,d={left:"start",center:"center",right:"end",start:"start",end:"end"};function h(g,m,y,v,E){var x=Object(A.findBox)(new Uint8Array(g),["mdat"]);if(x.length===0){E(new Error("Could not parse IMSC1 mdat"));return}var L=x.map(function(C){return Object(I.utf8ArrayToStr)(C)}),O=Object(b.toTimescaleFromScale)(m,1,y);try{L.forEach(function(C){return v(n(C,O))})}catch(C){E(C)}}function n(g,m){var y=new DOMParser,v=y.parseFromString(g,"text/xml"),E=v.getElementsByTagName("tt")[0];if(!E)throw new Error("Invalid ttml");var x={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},L=Object.keys(x).reduce(function(B,k){return B[k]=E.getAttribute("ttp:"+k)||x[k],B},{}),O=E.getAttribute("xml:space")!=="preserve",C=e(t(E,"styling","style")),F=e(t(E,"layout","region")),M=t(E,"body","[begin]");return[].map.call(M,function(B){var k=i(B,O);if(!k||!B.hasAttribute("begin"))return null;var w=a(B.getAttribute("begin"),L),U=a(B.getAttribute("dur"),L),N=a(B.getAttribute("end"),L);if(w===null)throw s(B);if(N===null){if(U===null)throw s(B);N=w+U}var K=new S.default(w-m,N-m,k);K.id=Object(T.generateCueId)(K.startTime,K.endTime,K.text);var H=F[B.getAttribute("region")],z=C[B.getAttribute("style")];K.position=10,K.size=80;var G=r(H,z,C),q=G.textAlign;if(q){var Z=d[q];Z&&(K.lineAlign=Z),K.align=q}return c(K,G),K}).filter(function(B){return B!==null})}function t(g,m,y){var v=g.getElementsByTagName(m)[0];return v?[].slice.call(v.querySelectorAll(y)):[]}function e(g){return g.reduce(function(m,y){var v=y.getAttribute("xml:id");return v&&(m[v]=y),m},{})}function i(g,m){return[].slice.call(g.childNodes).reduce(function(y,v,E){var x;return v.nodeName==="br"&&E?y+`
`:(x=v.childNodes)!==null&&x!==void 0&&x.length?i(v,m):m?y+v.textContent.trim().replace(/\s+/g," "):y+v.textContent},"")}function r(g,m,y){var v="http://www.w3.org/ns/ttml#styling",E=null,x=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],L=g!=null&&g.hasAttribute("style")?g.getAttribute("style"):null;return L&&y.hasOwnProperty(L)&&(E=y[L]),x.reduce(function(O,C){var F=o(m,v,C)||o(g,v,C)||o(E,v,C);return F&&(O[C]=F),O},{})}function o(g,m,y){return g&&g.hasAttributeNS(m,y)?g.getAttributeNS(m,y):null}function s(g){return new Error("Could not parse ttml timestamp "+g)}function a(g,m){if(!g)return null;var y=Object(R.parseTimeStamp)(g);return y===null&&(p.test(g)?y=u(g,m):l.test(g)&&(y=_(g,m))),y}function u(g,m){var y=p.exec(g),v=(y[4]|0)+(y[5]|0)/m.subFrameRate;return(y[1]|0)*3600+(y[2]|0)*60+(y[3]|0)+v/m.frameRate}function _(g,m){var y=l.exec(g),v=Number(y[1]),E=y[2];switch(E){case"h":return v*3600;case"m":return v*60;case"ms":return v*1e3;case"f":return v/m.frameRate;case"t":return v/m.tickRate}return v}},"./src/utils/logger.ts":function(j,P,D){D.r(P),D.d(P,"enableLogs",function(){return T}),D.d(P,"logger",function(){return c});var A=function(){},R={trace:A,debug:A,log:A,warn:A,info:A,error:A},S=R;function I(f){var p=self.console[f];return p?p.bind(self.console,"["+f+"] >"):A}function b(f){for(var p=arguments.length,l=new Array(p>1?p-1:0),d=1;d<p;d++)l[d-1]=arguments[d];l.forEach(function(h){S[h]=f[h]?f[h].bind(f):I(h)})}function T(f){if(self.console&&f===!0||typeof f=="object"){b(f,"debug","log","info","warn","error");try{S.log()}catch{S=R}}else S=R}var c=S},"./src/utils/mediakeys-helper.ts":function(j,P,D){D.r(P),D.d(P,"KeySystems",function(){return A}),D.d(P,"requestMediaKeySystemAccess",function(){return R});var A;(function(S){S.WIDEVINE="com.widevine.alpha",S.PLAYREADY="com.microsoft.playready"})(A||(A={}));var R=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(j,P,D){D.r(P),D.d(P,"getMediaSource",function(){return A});function A(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(j,P,D){D.r(P),D.d(P,"RemuxerTrackIdConfig",function(){return T}),D.d(P,"bin2str",function(){return c}),D.d(P,"readUint16",function(){return f}),D.d(P,"readUint32",function(){return p}),D.d(P,"readSint32",function(){return l}),D.d(P,"writeUint32",function(){return d}),D.d(P,"findBox",function(){return h}),D.d(P,"parseSegmentIndex",function(){return n}),D.d(P,"parseInitSegment",function(){return t}),D.d(P,"getStartDTS",function(){return e}),D.d(P,"getDuration",function(){return i}),D.d(P,"computeRawDurationFromSamples",function(){return r}),D.d(P,"offsetStartDTS",function(){return o}),D.d(P,"segmentValidRange",function(){return s}),D.d(P,"appendUint8Array",function(){return a}),D.d(P,"parseSamples",function(){return u}),D.d(P,"parseSEIMessageFromNALu",function(){return m}),D.d(P,"parseEmsg",function(){return v});var A=D("./src/utils/typed-array.ts"),R=D("./src/loader/fragment.ts"),S=D("./src/demux/id3.ts"),I=Math.pow(2,32)-1,b=[].push,T={video:1,audio:2,id3:3,text:4};function c(E){return String.fromCharCode.apply(null,E)}function f(E,x){var L=E[x]<<8|E[x+1];return L<0?65536+L:L}function p(E,x){var L=l(E,x);return L<0?4294967296+L:L}function l(E,x){return E[x]<<24|E[x+1]<<16|E[x+2]<<8|E[x+3]}function d(E,x,L){E[x]=L>>24,E[x+1]=L>>16&255,E[x+2]=L>>8&255,E[x+3]=L&255}function h(E,x){var L=[];if(!x.length)return L;for(var O=E.byteLength,C=0;C<O;){var F=p(E,C),M=c(E.subarray(C+4,C+8)),B=F>1?C+F:O;if(M===x[0])if(x.length===1)L.push(E.subarray(C+8,B));else{var k=h(E.subarray(C+8,B),x.slice(1));k.length&&b.apply(L,k)}C=B}return L}function n(E){var x=[],L=E[0],O=8,C=p(E,O);O+=4;var F=0,M=0;L===0?O+=8:O+=16,O+=2;var B=E.length+M,k=f(E,O);O+=2;for(var w=0;w<k;w++){var U=O,N=p(E,U);U+=4;var K=N&2147483647,H=(N&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var z=p(E,U);U+=4,x.push({referenceSize:K,subsegmentDuration:z,info:{duration:z/C,start:B,end:B+K-1}}),B+=K,U+=4,O=U}return{earliestPresentationTime:F,timescale:C,version:L,referencesCount:k,references:x}}function t(E){for(var x=[],L=h(E,["moov","trak"]),O=0;O<L.length;O++){var C=L[O],F=h(C,["tkhd"])[0];if(F){var M=F[0],B=M===0?12:20,k=p(F,B),w=h(C,["mdia","mdhd"])[0];if(w){M=w[0],B=M===0?12:20;var U=p(w,B),N=h(C,["mdia","hdlr"])[0];if(N){var K=c(N.subarray(8,12)),H={soun:R.ElementaryStreamTypes.AUDIO,vide:R.ElementaryStreamTypes.VIDEO}[K];if(H){var z=h(C,["mdia","minf","stbl","stsd"])[0],G=void 0;z&&(G=c(z.subarray(12,16))),x[k]={timescale:U,type:H},x[H]={timescale:U,id:k,codec:G}}}}}}var q=h(E,["moov","mvex","trex"]);return q.forEach(function(Z){var V=p(Z,4),X=x[V];X&&(X.default={duration:p(Z,12),flags:p(Z,20)})}),x}function e(E,x){return h(x,["moof","traf"]).reduce(function(L,O){var C=h(O,["tfdt"])[0],F=C[0],M=h(O,["tfhd"]).reduce(function(B,k){var w=p(k,4),U=E[w];if(U){var N=p(C,4);F===1&&(N*=Math.pow(2,32),N+=p(C,8));var K=U.timescale||9e4,H=N/K;if(isFinite(H)&&(B===null||H<B))return H}return B},null);return M!==null&&isFinite(M)&&(L===null||M<L)?M:L},null)||0}function i(E,x){for(var L=0,O=0,C=0,F=h(E,["moof","traf"]),M=0;M<F.length;M++){var B=F[M],k=h(B,["tfhd"])[0],w=p(k,4),U=x[w];if(!!U){var N=U.default,K=p(k,0)|(N==null?void 0:N.flags),H=N==null?void 0:N.duration;K&8&&(K&2?H=p(k,12):H=p(k,8));for(var z=U.timescale||9e4,G=h(B,["trun"]),q=0;q<G.length;q++){if(L=r(G[q]),!L&&H){var Z=p(G[q],4);L=H*Z}U.type===R.ElementaryStreamTypes.VIDEO?O+=L/z:U.type===R.ElementaryStreamTypes.AUDIO&&(C+=L/z)}}}if(O===0&&C===0){for(var V=0,X=h(E,["sidx"]),J=0;J<X.length;J++){var re=n(X[J]);re!=null&&re.references&&(V+=re.references.reduce(function(ie,ne){return ie+ne.info.duration||0},0))}return V}return O||C}function r(E){var x=p(E,0),L=8;x&1&&(L+=4),x&4&&(L+=4);for(var O=0,C=p(E,4),F=0;F<C;F++){if(x&256){var M=p(E,L);O+=M,L+=4}x&512&&(L+=4),x&1024&&(L+=4),x&2048&&(L+=4)}return O}function o(E,x,L){h(x,["moof","traf"]).forEach(function(O){h(O,["tfhd"]).forEach(function(C){var F=p(C,4),M=E[F];if(!!M){var B=M.timescale||9e4;h(O,["tfdt"]).forEach(function(k){var w=k[0],U=p(k,4);if(w===0)U-=L*B,U=Math.max(U,0),d(k,4,U);else{U*=Math.pow(2,32),U+=p(k,8),U-=L*B,U=Math.max(U,0);var N=Math.floor(U/(I+1)),K=Math.floor(U%(I+1));d(k,4,N),d(k,8,K)}})}})})}function s(E){var x={valid:null,remainder:null},L=h(E,["moof"]);if(L){if(L.length<2)return x.remainder=E,x}else return x;var O=L[L.length-1];return x.valid=Object(A.sliceUint8)(E,0,O.byteOffset-8),x.remainder=Object(A.sliceUint8)(E,O.byteOffset-8),x}function a(E,x){var L=new Uint8Array(E.length+x.length);return L.set(E),L.set(x,E.length),L}function u(E,x){var L=[],O=x.samples,C=x.timescale,F=x.id,M=!1,B=h(O,["moof"]);return B.map(function(k){var w=k.byteOffset-8,U=h(k,["traf"]);U.map(function(N){var K=h(N,["tfdt"]).map(function(H){var z=H[0],G=p(H,4);return z===1&&(G*=Math.pow(2,32),G+=p(H,8)),G/C})[0];return K!==void 0&&(E=K),h(N,["tfhd"]).map(function(H){var z=p(H,4),G=p(H,0)&16777215,q=(G&1)!==0,Z=(G&2)!==0,V=(G&8)!==0,X=0,J=(G&16)!==0,re=0,ie=(G&32)!==0,ne=8;z===F&&(q&&(ne+=8),Z&&(ne+=4),V&&(X=p(H,ne),ne+=4),J&&(re=p(H,ne),ne+=4),ie&&(ne+=4),x.type==="video"&&(M=_(x.codec)),h(N,["trun"]).map(function(ae){var ue=ae[0],oe=p(ae,0)&16777215,se=(oe&1)!==0,de=0,ce=(oe&4)!==0,pe=(oe&256)!==0,ve=0,xe=(oe&512)!==0,fe=0,me=(oe&1024)!==0,W=(oe&2048)!==0,Y=0,$=p(ae,4),Q=8;se&&(de=p(ae,Q),Q+=4),ce&&(Q+=4);for(var ee=de+w,te=0;te<$;te++){if(pe?(ve=p(ae,Q),Q+=4):ve=X,xe?(fe=p(ae,Q),Q+=4):fe=re,me&&(Q+=4),W&&(ue===0?Y=p(ae,Q):Y=l(ae,Q),Q+=4),x.type===R.ElementaryStreamTypes.VIDEO)for(var le=0;le<fe;){var Ee=p(O,ee);ee+=4;var he=O[ee]&31;if(g(M,he)){var ge=O.subarray(ee,ee+Ee);m(ge,E+Y/C,L)}ee+=Ee,le+=Ee+4}E+=ve/C}}))})})}),L}function _(E){if(!E)return!1;var x=E.indexOf("."),L=x<0?E:E.substring(0,x);return L==="hvc1"||L==="hev1"||L==="dvh1"||L==="dvhe"}function g(E,x){return E?x===39||x===40:x===6}function m(E,x,L){var O=y(E),C=0;C++;for(var F=0,M=0,B=!1,k=0;C<O.length;){F=0;do{if(C>=O.length)break;k=O[C++],F+=k}while(k===255);M=0;do{if(C>=O.length)break;k=O[C++],M+=k}while(k===255);var w=O.length-C;if(!B&&F===4&&C<O.length){B=!0;var U=O[C++];if(U===181){var N=f(O,C);if(C+=2,N===49){var K=p(O,C);if(C+=4,K===1195456820){var H=O[C++];if(H===3){var z=O[C++],G=31&z,q=64&z,Z=q?2+G*3:0,V=new Uint8Array(Z);if(q){V[0]=z;for(var X=1;X<Z;X++)V[X]=O[C++]}L.push({type:H,payloadType:F,pts:x,bytes:V})}}}}}else if(F===5&&M<w){if(B=!0,M>16){for(var J=[],re=0;re<16;re++){var ie=O[C++].toString(16);J.push(ie.length==1?"0"+ie:ie),(re===3||re===5||re===7||re===9)&&J.push("-")}for(var ne=M-16,ae=new Uint8Array(ne),ue=0;ue<ne;ue++)ae[ue]=O[C++];L.push({payloadType:F,pts:x,uuid:J.join(""),userData:Object(S.utf8ArrayToStr)(ae),userDataBytes:ae})}}else if(M<w)C+=M;else if(M>w)break}}function y(E){for(var x=E.byteLength,L=[],O=1;O<x-2;)E[O]===0&&E[O+1]===0&&E[O+2]===3?(L.push(O+2),O+=2):O++;if(L.length===0)return E;var C=x-L.length,F=new Uint8Array(C),M=0;for(O=0;O<C;M++,O++)M===L[0]&&(M++,L.shift()),F[O]=E[M];return F}function v(E){var x=E[0],L="",O="",C=0,F=0,M=0,B=0,k=0,w=0;if(x===0){for(;c(E.subarray(w,w+1))!=="\0";)L+=c(E.subarray(w,w+1)),w+=1;for(L+=c(E.subarray(w,w+1)),w+=1;c(E.subarray(w,w+1))!=="\0";)O+=c(E.subarray(w,w+1)),w+=1;O+=c(E.subarray(w,w+1)),w+=1,C=p(E,12),F=p(E,16),B=p(E,20),k=p(E,24),w=28}else if(x===1){w+=4,C=p(E,w),w+=4;var U=p(E,w);w+=4;var N=p(E,w);for(w+=4,M=Math.pow(2,32)*U+N,Number.isSafeInteger(M)||(M=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),B=p(E,w),w+=4,k=p(E,w),w+=4;c(E.subarray(w,w+1))!=="\0";)L+=c(E.subarray(w,w+1)),w+=1;for(L+=c(E.subarray(w,w+1)),w+=1;c(E.subarray(w,w+1))!=="\0";)O+=c(E.subarray(w,w+1)),w+=1;O+=c(E.subarray(w,w+1)),w+=1}var K=E.subarray(w,E.byteLength);return{schemeIdUri:L,value:O,timeScale:C,presentationTime:M,presentationTimeDelta:F,eventDuration:B,id:k,payload:K}}},"./src/utils/output-filter.ts":function(j,P,D){D.r(P),D.d(P,"default",function(){return A});var A=function(){function R(I,b){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=b}var S=R.prototype;return S.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},S.newCue=function(b,T,c){(this.startTime===null||this.startTime>b)&&(this.startTime=b),this.endTime=T,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},S.reset=function(){this.cueRanges=[],this.startTime=null},R}()},"./src/utils/texttrack-utils.ts":function(j,P,D){D.r(P),D.d(P,"sendAddTrackEvent",function(){return R}),D.d(P,"addCueToTrack",function(){return S}),D.d(P,"clearCurrentCues",function(){return I}),D.d(P,"removeCuesInRange",function(){return b}),D.d(P,"getCuesInRange",function(){return c});var A=D("./src/utils/logger.ts");function R(f,p){var l;try{l=new Event("addtrack")}catch{l=document.createEvent("Event"),l.initEvent("addtrack",!1,!1)}l.track=f,p.dispatchEvent(l)}function S(f,p){var l=f.mode;if(l==="disabled"&&(f.mode="hidden"),f.cues&&!f.cues.getCueById(p.id))try{if(f.addCue(p),!f.cues.getCueById(p.id))throw new Error("addCue is failed for: "+p)}catch(h){A.logger.debug("[texttrack-utils]: "+h);var d=new self.TextTrackCue(p.startTime,p.endTime,p.text);d.id=p.id,f.addCue(d)}l==="disabled"&&(f.mode=l)}function I(f){var p=f.mode;if(p==="disabled"&&(f.mode="hidden"),f.cues)for(var l=f.cues.length;l--;)f.removeCue(f.cues[l]);p==="disabled"&&(f.mode=p)}function b(f,p,l,d){var h=f.mode;if(h==="disabled"&&(f.mode="hidden"),f.cues&&f.cues.length>0)for(var n=c(f.cues,p,l),t=0;t<n.length;t++)(!d||d(n[t]))&&f.removeCue(n[t]);h==="disabled"&&(f.mode=h)}function T(f,p){if(p<f[0].startTime)return 0;var l=f.length-1;if(p>f[l].endTime)return-1;for(var d=0,h=l;d<=h;){var n=Math.floor((h+d)/2);if(p<f[n].startTime)h=n-1;else if(p>f[n].startTime&&d<l)d=n+1;else return n}return f[d].startTime-p<p-f[h].startTime?d:h}function c(f,p,l){var d=[],h=T(f,p);if(h>-1)for(var n=h,t=f.length;n<t;n++){var e=f[n];if(e.startTime>=p&&e.endTime<=l)d.push(e);else if(e.startTime>l)return d}return d}},"./src/utils/time-ranges.ts":function(j,P,D){D.r(P);var A={toString:function(S){for(var I="",b=S.length,T=0;T<b;T++)I+="["+S.start(T).toFixed(3)+","+S.end(T).toFixed(3)+"]";return I}};P.default=A},"./src/utils/timescale-conversion.ts":function(j,P,D){D.r(P),D.d(P,"toTimescaleFromBase",function(){return R}),D.d(P,"toTimescaleFromScale",function(){return S}),D.d(P,"toMsFromMpegTsClock",function(){return I}),D.d(P,"toMpegTsClockFromTimescale",function(){return b});var A=9e4;function R(T,c,f,p){f===void 0&&(f=1),p===void 0&&(p=!1);var l=T*c*f;return p?Math.round(l):l}function S(T,c,f,p){return f===void 0&&(f=1),p===void 0&&(p=!1),R(T,c,1/f,p)}function I(T,c){return c===void 0&&(c=!1),R(T,1e3,1/A,c)}function b(T,c){return c===void 0&&(c=1),R(T,A,1/c)}},"./src/utils/typed-array.ts":function(j,P,D){D.r(P),D.d(P,"sliceUint8",function(){return A});function A(R,S,I){return Uint8Array.prototype.slice?R.slice(S,I):new Uint8Array(Array.prototype.slice.call(R,S,I))}},"./src/utils/vttcue.ts":function(j,P,D){D.r(P),P.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],R=["start","middle","end","left","right"];function S(f,p){if(typeof p!="string"||!Array.isArray(f))return!1;var l=p.toLowerCase();return~f.indexOf(l)?l:!1}function I(f){return S(A,f)}function b(f){return S(R,f)}function T(f){for(var p=arguments.length,l=new Array(p>1?p-1:0),d=1;d<p;d++)l[d-1]=arguments[d];for(var h=1;h<arguments.length;h++){var n=arguments[h];for(var t in n)f[t]=n[t]}return f}function c(f,p,l){var d=this,h={enumerable:!0};d.hasBeenReset=!1;var n="",t=!1,e=f,i=p,r=l,o=null,s="",a=!0,u="auto",_="start",g=50,m="middle",y=50,v="middle";Object.defineProperty(d,"id",T({},h,{get:function(){return n},set:function(x){n=""+x}})),Object.defineProperty(d,"pauseOnExit",T({},h,{get:function(){return t},set:function(x){t=!!x}})),Object.defineProperty(d,"startTime",T({},h,{get:function(){return e},set:function(x){if(typeof x!="number")throw new TypeError("Start time must be set to a number.");e=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",T({},h,{get:function(){return i},set:function(x){if(typeof x!="number")throw new TypeError("End time must be set to a number.");i=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",T({},h,{get:function(){return r},set:function(x){r=""+x,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",T({},h,{get:function(){return o},set:function(x){o=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",T({},h,{get:function(){return s},set:function(x){var L=I(x);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=L,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",T({},h,{get:function(){return a},set:function(x){a=!!x,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",T({},h,{get:function(){return u},set:function(x){if(typeof x!="number"&&x!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");u=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",T({},h,{get:function(){return _},set:function(x){var L=b(x);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");_=L,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",T({},h,{get:function(){return g},set:function(x){if(x<0||x>100)throw new Error("Position must be between 0 and 100.");g=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",T({},h,{get:function(){return m},set:function(x){var L=b(x);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");m=L,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",T({},h,{get:function(){return y},set:function(x){if(x<0||x>100)throw new Error("Size must be between 0 and 100.");y=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",T({},h,{get:function(){return v},set:function(x){var L=b(x);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");v=L,this.hasBeenReset=!0}})),d.displayState=void 0}return c.prototype.getCueAsHTML=function(){var f=self.WebVTT;return f.convertCueToDOMTree(self,this.text)},c}()},"./src/utils/vttparser.ts":function(j,P,D){D.r(P),D.d(P,"parseTimeStamp",function(){return S}),D.d(P,"fixLineBreaks",function(){return p}),D.d(P,"VTTParser",function(){return l});var A=D("./src/utils/vttcue.ts"),R=function(){function d(){}var h=d.prototype;return h.decode=function(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},d}();function S(d){function h(t,e,i,r){return(t|0)*3600+(e|0)*60+(i|0)+parseFloat(r||0)}var n=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?h(n[2],n[3],0,n[4]):h(n[1],n[2],n[3],n[4]):null}var I=function(){function d(){this.values=Object.create(null)}var h=d.prototype;return h.set=function(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)},h.get=function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},h.has=function(t){return t in this.values},h.alt=function(t,e,i){for(var r=0;r<i.length;++r)if(e===i[r]){this.set(t,e);break}},h.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},h.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1},d}();function b(d,h,n,t){var e=t?d.split(t):[d];for(var i in e)if(typeof e[i]=="string"){var r=e[i].split(n);if(r.length===2){var o=r[0],s=r[1];h(o,s)}}}var T=new A.default(0,0,""),c=T.align==="middle"?"middle":"center";function f(d,h,n){var t=d;function e(){var o=S(d);if(o===null)throw new Error("Malformed timestamp: "+t);return d=d.replace(/^[^\sa-zA-Z-]+/,""),o}function i(o,s){var a=new I;b(o,function(g,m){var y;switch(g){case"region":for(var v=n.length-1;v>=0;v--)if(n[v].id===m){a.set(g,n[v].region);break}break;case"vertical":a.alt(g,m,["rl","lr"]);break;case"line":y=m.split(","),a.integer(g,y[0]),a.percent(g,y[0])&&a.set("snapToLines",!1),a.alt(g,y[0],["auto"]),y.length===2&&a.alt("lineAlign",y[1],["start",c,"end"]);break;case"position":y=m.split(","),a.percent(g,y[0]),y.length===2&&a.alt("positionAlign",y[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":a.percent(g,m);break;case"align":a.alt(g,m,["start",c,"end","left","right"]);break}},/:/,/\s/),s.region=a.get("region",null),s.vertical=a.get("vertical","");var u=a.get("line","auto");u==="auto"&&T.line===-1&&(u=-1),s.line=u,s.lineAlign=a.get("lineAlign","start"),s.snapToLines=a.get("snapToLines",!0),s.size=a.get("size",100),s.align=a.get("align",c);var _=a.get("position","auto");_==="auto"&&T.position===50&&(_=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=_}function r(){d=d.replace(/^\s+/,"")}if(r(),h.startTime=e(),r(),d.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);d=d.slice(3),r(),h.endTime=e(),r(),i(d,h)}function p(d){return d.replace(/<br(?: \/)?>/gi,`
`)}var l=function(){function d(){this.state="INITIAL",this.buffer="",this.decoder=new R,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var h=d.prototype;return h.parse=function(t){var e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){var _=e.buffer,g=0;for(_=p(_);g<_.length&&_[g]!=="\r"&&_[g]!==`
`;)++g;var m=_.slice(0,g);return _[g]==="\r"&&++g,_[g]===`
`&&++g,e.buffer=_.slice(g),m}function r(_){b(_,function(g,m){},/:/)}try{var o="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;o=i();var s=o.match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:o=i(),e.state){case"HEADER":/:/.test(o)?r(o):o||(e.state="ID");continue;case"NOTE":o||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(o)){e.state="NOTE";break}if(!o)continue;if(e.cue=new A.default(0,0,""),e.state="CUE",o.indexOf("-->")===-1){e.cue.id=o;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{f(o,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var u=o.indexOf("-->")!==-1;if(!o||u&&(a=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=o}continue;case"BADCUE":o||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},h.flush=function(){var t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},d}()},"./src/utils/webvtt-parser.ts":function(j,P,D){D.r(P),D.d(P,"generateCueId",function(){return l}),D.d(P,"parseWebVTT",function(){return h});var A=D("./src/polyfills/number.ts"),R=D("./src/utils/vttparser.ts"),S=D("./src/demux/id3.ts"),I=D("./src/utils/timescale-conversion.ts"),b=D("./src/remux/mp4-remuxer.ts"),T=/\r\n|\n\r|\n|\r/g,c=function(t,e,i){return i===void 0&&(i=0),t.slice(i,i+e.length)===e},f=function(t){var e=parseInt(t.slice(-3)),i=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),o=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!Object(A.isFiniteNumber)(e)||!Object(A.isFiniteNumber)(i)||!Object(A.isFiniteNumber)(r)||!Object(A.isFiniteNumber)(o))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*i,e+=60*1e3*r,e+=60*60*1e3*o,e},p=function(t){for(var e=5381,i=t.length;i;)e=e*33^t.charCodeAt(--i);return(e>>>0).toString()};function l(n,t,e){return p(n.toString())+p(t.toString())+p(e)}var d=function(t,e,i){var r=t[e],o=t[r.prevCC];if(!o||!o.new&&r.new){t.ccOffset=t.presentationOffset=r.start,r.new=!1;return}for(;(s=o)!==null&&s!==void 0&&s.new;){var s;t.ccOffset+=r.start-o.start,r.new=!1,r=o,o=t[r.prevCC]}t.presentationOffset=i};function h(n,t,e,i,r,o,s,a){var u=new R.VTTParser,_=Object(S.utf8ArrayToStr)(new Uint8Array(n)).trim().replace(T,`
`).split(`
`),g=[],m=Object(I.toMpegTsClockFromTimescale)(t,e),y="00:00.000",v=0,E=0,x,L=!0;u.oncue=function(O){var C=i[r],F=i.ccOffset,M=(v-m)/9e4;C!=null&&C.new&&(E!==void 0?F=i.ccOffset=C.start:d(i,r,M)),M&&(F=M-i.presentationOffset);var B=O.endTime-O.startTime,k=Object(b.normalizePts)((O.startTime+F-E)*9e4,o*9e4)/9e4;O.startTime=Math.max(k,0),O.endTime=Math.max(k+B,0);var w=O.text.trim();O.text=decodeURIComponent(encodeURIComponent(w)),O.id||(O.id=l(O.startTime,O.endTime,w)),O.endTime>0&&g.push(O)},u.onparsingerror=function(O){x=O},u.onflush=function(){if(x){a(x);return}s(g)},_.forEach(function(O){if(L)if(c(O,"X-TIMESTAMP-MAP=")){L=!1,O.slice(16).split(",").forEach(function(C){c(C,"LOCAL:")?y=C.slice(6):c(C,"MPEGTS:")&&(v=parseInt(C.slice(7)))});try{E=f(y)/1e3}catch(C){x=C}return}else O===""&&(L=!1);u.parse(O+`
`)}),u.flush()}},"./src/utils/xhr-loader.ts":function(j,P,D){D.r(P);var A=D("./src/utils/logger.ts"),R=D("./src/loader/load-stats.ts"),S=/^age:\s*[\d.]+\s*$/m,I=function(){function b(c){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=c?c.xhrSetup:null,this.stats=new R.LoadStats,this.retryDelay=0}var T=b.prototype;return T.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},T.abortInternal=function(){var f=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),f&&(f.onreadystatechange=null,f.onprogress=null,f.readyState!==4&&(this.stats.aborted=!0,f.abort()))},T.abort=function(){var f;this.abortInternal(),(f=this.callbacks)!==null&&f!==void 0&&f.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},T.load=function(f,p,l){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=f,this.config=p,this.callbacks=l,this.retryDelay=p.retryDelay,this.loadInternal()},T.loadInternal=function(){var f=this.config,p=this.context;if(!!f){var l=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0;var h=this.xhrSetup;try{if(h)try{h(l,p.url)}catch{l.open("GET",p.url,!0),h(l,p.url)}l.readyState||l.open("GET",p.url,!0);var n=this.context.headers;if(n)for(var t in n)l.setRequestHeader(t,n[t])}catch(e){this.callbacks.onError({code:l.status,text:e.message},p,l);return}p.rangeEnd&&l.setRequestHeader("Range","bytes="+p.rangeStart+"-"+(p.rangeEnd-1)),l.onreadystatechange=this.readystatechange.bind(this),l.onprogress=this.loadprogress.bind(this),l.responseType=p.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),f.timeout),l.send()}},T.readystatechange=function(){var f=this.context,p=this.loader,l=this.stats;if(!(!f||!p)){var d=p.readyState,h=this.config;if(!l.aborted&&d>=2)if(self.clearTimeout(this.requestTimeout),l.loading.first===0&&(l.loading.first=Math.max(self.performance.now(),l.loading.start)),d===4){p.onreadystatechange=null,p.onprogress=null;var n=p.status;if(n>=200&&n<300){l.loading.end=Math.max(self.performance.now(),l.loading.first);var t,e;if(f.responseType==="arraybuffer"?(t=p.response,e=t.byteLength):(t=p.responseText,e=t.length),l.loaded=l.total=e,!this.callbacks)return;var i=this.callbacks.onProgress;if(i&&i(l,f,t,p),!this.callbacks)return;var r={url:p.responseURL,data:t};this.callbacks.onSuccess(r,l,f,p)}else l.retry>=h.maxRetry||n>=400&&n<499?(A.logger.error(n+" while loading "+f.url),this.callbacks.onError({code:n,text:p.statusText},f,p)):(A.logger.warn(n+" while loading "+f.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),l.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),h.timeout)}},T.loadtimeout=function(){A.logger.warn("timeout while loading "+this.context.url);var f=this.callbacks;f&&(this.abortInternal(),f.onTimeout(this.stats,this.context,this.loader))},T.loadprogress=function(f){var p=this.stats;p.loaded=f.loaded,f.lengthComputable&&(p.total=f.total)},T.getCacheAge=function(){var f=null;if(this.loader&&S.test(this.loader.getAllResponseHeaders())){var p=this.loader.getResponseHeader("age");f=p?parseFloat(p):null}return f},b}();P.default=I}}).default})})(Ye);const Rt=Ue(Ye.exports),bt=ct("<span></span>"),jt=()=>{var f,p,l;if(localStorage.getItem("watermarkUsername")==null){tt("");return}const{pathname:ye,searchParams:_e}=rt(),{proxyLink:j}=it(),P=nt();let D=Ae.objs.filter(d=>d.type===gt.VIDEO);D.length===0&&(D=[Ae.obj]);const A=()=>{const d=D.findIndex(h=>h.name===Ae.obj.name);d<D.length-1&&P(vt(mt(location.pathname),D[d+1].name)+"?auto_fullscreen="+R.fullscreen)};let R,S={id:ye(),container:"#video-player",url:Ae.raw_url,title:Ae.obj.name,volume:.5,autoplay:at("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!1,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,layers:[{html:`<style>
                .watermark {
                  position: absolute;
                  top: 60%;
                  right: 35%;
                  color: white;
                }
                .watermark .sub-text {
                  font-size: 3em;
                  opacity: 0.3;
                  line-height: 1.2;
                }
                .watermark span {
                  display: block;
                }
                .watermark_logo {
                  position: absolute;
                  bottom: 5%;
                  right: 5%;
                  opacity: 0.7;
                  max-width: 25%;
                }
              </style>
              <div class="watermark_logo">
                <img src="https://img.fdtstudio.org/FDTPlayer_logo.png" alt="Watermark">
              </div>
              <div class="watermark">
                <span class="sub-text">\u7528\u6237: ${localStorage.getItem("watermarkUsername")}</span>
              </div>
              `}],controls:[{name:"next-button",index:11,position:"left",html:'<svg fill="none" stroke-width="2" xmlns="http://www.w3.org/2000/svg" height="22" width="22" class="icon icon-tabler icon-tabler-player-track-next-filled" width="1em" height="1em" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" style="overflow: visible; color: currentcolor;"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M2 5v14c0 .86 1.012 1.318 1.659 .753l8 -7a1 1 0 0 0 0 -1.506l-8 -7c-.647 -.565 -1.659 -.106 -1.659 .753z" stroke-width="0" fill="currentColor"></path><path d="M13 5v14c0 .86 1.012 1.318 1.659 .753l8 -7a1 1 0 0 0 0 -1.506l-8 -7c-.647 -.565 -1.659 -.106 -1.659 .753z" stroke-width="0" fill="currentColor"></path></svg>',tooltip:"Next",click:function(){A()}}],quality:[],plugins:[],whitelist:[],settings:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:Me(Ae.obj.name),customType:{flv:function(d,h){const n=Ot.createPlayer({type:"flv",url:h},{referrerPolicy:"same-origin"});n.attachMediaElement(d),n.load()},m3u8:function(d,h){const n=new Rt;n.loadSource(h),n.attachMedia(d),d.src||(d.src=h)},mpd:function(d,h){if(!window.MediaSource){console.error("MediaSource API is not available");return}const n=new MediaSource;d.src=URL.createObjectURL(n),n.addEventListener("sourceopen",t,{once:!0});function t(e){URL.revokeObjectURL(d.src);var i=e.target;const r=i.addSourceBuffer('video/mp4; codecs="avc1.64001f,mp4a.40.2"');fetch(h).then(function(o){if(o.body==null)throw new Error("Video is not found");return o.arrayBuffer()}).then(function(o){r.addEventListener("updateend",function(s){!r.updating&&i.readyState==="open"&&i.endOfStream()}),r.appendBuffer(new Uint8Array(o).map(s=>~s))}).catch(o=>{console.error("Error fetching video:",o)})}}},lang:["en","zh-cn","zh-tw"].includes(Ke().toLowerCase())?Ke().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const I=Ae.related.filter(d=>{for(const h of[".srt",".ass",".vtt"])if(d.name.endsWith(h))return!0;return!1}),b=Ae.related.find(d=>{for(const h of[".xml"])if(d.name.endsWith(h))return!0;return!1});if(I.length!=0){let t=function(e){switch(d?"ass":"webvtt"){case"ass":R.subtitle.show=!1,R.emit("artplayer-plugin-ass:visible",e);break;case"webvtt":default:R.subtitle.show=e,R.emit("artplayer-plugin-ass:visible",!1);break}},d=!1;const h=I[0];Me(h.name).toLowerCase()==="ass"?(d=!0,(f=S.plugins)==null||f.push(Dt({subUrl:j(h,!0)}))):S.subtitle={url:j(h,!0),type:Me(h.name)};const n=[{id:"setting_subtitle_display",html:"Display",tooltip:"Show",switch:!0,onSwitch:function(e){var r;e.tooltip=e.switch?"Hide":"Show",t(!e.switch);const i=(r=S.settings)==null?void 0:r.find(o=>o.id==="setting_subtitle");return i&&(i.tooltip=e.tooltip),!e.switch}}];I.forEach((e,i)=>{n.push({default:i===0,html:(()=>{const r=bt.cloneNode(!0);return r.style.setProperty("display","inline-block"),r.style.setProperty("max-width","15em"),r.style.setProperty("text-overflow","ellipsis"),r.style.setProperty("overflow","hidden"),st(r,()=>e.name),ot(()=>lt(r,"title",e.name)),r})(),name:e.name,url:j(e,!0)})}),(p=S.settings)==null||p.push({id:"setting_subtitle",html:"Subtitle",tooltip:"Show",icon:pt({size:24}),selector:n,onSelect:function(e){var r,o;Me(e.name).toLowerCase()==="ass"?(d=!0,this.emit("artplayer-plugin-ass:switch",e.url),t(!0)):(d=!1,this.subtitle.switch(e.url,{name:e.name}),this.once("subtitleLoad",t.bind(this,!0)));const i=n.find(s=>s.id==="setting_subtitle_display");return i&&!i.switch&&((o=(r=i.$html)==null?void 0:r.click)==null||o.call(r)),i==null?void 0:i.tooltip}})}b&&((l=S.plugins)==null||l.push(_t({danmuku:j(b,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"}))),ut(()=>{R=new Et(S);let d;switch(_e.auto_fullscreen){case"true":d=!0;case"false":d=!1;default:d=!1}console.log(d),R.on("ready",()=>{R.fullscreen=d}),R.on("video:ended",()=>{!T()||A()});let h=document.querySelector("#video-player > div"),n=document.querySelector("#video-player > div > div.art-layers");if(n!=null&&h!=null){const t=n.innerHTML,e=setInterval(()=>{if(document.querySelector("#video-player")!=null){let i=document.querySelector("#video-player > div > div.art-layers");if(i)i.innerHTML="",i.innerHTML=t;else{let r=document.createElement("div");r.className="art-layers",r.innerHTML=t}}else clearInterval(e)},1e3)}}),ft(()=>{R==null||R.destroy()});const[T,c]=dt();return We(yt,{onAutoNextChange:c,get children(){return We(ht,{w:"$full",h:"60vh",id:"video-player"})}})};export{jt as default};
