import{ap as N,bN as D,bO as $,av as V,H as G,h as e,Y as k,as as R,D as L,b as A,bI as f,bP as C,o as ne,af as j,b1 as _,bE as oe,bQ as re,bR as se,bS as ae,a as le,r as ie,d as h,bT as ce,aO as I,V as ue,bD as O,ac as ge,bC as de,S as v,I as T,bh as pe,bi as he,bj as fe,bk as me,bl as be,bm as we,bn as ve,t as Se,bo as _e,bp as $e,bq as Ce,bU as xe,aZ as ye,ab as ke,B,bc as Ie,bd as Oe,bV as Te,ai as Ge,bx as M,n as S,b2 as Re}from"./index.670bf9f1.js";import{p as Le,c as Ee}from"./index.2d31c317.js";import{s as Pe,g as Fe,a as Ue}from"./webauthn-json.browser-ponyfill.1c672167.js";const ze=V('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),Be=i=>{const u=N({startColor:"#28aff0",endColor:"#120fc4"},i);return(()=>{const n=ze.cloneNode(!0),c=n.firstChild,g=c.firstChild,r=g.nextSibling,s=r.firstChild,a=s.nextSibling;return D(t=>{const l=u.startColor,d=u.endColor;return l!==t._v$&&$(s,"stop-color",t._v$=l),d!==t._v$2&&$(a,"stop-color",t._v$2=d),t},{_v$:void 0,_v$2:void 0}),n})()},Me=V('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),Ne=i=>{const u=N({startColor:"#28aff0",endColor:"#120fc4"},i);return(()=>{const n=Me.cloneNode(!0),c=n.firstChild,g=c.firstChild,r=g.nextSibling,s=r.firstChild,a=s.nextSibling;return D(t=>{const l=u.startColor,d=u.endColor;return l!==t._v$&&$(s,"stop-color",t._v$=l),d!==t._v$2&&$(a,"stop-color",t._v$2=d),t},{_v$:void 0,_v$2:void 0}),n})()},De=()=>{const i=G("#a9c6ff","#062b74");return e(k,{get bgColor(){return i()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(k,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(Ne,{})}}),e(k,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Be,{})}})]}})},Ve=()=>{const i=R("sso_login_enabled"),u=L("sso_login_platform"),n=R("sso_compatibility_mode"),{searchParams:c,to:g}=A(),r=c.token;r!=null&&r!=""&&(f(r),g(decodeURIComponent(c.redirect||C||"/"),!0));function s(a){const t=a.data;t.token&&(f(t.token),g(decodeURIComponent(c.redirect||C||"/"),!0))}if(window.addEventListener("message",s),ne(()=>{window.removeEventListener("message",s)}),i){const a=()=>{const l=_.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=l;return}window.open(l,"authPopup","width=500,height=600")};let t;switch(u){case"Github":t=ae;break;case"Microsoft":t=Le;break;case"Google":t=se;break;case"Dingtalk":t=re;break;default:t=oe}return e(j,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:a})}},qe=()=>{const i=L("logo").split(`
`),u=G(i[0],i.pop()),n=le(),c=ie(()=>`${n("login.login_to")} ${L("site_title")}`);Ee(c);const g=G("white","$neutral1"),[r,s]=h(localStorage.getItem("username")||""),[a,t]=h(localStorage.getItem("password")||""),[l,d]=h(""),[E,P]=h(""),[m,H]=h(!1),[b,Z]=ce("remember-pwd","false"),[q,J]=I(async()=>_.post("/auth/login",{username:r(),password:a(),login_type:l(),otp_code:E()})),[,K]=I((o,p,w)=>_.post("/authn/webauthn_finish_login?username="+w,JSON.stringify(p),{headers:{session:o}})),[,W]=I(o=>_.get("/authn/webauthn_begin_login?username="+o)),{searchParams:F,to:U}=A(),Q=R("webauthn_login_enabled"),Y=async()=>{H(!m())},x=async()=>{if(m()){if(!Pe()){S.error(n("users.webauthn_not_supported"));return}f(),b()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const o=await W(r());Re(o,async p=>{const w=Fe(p.options),X=await Ue(w),ee=await K(p.session,X,r());M(ee,te=>{S.success(n("login.success")),f(te.token),U(decodeURIComponent(F.redirect||C||"/"),!0)})})}else{b()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",a()),localStorage.setItem("login_type",l())):(localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("login_type"));const o=await J();M(o,p=>{S.success(n("login.success")),localStorage.setItem("watermarkUsername",r()),f(p.token),U(decodeURIComponent(F.redirect||C||"/"),!0)},(p,w)=>{S.error(p)})}},[z,Ae]=h(!1),y=[{id:1,text:n("login.admin"),value:"admin"},{id:2,text:n("login.skunkgirl"),value:"skunkgirl"}];return d(y[1].value),e(Ge,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ue,{get bgColor(){return g()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(O,{alignItems:"center",justifyContent:"space-around",get children(){return[e(ge,{mr:"$2",boxSize:"$12",get src(){return u()}}),e(de,{color:"$info9",fontSize:"$2xl",get children(){return c()}})]}}),e(v,{get when(){return!z()},get fallback(){return e(T,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return E()},onInput:o=>P(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&x()}})},get children(){return[e(pe,{get defaultValue(){return y[1].value},onChange:d,get children(){return[e(he,{get children(){return[e(fe,{get children(){return n("login.select-tips")}}),e(me,{}),e(be,{})]}}),e(we,{get children(){return e(ve,{get children(){return e(Se,{each:y,children:o=>e(_e,{get value(){return o.value},get children(){return[e($e,{get children(){return o.text}}),e(Ce,{})]}})})}})}})]}}),e(T,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:o=>s(o.currentTarget.value)}),e(v,{get when(){return!m()},get children(){return e(T,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return a()},onInput:o=>t(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&x()}})}}),e(O,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(xe,{get checked(){return b()==="true"},onChange:()=>Z(b()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(ye,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),e(ke,{w:"$full",spacing:"$2",get children(){return[e(v,{get when(){return!m()},get children(){return e(B,{colorScheme:"primary",w:"$full",onClick:()=>{z()?P(""):(s(""),t(""))},get children(){return n("login.clear")}})}}),e(B,{w:"$full",get loading(){return q()},onClick:x,get children(){return n("login.login")}})]}}),e(O,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Ie,{}),e(Oe,{}),e(Ve,{}),e(v,{when:Q,get children(){return e(j,{cursor:"pointer",boxSize:"$8",as:Te,p:"$0_5",onclick:Y})}})]}})]}}),e(De,{})]}})};export{qe as default};
