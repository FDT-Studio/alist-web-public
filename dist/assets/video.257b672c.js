import{cb as Ie,bI as Me,b as De,W as Pe,cT as ke,Q as fe,as as Fe,c9 as xe,cQ as Le,au as Be,bN as Ue,bO as je,ax as Ne,o as We,d as Ge,h as Se,Y as Ke,av as Ve,p as ze,cU as He}from"./index.780fdb1a.js";import{O as Ye,A as Xe}from"./icon.6442a345.js";import{A as Je,V as Qe}from"./video_box.c66b1f70.js";import{H as Ze,a as $e}from"./hls.c5812fe7.js";import"./index.e9774819.js";import"./index.df62c6cd.js";import"./Layout.5b8989cc.js";import"./usePath.528710f7.js";import"./index.b0b6517a.js";import"./FolderTree.23e63a19.js";import"./index.6e9d40a6.js";var Ae={exports:{}};(function(re,ne){var X=function(G){var Y=!1;try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){const r=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));r instanceof WebAssembly.Module&&(Y=new WebAssembly.Instance(r)instanceof WebAssembly.Instance)}}catch{}console.log("WebAssembly support detected: "+(Y?"yes":"no"));var h=this;h.canvas=G.canvas,h.renderMode=G.renderMode||(G.lossyRender?"lossy":"wasm-blend"),h.libassMemoryLimit=G.libassMemoryLimit||0,h.libassGlyphLimit=G.libassGlyphLimit||0,h.targetFps=G.targetFps||24,h.prescaleFactor=G.prescaleFactor||1,h.prescaleHeightLimit=G.prescaleHeightLimit||1080,h.maxRenderHeight=G.maxRenderHeight||0,h.dropAllAnimations=G.dropAllAnimations||!1,h.isOurCanvas=!1,h.video=G.video,h.canvasParent=null,h.fonts=G.fonts||[],h.availableFonts=G.availableFonts||[],h.fallbackFont=G.fallbackFont||"default.woff2",h.lazyFileLoading=G.lazyFileLoading||!1,h.onReadyEvent=G.onReady,Y?h.workerUrl=G.workerUrl||"subtitles-octopus-worker.js":h.workerUrl=G.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",h.subUrl=G.subUrl,h.subContent=G.subContent||null,h.onErrorEvent=G.onError,h.debug=G.debug||!1,h.lastRenderTime=0,h.pixelRatio=window.devicePixelRatio||1,h.timeOffset=G.timeOffset||0,h.hasAlphaBug=!1,function(){if(typeof ImageData.prototype.constructor=="function")try{new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1);return}catch{console.log("detected that ImageData is not constructable despite browser saying so")}var r=document.createElement("canvas"),t=r.getContext("2d");window.ImageData=function(){var i=0;if(arguments[0]instanceof Uint8ClampedArray)var n=arguments[i++];var e=arguments[i++],u=arguments[i],_=t.createImageData(e,u);return n&&_.data.set(n),_}}(),h.workerError=function(r){if(console.error("Worker error: ",r),h.onErrorEvent&&h.onErrorEvent(r),!h.debug)throw h.dispose(),new Error("Worker error: "+r)},h.init=function(){if(!window.Worker){h.workerError("worker not supported");return}h.worker||(h.worker=new Worker(h.workerUrl),h.worker.addEventListener("message",h.onWorkerMessage),h.worker.addEventListener("error",h.workerError)),h.workerActive=!1,h.createCanvas(),h.setVideo(G.video),h.setSubUrl(G.subUrl),h.worker.postMessage({target:"worker-init",width:h.canvas.width,height:h.canvas.height,URL:document.URL,currentScript:h.workerUrl,preMain:!0,renderMode:h.renderMode,subUrl:h.subUrl,subContent:h.subContent,fonts:h.fonts,availableFonts:h.availableFonts,fallbackFont:h.fallbackFont,lazyFileLoading:h.lazyFileLoading,debug:h.debug,targetFps:h.targetFps,libassMemoryLimit:h.libassMemoryLimit,libassGlyphLimit:h.libassGlyphLimit,dropAllAnimations:h.dropAllAnimations})},h.createCanvas=function(){h.canvas||(h.video?(h.isOurCanvas=!0,h.canvas=document.createElement("canvas"),h.canvas.className="libassjs-canvas",h.canvas.style.display="none",h.canvasParent=document.createElement("div"),h.canvasParent.className="libassjs-canvas-parent",h.canvasParent.appendChild(h.canvas),h.video.nextSibling?h.video.parentNode.insertBefore(h.canvasParent,h.video.nextSibling):h.video.parentNode.appendChild(h.canvasParent)):h.canvas||h.workerError("Don't know where to render: you should give video or canvas in options.")),h.ctx=h.canvas.getContext("2d"),h.bufferCanvas=document.createElement("canvas"),h.bufferCanvasCtx=h.bufferCanvas.getContext("2d"),h.bufferCanvas.width=1,h.bufferCanvas.height=1;var r=new Uint8ClampedArray([0,255,0,0]),t=new ImageData(r,1,1);h.bufferCanvasCtx.clearRect(0,0,1,1),h.ctx.clearRect(0,0,1,1);var i=h.ctx.getImageData(0,0,1,1).data;h.bufferCanvasCtx.putImageData(t,0,0),h.ctx.drawImage(h.bufferCanvas,0,0);var n=h.ctx.getImageData(0,0,1,1).data;h.hasAlphaBug=i[1]!=n[1],h.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")};function w(){h.setCurrentTime(h.video.currentTime+h.timeOffset)}function L(){h.setIsPaused(!1,h.video.currentTime+h.timeOffset)}function m(){h.setIsPaused(!0,h.video.currentTime+h.timeOffset)}function y(){h.video.removeEventListener("timeupdate",w,!1)}function c(){h.video.addEventListener("timeupdate",w,!1);var r=h.video.currentTime+h.timeOffset;h.setCurrentTime(r)}function d(){h.setRate(h.video.playbackRate)}function o(){h.setIsPaused(!0,h.video.currentTime+h.timeOffset)}function f(r){r.target.removeEventListener(r.type,f,!1),h.resize()}h.setVideo=function(r){h.video=r,h.video&&(h.video.addEventListener("timeupdate",w,!1),h.video.addEventListener("playing",L,!1),h.video.addEventListener("pause",m,!1),h.video.addEventListener("seeking",y,!1),h.video.addEventListener("seeked",c,!1),h.video.addEventListener("ratechange",d,!1),h.video.addEventListener("waiting",o,!1),document.addEventListener("fullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",h.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",h.resizeWithTimeout,!1),window.addEventListener("resize",h.resizeWithTimeout,!1),typeof ResizeObserver<"u"&&(h.ro=new ResizeObserver(h.resizeWithTimeout),h.ro.observe(h.video)),h.video.videoWidth>0?h.resize():h.video.addEventListener("loadedmetadata",f,!1))},h.getVideoPosition=function(){var r=h.video.videoWidth/h.video.videoHeight,t=h.video.offsetWidth,i=h.video.offsetHeight,n=t/i,e=t,u=i;n>r?e=Math.floor(i*r):u=Math.floor(t/r);var _=(t-e)/2,p=(i-u)/2;return{width:e,height:u,x:_,y:p}},h.setSubUrl=function(r){h.subUrl=r},h.renderFrameData=null;function s(){var r=h.renderFramesData,t=performance.now();h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height);for(var i=0;i<r.canvases.length;i++){var n=r.canvases[i];h.bufferCanvas.width=n.w,h.bufferCanvas.height=n.h;var e=new Uint8ClampedArray(n.buffer);if(h.hasAlphaBug)for(var u=3;u<e.length;u=u+4)e[u]=e[u]>=1?e[u]:1;var _=new ImageData(e,n.w,n.h);h.bufferCanvasCtx.putImageData(_,0,0),h.ctx.drawImage(h.bufferCanvas,n.x,n.y)}if(h.debug){var p=Math.round(performance.now()-t),g=r.blendTime;console.log(typeof g<"u"?"render: "+Math.round(r.spentTime-g)+" ms, blend: "+Math.round(g)+" ms, draw: "+p+" ms; TOTAL="+Math.round(r.spentTime+p)+" ms":Math.round(r.spentTime)+" ms (+ "+p+" ms draw)"),h.renderStart=performance.now()}}function a(){var r=h.renderFramesData,t=performance.now();h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height);for(var i=0;i<r.bitmaps.length;i++){var n=r.bitmaps[i];h.ctx.drawImage(n.bitmap,n.x,n.y)}if(h.debug){var e=Math.round(performance.now()-t);console.log(r.bitmaps.length+" bitmaps, libass: "+Math.round(r.libassTime)+"ms, decode: "+Math.round(r.decodeTime)+"ms, draw: "+e+"ms"),h.renderStart=performance.now()}}h.workerActive=!1,h.frameId=0,h.onWorkerMessage=function(r){h.workerActive||(h.workerActive=!0,h.onReadyEvent&&h.onReadyEvent());var t=r.data;switch(t.target){case"stdout":{console.log(t.content);break}case"console-log":{console.log.apply(console,JSON.parse(t.content));break}case"console-debug":{console.debug.apply(console,JSON.parse(t.content));break}case"console-info":{console.info.apply(console,JSON.parse(t.content));break}case"console-warn":{console.warn.apply(console,JSON.parse(t.content));break}case"console-error":{console.error.apply(console,JSON.parse(t.content));break}case"stderr":{console.error(t.content);break}case"window":{window[t.method]();break}case"canvas":{switch(t.op){case"getContext":{h.ctx=h.canvas.getContext(t.type,t.attributes);break}case"resize":{h.resize(t.width,t.height);break}case"renderCanvas":{h.lastRenderTime<t.time&&(h.lastRenderTime=t.time,h.renderFramesData=t,window.requestAnimationFrame(s));break}case"renderFastCanvas":{h.lastRenderTime<t.time&&(h.lastRenderTime=t.time,h.renderFramesData=t,window.requestAnimationFrame(a));break}case"setObjectProperty":{h.canvas[t.object][t.property]=t.value;break}default:throw"eh?"}break}case"tick":{h.frameId=t.id,h.worker.postMessage({target:"tock",id:h.frameId});break}case"custom":{if(h.onCustomMessage)h.onCustomMessage(r);else throw"Custom message received but client onCustomMessage not implemented.";break}case"setimmediate":{h.worker.postMessage({target:"setimmediate"});break}case"get-events":break;case"get-styles":break;case"ready":break;default:throw"what? "+t.target}};function l(r,t){var i=h.prescaleFactor<=0?1:h.prescaleFactor;if(t<=0||r<=0)r=0,t=0;else{var n=i<1?-1:1,e=t;n*e*i<=n*h.prescaleHeightLimit?e*=i:n*e<n*h.prescaleHeightLimit&&(e=h.prescaleHeightLimit),h.maxRenderHeight>0&&e>h.maxRenderHeight&&(e=h.maxRenderHeight),r*=e/t,t=e}return{width:r,height:t}}h.resize=function(r,t,i,n){var e=null;if(i=i||0,n=n||0,(!r||!t)&&h.video){e=h.getVideoPosition();var u=l(e.width*h.pixelRatio,e.height*h.pixelRatio);r=u.width,t=u.height;var _=h.canvasParent.getBoundingClientRect().top-h.video.getBoundingClientRect().top;i=e.y-_,n=e.x}if(!r||!t){h.video||console.error("width or height is 0. You should specify width & height for resize.");return}(h.canvas.width!=r||h.canvas.height!=t||h.canvas.style.top!=i||h.canvas.style.left!=n)&&(h.canvas.width=r,h.canvas.height=t,e!=null&&(h.canvasParent.style.position="relative",h.canvas.style.display="block",h.canvas.style.position="absolute",h.canvas.style.width=e.width+"px",h.canvas.style.height=e.height+"px",h.canvas.style.top=i+"px",h.canvas.style.left=n+"px",h.canvas.style.pointerEvents="none"),h.worker.postMessage({target:"canvas",width:h.canvas.width,height:h.canvas.height}))},h.resizeWithTimeout=function(){h.resize(),setTimeout(h.resize,100)},h.runBenchmark=function(){h.worker.postMessage({target:"runBenchmark"})},h.customMessage=function(r,t){t=t||{},h.worker.postMessage({target:"custom",userData:r,preMain:t.preMain})},h.setCurrentTime=function(r){h.worker.postMessage({target:"video",currentTime:r})},h.setTrackByUrl=function(r){h.worker.postMessage({target:"set-track-by-url",url:r})},h.setTrack=function(r){h.worker.postMessage({target:"set-track",content:r})},h.freeTrack=function(r){h.worker.postMessage({target:"free-track"})},h.render=h.setCurrentTime,h.setIsPaused=function(r,t){h.worker.postMessage({target:"video",isPaused:r,currentTime:t})},h.setRate=function(r){h.worker.postMessage({target:"video",rate:r})},h.dispose=function(){h.worker.postMessage({target:"destroy"}),h.worker.terminate(),h.worker.removeEventListener("message",h.onWorkerMessage),h.worker.removeEventListener("error",h.workerError),h.workerActive=!1,h.worker=null,h.video&&(h.video.removeEventListener("timeupdate",w,!1),h.video.removeEventListener("playing",L,!1),h.video.removeEventListener("pause",m,!1),h.video.removeEventListener("seeking",y,!1),h.video.removeEventListener("seeked",c,!1),h.video.removeEventListener("ratechange",d,!1),h.video.removeEventListener("waiting",o,!1),h.video.removeEventListener("loadedmetadata",f,!1),document.removeEventListener("fullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",h.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",h.resizeWithTimeout,!1),window.removeEventListener("resize",h.resizeWithTimeout,!1),h.video.parentNode.removeChild(h.canvasParent),h.video=null),h.ro&&(h.ro.disconnect(),h.ro=null),h.onCustomMessage=null,h.onErrorEvent=null,h.onReadyEvent=null},h.fetchFromWorker=function(r,t,i){try{var n=r.target,e=setTimeout(function(){_(Error("Error: Timeout while try to fetch "+n))},5e3),u=function(p){p.data.target==n&&(t(p.data),h.worker.removeEventListener("message",u),h.worker.removeEventListener("error",_),clearTimeout(e))},_=function(p){i(p),h.worker.removeEventListener("message",u),h.worker.removeEventListener("error",_),clearTimeout(e)};h.worker.addEventListener("message",u),h.worker.addEventListener("error",_),h.worker.postMessage(r)}catch(p){i(p)}},h.createEvent=function(r){h.worker.postMessage({target:"create-event",event:r})},h.getEvents=function(r,t){h.fetchFromWorker({target:"get-events"},function(i){r(i.events)},t)},h.setEvent=function(r,t){h.worker.postMessage({target:"set-event",event:r,index:t})},h.removeEvent=function(r){h.worker.postMessage({target:"remove-event",index:r})},h.createStyle=function(r){h.worker.postMessage({target:"create-style",style:r})},h.getStyles=function(r,t){h.fetchFromWorker({target:"get-styles"},function(i){r(i.styles)},t)},h.setStyle=function(r,t){h.worker.postMessage({target:"set-style",style:r,index:t})},h.removeStyle=function(r){h.worker.postMessage({target:"remove-style",index:r})},h.init()};typeof SubtitlesOctopusOnLoad=="function"&&SubtitlesOctopusOnLoad(),re.exports&&(re.exports=X)})(Ae);const qe=Ae.exports,et= window.__dynamic_base__+"/assets/subtitles-octopus-worker-legacy.b6ac3ec1.js",tt= window.__dynamic_base__+"/assets/subtitles-octopus-worker.f95f2186.js",rt= window.__dynamic_base__+"/assets/TimesNewRoman.d9fb32eb.ttf",nt= window.__dynamic_base__+"/assets/SourceHanSansCN-Bold.b5627435.woff2";let oe=null;function be(re){oe.canvasParent&&(oe.canvasParent.style.display=re?"block":"none")}function it(re){return ne=>(oe=new qe({availableFonts:{"times new roman":rt},fallbackFont:nt,legacyWorkerUrl:et,workerUrl:tt,video:ne.template.$video,...re}),oe.canvasParent.className="artplayer-plugin-ass",oe.canvasParent.style.cssText=`
      position: absolute;
      width: 100%;
      height: 100%;
      user-select: none;
      pointer-events: none;
      z-index: 20;
    `,ne.on("artplayer-plugin-ass:switch",X=>{oe.freeTrack(),oe.setTrackByUrl(X),be(!0)}),ne.on("subtitle",X=>be(X)),ne.on("artplayer-plugin-ass:visible",X=>be(X)),ne.on("subtitleOffset",X=>oe.timeOffset=X),ne.on("destroy",()=>oe.dispose()),{name:"artplayerPluginAss",instance:oe})}var Re={exports:{}};(function(re,ne){(function(G,Y){re.exports=Y()})(self,function(){return function(){var X={"./node_modules/es6-promise/dist/es6-promise.js":function(w,L,m){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(y,c){w.exports=c()})(this,function(){function y(A){var C=typeof A;return A!==null&&(C==="object"||C==="function")}function c(A){return typeof A=="function"}var d=void 0;Array.isArray?d=Array.isArray:d=function(A){return Object.prototype.toString.call(A)==="[object Array]"};var o=d,f=0,s=void 0,a=void 0,l=function(C,T){x[f]=C,x[f+1]=T,f+=2,f===2&&(a?a(S):R())};function r(A){a=A}function t(A){l=A}var i=typeof window<"u"?window:void 0,n=i||{},e=n.MutationObserver||n.WebKitMutationObserver,u=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",_=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function p(){return function(){return process.nextTick(S)}}function g(){return typeof s<"u"?function(){s(S)}:v()}function b(){var A=0,C=new e(S),T=document.createTextNode("");return C.observe(T,{characterData:!0}),function(){T.data=A=++A%2}}function E(){var A=new MessageChannel;return A.port1.onmessage=S,function(){return A.port2.postMessage(0)}}function v(){var A=setTimeout;return function(){return A(S,1)}}var x=new Array(1e3);function S(){for(var A=0;A<f;A+=2){var C=x[A],T=x[A+1];C(T),x[A]=void 0,x[A+1]=void 0}f=0}function O(){try{var A=Function("return this")().require("vertx");return s=A.runOnLoop||A.runOnContext,g()}catch{return v()}}var R=void 0;u?R=p():e?R=b():_?R=E():i===void 0?R=O():R=v();function I(A,C){var T=this,M=new this.constructor(k);M[U]===void 0&&_e(M);var F=T._state;if(F){var j=arguments[F-1];l(function(){return he(F,M,j,T._result)})}else q(T,M,A,C);return M}function B(A){var C=this;if(A&&typeof A=="object"&&A.constructor===C)return A;var T=new C(k);return $(T,A),T}var U=Math.random().toString(36).substring(2);function k(){}var N=void 0,V=1,P=2;function W(){return new TypeError("You cannot resolve a promise with itself")}function ie(){return new TypeError("A promises callback cannot return that same promise.")}function K(A,C,T,M){try{A.call(C,T,M)}catch(F){return F}}function z(A,C,T){l(function(M){var F=!1,j=K(T,C,function(J){F||(F=!0,C!==J?$(M,J):H(M,J))},function(J){F||(F=!0,D(M,J))},"Settle: "+(M._label||" unknown promise"));!F&&j&&(F=!0,D(M,j))},A)}function ee(A,C){C._state===V?H(A,C._result):C._state===P?D(A,C._result):q(C,void 0,function(T){return $(A,T)},function(T){return D(A,T)})}function Q(A,C,T){C.constructor===A.constructor&&T===I&&C.constructor.resolve===B?ee(A,C):T===void 0?H(A,C):c(T)?z(A,C,T):H(A,C)}function $(A,C){if(A===C)D(A,W());else if(y(C)){var T=void 0;try{T=C.then}catch(M){D(A,M);return}Q(A,C,T)}else H(A,C)}function ue(A){A._onerror&&A._onerror(A._result),se(A)}function H(A,C){A._state===N&&(A._result=C,A._state=V,A._subscribers.length!==0&&l(se,A))}function D(A,C){A._state===N&&(A._state=P,A._result=C,l(ue,A))}function q(A,C,T,M){var F=A._subscribers,j=F.length;A._onerror=null,F[j]=C,F[j+V]=T,F[j+P]=M,j===0&&A._state&&l(se,A)}function se(A){var C=A._subscribers,T=A._state;if(C.length!==0){for(var M=void 0,F=void 0,j=A._result,J=0;J<C.length;J+=3)M=C[J],F=C[J+T],M?he(T,M,F,j):F(j);A._subscribers.length=0}}function he(A,C,T,M){var F=c(T),j=void 0,J=void 0,pe=!0;if(F){try{j=T(M)}catch(ge){pe=!1,J=ge}if(C===j){D(C,ie());return}}else j=M;C._state!==N||(F&&pe?$(C,j):pe===!1?D(C,J):A===V?H(C,j):A===P&&D(C,j))}function le(A,C){try{C(function(M){$(A,M)},function(M){D(A,M)})}catch(T){D(A,T)}}var de=0;function ce(){return de++}function _e(A){A[U]=de++,A._state=void 0,A._result=void 0,A._subscribers=[]}function ae(){return new Error("Array Methods must be provided an Array")}var te=function(){function A(C,T){this._instanceConstructor=C,this.promise=new C(k),this.promise[U]||_e(this.promise),o(T)?(this.length=T.length,this._remaining=T.length,this._result=new Array(this.length),this.length===0?H(this.promise,this._result):(this.length=this.length||0,this._enumerate(T),this._remaining===0&&H(this.promise,this._result))):D(this.promise,ae())}return A.prototype._enumerate=function(T){for(var M=0;this._state===N&&M<T.length;M++)this._eachEntry(T[M],M)},A.prototype._eachEntry=function(T,M){var F=this._instanceConstructor,j=F.resolve;if(j===B){var J=void 0,pe=void 0,ge=!1;try{J=T.then}catch(ye){ge=!0,pe=ye}if(J===I&&T._state!==N)this._settledAt(T._state,M,T._result);else if(typeof J!="function")this._remaining--,this._result[M]=T;else if(F===Z){var Ee=new F(k);ge?D(Ee,pe):Q(Ee,T,J),this._willSettleAt(Ee,M)}else this._willSettleAt(new F(function(ye){return ye(T)}),M)}else this._willSettleAt(j(T),M)},A.prototype._settledAt=function(T,M,F){var j=this.promise;j._state===N&&(this._remaining--,T===P?D(j,F):this._result[M]=F),this._remaining===0&&H(j,this._result)},A.prototype._willSettleAt=function(T,M){var F=this;q(T,void 0,function(j){return F._settledAt(V,M,j)},function(j){return F._settledAt(P,M,j)})},A}();function me(A){return new te(this,A).promise}function ve(A){var C=this;return o(A)?new C(function(T,M){for(var F=A.length,j=0;j<F;j++)C.resolve(A[j]).then(T,M)}):new C(function(T,M){return M(new TypeError("You must pass an array to race."))})}function Oe(A){var C=this,T=new C(k);return D(T,A),T}function we(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Ce(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Z=function(){function A(C){this[U]=ce(),this._result=this._state=void 0,this._subscribers=[],k!==C&&(typeof C!="function"&&we(),this instanceof A?le(this,C):Ce())}return A.prototype.catch=function(T){return this.then(null,T)},A.prototype.finally=function(T){var M=this,F=M.constructor;return c(T)?M.then(function(j){return F.resolve(T()).then(function(){return j})},function(j){return F.resolve(T()).then(function(){throw j})}):M.then(T,T)},A}();Z.prototype.then=I,Z.all=me,Z.race=ve,Z.resolve=B,Z.reject=Oe,Z._setScheduler=r,Z._setAsap=t,Z._asap=l;function Te(){var A=void 0;if(typeof m.g<"u")A=m.g;else if(typeof self<"u")A=self;else try{A=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var C=A.Promise;if(C){var T=null;try{T=Object.prototype.toString.call(C.resolve())}catch{}if(T==="[object Promise]"&&!C.cast)return}A.Promise=Z}return Z.polyfill=Te,Z.Promise=Z,Z})},"./node_modules/events/events.js":function(w){var L=typeof Reflect=="object"?Reflect:null,m=L&&typeof L.apply=="function"?L.apply:function(v,x,S){return Function.prototype.apply.call(v,x,S)},y;L&&typeof L.ownKeys=="function"?y=L.ownKeys:Object.getOwnPropertySymbols?y=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:y=function(v){return Object.getOwnPropertyNames(v)};function c(E){console&&console.warn&&console.warn(E)}var d=Number.isNaN||function(v){return v!==v};function o(){o.init.call(this)}w.exports=o,w.exports.once=p,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var f=10;function s(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(E){if(typeof E!="number"||E<0||d(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");f=E}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||d(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function a(E){return E._maxListeners===void 0?o.defaultMaxListeners:E._maxListeners}o.prototype.getMaxListeners=function(){return a(this)},o.prototype.emit=function(v){for(var x=[],S=1;S<arguments.length;S++)x.push(arguments[S]);var O=v==="error",R=this._events;if(R!==void 0)O=O&&R.error===void 0;else if(!O)return!1;if(O){var I;if(x.length>0&&(I=x[0]),I instanceof Error)throw I;var B=new Error("Unhandled error."+(I?" ("+I.message+")":""));throw B.context=I,B}var U=R[v];if(U===void 0)return!1;if(typeof U=="function")m(U,this,x);else for(var k=U.length,N=e(U,k),S=0;S<k;++S)m(N[S],this,x);return!0};function l(E,v,x,S){var O,R,I;if(s(x),R=E._events,R===void 0?(R=E._events=Object.create(null),E._eventsCount=0):(R.newListener!==void 0&&(E.emit("newListener",v,x.listener?x.listener:x),R=E._events),I=R[v]),I===void 0)I=R[v]=x,++E._eventsCount;else if(typeof I=="function"?I=R[v]=S?[x,I]:[I,x]:S?I.unshift(x):I.push(x),O=a(E),O>0&&I.length>O&&!I.warned){I.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=E,B.type=v,B.count=I.length,c(B)}return E}o.prototype.addListener=function(v,x){return l(this,v,x,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(v,x){return l(this,v,x,!0)};function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(E,v,x){var S={fired:!1,wrapFn:void 0,target:E,type:v,listener:x},O=r.bind(S);return O.listener=x,S.wrapFn=O,O}o.prototype.once=function(v,x){return s(x),this.on(v,t(this,v,x)),this},o.prototype.prependOnceListener=function(v,x){return s(x),this.prependListener(v,t(this,v,x)),this},o.prototype.removeListener=function(v,x){var S,O,R,I,B;if(s(x),O=this._events,O===void 0)return this;if(S=O[v],S===void 0)return this;if(S===x||S.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete O[v],O.removeListener&&this.emit("removeListener",v,S.listener||x));else if(typeof S!="function"){for(R=-1,I=S.length-1;I>=0;I--)if(S[I]===x||S[I].listener===x){B=S[I].listener,R=I;break}if(R<0)return this;R===0?S.shift():u(S,R),S.length===1&&(O[v]=S[0]),O.removeListener!==void 0&&this.emit("removeListener",v,B||x)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(v){var x,S,O;if(S=this._events,S===void 0)return this;if(S.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):S[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete S[v]),this;if(arguments.length===0){var R=Object.keys(S),I;for(O=0;O<R.length;++O)I=R[O],I!=="removeListener"&&this.removeAllListeners(I);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=S[v],typeof x=="function")this.removeListener(v,x);else if(x!==void 0)for(O=x.length-1;O>=0;O--)this.removeListener(v,x[O]);return this};function i(E,v,x){var S=E._events;if(S===void 0)return[];var O=S[v];return O===void 0?[]:typeof O=="function"?x?[O.listener||O]:[O]:x?_(O):e(O,O.length)}o.prototype.listeners=function(v){return i(this,v,!0)},o.prototype.rawListeners=function(v){return i(this,v,!1)},o.listenerCount=function(E,v){return typeof E.listenerCount=="function"?E.listenerCount(v):n.call(E,v)},o.prototype.listenerCount=n;function n(E){var v=this._events;if(v!==void 0){var x=v[E];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]};function e(E,v){for(var x=new Array(v),S=0;S<v;++S)x[S]=E[S];return x}function u(E,v){for(;v+1<E.length;v++)E[v]=E[v+1];E.pop()}function _(E){for(var v=new Array(E.length),x=0;x<v.length;++x)v[x]=E[x].listener||E[x];return v}function p(E,v){return new Promise(function(x,S){function O(I){E.removeListener(v,R),S(I)}function R(){typeof E.removeListener=="function"&&E.removeListener("error",O),x([].slice.call(arguments))}b(E,v,R,{once:!0}),v!=="error"&&g(E,O,{once:!0})})}function g(E,v,x){typeof E.on=="function"&&b(E,"error",v,x)}function b(E,v,x,S){if(typeof E.on=="function")S.once?E.once(v,x):E.on(v,x);else if(typeof E.addEventListener=="function")E.addEventListener(v,function O(R){S.once&&E.removeEventListener(v,O),x(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}},"./node_modules/webworkify-webpack/index.js":function(w,L,m){function y(r){var t={};function i(e){if(t[e])return t[e].exports;var u=t[e]={i:e,l:!1,exports:{}};return r[e].call(u.exports,u,u.exports,i),u.l=!0,u.exports}i.m=r,i.c=t,i.i=function(e){return e},i.d=function(e,u,_){i.o(e,u)||Object.defineProperty(e,u,{configurable:!1,enumerable:!0,get:_})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var u=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(u,"a",u),u},i.o=function(e,u){return Object.prototype.hasOwnProperty.call(e,u)},i.p="/",i.oe=function(e){throw console.error(e),e};var n=i(i.s=ENTRY_MODULE);return n.default||n}var c="[\\.|\\-|\\+|\\w|/|@]+",d="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+c+").*?\\)";function o(r){return(r+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(r){return!isNaN(1*r)}function s(r,t,i){var n={};n[i]=[];var e=t.toString(),u=e.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return n;for(var _=u[1],p=new RegExp("(\\\\n|\\W)"+o(_)+d,"g"),g;g=p.exec(e);)g[3]!=="dll-reference"&&n[i].push(g[3]);for(p=new RegExp("\\("+o(_)+'\\("(dll-reference\\s('+c+'))"\\)\\)'+d,"g");g=p.exec(e);)r[g[2]]||(n[i].push(g[1]),r[g[2]]=m(g[1]).m),n[g[2]]=n[g[2]]||[],n[g[2]].push(g[4]);for(var b=Object.keys(n),E=0;E<b.length;E++)for(var v=0;v<n[b[E]].length;v++)f(n[b[E]][v])&&(n[b[E]][v]=1*n[b[E]][v]);return n}function a(r){var t=Object.keys(r);return t.reduce(function(i,n){return i||r[n].length>0},!1)}function l(r,t){for(var i={main:[t]},n={main:[]},e={main:{}};a(i);)for(var u=Object.keys(i),_=0;_<u.length;_++){var p=u[_],g=i[p],b=g.pop();if(e[p]=e[p]||{},!(e[p][b]||!r[p][b])){e[p][b]=!0,n[p]=n[p]||[],n[p].push(b);for(var E=s(r,r[p][b],p),v=Object.keys(E),x=0;x<v.length;x++)i[v[x]]=i[v[x]]||[],i[v[x]]=i[v[x]].concat(E[v[x]])}}return n}w.exports=function(r,t){t=t||{};var i={main:m.m},n=t.all?{main:Object.keys(i.main)}:l(i,r),e="";Object.keys(n).filter(function(b){return b!=="main"}).forEach(function(b){for(var E=0;n[b][E];)E++;n[b].push(E),i[b][E]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",e=e+"var "+b+" = ("+y.toString().replace("ENTRY_MODULE",JSON.stringify(E))+")({"+n[b].map(function(v){return""+JSON.stringify(v)+": "+i[b][v].toString()}).join(",")+`});
`}),e=e+"new (("+y.toString().replace("ENTRY_MODULE",JSON.stringify(r))+")({"+n.main.map(function(b){return""+JSON.stringify(b)+": "+i.main[b].toString()}).join(",")+"}))(self);";var u=new window.Blob([e],{type:"text/javascript"});if(t.bare)return u;var _=window.URL||window.webkitURL||window.mozURL||window.msURL,p=_.createObjectURL(u),g=new window.Worker(p);return g.objectURL=p,g}},"./src/config.js":function(w,L,m){m.r(L),m.d(L,{defaultConfig:function(){return y},createDefaultConfig:function(){return c}});var y={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function c(){return Object.assign({},y)}},"./src/core/features.js":function(w,L,m){m.r(L);var y=m("./src/io/io-controller.js"),c=m("./src/config.js"),d=function(){function o(){}return o.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},o.supportNetworkStreamIO=function(){var f=new y.default({},(0,c.createDefaultConfig)()),s=f.loaderType;return f.destroy(),s=="fetch-stream-loader"||s=="xhr-moz-chunked-loader"},o.getNetworkLoaderTypeName=function(){var f=new y.default({},(0,c.createDefaultConfig)()),s=f.loaderType;return f.destroy(),s},o.supportNativeMediaPlayback=function(f){o.videoElement==null&&(o.videoElement=window.document.createElement("video"));var s=o.videoElement.canPlayType(f);return s==="probably"||s=="maybe"},o.getFeatureList=function(){var f={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return f.mseFlvPlayback=o.supportMSEH264Playback(),f.networkStreamIO=o.supportNetworkStreamIO(),f.networkLoaderName=o.getNetworkLoaderTypeName(),f.mseLiveFlvPlayback=f.mseFlvPlayback&&f.networkStreamIO,f.nativeMP4H264Playback=o.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),f.nativeWebmVP8Playback=o.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),f.nativeWebmVP9Playback=o.supportNativeMediaPlayback('video/webm; codecs="vp9"'),f},o}();L.default=d},"./src/core/media-info.js":function(w,L,m){m.r(L);var y=function(){function c(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return c.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,o=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&d&&o},c.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},c.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var o=this.keyframesIndex,f=this._search(o.times,d);return{index:f,milliseconds:o.times[f],fileposition:o.filepositions[f]}},c.prototype._search=function(d,o){var f=0,s=d.length-1,a=0,l=0,r=s;for(o<d[0]&&(f=0,l=r+1);l<=r;)if(a=l+Math.floor((r-l)/2),a===s||o>=d[a]&&o<d[a+1]){f=a;break}else d[a]<o?l=a+1:r=a-1;return f},c}();L.default=y},"./src/core/media-segment-info.js":function(w,L,m){m.r(L),m.d(L,{SampleInfo:function(){return y},MediaSegmentInfo:function(){return c},IDRSampleList:function(){return d},MediaSegmentInfoList:function(){return o}});var y=function(){function f(s,a,l,r,t){this.dts=s,this.pts=a,this.duration=l,this.originalDts=r,this.isSyncPoint=t,this.fileposition=null}return f}(),c=function(){function f(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return f.prototype.appendSyncPoint=function(s){s.isSyncPoint=!0,this.syncPoints.push(s)},f}(),d=function(){function f(){this._list=[]}return f.prototype.clear=function(){this._list=[]},f.prototype.appendArray=function(s){var a=this._list;s.length!==0&&(a.length>0&&s[0].originalDts<a[a.length-1].originalDts&&this.clear(),Array.prototype.push.apply(a,s))},f.prototype.getLastSyncPointBeforeDts=function(s){if(this._list.length==0)return null;var a=this._list,l=0,r=a.length-1,t=0,i=0,n=r;for(s<a[0].dts&&(l=0,i=n+1);i<=n;)if(t=i+Math.floor((n-i)/2),t===r||s>=a[t].dts&&s<a[t+1].dts){l=t;break}else a[t].dts<s?i=t+1:n=t-1;return this._list[l]},f}(),o=function(){function f(s){this._type=s,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),f.prototype.isEmpty=function(){return this._list.length===0},f.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},f.prototype._searchNearestSegmentBefore=function(s){var a=this._list;if(a.length===0)return-2;var l=a.length-1,r=0,t=0,i=l,n=0;if(s<a[0].originalBeginDts)return n=-1,n;for(;t<=i;)if(r=t+Math.floor((i-t)/2),r===l||s>a[r].lastSample.originalDts&&s<a[r+1].originalBeginDts){n=r;break}else a[r].originalBeginDts<s?t=r+1:i=r-1;return n},f.prototype._searchNearestSegmentAfter=function(s){return this._searchNearestSegmentBefore(s)+1},f.prototype.append=function(s){var a=this._list,l=s,r=this._lastAppendLocation,t=0;r!==-1&&r<a.length&&l.originalBeginDts>=a[r].lastSample.originalDts&&(r===a.length-1||r<a.length-1&&l.originalBeginDts<a[r+1].originalBeginDts)?t=r+1:a.length>0&&(t=this._searchNearestSegmentBefore(l.originalBeginDts)+1),this._lastAppendLocation=t,this._list.splice(t,0,l)},f.prototype.getLastSegmentBefore=function(s){var a=this._searchNearestSegmentBefore(s);return a>=0?this._list[a]:null},f.prototype.getLastSampleBefore=function(s){var a=this.getLastSegmentBefore(s);return a!=null?a.lastSample:null},f.prototype.getLastSyncPointBefore=function(s){for(var a=this._searchNearestSegmentBefore(s),l=this._list[a].syncPoints;l.length===0&&a>0;)a--,l=this._list[a].syncPoints;return l.length>0?l[l.length-1]:null},f}()},"./src/core/mse-controller.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),o=m("./src/utils/browser.js"),f=m("./src/core/mse-events.js"),s=m("./src/core/media-segment-info.js"),a=m("./src/utils/exception.js"),l=function(){function r(t){this.TAG="MSEController",this._config=t,this._emitter=new(c()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new s.IDRSampleList}return r.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},r.prototype.on=function(t,i){this._emitter.addListener(t,i)},r.prototype.off=function(t,i){this._emitter.removeListener(t,i)},r.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new a.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var i=this._mediaSource=new window.MediaSource;i.addEventListener("sourceopen",this.e.onSourceOpen),i.addEventListener("sourceended",this.e.onSourceEnded),i.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},r.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var i in this._sourceBuffers){var n=this._pendingSegments[i];n.splice(0,n.length),this._pendingSegments[i]=null,this._pendingRemoveRanges[i]=null,this._lastInitSegments[i]=null;var e=this._sourceBuffers[i];if(e){if(t.readyState!=="closed"){try{t.removeSourceBuffer(e)}catch(u){d.default.e(this.TAG,u.message)}e.removeEventListener("error",this.e.onSourceBufferError),e.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[i]=null,this._sourceBuffers[i]=null}}if(t.readyState==="open")try{t.endOfStream()}catch(u){d.default.e(this.TAG,u.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},r.prototype.appendInitSegment=function(t,i){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t),this._pendingSegments[t.type].push(t);return}var n=t,e=""+n.container;n.codec&&n.codec.length>0&&(e+=";codecs="+n.codec);var u=!1;if(d.default.v(this.TAG,"Received Initialization Segment, mimeType: "+e),this._lastInitSegments[n.type]=n,e!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])d.default.v(this.TAG,"Notice: "+n.type+" mimeType changed, origin: "+this._mimeTypes[n.type]+", target: "+e);else{u=!0;try{var _=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(e);_.addEventListener("error",this.e.onSourceBufferError),_.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(p){d.default.e(this.TAG,p.message),this._emitter.emit(f.default.ERROR,{code:p.code,msg:p.message});return}}this._mimeTypes[n.type]=e}i||this._pendingSegments[n.type].push(n),u||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),o.default.safari&&n.container==="audio/mpeg"&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())},r.prototype.appendMediaSegment=function(t){var i=t;this._pendingSegments[i.type].push(i),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[i.type];n&&!n.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},r.prototype.seek=function(t){for(var i in this._sourceBuffers)if(!!this._sourceBuffers[i]){var n=this._sourceBuffers[i];if(this._mediaSource.readyState==="open")try{n.abort()}catch(b){d.default.e(this.TAG,b.message)}this._idrList.clear();var e=this._pendingSegments[i];if(e.splice(0,e.length),this._mediaSource.readyState!=="closed"){for(var u=0;u<n.buffered.length;u++){var _=n.buffered.start(u),p=n.buffered.end(u);this._pendingRemoveRanges[i].push({start:_,end:p})}if(n.updating||this._doRemoveRanges(),o.default.safari){var g=this._lastInitSegments[i];g&&(this._pendingSegments[i].push(g),n.updating||this._doAppendSegments())}}}},r.prototype.endOfStream=function(){var t=this._mediaSource,i=this._sourceBuffers;if(!t||t.readyState!=="open"){t&&t.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}i.video&&i.video.updating||i.audio&&i.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())},r.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},r.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var i in this._sourceBuffers){var n=this._sourceBuffers[i];if(n){var e=n.buffered;if(e.length>=1&&t-e.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},r.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var i in this._sourceBuffers){var n=this._sourceBuffers[i];if(n){for(var e=n.buffered,u=!1,_=0;_<e.length;_++){var p=e.start(_),g=e.end(_);if(p<=t&&t<g+3){if(t-p>=this._config.autoCleanupMaxBackwardDuration){u=!0;var b=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[i].push({start:p,end:b})}}else g<t&&(u=!0,this._pendingRemoveRanges[i].push({start:p,end:g}))}u&&!n.updating&&this._doRemoveRanges()}}},r.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var i=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(i)||n>i)&&(d.default.v(this.TAG,"Update MediaSource duration from "+i+" to "+n),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},r.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(!(!this._sourceBuffers[t]||this._sourceBuffers[t].updating))for(var i=this._sourceBuffers[t],n=this._pendingRemoveRanges[t];n.length&&!i.updating;){var e=n.shift();i.remove(e.start,e.end)}},r.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var i in t)if(!(!this._sourceBuffers[i]||this._sourceBuffers[i].updating)&&t[i].length>0){var n=t[i].shift();if(n.timestampOffset){var e=this._sourceBuffers[i].timestampOffset,u=n.timestampOffset/1e3,_=Math.abs(e-u);_>.1&&(d.default.v(this.TAG,"Update MPEG audio timestampOffset from "+e+" to "+u),this._sourceBuffers[i].timestampOffset=u),delete n.timestampOffset}if(!n.data||n.data.byteLength===0)continue;try{this._sourceBuffers[i].appendBuffer(n.data),this._isBufferFull=!1,i==="video"&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(p){this._pendingSegments[i].unshift(n),p.code===22?(this._isBufferFull||this._emitter.emit(f.default.BUFFER_FULL),this._isBufferFull=!0):(d.default.e(this.TAG,p.message),this._emitter.emit(f.default.ERROR,{code:p.code,msg:p.message}))}}},r.prototype._onSourceOpen=function(){if(d.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var i=t.shift();this.appendInitSegment(i,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(f.default.SOURCE_OPEN)},r.prototype._onSourceEnded=function(){d.default.v(this.TAG,"MediaSource onSourceEnded")},r.prototype._onSourceClose=function(){d.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},r.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},r.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},r.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(f.default.UPDATE_END)},r.prototype._onSourceBufferError=function(t){d.default.e(this.TAG,"SourceBuffer Error: "+t)},r}();L.default=l},"./src/core/mse-events.js":function(w,L,m){m.r(L);var y={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};L.default=y},"./src/core/transmuxer.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./node_modules/webworkify-webpack/index.js"),o=m.n(d),f=m("./src/utils/logger.js"),s=m("./src/utils/logging-control.js"),a=m("./src/core/transmuxing-controller.js"),l=m("./src/core/transmuxing-events.js"),r=m("./src/core/media-info.js"),t=function(){function i(n,e){if(this.TAG="Transmuxer",this._emitter=new(c()),e.enableWorker&&typeof Worker<"u")try{this._worker=o()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[n,e]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},s.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:s.default.getConfig()})}catch{f.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new a.default(n,e)}else this._controller=new a.default(n,e);if(this._controller){var u=this._controller;u.on(l.default.IO_ERROR,this._onIOError.bind(this)),u.on(l.default.DEMUX_ERROR,this._onDemuxError.bind(this)),u.on(l.default.INIT_SEGMENT,this._onInitSegment.bind(this)),u.on(l.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),u.on(l.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),u.on(l.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),u.on(l.default.MEDIA_INFO,this._onMediaInfo.bind(this)),u.on(l.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),u.on(l.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),u.on(l.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),u.on(l.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return i.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),s.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},i.prototype.on=function(n,e){this._emitter.addListener(n,e)},i.prototype.off=function(n,e){this._emitter.removeListener(n,e)},i.prototype.hasWorker=function(){return this._worker!=null},i.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},i.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},i.prototype.seek=function(n){this._worker?this._worker.postMessage({cmd:"seek",param:n}):this._controller.seek(n)},i.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},i.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},i.prototype._onInitSegment=function(n,e){var u=this;Promise.resolve().then(function(){u._emitter.emit(l.default.INIT_SEGMENT,n,e)})},i.prototype._onMediaSegment=function(n,e){var u=this;Promise.resolve().then(function(){u._emitter.emit(l.default.MEDIA_SEGMENT,n,e)})},i.prototype._onLoadingComplete=function(){var n=this;Promise.resolve().then(function(){n._emitter.emit(l.default.LOADING_COMPLETE)})},i.prototype._onRecoveredEarlyEof=function(){var n=this;Promise.resolve().then(function(){n._emitter.emit(l.default.RECOVERED_EARLY_EOF)})},i.prototype._onMediaInfo=function(n){var e=this;Promise.resolve().then(function(){e._emitter.emit(l.default.MEDIA_INFO,n)})},i.prototype._onMetaDataArrived=function(n){var e=this;Promise.resolve().then(function(){e._emitter.emit(l.default.METADATA_ARRIVED,n)})},i.prototype._onScriptDataArrived=function(n){var e=this;Promise.resolve().then(function(){e._emitter.emit(l.default.SCRIPTDATA_ARRIVED,n)})},i.prototype._onStatisticsInfo=function(n){var e=this;Promise.resolve().then(function(){e._emitter.emit(l.default.STATISTICS_INFO,n)})},i.prototype._onIOError=function(n,e){var u=this;Promise.resolve().then(function(){u._emitter.emit(l.default.IO_ERROR,n,e)})},i.prototype._onDemuxError=function(n,e){var u=this;Promise.resolve().then(function(){u._emitter.emit(l.default.DEMUX_ERROR,n,e)})},i.prototype._onRecommendSeekpoint=function(n){var e=this;Promise.resolve().then(function(){e._emitter.emit(l.default.RECOMMEND_SEEKPOINT,n)})},i.prototype._onLoggingConfigChanged=function(n){this._worker&&this._worker.postMessage({cmd:"logging_config",param:n})},i.prototype._onWorkerMessage=function(n){var e=n.data,u=e.data;if(e.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(e.msg){case l.default.INIT_SEGMENT:case l.default.MEDIA_SEGMENT:this._emitter.emit(e.msg,u.type,u.data);break;case l.default.LOADING_COMPLETE:case l.default.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case l.default.MEDIA_INFO:Object.setPrototypeOf(u,r.default.prototype),this._emitter.emit(e.msg,u);break;case l.default.METADATA_ARRIVED:case l.default.SCRIPTDATA_ARRIVED:case l.default.STATISTICS_INFO:this._emitter.emit(e.msg,u);break;case l.default.IO_ERROR:case l.default.DEMUX_ERROR:this._emitter.emit(e.msg,u.type,u.info);break;case l.default.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,u);break;case"logcat_callback":f.default.emitter.emit("log",u.type,u.logcat);break}},i}();L.default=t},"./src/core/transmuxing-controller.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),o=m("./src/utils/browser.js"),f=m("./src/core/media-info.js"),s=m("./src/demux/flv-demuxer.js"),a=m("./src/remux/mp4-remuxer.js"),l=m("./src/demux/demux-errors.js"),r=m("./src/io/io-controller.js"),t=m("./src/core/transmuxing-events.js"),i=function(){function n(e,u){this.TAG="TransmuxingController",this._emitter=new(c()),this._config=u,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),typeof e.cors!="boolean"&&(e.cors=!0),typeof e.withCredentials!="boolean"&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var _=0;this._mediaDataSource.segments.forEach(function(p){p.timestampBase=_,_+=p.duration,p.cors=e.cors,p.withCredentials=e.withCredentials,u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy)}),!isNaN(_)&&this._mediaDataSource.duration!==_&&(this._mediaDataSource.duration=_),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return n.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(e,u){this._emitter.addListener(e,u)},n.prototype.off=function(e,u){this._emitter.removeListener(e,u)},n.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},n.prototype._loadSegment=function(e,u){this._currentSegmentIndex=e;var _=this._mediaDataSource.segments[e],p=this._ioctl=new r.default(_,this._config,e);p.onError=this._onIOException.bind(this),p.onSeeked=this._onIOSeeked.bind(this),p.onComplete=this._onIOComplete.bind(this),p.onRedirect=this._onIORedirect.bind(this),p.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),u?this._demuxer.bindDataSource(this._ioctl):p.onDataArrival=this._onInitChunkArrival.bind(this),p.open(u)},n.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},n.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},n.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},n.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},n.prototype.seek=function(e){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var u=this._searchSegmentIndexContains(e);if(u===this._currentSegmentIndex){var _=this._mediaInfo.segments[u];if(_==null)this._pendingSeekTime=e;else{var p=_.getNearestKeyframe(e);this._remuxer.seek(p.milliseconds),this._ioctl.seek(p.fileposition),this._pendingResolveSeekPoint=p.milliseconds}}else{var g=this._mediaInfo.segments[u];if(g==null)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(u);else{var p=g.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[u].timestampBase,this._loadSegment(u,p.fileposition),this._pendingResolveSeekPoint=p.milliseconds,this._reportSegmentMediaInfo(u)}}this._enableStatisticsReporter()}},n.prototype._searchSegmentIndexContains=function(e){for(var u=this._mediaDataSource.segments,_=u.length-1,p=0;p<u.length;p++)if(e<u[p].timestampBase){_=p-1;break}return _},n.prototype._onInitChunkArrival=function(e,u){var _=this,p=null,g=0;if(u>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,g=this._demuxer.parseChunks(e,u);else if((p=s.default.probe(e)).match){this._demuxer=new s.default(p,this._config),this._remuxer||(this._remuxer=new a.default(this._config));var b=this._mediaDataSource;b.duration!=null&&!isNaN(b.duration)&&(this._demuxer.overridedDuration=b.duration),typeof b.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=b.hasAudio),typeof b.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=b.hasVideo),this._demuxer.timestampBase=b.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),g=this._demuxer.parseChunks(e,u)}else p=null,d.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){_._internalAbort()}),this._emitter.emit(t.default.DEMUX_ERROR,l.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),g=0;return g},n.prototype._onMediaInfo=function(e){var u=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,f.default.prototype));var _=Object.assign({},e);Object.setPrototypeOf(_,f.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=_,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var p=u._pendingSeekTime;u._pendingSeekTime=null,u.seek(p)})},n.prototype._onMetaDataArrived=function(e){this._emitter.emit(t.default.METADATA_ARRIVED,e)},n.prototype._onScriptDataArrived=function(e){this._emitter.emit(t.default.SCRIPTDATA_ARRIVED,e)},n.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},n.prototype._onIOComplete=function(e){var u=e,_=u+1;_<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(_)):(this._remuxer.flushStashedSamples(),this._emitter.emit(t.default.LOADING_COMPLETE),this._disableStatisticsReporter())},n.prototype._onIORedirect=function(e){var u=this._ioctl.extraData;this._mediaDataSource.segments[u].redirectedURL=e},n.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(t.default.RECOVERED_EARLY_EOF)},n.prototype._onIOException=function(e,u){d.default.e(this.TAG,"IOException: type = "+e+", code = "+u.code+", msg = "+u.msg),this._emitter.emit(t.default.IO_ERROR,e,u),this._disableStatisticsReporter()},n.prototype._onDemuxException=function(e,u){d.default.e(this.TAG,"DemuxException: type = "+e+", info = "+u),this._emitter.emit(t.default.DEMUX_ERROR,e,u)},n.prototype._onRemuxerInitSegmentArrival=function(e,u){this._emitter.emit(t.default.INIT_SEGMENT,e,u)},n.prototype._onRemuxerMediaSegmentArrival=function(e,u){if(this._pendingSeekTime==null&&(this._emitter.emit(t.default.MEDIA_SEGMENT,e,u),this._pendingResolveSeekPoint!=null&&e==="video")){var _=u.info.syncPoints,p=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,o.default.safari&&_.length>0&&_[0].originalDts===p&&(p=_[0].pts),this._emitter.emit(t.default.RECOMMEND_SEEKPOINT,p)}},n.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},n.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype._reportSegmentMediaInfo=function(e){var u=this._mediaInfo.segments[e],_=Object.assign({},u);_.duration=this._mediaInfo.duration,_.segmentCount=this._mediaInfo.segmentCount,delete _.segments,delete _.keyframesIndex,this._emitter.emit(t.default.MEDIA_INFO,_)},n.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(t.default.STATISTICS_INFO,e)},n}();L.default=i},"./src/core/transmuxing-events.js":function(w,L,m){m.r(L);var y={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};L.default=y},"./src/core/transmuxing-worker.js":function(w,L,m){m.r(L);var y=m("./src/utils/logging-control.js"),c=m("./src/utils/polyfill.js"),d=m("./src/core/transmuxing-controller.js"),o=m("./src/core/transmuxing-events.js"),f=function(s){var a=null,l=v.bind(this);c.default.install(),s.addEventListener("message",function(x){switch(x.data.cmd){case"init":a=new d.default(x.data.param[0],x.data.param[1]),a.on(o.default.IO_ERROR,g.bind(this)),a.on(o.default.DEMUX_ERROR,b.bind(this)),a.on(o.default.INIT_SEGMENT,r.bind(this)),a.on(o.default.MEDIA_SEGMENT,t.bind(this)),a.on(o.default.LOADING_COMPLETE,i.bind(this)),a.on(o.default.RECOVERED_EARLY_EOF,n.bind(this)),a.on(o.default.MEDIA_INFO,e.bind(this)),a.on(o.default.METADATA_ARRIVED,u.bind(this)),a.on(o.default.SCRIPTDATA_ARRIVED,_.bind(this)),a.on(o.default.STATISTICS_INFO,p.bind(this)),a.on(o.default.RECOMMEND_SEEKPOINT,E.bind(this));break;case"destroy":a&&(a.destroy(),a=null),s.postMessage({msg:"destroyed"});break;case"start":a.start();break;case"stop":a.stop();break;case"seek":a.seek(x.data.param);break;case"pause":a.pause();break;case"resume":a.resume();break;case"logging_config":{var S=x.data.param;y.default.applyConfig(S),S.enableCallback===!0?y.default.addLogListener(l):y.default.removeLogListener(l);break}}});function r(x,S){var O={msg:o.default.INIT_SEGMENT,data:{type:x,data:S}};s.postMessage(O,[S.data])}function t(x,S){var O={msg:o.default.MEDIA_SEGMENT,data:{type:x,data:S}};s.postMessage(O,[S.data])}function i(){var x={msg:o.default.LOADING_COMPLETE};s.postMessage(x)}function n(){var x={msg:o.default.RECOVERED_EARLY_EOF};s.postMessage(x)}function e(x){var S={msg:o.default.MEDIA_INFO,data:x};s.postMessage(S)}function u(x){var S={msg:o.default.METADATA_ARRIVED,data:x};s.postMessage(S)}function _(x){var S={msg:o.default.SCRIPTDATA_ARRIVED,data:x};s.postMessage(S)}function p(x){var S={msg:o.default.STATISTICS_INFO,data:x};s.postMessage(S)}function g(x,S){s.postMessage({msg:o.default.IO_ERROR,data:{type:x,info:S}})}function b(x,S){s.postMessage({msg:o.default.DEMUX_ERROR,data:{type:x,info:S}})}function E(x){s.postMessage({msg:o.default.RECOMMEND_SEEKPOINT,data:x})}function v(x,S){s.postMessage({msg:"logcat_callback",data:{type:x,logcat:S}})}};L.default=f},"./src/demux/amf-parser.js":function(w,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/utils/utf8-conv.js"),d=m("./src/utils/exception.js"),o=function(){var s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256}(),f=function(){function s(){}return s.parseScriptData=function(a,l,r){var t={};try{var i=s.parseValue(a,l,r),n=s.parseValue(a,l+i.size,r-i.size);t[i.data]=n.data}catch(e){y.default.e("AMF",e.toString())}return t},s.parseObject=function(a,l,r){if(r<3)throw new d.IllegalStateException("Data not enough when parse ScriptDataObject");var t=s.parseString(a,l,r),i=s.parseValue(a,l+t.size,r-t.size),n=i.objectEnd;return{data:{name:t.data,value:i.data},size:t.size+i.size,objectEnd:n}},s.parseVariable=function(a,l,r){return s.parseObject(a,l,r)},s.parseString=function(a,l,r){if(r<2)throw new d.IllegalStateException("Data not enough when parse String");var t=new DataView(a,l,r),i=t.getUint16(0,!o),n;return i>0?n=(0,c.default)(new Uint8Array(a,l+2,i)):n="",{data:n,size:2+i}},s.parseLongString=function(a,l,r){if(r<4)throw new d.IllegalStateException("Data not enough when parse LongString");var t=new DataView(a,l,r),i=t.getUint32(0,!o),n;return i>0?n=(0,c.default)(new Uint8Array(a,l+4,i)):n="",{data:n,size:4+i}},s.parseDate=function(a,l,r){if(r<10)throw new d.IllegalStateException("Data size invalid when parse Date");var t=new DataView(a,l,r),i=t.getFloat64(0,!o),n=t.getInt16(8,!o);return i+=n*60*1e3,{data:new Date(i),size:8+2}},s.parseValue=function(a,l,r){if(r<1)throw new d.IllegalStateException("Data not enough when parse Value");var t=new DataView(a,l,r),i=1,n=t.getUint8(0),e,u=!1;try{switch(n){case 0:e=t.getFloat64(1,!o),i+=8;break;case 1:{var _=t.getUint8(1);e=!!_,i+=1;break}case 2:{var p=s.parseString(a,l+1,r-1);e=p.data,i+=p.size;break}case 3:{e={};var g=0;for((t.getUint32(r-4,!o)&16777215)===9&&(g=3);i<r-4;){var b=s.parseObject(a,l+i,r-i-g);if(b.objectEnd)break;e[b.data.name]=b.data.value,i+=b.size}if(i<=r-3){var E=t.getUint32(i-1,!o)&16777215;E===9&&(i+=3)}break}case 8:{e={},i+=4;var g=0;for((t.getUint32(r-4,!o)&16777215)===9&&(g=3);i<r-8;){var v=s.parseVariable(a,l+i,r-i-g);if(v.objectEnd)break;e[v.data.name]=v.data.value,i+=v.size}if(i<=r-3){var E=t.getUint32(i-1,!o)&16777215;E===9&&(i+=3)}break}case 9:e=void 0,i=1,u=!0;break;case 10:{e=[];var x=t.getUint32(1,!o);i+=4;for(var S=0;S<x;S++){var O=s.parseValue(a,l+i,r-i);e.push(O.data),i+=O.size}break}case 11:{var R=s.parseDate(a,l+1,r-1);e=R.data,i+=R.size;break}case 12:{var I=s.parseString(a,l+1,r-1);e=I.data,i+=I.size;break}default:i=r,y.default.w("AMF","Unsupported AMF value type "+n)}}catch(B){y.default.e("AMF",B.toString())}return{data:e,size:i,objectEnd:u}},s}();L.default=f},"./src/demux/demux-errors.js":function(w,L,m){m.r(L);var y={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};L.default=y},"./src/demux/exp-golomb.js":function(w,L,m){m.r(L);var y=m("./src/utils/exception.js"),c=function(){function d(o){this.TAG="ExpGolomb",this._buffer=o,this._buffer_index=0,this._total_bytes=o.byteLength,this._total_bits=o.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return d.prototype.destroy=function(){this._buffer=null},d.prototype._fillCurrentWord=function(){var o=this._total_bytes-this._buffer_index;if(o<=0)throw new y.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var f=Math.min(4,o),s=new Uint8Array(4);s.set(this._buffer.subarray(this._buffer_index,this._buffer_index+f)),this._current_word=new DataView(s.buffer).getUint32(0,!1),this._buffer_index+=f,this._current_word_bits_left=f*8},d.prototype.readBits=function(o){if(o>32)throw new y.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(o<=this._current_word_bits_left){var f=this._current_word>>>32-o;return this._current_word<<=o,this._current_word_bits_left-=o,f}var s=this._current_word_bits_left?this._current_word:0;s=s>>>32-this._current_word_bits_left;var a=o-this._current_word_bits_left;this._fillCurrentWord();var l=Math.min(a,this._current_word_bits_left),r=this._current_word>>>32-l;return this._current_word<<=l,this._current_word_bits_left-=l,s=s<<l|r,s},d.prototype.readBool=function(){return this.readBits(1)===1},d.prototype.readByte=function(){return this.readBits(8)},d.prototype._skipLeadingZero=function(){var o;for(o=0;o<this._current_word_bits_left;o++)if((this._current_word&2147483648>>>o)!==0)return this._current_word<<=o,this._current_word_bits_left-=o,o;return this._fillCurrentWord(),o+this._skipLeadingZero()},d.prototype.readUEG=function(){var o=this._skipLeadingZero();return this.readBits(o+1)-1},d.prototype.readSEG=function(){var o=this.readUEG();return o&1?o+1>>>1:-1*(o>>>1)},d}();L.default=c},"./src/demux/flv-demuxer.js":function(w,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/demux/amf-parser.js"),d=m("./src/demux/sps-parser.js"),o=m("./src/demux/demux-errors.js"),f=m("./src/core/media-info.js"),s=m("./src/utils/exception.js");function a(r,t){return r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]}var l=function(){function r(t,i){this.TAG="FLVDemuxer",this._config=i,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new f.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256}()}return r.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},r.probe=function(t){var i=new Uint8Array(t),n={match:!1};if(i[0]!==70||i[1]!==76||i[2]!==86||i[3]!==1)return n;var e=(i[4]&4)>>>2!==0,u=(i[4]&1)!==0,_=a(i,5);return _<9?n:{match:!0,consumed:_,dataOffset:_,hasAudioTrack:e,hasVideoTrack:u}},r.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(r.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),r.prototype.resetMediaInfo=function(){this._mediaInfo=new f.default},r.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},r.prototype.parseChunks=function(t,i){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new s.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var n=0,e=this._littleEndian;if(i===0)if(t.byteLength>13){var u=r.probe(t);n=u.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,i+n!==this._dataOffset&&y.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var _=new DataView(t,n),p=_.getUint32(0,!e);p!==0&&y.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),n+=4}for(;n<t.byteLength;){this._dispatch=!0;var _=new DataView(t,n);if(n+11+4>t.byteLength)break;var g=_.getUint8(0),b=_.getUint32(0,!e)&16777215;if(n+11+b+4>t.byteLength)break;if(g!==8&&g!==9&&g!==18){y.default.w(this.TAG,"Unsupported tag type "+g+", skipped"),n+=11+b+4;continue}var E=_.getUint8(4),v=_.getUint8(5),x=_.getUint8(6),S=_.getUint8(7),O=x|v<<8|E<<16|S<<24,R=_.getUint32(7,!e)&16777215;R!==0&&y.default.w(this.TAG,"Meet tag which has StreamID != 0!");var I=n+11;switch(g){case 8:this._parseAudioData(t,I,b,O);break;case 9:this._parseVideoData(t,I,b,O,i+n);break;case 18:this._parseScriptData(t,I,b);break}var B=_.getUint32(11+b,!e);B!==11+b&&y.default.w(this.TAG,"Invalid PrevTagSize "+B),n+=11+b+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),n},r.prototype._parseScriptData=function(t,i,n){var e=c.default.parseScriptData(t,i,n);if(e.hasOwnProperty("onMetaData")){if(e.onMetaData==null||typeof e.onMetaData!="object"){y.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&y.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=e;var u=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},u)),typeof u.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=u.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof u.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=u.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof u.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=u.audiodatarate),typeof u.videodatarate=="number"&&(this._mediaInfo.videoDataRate=u.videodatarate),typeof u.width=="number"&&(this._mediaInfo.width=u.width),typeof u.height=="number"&&(this._mediaInfo.height=u.height),typeof u.duration=="number"){if(!this._durationOverrided){var _=Math.floor(u.duration*this._timescale);this._duration=_,this._mediaInfo.duration=_}}else this._mediaInfo.duration=0;if(typeof u.framerate=="number"){var p=Math.floor(u.framerate*1e3);if(p>0){var g=p/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=g,this._referenceFrameRate.fps_num=p,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=g}}if(typeof u.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var b=u.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(b),u.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=u,y.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(e).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},e))},r.prototype._parseKeyframesIndex=function(t){for(var i=[],n=[],e=1;e<t.times.length;e++){var u=this._timestampBase+Math.floor(t.times[e]*1e3);i.push(u),n.push(t.filepositions[e])}return{times:i,filepositions:n}},r.prototype._parseAudioData=function(t,i,n,e){if(n<=1){y.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var u=new DataView(t,i,n),_=u.getUint8(0),p=_>>>4;if(p!==2&&p!==10){this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+p);return}var g=0,b=(_&12)>>>2;if(b>=0&&b<=4)g=this._flvSoundRateTable[b];else{this._onError(o.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+b);return}var E=_&1,v=this._audioMetadata,x=this._audioTrack;if(v||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),v=this._audioMetadata={},v.type="audio",v.id=x.id,v.timescale=this._timescale,v.duration=this._duration,v.audioSampleRate=g,v.channelCount=E===0?1:2),p===10){var S=this._parseAACAudioData(t,i+1,n-1);if(S==null)return;if(S.packetType===0){v.config&&y.default.w(this.TAG,"Found another AudioSpecificConfig!");var O=S.data;v.audioSampleRate=O.samplingRate,v.channelCount=O.channelCount,v.codec=O.codec,v.originalCodec=O.originalCodec,v.config=O.config,v.refSampleDuration=1024/v.audioSampleRate*v.timescale,y.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",v);var R=this._mediaInfo;R.audioCodec=v.originalCodec,R.audioSampleRate=v.audioSampleRate,R.audioChannelCount=v.channelCount,R.hasVideo?R.videoCodec!=null&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.audioCodec+'"',R.isComplete()&&this._onMediaInfo(R)}else if(S.packetType===1){var I=this._timestampBase+e,B={unit:S.data,length:S.data.byteLength,dts:I,pts:I};x.samples.push(B),x.length+=S.data.length}else y.default.e(this.TAG,"Flv: Unsupported AAC data type "+S.packetType)}else if(p===2){if(!v.codec){var O=this._parseMP3AudioData(t,i+1,n-1,!0);if(O==null)return;v.audioSampleRate=O.samplingRate,v.channelCount=O.channelCount,v.codec=O.codec,v.originalCodec=O.originalCodec,v.refSampleDuration=1152/v.audioSampleRate*v.timescale,y.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",v);var R=this._mediaInfo;R.audioCodec=v.codec,R.audioSampleRate=v.audioSampleRate,R.audioChannelCount=v.channelCount,R.audioDataRate=O.bitRate,R.hasVideo?R.videoCodec!=null&&(R.mimeType='video/x-flv; codecs="'+R.videoCodec+","+R.audioCodec+'"'):R.mimeType='video/x-flv; codecs="'+R.audioCodec+'"',R.isComplete()&&this._onMediaInfo(R)}var U=this._parseMP3AudioData(t,i+1,n-1,!1);if(U==null)return;var I=this._timestampBase+e,k={unit:U,length:U.byteLength,dts:I,pts:I};x.samples.push(k),x.length+=U.length}}},r.prototype._parseAACAudioData=function(t,i,n){if(n<=1){y.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var e={},u=new Uint8Array(t,i,n);return e.packetType=u[0],u[0]===0?e.data=this._parseAACAudioSpecificConfig(t,i+1,n-1):e.data=u.subarray(1),e},r.prototype._parseAACAudioSpecificConfig=function(t,i,n){var e=new Uint8Array(t,i,n),u=null,_=0,p=0,g=0,b=null;if(_=p=e[0]>>>3,g=(e[0]&7)<<1|e[1]>>>7,g<0||g>=this._mpegSamplingRates.length){this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var E=this._mpegSamplingRates[g],v=(e[1]&120)>>>3;if(v<0||v>=8){this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}_===5&&(b=(e[1]&7)<<1|e[2]>>>7,(e[2]&124)>>>2);var x=self.navigator.userAgent.toLowerCase();return x.indexOf("firefox")!==-1?g>=6?(_=5,u=new Array(4),b=g-3):(_=2,u=new Array(2),b=g):x.indexOf("android")!==-1?(_=2,u=new Array(2),b=g):(_=5,b=g,u=new Array(4),g>=6?b=g-3:v===1&&(_=2,u=new Array(2),b=g)),u[0]=_<<3,u[0]|=(g&15)>>>1,u[1]=(g&15)<<7,u[1]|=(v&15)<<3,_===5&&(u[1]|=(b&15)>>>1,u[2]=(b&1)<<7,u[2]|=2<<2,u[3]=0),{config:u,samplingRate:E,channelCount:v,codec:"mp4a.40."+_,originalCodec:"mp4a.40."+p}},r.prototype._parseMP3AudioData=function(t,i,n,e){if(n<4){y.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var u=new Uint8Array(t,i,n),_=null;if(e){if(u[0]!==255)return;var p=u[1]>>>3&3,g=(u[1]&6)>>1,b=(u[2]&240)>>>4,E=(u[2]&12)>>>2,v=u[3]>>>6&3,x=v!==3?2:1,S=0,O=0,R="mp3";switch(p){case 0:S=this._mpegAudioV25SampleRateTable[E];break;case 2:S=this._mpegAudioV20SampleRateTable[E];break;case 3:S=this._mpegAudioV10SampleRateTable[E];break}switch(g){case 1:b<this._mpegAudioL3BitRateTable.length&&(O=this._mpegAudioL3BitRateTable[b]);break;case 2:b<this._mpegAudioL2BitRateTable.length&&(O=this._mpegAudioL2BitRateTable[b]);break;case 3:b<this._mpegAudioL1BitRateTable.length&&(O=this._mpegAudioL1BitRateTable[b]);break}_={bitRate:O,samplingRate:S,channelCount:x,codec:R,originalCodec:R}}else _=u;return _},r.prototype._parseVideoData=function(t,i,n,e,u){if(n<=1){y.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var _=new Uint8Array(t,i,n)[0],p=(_&240)>>>4,g=_&15;if(g!==7){this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+g);return}this._parseAVCVideoPacket(t,i+1,n-1,e,u,p)}},r.prototype._parseAVCVideoPacket=function(t,i,n,e,u,_){if(n<4){y.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var p=this._littleEndian,g=new DataView(t,i,n),b=g.getUint8(0),E=g.getUint32(0,!p)&16777215,v=E<<8>>8;if(b===0)this._parseAVCDecoderConfigurationRecord(t,i+4,n-4);else if(b===1)this._parseAVCVideoData(t,i+4,n-4,e,u,_,v);else if(b!==2){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid video packet type "+b);return}},r.prototype._parseAVCDecoderConfigurationRecord=function(t,i,n){if(n<7){y.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var e=this._videoMetadata,u=this._videoTrack,_=this._littleEndian,p=new DataView(t,i,n);e?typeof e.avcc<"u"&&y.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),e=this._videoMetadata={},e.type="video",e.id=u.id,e.timescale=this._timescale,e.duration=this._duration);var g=p.getUint8(0),b=p.getUint8(1);if(p.getUint8(2),p.getUint8(3),g!==1||b===0){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(p.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(o.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var E=p.getUint8(5)&31;if(E===0){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else E>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+E);for(var v=6,x=0;x<E;x++){var S=p.getUint16(v,!_);if(v+=2,S!==0){var O=new Uint8Array(t,i+v,S);v+=S;var R=d.default.parseSPS(O);if(x===0){e.codecWidth=R.codec_size.width,e.codecHeight=R.codec_size.height,e.presentWidth=R.present_size.width,e.presentHeight=R.present_size.height,e.profile=R.profile_string,e.level=R.level_string,e.bitDepth=R.bit_depth,e.chromaFormat=R.chroma_format,e.sarRatio=R.sar_ratio,e.frameRate=R.frame_rate,(R.frame_rate.fixed===!1||R.frame_rate.fps_num===0||R.frame_rate.fps_den===0)&&(e.frameRate=this._referenceFrameRate);var I=e.frameRate.fps_den,B=e.frameRate.fps_num;e.refSampleDuration=e.timescale*(I/B);for(var U=O.subarray(1,4),k="avc1.",N=0;N<3;N++){var V=U[N].toString(16);V.length<2&&(V="0"+V),k+=V}e.codec=k;var P=this._mediaInfo;P.width=e.codecWidth,P.height=e.codecHeight,P.fps=e.frameRate.fps,P.profile=e.profile,P.level=e.level,P.refFrames=R.ref_frames,P.chromaFormat=R.chroma_format_string,P.sarNum=e.sarRatio.width,P.sarDen=e.sarRatio.height,P.videoCodec=k,P.hasAudio?P.audioCodec!=null&&(P.mimeType='video/x-flv; codecs="'+P.videoCodec+","+P.audioCodec+'"'):P.mimeType='video/x-flv; codecs="'+P.videoCodec+'"',P.isComplete()&&this._onMediaInfo(P)}}}var W=p.getUint8(v);if(W===0){this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else W>1&&y.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+W);v++;for(var x=0;x<W;x++){var S=p.getUint16(v,!_);v+=2,S!==0&&(v+=S)}e.avcc=new Uint8Array(n),e.avcc.set(new Uint8Array(t,i,n),0),y.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",e)},r.prototype._parseAVCVideoData=function(t,i,n,e,u,_,p){for(var g=this._littleEndian,b=new DataView(t,i,n),E=[],v=0,x=0,S=this._naluLengthSize,O=this._timestampBase+e,R=_===1;x<n;){if(x+4>=n){y.default.w(this.TAG,"Malformed Nalu near timestamp "+O+", offset = "+x+", dataSize = "+n);break}var I=b.getUint32(x,!g);if(S===3&&(I>>>=8),I>n-S){y.default.w(this.TAG,"Malformed Nalus near timestamp "+O+", NaluSize > DataSize!");return}var B=b.getUint8(x+S)&31;B===5&&(R=!0);var U=new Uint8Array(t,i+x,S+I),k={type:B,data:U};E.push(k),v+=U.byteLength,x+=S+I}if(E.length){var N=this._videoTrack,V={units:E,length:v,isKeyframe:R,dts:O,cts:p,pts:O+p};R&&(V.fileposition=u),N.samples.push(V),N.length+=v}},r}();L.default=l},"./src/demux/sps-parser.js":function(w,L,m){m.r(L);var y=m("./src/demux/exp-golomb.js"),c=function(){function d(){}return d._ebsp2rbsp=function(o){for(var f=o,s=f.byteLength,a=new Uint8Array(s),l=0,r=0;r<s;r++)r>=2&&f[r]===3&&f[r-1]===0&&f[r-2]===0||(a[l]=f[r],l++);return new Uint8Array(a.buffer,0,l)},d.parseSPS=function(o){var f=d._ebsp2rbsp(o),s=new y.default(f);s.readByte();var a=s.readByte();s.readByte();var l=s.readByte();s.readUEG();var r=d.getProfileString(a),t=d.getLevelString(l),i=1,n=420,e=[0,420,422,444],u=8;if((a===100||a===110||a===122||a===244||a===44||a===83||a===86||a===118||a===128||a===138||a===144)&&(i=s.readUEG(),i===3&&s.readBits(1),i<=3&&(n=e[i]),u=s.readUEG()+8,s.readUEG(),s.readBits(1),s.readBool()))for(var _=i!==3?8:12,p=0;p<_;p++)s.readBool()&&(p<6?d._skipScalingList(s,16):d._skipScalingList(s,64));s.readUEG();var g=s.readUEG();if(g===0)s.readUEG();else if(g===1){s.readBits(1),s.readSEG(),s.readSEG();for(var b=s.readUEG(),p=0;p<b;p++)s.readSEG()}var E=s.readUEG();s.readBits(1);var v=s.readUEG(),x=s.readUEG(),S=s.readBits(1);S===0&&s.readBits(1),s.readBits(1);var O=0,R=0,I=0,B=0,U=s.readBool();U&&(O=s.readUEG(),R=s.readUEG(),I=s.readUEG(),B=s.readUEG());var k=1,N=1,V=0,P=!0,W=0,ie=0,K=s.readBool();if(K){if(s.readBool()){var z=s.readByte(),ee=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Q=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];z>0&&z<16?(k=ee[z-1],N=Q[z-1]):z===255&&(k=s.readByte()<<8|s.readByte(),N=s.readByte()<<8|s.readByte())}if(s.readBool()&&s.readBool(),s.readBool()&&(s.readBits(4),s.readBool()&&s.readBits(24)),s.readBool()&&(s.readUEG(),s.readUEG()),s.readBool()){var $=s.readBits(32),ue=s.readBits(32);P=s.readBool(),W=ue,ie=$*2,V=W/ie}}var H=1;(k!==1||N!==1)&&(H=k/N);var D=0,q=0;if(i===0)D=1,q=2-S;else{var se=i===3?1:2,he=i===1?2:1;D=se,q=he*(2-S)}var le=(v+1)*16,de=(2-S)*((x+1)*16);le-=(O+R)*D,de-=(I+B)*q;var ce=Math.ceil(le*H);return s.destroy(),s=null,{profile_string:r,level_string:t,bit_depth:u,ref_frames:E,chroma_format:n,chroma_format_string:d.getChromaFormatString(n),frame_rate:{fixed:P,fps:V,fps_den:ie,fps_num:W},sar_ratio:{width:k,height:N},codec_size:{width:le,height:de},present_size:{width:ce,height:de}}},d._skipScalingList=function(o,f){for(var s=8,a=8,l=0,r=0;r<f;r++)a!==0&&(l=o.readSEG(),a=(s+l+256)%256),s=a===0?s:a},d.getProfileString=function(o){switch(o){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},d.getLevelString=function(o){return(o/10).toFixed(1)},d.getChromaFormatString=function(o){switch(o){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},d}();L.default=c},"./src/flv.js":function(w,L,m){m.r(L);var y=m("./src/utils/polyfill.js"),c=m("./src/core/features.js"),d=m("./src/io/loader.js"),o=m("./src/player/flv-player.js"),f=m("./src/player/native-player.js"),s=m("./src/player/player-events.js"),a=m("./src/player/player-errors.js"),l=m("./src/utils/logging-control.js"),r=m("./src/utils/exception.js");y.default.install();function t(u,_){var p=u;if(p==null||typeof p!="object")throw new r.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!p.hasOwnProperty("type"))throw new r.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(p.type){case"flv":return new o.default(p,_);default:return new f.default(p,_)}}function i(){return c.default.supportMSEH264Playback()}function n(){return c.default.getFeatureList()}var e={};e.createPlayer=t,e.isSupported=i,e.getFeatureList=n,e.BaseLoader=d.BaseLoader,e.LoaderStatus=d.LoaderStatus,e.LoaderErrors=d.LoaderErrors,e.Events=s.default,e.ErrorTypes=a.ErrorTypes,e.ErrorDetails=a.ErrorDetails,e.FlvPlayer=o.default,e.NativePlayer=f.default,e.LoggingControl=l.default,Object.defineProperty(e,"version",{enumerable:!0,get:function(){return"1.6.2"}}),L.default=e},"./src/index.js":function(w,L,m){w.exports=m("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(w,L,m){m.r(L);var y=m("./src/utils/browser.js"),c=m("./src/io/loader.js"),d=m("./src/utils/exception.js"),o=function(){var s=function(a,l){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])},s(a,l)};return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");s(a,l);function r(){this.constructor=a}a.prototype=l===null?Object.create(l):(r.prototype=l.prototype,new r)}}(),f=function(s){o(a,s);function a(l,r){var t=s.call(this,"fetch-stream-loader")||this;return t.TAG="FetchStreamLoader",t._seekHandler=l,t._config=r,t._needStash=!0,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return a.isSupported=function(){try{var l=y.default.msedge&&y.default.version.minor>=15048,r=y.default.msedge?l:!0;return self.fetch&&self.ReadableStream&&r}catch{return!1}},a.prototype.destroy=function(){this.isWorking()&&this.abort(),s.prototype.destroy.call(this)},a.prototype.open=function(l,r){var t=this;this._dataSource=l,this._range=r;var i=l.url;this._config.reuseRedirectedURL&&l.redirectedURL!=null&&(i=l.redirectedURL);var n=this._seekHandler.getConfig(i,r),e=new self.Headers;if(typeof n.headers=="object"){var u=n.headers;for(var _ in u)u.hasOwnProperty(_)&&e.append(_,u[_])}var p={method:"GET",headers:e,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var _ in this._config.headers)e.append(_,this._config.headers[_]);l.cors===!1&&(p.mode="same-origin"),l.withCredentials&&(p.credentials="include"),l.referrerPolicy&&(p.referrerPolicy=l.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,p.signal=this._abortController.signal),this._status=c.LoaderStatus.kConnecting,self.fetch(n.url,p).then(function(g){if(t._requestAbort){t._status=c.LoaderStatus.kIdle,g.body.cancel();return}if(g.ok&&g.status>=200&&g.status<=299){if(g.url!==n.url&&t._onURLRedirect){var b=t._seekHandler.removeURLParameters(g.url);t._onURLRedirect(b)}var E=g.headers.get("Content-Length");return E!=null&&(t._contentLength=parseInt(E),t._contentLength!==0&&t._onContentLengthKnown&&t._onContentLengthKnown(t._contentLength)),t._pump.call(t,g.body.getReader())}else if(t._status=c.LoaderStatus.kError,t._onError)t._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:g.status,msg:g.statusText});else throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+g.status+" "+g.statusText)}).catch(function(g){if(!(t._abortController&&t._abortController.signal.aborted))if(t._status=c.LoaderStatus.kError,t._onError)t._onError(c.LoaderErrors.EXCEPTION,{code:-1,msg:g.message});else throw g})},a.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==c.LoaderStatus.kBuffering||!y.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},a.prototype._pump=function(l){var r=this;return l.read().then(function(t){if(t.done)if(r._contentLength!==null&&r._receivedLength<r._contentLength){r._status=c.LoaderStatus.kError;var i=c.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Fetch stream meet Early-EOF"};if(r._onError)r._onError(i,n);else throw new d.RuntimeException(n.msg)}else r._status=c.LoaderStatus.kComplete,r._onComplete&&r._onComplete(r._range.from,r._range.from+r._receivedLength-1);else{if(r._abortController&&r._abortController.signal.aborted){r._status=c.LoaderStatus.kComplete;return}else if(r._requestAbort===!0)return r._status=c.LoaderStatus.kComplete,l.cancel();r._status=c.LoaderStatus.kBuffering;var e=t.value.buffer,u=r._range.from+r._receivedLength;r._receivedLength+=e.byteLength,r._onDataArrival&&r._onDataArrival(e,u,r._receivedLength),r._pump(l)}}).catch(function(t){if(r._abortController&&r._abortController.signal.aborted){r._status=c.LoaderStatus.kComplete;return}if(!(t.code===11&&y.default.msedge)){r._status=c.LoaderStatus.kError;var i=0,n=null;if((t.code===19||t.message==="network error")&&(r._contentLength===null||r._contentLength!==null&&r._receivedLength<r._contentLength)?(i=c.LoaderErrors.EARLY_EOF,n={code:t.code,msg:"Fetch stream meet Early-EOF"}):(i=c.LoaderErrors.EXCEPTION,n={code:t.code,msg:t.message}),r._onError)r._onError(i,n);else throw new d.RuntimeException(n.msg)}})},a}(c.BaseLoader);L.default=f},"./src/io/io-controller.js":function(w,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/io/speed-sampler.js"),d=m("./src/io/loader.js"),o=m("./src/io/fetch-stream-loader.js"),f=m("./src/io/xhr-moz-chunked-loader.js"),s=m("./src/io/xhr-range-loader.js"),a=m("./src/io/websocket-loader.js"),l=m("./src/io/range-seek-handler.js"),r=m("./src/io/param-seek-handler.js"),t=m("./src/utils/exception.js"),i=function(){function n(e,u,_){this.TAG="IOController",this._config=u,this._extraData=_,this._stashInitialSize=1024*384,u.stashInitialSize!=null&&u.stashInitialSize>0&&(this._stashInitialSize=u.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,u.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new c.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return n.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},n.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},n.prototype.isPaused=function(){return this._paused},Object.defineProperty(n.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentSpeed",{get:function(){return this._loaderClass===s.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),n.prototype._selectSeekHandler=function(){var e=this._config;if(e.seekType==="range")this._seekHandler=new l.default(this._config.rangeLoadZeroStart);else if(e.seekType==="param"){var u=e.seekParamStart||"bstart",_=e.seekParamEnd||"bend";this._seekHandler=new r.default(u,_)}else if(e.seekType==="custom"){if(typeof e.customSeekHandler!="function")throw new t.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}else throw new t.InvalidArgumentException("Invalid seekType in config: "+e.seekType)},n.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=a.default;else if(o.default.isSupported())this._loaderClass=o.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(s.default.isSupported())this._loaderClass=s.default;else throw new t.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},n.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},n.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},n.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},n.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},n.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},n.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},n.prototype._internalSeek=function(e,u){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(u),this._loader.destroy(),this._loader=null;var _={from:e,to:-1};this._currentRange={from:_.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,_),this._onSeeked&&this._onSeeked()},n.prototype.updateUrl=function(e){if(!e||typeof e!="string"||e.length===0)throw new t.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e},n.prototype._expandBuffer=function(e){for(var u=this._stashSize;u+1024*1024*1<e;)u*=2;if(u+=1024*1024*1,u!==this._bufferSize){var _=new ArrayBuffer(u);if(this._stashUsed>0){var p=new Uint8Array(this._stashBuffer,0,this._stashUsed),g=new Uint8Array(_,0,u);g.set(p,0)}this._stashBuffer=_,this._bufferSize=u}},n.prototype._normalizeSpeed=function(e){var u=this._speedNormalizeList,_=u.length-1,p=0,g=0,b=_;if(e<u[0])return u[0];for(;g<=b;){if(p=g+Math.floor((b-g)/2),p===_||e>=u[p]&&e<u[p+1])return u[p];u[p]<e?g=p+1:b=p-1}},n.prototype._adjustStashSize=function(e){var u=0;this._config.isLive||e<512?u=e:e>=512&&e<=1024?u=Math.floor(e*1.5):u=e*2,u>8192&&(u=8192);var _=u*1024+1024*1024*1;this._bufferSize<_&&this._expandBuffer(_),this._stashSize=u*1024},n.prototype._dispatchChunks=function(e,u){return this._currentRange.to=u+e.byteLength-1,this._onDataArrival(e,u)},n.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},n.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},n.prototype._onLoaderChunkArrival=function(e,u,_){if(!this._onDataArrival)throw new t.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var p=this._speedSampler.lastSecondKBps;if(p!==0){var g=this._normalizeSpeed(p);this._speedNormalized!==g&&(this._speedNormalized=g,this._adjustStashSize(g))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=u),this._stashUsed+e.byteLength<=this._stashSize){var v=new Uint8Array(this._stashBuffer,0,this._stashSize);v.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var S=this._stashBuffer.slice(0,this._stashUsed),b=this._dispatchChunks(S,this._stashByteStart);if(b<S.byteLength){if(b>0){var x=new Uint8Array(S,b);v.set(x,0),this._stashUsed=x.byteLength,this._stashByteStart+=b}}else this._stashUsed=0,this._stashByteStart+=b;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),v=new Uint8Array(this._stashBuffer,0,this._bufferSize)),v.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var b=this._dispatchChunks(e,u);if(b<e.byteLength){var E=e.byteLength-b;E>this._bufferSize&&(this._expandBuffer(E),v=new Uint8Array(this._stashBuffer,0,this._bufferSize)),v.set(new Uint8Array(e,b),0),this._stashUsed+=E,this._stashByteStart=u+b}}}else if(this._stashUsed===0){var b=this._dispatchChunks(e,u);if(b<e.byteLength){var E=e.byteLength-b;E>this._bufferSize&&this._expandBuffer(E);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(e,b),0),this._stashUsed+=E,this._stashByteStart=u+b}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var b=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(b<this._stashUsed&&b>0){var x=new Uint8Array(this._stashBuffer,b);v.set(x,0)}this._stashUsed-=b,this._stashByteStart+=b}}},n.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var u=this._stashBuffer.slice(0,this._stashUsed),_=this._dispatchChunks(u,this._stashByteStart),p=u.byteLength-_;if(_<u.byteLength)if(e)y.default.w(this.TAG,p+" bytes unconsumed data remain when flush buffer, dropped");else{if(_>0){var g=new Uint8Array(this._stashBuffer,0,this._bufferSize),b=new Uint8Array(u,_);g.set(b,0),this._stashUsed=b.byteLength,this._stashByteStart+=_}return 0}return this._stashUsed=0,this._stashByteStart=0,p}return 0},n.prototype._onLoaderComplete=function(e,u){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},n.prototype._onLoaderError=function(e,u){switch(y.default.e(this.TAG,"Loader error, code = "+u.code+", msg = "+u.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case d.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var _=this._currentRange.to+1;_<this._totalLength&&(y.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(_,!1));return}e=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case d.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case d.LoaderErrors.CONNECTING_TIMEOUT:case d.LoaderErrors.HTTP_STATUS_CODE_INVALID:case d.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(e,u);else throw new t.RuntimeException("IOException: "+u.msg)},n}();L.default=i},"./src/io/loader.js":function(w,L,m){m.r(L),m.d(L,{LoaderStatus:function(){return c},LoaderErrors:function(){return d},BaseLoader:function(){return o}});var y=m("./src/utils/exception.js"),c={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},o=function(){function f(s){this._type=s||"undefined",this._status=c.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return f.prototype.destroy=function(){this._status=c.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},f.prototype.isWorking=function(){return this._status===c.kConnecting||this._status===c.kBuffering},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(s){this._onContentLengthKnown=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(s){this._onURLRedirect=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(s){this._onDataArrival=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(s){this._onError=s},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onComplete",{get:function(){return this._onComplete},set:function(s){this._onComplete=s},enumerable:!1,configurable:!0}),f.prototype.open=function(s,a){throw new y.NotImplementedException("Unimplemented abstract function!")},f.prototype.abort=function(){throw new y.NotImplementedException("Unimplemented abstract function!")},f}()},"./src/io/param-seek-handler.js":function(w,L,m){m.r(L);var y=function(){function c(d,o){this._startName=d,this._endName=o}return c.prototype.getConfig=function(d,o){var f=d;if(o.from!==0||o.to!==-1){var s=!0;f.indexOf("?")===-1&&(f+="?",s=!1),s&&(f+="&"),f+=this._startName+"="+o.from.toString(),o.to!==-1&&(f+="&"+this._endName+"="+o.to.toString())}return{url:f,headers:{}}},c.prototype.removeURLParameters=function(d){var o=d.split("?")[0],f=void 0,s=d.indexOf("?");s!==-1&&(f=d.substring(s+1));var a="";if(f!=null&&f.length>0)for(var l=f.split("&"),r=0;r<l.length;r++){var t=l[r].split("="),i=r>0;t[0]!==this._startName&&t[0]!==this._endName&&(i&&(a+="&"),a+=l[r])}return a.length===0?o:o+"?"+a},c}();L.default=y},"./src/io/range-seek-handler.js":function(w,L,m){m.r(L);var y=function(){function c(d){this._zeroStart=d||!1}return c.prototype.getConfig=function(d,o){var f={};if(o.from!==0||o.to!==-1){var s=void 0;o.to!==-1?s="bytes="+o.from.toString()+"-"+o.to.toString():s="bytes="+o.from.toString()+"-",f.Range=s}else this._zeroStart&&(f.Range="bytes=0-");return{url:d,headers:f}},c.prototype.removeURLParameters=function(d){return d},c}();L.default=y},"./src/io/speed-sampler.js":function(w,L,m){m.r(L);var y=function(){function c(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return c.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},c.prototype.addBytes=function(d){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=d,this._totalBytes+=d):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=d,this._totalBytes+=d):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=d,this._totalBytes+=d,this._lastCheckpoint=this._now())},Object.defineProperty(c.prototype,"currentKBps",{get:function(){this.addBytes(0);var d=(this._now()-this._lastCheckpoint)/1e3;return d==0&&(d=1),this._intervalBytes/d/1024},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"averageKBps",{get:function(){var d=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/d/1024},enumerable:!1,configurable:!0}),c}();L.default=y},"./src/io/websocket-loader.js":function(w,L,m){m.r(L);var y=m("./src/io/loader.js"),c=m("./src/utils/exception.js"),d=function(){var f=function(s,a){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,r){l.__proto__=r}||function(l,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(l[t]=r[t])},f(s,a)};return function(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");f(s,a);function l(){this.constructor=s}s.prototype=a===null?Object.create(a):(l.prototype=a.prototype,new l)}}(),o=function(f){d(s,f);function s(){var a=f.call(this,"websocket-loader")||this;return a.TAG="WebSocketLoader",a._needStash=!0,a._ws=null,a._requestAbort=!1,a._receivedLength=0,a}return s.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},s.prototype.destroy=function(){this._ws&&this.abort(),f.prototype.destroy.call(this)},s.prototype.open=function(a){try{var l=this._ws=new self.WebSocket(a.url);l.binaryType="arraybuffer",l.onopen=this._onWebSocketOpen.bind(this),l.onclose=this._onWebSocketClose.bind(this),l.onmessage=this._onWebSocketMessage.bind(this),l.onerror=this._onWebSocketError.bind(this),this._status=y.LoaderStatus.kConnecting}catch(t){this._status=y.LoaderStatus.kError;var r={code:t.code,msg:t.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,r);else throw new c.RuntimeException(r.msg)}},s.prototype.abort=function(){var a=this._ws;a&&(a.readyState===0||a.readyState===1)&&(this._requestAbort=!0,a.close()),this._ws=null,this._status=y.LoaderStatus.kComplete},s.prototype._onWebSocketOpen=function(a){this._status=y.LoaderStatus.kBuffering},s.prototype._onWebSocketClose=function(a){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=y.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},s.prototype._onWebSocketMessage=function(a){var l=this;if(a.data instanceof ArrayBuffer)this._dispatchArrayBuffer(a.data);else if(a.data instanceof Blob){var r=new FileReader;r.onload=function(){l._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(a.data)}else{this._status=y.LoaderStatus.kError;var t={code:-1,msg:"Unsupported WebSocket message type: "+a.data.constructor.name};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,t);else throw new c.RuntimeException(t.msg)}},s.prototype._dispatchArrayBuffer=function(a){var l=a,r=this._receivedLength;this._receivedLength+=l.byteLength,this._onDataArrival&&this._onDataArrival(l,r,this._receivedLength)},s.prototype._onWebSocketError=function(a){this._status=y.LoaderStatus.kError;var l={code:a.code,msg:a.message};if(this._onError)this._onError(y.LoaderErrors.EXCEPTION,l);else throw new c.RuntimeException(l.msg)},s}(y.BaseLoader);L.default=o},"./src/io/xhr-moz-chunked-loader.js":function(w,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/io/loader.js"),d=m("./src/utils/exception.js"),o=function(){var s=function(a,l){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])},s(a,l)};return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");s(a,l);function r(){this.constructor=a}a.prototype=l===null?Object.create(l):(r.prototype=l.prototype,new r)}}(),f=function(s){o(a,s);function a(l,r){var t=s.call(this,"xhr-moz-chunked-loader")||this;return t.TAG="MozChunkedLoader",t._seekHandler=l,t._config=r,t._needStash=!0,t._xhr=null,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return a.isSupported=function(){try{var l=new XMLHttpRequest;return l.open("GET","https://example.com",!0),l.responseType="moz-chunked-arraybuffer",l.responseType==="moz-chunked-arraybuffer"}catch(r){return y.default.w("MozChunkedLoader",r.message),!1}},a.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),s.prototype.destroy.call(this)},a.prototype.open=function(l,r){this._dataSource=l,this._range=r;var t=l.url;this._config.reuseRedirectedURL&&l.redirectedURL!=null&&(t=l.redirectedURL);var i=this._seekHandler.getConfig(t,r);this._requestURL=i.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",i.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),l.withCredentials&&(n.withCredentials=!0),typeof i.headers=="object"){var e=i.headers;for(var u in e)e.hasOwnProperty(u)&&n.setRequestHeader(u,e[u])}if(typeof this._config.headers=="object"){var e=this._config.headers;for(var u in e)e.hasOwnProperty(u)&&n.setRequestHeader(u,e[u])}this._status=c.LoaderStatus.kConnecting,n.send()},a.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=c.LoaderStatus.kComplete},a.prototype._onReadyStateChange=function(l){var r=l.target;if(r.readyState===2){if(r.responseURL!=null&&r.responseURL!==this._requestURL&&this._onURLRedirect){var t=this._seekHandler.removeURLParameters(r.responseURL);this._onURLRedirect(t)}if(r.status!==0&&(r.status<200||r.status>299))if(this._status=c.LoaderStatus.kError,this._onError)this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText});else throw new d.RuntimeException("MozChunkedLoader: Http code invalid, "+r.status+" "+r.statusText);else this._status=c.LoaderStatus.kBuffering}},a.prototype._onProgress=function(l){if(this._status!==c.LoaderStatus.kError){this._contentLength===null&&l.total!==null&&l.total!==0&&(this._contentLength=l.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var r=l.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,t,this._receivedLength)}},a.prototype._onLoadEnd=function(l){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===c.LoaderStatus.kError)return;this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},a.prototype._onXhrError=function(l){this._status=c.LoaderStatus.kError;var r=0,t=null;if(this._contentLength&&l.loaded<this._contentLength?(r=c.LoaderErrors.EARLY_EOF,t={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(r=c.LoaderErrors.EXCEPTION,t={code:-1,msg:l.constructor.name+" "+l.type}),this._onError)this._onError(r,t);else throw new d.RuntimeException(t.msg)},a}(c.BaseLoader);L.default=f},"./src/io/xhr-range-loader.js":function(w,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/io/speed-sampler.js"),d=m("./src/io/loader.js"),o=m("./src/utils/exception.js"),f=function(){var a=function(l,r){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},a(l,r)};return function(l,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");a(l,r);function t(){this.constructor=l}l.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),s=function(a){f(l,a);function l(r,t){var i=a.call(this,"xhr-range-loader")||this;return i.TAG="RangeLoader",i._seekHandler=r,i._config=t,i._needStash=!1,i._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],i._currentChunkSizeKB=384,i._currentSpeedNormalized=0,i._zeroSpeedChunkCount=0,i._xhr=null,i._speedSampler=new c.default,i._requestAbort=!1,i._waitForTotalLength=!1,i._totalLengthReceived=!1,i._currentRequestURL=null,i._currentRedirectedURL=null,i._currentRequestRange=null,i._totalLength=null,i._contentLength=null,i._receivedLength=0,i._lastTimeLoaded=0,i}return l.isSupported=function(){try{var r=new XMLHttpRequest;return r.open("GET","https://example.com",!0),r.responseType="arraybuffer",r.responseType==="arraybuffer"}catch(t){return y.default.w("RangeLoader",t.message),!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),a.prototype.destroy.call(this)},Object.defineProperty(l.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),l.prototype.open=function(r,t){this._dataSource=r,this._range=t,this._status=d.LoaderStatus.kConnecting;var i=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(i=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!i?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},l.prototype._openSubRange=function(){var r=this._currentChunkSizeKB*1024,t=this._range.from+this._receivedLength,i=t+r;this._contentLength!=null&&i-this._range.from>=this._contentLength&&(i=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:i},this._internalOpen(this._dataSource,this._currentRequestRange)},l.prototype._internalOpen=function(r,t){this._lastTimeLoaded=0;var i=r.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?i=this._currentRedirectedURL:r.redirectedURL!=null&&(i=r.redirectedURL));var n=this._seekHandler.getConfig(i,t);this._currentRequestURL=n.url;var e=this._xhr=new XMLHttpRequest;if(e.open("GET",n.url,!0),e.responseType="arraybuffer",e.onreadystatechange=this._onReadyStateChange.bind(this),e.onprogress=this._onProgress.bind(this),e.onload=this._onLoad.bind(this),e.onerror=this._onXhrError.bind(this),r.withCredentials&&(e.withCredentials=!0),typeof n.headers=="object"){var u=n.headers;for(var _ in u)u.hasOwnProperty(_)&&e.setRequestHeader(_,u[_])}if(typeof this._config.headers=="object"){var u=this._config.headers;for(var _ in u)u.hasOwnProperty(_)&&e.setRequestHeader(_,u[_])}e.send()},l.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=d.LoaderStatus.kComplete},l.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},l.prototype._onReadyStateChange=function(r){var t=r.target;if(t.readyState===2){if(t.responseURL!=null){var i=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&i!==this._currentRedirectedURL&&(this._currentRedirectedURL=i,this._onURLRedirect&&this._onURLRedirect(i))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=d.LoaderStatus.kBuffering}else if(this._status=d.LoaderStatus.kError,this._onError)this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new o.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText)}},l.prototype._onProgress=function(r){if(this._status!==d.LoaderStatus.kError){if(this._contentLength===null){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var i=r.total;this._internalAbort(),i!=null&i!==0&&(this._totalLength=i)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=r.loaded-this._lastTimeLoaded;this._lastTimeLoaded=r.loaded,this._speedSampler.addBytes(n)}},l.prototype._normalizeSpeed=function(r){var t=this._chunkSizeKBList,i=t.length-1,n=0,e=0,u=i;if(r<t[0])return t[0];for(;e<=u;){if(n=e+Math.floor((u-e)/2),n===i||r>=t[n]&&r<t[n+1])return t[n];t[n]<r?e=n+1:u=n-1}},l.prototype._onLoad=function(r){if(this._status!==d.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(t===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),t!==0){var i=this._normalizeSpeed(t);this._currentSpeedNormalized!==i&&(this._currentSpeedNormalized=i,this._currentChunkSizeKB=i)}var n=r.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var u=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():u=!0,this._onDataArrival&&this._onDataArrival(n,e,this._receivedLength),u&&(this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},l.prototype._onXhrError=function(r){this._status=d.LoaderStatus.kError;var t=0,i=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=d.LoaderErrors.EARLY_EOF,i={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=d.LoaderErrors.EXCEPTION,i={code:-1,msg:r.constructor.name+" "+r.type}),this._onError)this._onError(t,i);else throw new o.RuntimeException(i.msg)},l}(d.BaseLoader);L.default=s},"./src/player/flv-player.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),o=m("./src/utils/browser.js"),f=m("./src/player/player-events.js"),s=m("./src/core/transmuxer.js"),a=m("./src/core/transmuxing-events.js"),l=m("./src/core/mse-controller.js"),r=m("./src/core/mse-events.js"),t=m("./src/player/player-errors.js"),i=m("./src/config.js"),n=m("./src/utils/exception.js"),e=function(){function u(_,p){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(c()),this._config=(0,i.createDefaultConfig)(),typeof p=="object"&&Object.assign(this._config,p),_.type.toLowerCase()!=="flv")throw new n.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");_.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=_,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var g=o.default.chrome&&(o.default.version.major<50||o.default.version.major===50&&o.default.version.build<2661);this._alwaysSeekKeyframe=!!(g||o.default.msedge||o.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return u.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},u.prototype.on=function(_,p){var g=this;_===f.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){g._emitter.emit(f.default.MEDIA_INFO,g.mediaInfo)}):_===f.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){g._emitter.emit(f.default.STATISTICS_INFO,g.statisticsInfo)}),this._emitter.addListener(_,p)},u.prototype.off=function(_,p){this._emitter.removeListener(_,p)},u.prototype.attachMediaElement=function(_){var p=this;if(this._mediaElement=_,_.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),_.addEventListener("seeking",this.e.onvSeeking),_.addEventListener("canplay",this.e.onvCanPlay),_.addEventListener("stalled",this.e.onvStalled),_.addEventListener("progress",this.e.onvProgress),this._msectl=new l.default(this._config),this._msectl.on(r.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(r.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(r.default.SOURCE_OPEN,function(){p._mseSourceOpened=!0,p._hasPendingLoad&&(p._hasPendingLoad=!1,p.load())}),this._msectl.on(r.default.ERROR,function(g){p._emitter.emit(f.default.ERROR,t.ErrorTypes.MEDIA_ERROR,t.ErrorDetails.MEDIA_MSE_ERROR,g)}),this._msectl.attachMediaElement(_),this._pendingSeekTime!=null)try{_.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},u.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},u.prototype.load=function(){var _=this;if(!this._mediaElement)throw new n.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new n.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new s.default(this._mediaDataSource,this._config),this._transmuxer.on(a.default.INIT_SEGMENT,function(p,g){_._msectl.appendInitSegment(g)}),this._transmuxer.on(a.default.MEDIA_SEGMENT,function(p,g){if(_._msectl.appendMediaSegment(g),_._config.lazyLoad&&!_._config.isLive){var b=_._mediaElement.currentTime;g.info.endDts>=(b+_._config.lazyLoadMaxDuration)*1e3&&_._progressChecker==null&&(d.default.v(_.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),_._suspendTransmuxer())}}),this._transmuxer.on(a.default.LOADING_COMPLETE,function(){_._msectl.endOfStream(),_._emitter.emit(f.default.LOADING_COMPLETE)}),this._transmuxer.on(a.default.RECOVERED_EARLY_EOF,function(){_._emitter.emit(f.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(a.default.IO_ERROR,function(p,g){_._emitter.emit(f.default.ERROR,t.ErrorTypes.NETWORK_ERROR,p,g)}),this._transmuxer.on(a.default.DEMUX_ERROR,function(p,g){_._emitter.emit(f.default.ERROR,t.ErrorTypes.MEDIA_ERROR,p,{code:-1,msg:g})}),this._transmuxer.on(a.default.MEDIA_INFO,function(p){_._mediaInfo=p,_._emitter.emit(f.default.MEDIA_INFO,Object.assign({},p))}),this._transmuxer.on(a.default.METADATA_ARRIVED,function(p){_._emitter.emit(f.default.METADATA_ARRIVED,p)}),this._transmuxer.on(a.default.SCRIPTDATA_ARRIVED,function(p){_._emitter.emit(f.default.SCRIPTDATA_ARRIVED,p)}),this._transmuxer.on(a.default.STATISTICS_INFO,function(p){_._statisticsInfo=_._fillStatisticsInfo(p),_._emitter.emit(f.default.STATISTICS_INFO,Object.assign({},_._statisticsInfo))}),this._transmuxer.on(a.default.RECOMMEND_SEEKPOINT,function(p){_._mediaElement&&!_._config.accurateSeek&&(_._requestSetTime=!0,_._mediaElement.currentTime=p/1e3)}),this._transmuxer.open()}},u.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},u.prototype.play=function(){return this._mediaElement.play()},u.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(u.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(_){this._mediaElement.volume=_},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(_){this._mediaElement.muted=_},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(_){this._mediaElement?this._internalSeek(_):this._pendingSeekTime=_},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),u.prototype._fillStatisticsInfo=function(_){if(_.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return _;var p=!0,g=0,b=0;if(this._mediaElement.getVideoPlaybackQuality){var E=this._mediaElement.getVideoPlaybackQuality();g=E.totalVideoFrames,b=E.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(g=this._mediaElement.webkitDecodedFrameCount,b=this._mediaElement.webkitDroppedFrameCount):p=!1;return p&&(_.decodedFrames=g,_.droppedFrames=b),_},u.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var _=this._mediaElement.buffered,p=this._mediaElement.currentTime,g=0,b=0;b<_.length;b++){var E=_.start(b),v=_.end(b);if(E<=p&&p<v){g=v;break}}g>=p+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(d.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},u.prototype._onmseBufferFull=function(){d.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},u.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},u.prototype._checkProgressAndResume=function(){for(var _=this._mediaElement.currentTime,p=this._mediaElement.buffered,g=!1,b=0;b<p.length;b++){var E=p.start(b),v=p.end(b);if(_>=E&&_<v){_>=v-this._config.lazyLoadRecoverDuration&&(g=!0);break}}g&&(window.clearInterval(this._progressChecker),this._progressChecker=null,g&&(d.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},u.prototype._isTimepointBuffered=function(_){for(var p=this._mediaElement.buffered,g=0;g<p.length;g++){var b=p.start(g),E=p.end(g);if(_>=b&&_<E)return!0}return!1},u.prototype._internalSeek=function(_){var p=this._isTimepointBuffered(_),g=!1,b=0;if(_<1&&this._mediaElement.buffered.length>0){var E=this._mediaElement.buffered.start(0);(E<1&&_<E||o.default.safari)&&(g=!0,b=o.default.safari?.1:E)}if(g)this._requestSetTime=!0,this._mediaElement.currentTime=b;else if(p){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=_;else{var v=this._msectl.getNearestKeyframe(Math.floor(_*1e3));this._requestSetTime=!0,v!=null?this._mediaElement.currentTime=v.dts/1e3:this._mediaElement.currentTime=_}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(_),this._transmuxer.seek(Math.floor(_*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=_)},u.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var _=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(_)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(_),this._transmuxer.seek(Math.floor(_*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=_))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},u.prototype._checkAndResumeStuckPlayback=function(_){var p=this._mediaElement;if(_||!this._receivedCanPlay||p.readyState<2){var g=p.buffered;g.length>0&&p.currentTime<g.start(0)&&(d.default.w(this.TAG,"Playback seems stuck at "+p.currentTime+", seek to "+g.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=g.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},u.prototype._onvLoadedMetadata=function(_){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},u.prototype._onvSeeking=function(_){var p=this._mediaElement.currentTime,g=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(p<1&&g.length>0){var b=g.start(0);if(b<1&&p<b||o.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=o.default.safari?.1:b;return}}if(this._isTimepointBuffered(p)){if(this._alwaysSeekKeyframe){var E=this._msectl.getNearestKeyframe(Math.floor(p*1e3));E!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=E.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:p,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},u.prototype._onvCanPlay=function(_){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},u.prototype._onvStalled=function(_){this._checkAndResumeStuckPlayback(!0)},u.prototype._onvProgress=function(_){this._checkAndResumeStuckPlayback()},u}();L.default=e},"./src/player/native-player.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/player/player-events.js"),o=m("./src/config.js"),f=m("./src/utils/exception.js"),s=function(){function a(l,r){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(c()),this._config=(0,o.createDefaultConfig)(),typeof r=="object"&&Object.assign(this._config,r),l.type.toLowerCase()==="flv")throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(l.hasOwnProperty("segments"))throw new f.InvalidArgumentException("NativePlayer("+l.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=l,this._mediaElement=null}return a.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(l,r){var t=this;l===d.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(d.default.MEDIA_INFO,t.mediaInfo)}):l===d.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(d.default.STATISTICS_INFO,t.statisticsInfo)}),this._emitter.addListener(l,r)},a.prototype.off=function(l,r){this._emitter.removeListener(l,r)},a.prototype.attachMediaElement=function(l){if(this._mediaElement=l,l.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{l.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},a.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},a.prototype.load=function(){if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},a.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},a.prototype.play=function(){return this._mediaElement.play()},a.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(l){this._mediaElement.volume=l},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(l){this._mediaElement.muted=l},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(l){this._mediaElement?this._mediaElement.currentTime=l:this._pendingSeekTime=l},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mediaInfo",{get:function(){var l=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",r={mimeType:l+this._mediaDataSource.type};return this._mediaElement&&(r.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(r.width=this._mediaElement.videoWidth,r.height=this._mediaElement.videoHeight)),r},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"statisticsInfo",{get:function(){var l={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return l;var r=!0,t=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();t=n.totalVideoFrames,i=n.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(t=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):r=!1;return r&&(l.decodedFrames=t,l.droppedFrames=i),l},enumerable:!1,configurable:!0}),a.prototype._onvLoadedMetadata=function(l){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(d.default.MEDIA_INFO,this.mediaInfo)},a.prototype._reportStatisticsInfo=function(){this._emitter.emit(d.default.STATISTICS_INFO,this.statisticsInfo)},a}();L.default=s},"./src/player/player-errors.js":function(w,L,m){m.r(L),m.d(L,{ErrorTypes:function(){return d},ErrorDetails:function(){return o}});var y=m("./src/io/loader.js"),c=m("./src/demux/demux-errors.js"),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},o={NETWORK_EXCEPTION:y.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:y.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:y.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:y.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:c.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:c.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:c.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(w,L,m){m.r(L);var y={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};L.default=y},"./src/remux/aac-silent.js":function(w,L,m){m.r(L);var y=function(){function c(){}return c.getSilentFrame=function(d,o){if(d==="mp4a.40.2"){if(o===1)return new Uint8Array([0,200,0,128,35,128]);if(o===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(o===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(o===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(o===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(o===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(o===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(o===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(o===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},c}();L.default=y},"./src/remux/mp4-generator.js":function(w,L,m){m.r(L);var y=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var d in c.types)c.types.hasOwnProperty(d)&&(c.types[d]=[d.charCodeAt(0),d.charCodeAt(1),d.charCodeAt(2),d.charCodeAt(3)]);var o=c.constants={};o.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),o.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),o.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),o.STSC=o.STCO=o.STTS,o.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),o.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),o.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),o.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),o.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},c.box=function(d){for(var o=8,f=null,s=Array.prototype.slice.call(arguments,1),a=s.length,l=0;l<a;l++)o+=s[l].byteLength;f=new Uint8Array(o),f[0]=o>>>24&255,f[1]=o>>>16&255,f[2]=o>>>8&255,f[3]=o&255,f.set(d,4);for(var r=8,l=0;l<a;l++)f.set(s[l],r),r+=s[l].byteLength;return f},c.generateInitSegment=function(d){var o=c.box(c.types.ftyp,c.constants.FTYP),f=c.moov(d),s=new Uint8Array(o.byteLength+f.byteLength);return s.set(o,0),s.set(f,o.byteLength),s},c.moov=function(d){var o=c.mvhd(d.timescale,d.duration),f=c.trak(d),s=c.mvex(d);return c.box(c.types.moov,o,f,s)},c.mvhd=function(d,o){return c.box(c.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},c.trak=function(d){return c.box(c.types.trak,c.tkhd(d),c.mdia(d))},c.tkhd=function(d){var o=d.id,f=d.duration,s=d.presentWidth,a=d.presentHeight;return c.box(c.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>>8&255,s&255,0,0,a>>>8&255,a&255,0,0]))},c.mdia=function(d){return c.box(c.types.mdia,c.mdhd(d),c.hdlr(d),c.minf(d))},c.mdhd=function(d){var o=d.timescale,f=d.duration;return c.box(c.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,85,196,0,0]))},c.hdlr=function(d){var o=null;return d.type==="audio"?o=c.constants.HDLR_AUDIO:o=c.constants.HDLR_VIDEO,c.box(c.types.hdlr,o)},c.minf=function(d){var o=null;return d.type==="audio"?o=c.box(c.types.smhd,c.constants.SMHD):o=c.box(c.types.vmhd,c.constants.VMHD),c.box(c.types.minf,o,c.dinf(),c.stbl(d))},c.dinf=function(){var d=c.box(c.types.dinf,c.box(c.types.dref,c.constants.DREF));return d},c.stbl=function(d){var o=c.box(c.types.stbl,c.stsd(d),c.box(c.types.stts,c.constants.STTS),c.box(c.types.stsc,c.constants.STSC),c.box(c.types.stsz,c.constants.STSZ),c.box(c.types.stco,c.constants.STCO));return o},c.stsd=function(d){return d.type==="audio"?d.codec==="mp3"?c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp3(d)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.mp4a(d)):c.box(c.types.stsd,c.constants.STSD_PREFIX,c.avc1(d))},c.mp3=function(d){var o=d.channelCount,f=d.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,o,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return c.box(c.types[".mp3"],s)},c.mp4a=function(d){var o=d.channelCount,f=d.audioSampleRate,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,o,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return c.box(c.types.mp4a,s,c.esds(d))},c.esds=function(d){var o=d.config||[],f=o.length,s=new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(o).concat([6,1,2]));return c.box(c.types.esds,s)},c.avc1=function(d){var o=d.avcc,f=d.codecWidth,s=d.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,f&255,s>>>8&255,s&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return c.box(c.types.avc1,a,c.box(c.types.avcC,o))},c.mvex=function(d){return c.box(c.types.mvex,c.trex(d))},c.trex=function(d){var o=d.id,f=new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return c.box(c.types.trex,f)},c.moof=function(d,o){return c.box(c.types.moof,c.mfhd(d.sequenceNumber),c.traf(d,o))},c.mfhd=function(d){var o=new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255]);return c.box(c.types.mfhd,o)},c.traf=function(d,o){var f=d.id,s=c.box(c.types.tfhd,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255])),a=c.box(c.types.tfdt,new Uint8Array([0,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255])),l=c.sdtp(d),r=c.trun(d,l.byteLength+16+16+8+16+8+8);return c.box(c.types.traf,s,a,r,l)},c.sdtp=function(d){for(var o=d.samples||[],f=o.length,s=new Uint8Array(4+f),a=0;a<f;a++){var l=o[a].flags;s[a+4]=l.isLeading<<6|l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy}return c.box(c.types.sdtp,s)},c.trun=function(d,o){var f=d.samples||[],s=f.length,a=12+16*s,l=new Uint8Array(a);o+=8+a,l.set([0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255],0);for(var r=0;r<s;r++){var t=f[r].duration,i=f[r].size,n=f[r].flags,e=f[r].cts;l.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.isNonSync,0,0,e>>>24&255,e>>>16&255,e>>>8&255,e&255],12+16*r)}return c.box(c.types.trun,l)},c.mdat=function(d){return c.box(c.types.mdat,d)},c}();y.init(),L.default=y},"./src/remux/mp4-remuxer.js":function(w,L,m){m.r(L);var y=m("./src/utils/logger.js"),c=m("./src/remux/mp4-generator.js"),d=m("./src/remux/aac-silent.js"),o=m("./src/utils/browser.js"),f=m("./src/core/media-segment-info.js"),s=m("./src/utils/exception.js"),a=function(){function l(r){this.TAG="MP4Remuxer",this._config=r,this._isLive=r.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new f.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new f.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(o.default.chrome&&(o.default.version.major<50||o.default.version.major===50&&o.default.version.build<2661)),this._fillSilentAfterSeek=o.default.msedge||o.default.msie,this._mp3UseMpegAudio=!o.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return l.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},l.prototype.bindDataSource=function(r){return r.onDataAvailable=this.remux.bind(this),r.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(l.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(r){this._onInitSegment=r},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(r){this._onMediaSegment=r},enumerable:!1,configurable:!0}),l.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},l.prototype.seek=function(r){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},l.prototype.remux=function(r,t){if(!this._onMediaSegment)throw new s.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(r,t),this._remuxVideo(t),this._remuxAudio(r)},l.prototype._onTrackMetadataReceived=function(r,t){var i=null,n="mp4",e=t.codec;if(r==="audio")this._audioMeta=t,t.codec==="mp3"&&this._mp3UseMpegAudio?(n="mpeg",e="",i=new Uint8Array):i=c.default.generateInitSegment(t);else if(r==="video")this._videoMeta=t,i=c.default.generateInitSegment(t);else return;if(!this._onInitSegment)throw new s.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(r,{type:r,data:i.buffer,codec:e,container:r+"/"+n,mediaDuration:t.duration})},l.prototype._calculateDtsBase=function(r,t){this._dtsBaseInited||(r.samples&&r.samples.length&&(this._audioDtsBase=r.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},l.prototype.flushStashedSamples=function(){var r=this._videoStashedLastSample,t=this._audioStashedLastSample,i={type:"video",id:1,sequenceNumber:0,samples:[],length:0};r!=null&&(i.samples.push(r),i.length=r.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};t!=null&&(n.samples.push(t),n.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(i,!0),this._remuxAudio(n,!0)},l.prototype._remuxAudio=function(r,t){if(this._audioMeta!=null){var i=r,n=i.samples,e=void 0,u=-1,_=-1,p=this._audioMeta.refSampleDuration,g=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,b=this._dtsBaseInited&&this._audioNextDts===void 0,E=!1;if(!(!n||n.length===0)&&!(n.length===1&&!t)){var v=0,x=null,S=0;g?(v=0,S=i.length):(v=8,S=8+i.length);var O=null;if(n.length>1&&(O=n.pop(),S-=O.length),this._audioStashedLastSample!=null){var R=this._audioStashedLastSample;this._audioStashedLastSample=null,n.unshift(R),S+=R.length}O!=null&&(this._audioStashedLastSample=O);var I=n[0].dts-this._dtsBase;if(this._audioNextDts)e=I-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())e=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(E=!0);else{var B=this._audioSegmentInfoList.getLastSampleBefore(I);if(B!=null){var U=I-(B.originalDts+B.duration);U<=3&&(U=0);var k=B.dts+B.duration+U;e=I-k}else e=0}if(E){var N=I-e,V=this._videoSegmentInfoList.getLastSegmentBefore(I);if(V!=null&&V.beginDts<N){var P=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(P){var W=V.beginDts,ie=N-V.beginDts;y.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+W+", duration: "+ie),n.unshift({unit:P,dts:W,pts:W}),S+=P.byteLength}}else E=!1}for(var K=[],z=0;z<n.length;z++){var R=n[z],ee=R.unit,Q=R.dts-this._dtsBase,W=Q,$=!1,ue=null,H=0;if(!(Q<-.001)){if(this._audioMeta.codec!=="mp3"){var D=Q,q=3;if(this._audioNextDts&&(D=this._audioNextDts),e=Q-D,e<=-q*p){y.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Q+" ms ,curRefDts: "+D+" ms)  due to dtsCorrection: "+e+" ms overlap.");continue}else if(e>=q*p&&this._fillAudioTimestampGap&&!o.default.safari){$=!0;var se=Math.floor(e/p);y.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+Q+" ms, curRefDts: "+D+" ms, ")+("dtsCorrection: "+Math.round(e)+" ms, generate: "+se+" frames")),W=Math.floor(D),H=Math.floor(D+p)-W;var P=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);P==null&&(y.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),P=ee),ue=[];for(var he=0;he<se;he++){D=D+p;var le=Math.floor(D),de=Math.floor(D+p)-le,ce={dts:le,pts:le,cts:0,unit:P,size:P.byteLength,duration:de,originalDts:Q,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ue.push(ce),S+=ce.size}this._audioNextDts=D+p}else W=Math.floor(D),H=Math.floor(D+p)-W,this._audioNextDts=D+p}else{if(W=Q-e,z!==n.length-1){var _e=n[z+1].dts-this._dtsBase-e;H=_e-W}else if(O!=null){var _e=O.dts-this._dtsBase-e;H=_e-W}else K.length>=1?H=K[K.length-1].duration:H=Math.floor(p);this._audioNextDts=W+H}u===-1&&(u=W),K.push({dts:W,pts:W,cts:0,unit:R.unit,size:R.unit.byteLength,duration:H,originalDts:Q,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),$&&K.push.apply(K,ue)}}if(K.length===0){i.samples=[],i.length=0;return}g?x=new Uint8Array(S):(x=new Uint8Array(S),x[0]=S>>>24&255,x[1]=S>>>16&255,x[2]=S>>>8&255,x[3]=S&255,x.set(c.default.types.mdat,4));for(var z=0;z<K.length;z++){var ee=K[z].unit;x.set(ee,v),v+=ee.byteLength}var ae=K[K.length-1];_=ae.dts+ae.duration;var te=new f.MediaSegmentInfo;te.beginDts=u,te.endDts=_,te.beginPts=u,te.endPts=_,te.originalBeginDts=K[0].originalDts,te.originalEndDts=ae.originalDts+ae.duration,te.firstSample=new f.SampleInfo(K[0].dts,K[0].pts,K[0].duration,K[0].originalDts,!1),te.lastSample=new f.SampleInfo(ae.dts,ae.pts,ae.duration,ae.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(te),i.samples=K,i.sequenceNumber++;var me=null;g?me=new Uint8Array:me=c.default.moof(i,u),i.samples=[],i.length=0;var ve={type:"audio",data:this._mergeBoxes(me,x).buffer,sampleCount:K.length,info:te};g&&b&&(ve.timestampOffset=u),this._onMediaSegment("audio",ve)}}},l.prototype._remuxVideo=function(r,t){if(this._videoMeta!=null){var i=r,n=i.samples,e=void 0,u=-1,_=-1,p=-1,g=-1;if(!(!n||n.length===0)&&!(n.length===1&&!t)){var b=8,E=null,v=8+r.length,x=null;if(n.length>1&&(x=n.pop(),v-=x.length),this._videoStashedLastSample!=null){var S=this._videoStashedLastSample;this._videoStashedLastSample=null,n.unshift(S),v+=S.length}x!=null&&(this._videoStashedLastSample=x);var O=n[0].dts-this._dtsBase;if(this._videoNextDts)e=O-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())e=0;else{var R=this._videoSegmentInfoList.getLastSampleBefore(O);if(R!=null){var I=O-(R.originalDts+R.duration);I<=3&&(I=0);var B=R.dts+R.duration+I;e=O-B}else e=0}for(var U=new f.MediaSegmentInfo,k=[],N=0;N<n.length;N++){var S=n[N],V=S.dts-this._dtsBase,P=S.isKeyframe,W=V-e,ie=S.cts,K=W+ie;u===-1&&(u=W,p=K);var z=0;if(N!==n.length-1){var ee=n[N+1].dts-this._dtsBase-e;z=ee-W}else if(x!=null){var ee=x.dts-this._dtsBase-e;z=ee-W}else k.length>=1?z=k[k.length-1].duration:z=Math.floor(this._videoMeta.refSampleDuration);if(P){var Q=new f.SampleInfo(W,K,z,S.dts,!0);Q.fileposition=S.fileposition,U.appendSyncPoint(Q)}k.push({dts:W,pts:K,cts:ie,units:S.units,size:S.length,isKeyframe:P,duration:z,originalDts:V,flags:{isLeading:0,dependsOn:P?2:1,isDependedOn:P?1:0,hasRedundancy:0,isNonSync:P?0:1}})}E=new Uint8Array(v),E[0]=v>>>24&255,E[1]=v>>>16&255,E[2]=v>>>8&255,E[3]=v&255,E.set(c.default.types.mdat,4);for(var N=0;N<k.length;N++)for(var $=k[N].units;$.length;){var ue=$.shift(),H=ue.data;E.set(H,b),b+=H.byteLength}var D=k[k.length-1];if(_=D.dts+D.duration,g=D.pts+D.duration,this._videoNextDts=_,U.beginDts=u,U.endDts=_,U.beginPts=p,U.endPts=g,U.originalBeginDts=k[0].originalDts,U.originalEndDts=D.originalDts+D.duration,U.firstSample=new f.SampleInfo(k[0].dts,k[0].pts,k[0].duration,k[0].originalDts,k[0].isKeyframe),U.lastSample=new f.SampleInfo(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(U),i.samples=k,i.sequenceNumber++,this._forceFirstIDR){var q=k[0].flags;q.dependsOn=2,q.isNonSync=0}var se=c.default.moof(i,u);i.samples=[],i.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(se,E).buffer,sampleCount:k.length,info:U})}}},l.prototype._mergeBoxes=function(r,t){var i=new Uint8Array(r.byteLength+t.byteLength);return i.set(r,0),i.set(t,r.byteLength),i},l}();L.default=a},"./src/utils/browser.js":function(w,L,m){m.r(L);var y={};function c(){var d=self.navigator.userAgent.toLowerCase(),o=/(edge)\/([\w.]+)/.exec(d)||/(opr)[\/]([\w.]+)/.exec(d)||/(chrome)[ \/]([\w.]+)/.exec(d)||/(iemobile)[\/]([\w.]+)/.exec(d)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||d.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(d)||d.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(d)||[],f=/(ipad)/.exec(d)||/(ipod)/.exec(d)||/(windows phone)/.exec(d)||/(iphone)/.exec(d)||/(kindle)/.exec(d)||/(android)/.exec(d)||/(windows)/.exec(d)||/(mac)/.exec(d)||/(linux)/.exec(d)||/(cros)/.exec(d)||[],s={browser:o[5]||o[3]||o[1]||"",version:o[2]||o[4]||"0",majorVersion:o[4]||o[2]||"0",platform:f[0]||""},a={};if(s.browser){a[s.browser]=!0;var l=s.majorVersion.split(".");a.version={major:parseInt(s.majorVersion,10),string:s.version},l.length>1&&(a.version.minor=parseInt(l[1],10)),l.length>2&&(a.version.build=parseInt(l[2],10))}if(s.platform&&(a[s.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;var r="msie";s.browser=r,a[r]=!0}if(a.edge){delete a.edge;var t="msedge";s.browser=t,a[t]=!0}if(a.opr){var i="opera";s.browser=i,a[i]=!0}if(a.safari&&a.android){var n="android";s.browser=n,a[n]=!0}a.name=s.browser,a.platform=s.platform;for(var e in y)y.hasOwnProperty(e)&&delete y[e];Object.assign(y,a)}c(),L.default=y},"./src/utils/exception.js":function(w,L,m){m.r(L),m.d(L,{RuntimeException:function(){return c},IllegalStateException:function(){return d},InvalidArgumentException:function(){return o},NotImplementedException:function(){return f}});var y=function(){var s=function(a,l){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])},s(a,l)};return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");s(a,l);function r(){this.constructor=a}a.prototype=l===null?Object.create(l):(r.prototype=l.prototype,new r)}}(),c=function(){function s(a){this._message=a}return Object.defineProperty(s.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),s.prototype.toString=function(){return this.name+": "+this.message},s}(),d=function(s){y(a,s);function a(l){return s.call(this,l)||this}return Object.defineProperty(a.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),a}(c),o=function(s){y(a,s);function a(l){return s.call(this,l)||this}return Object.defineProperty(a.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),a}(c),f=function(s){y(a,s);function a(l){return s.call(this,l)||this}return Object.defineProperty(a.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),a}(c)},"./src/utils/logger.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=function(){function o(){}return o.e=function(f,s){(!f||o.FORCE_GLOBAL_TAG)&&(f=o.GLOBAL_TAG);var a="["+f+"] > "+s;o.ENABLE_CALLBACK&&o.emitter.emit("log","error",a),o.ENABLE_ERROR&&(console.error?console.error(a):console.warn?console.warn(a):console.log(a))},o.i=function(f,s){(!f||o.FORCE_GLOBAL_TAG)&&(f=o.GLOBAL_TAG);var a="["+f+"] > "+s;o.ENABLE_CALLBACK&&o.emitter.emit("log","info",a),o.ENABLE_INFO&&(console.info?console.info(a):console.log(a))},o.w=function(f,s){(!f||o.FORCE_GLOBAL_TAG)&&(f=o.GLOBAL_TAG);var a="["+f+"] > "+s;o.ENABLE_CALLBACK&&o.emitter.emit("log","warn",a),o.ENABLE_WARN&&(console.warn?console.warn(a):console.log(a))},o.d=function(f,s){(!f||o.FORCE_GLOBAL_TAG)&&(f=o.GLOBAL_TAG);var a="["+f+"] > "+s;o.ENABLE_CALLBACK&&o.emitter.emit("log","debug",a),o.ENABLE_DEBUG&&(console.debug?console.debug(a):console.log(a))},o.v=function(f,s){(!f||o.FORCE_GLOBAL_TAG)&&(f=o.GLOBAL_TAG);var a="["+f+"] > "+s;o.ENABLE_CALLBACK&&o.emitter.emit("log","verbose",a),o.ENABLE_VERBOSE&&console.log(a)},o}();d.GLOBAL_TAG="flv.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new(c()),L.default=d},"./src/utils/logging-control.js":function(w,L,m){m.r(L);var y=m("./node_modules/events/events.js"),c=m.n(y),d=m("./src/utils/logger.js"),o=function(){function f(){}return Object.defineProperty(f,"forceGlobalTag",{get:function(){return d.default.FORCE_GLOBAL_TAG},set:function(s){d.default.FORCE_GLOBAL_TAG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"globalTag",{get:function(){return d.default.GLOBAL_TAG},set:function(s){d.default.GLOBAL_TAG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableAll",{get:function(){return d.default.ENABLE_VERBOSE&&d.default.ENABLE_DEBUG&&d.default.ENABLE_INFO&&d.default.ENABLE_WARN&&d.default.ENABLE_ERROR},set:function(s){d.default.ENABLE_VERBOSE=s,d.default.ENABLE_DEBUG=s,d.default.ENABLE_INFO=s,d.default.ENABLE_WARN=s,d.default.ENABLE_ERROR=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableDebug",{get:function(){return d.default.ENABLE_DEBUG},set:function(s){d.default.ENABLE_DEBUG=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableVerbose",{get:function(){return d.default.ENABLE_VERBOSE},set:function(s){d.default.ENABLE_VERBOSE=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableInfo",{get:function(){return d.default.ENABLE_INFO},set:function(s){d.default.ENABLE_INFO=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableWarn",{get:function(){return d.default.ENABLE_WARN},set:function(s){d.default.ENABLE_WARN=s,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableError",{get:function(){return d.default.ENABLE_ERROR},set:function(s){d.default.ENABLE_ERROR=s,f._notifyChange()},enumerable:!1,configurable:!0}),f.getConfig=function(){return{globalTag:d.default.GLOBAL_TAG,forceGlobalTag:d.default.FORCE_GLOBAL_TAG,enableVerbose:d.default.ENABLE_VERBOSE,enableDebug:d.default.ENABLE_DEBUG,enableInfo:d.default.ENABLE_INFO,enableWarn:d.default.ENABLE_WARN,enableError:d.default.ENABLE_ERROR,enableCallback:d.default.ENABLE_CALLBACK}},f.applyConfig=function(s){d.default.GLOBAL_TAG=s.globalTag,d.default.FORCE_GLOBAL_TAG=s.forceGlobalTag,d.default.ENABLE_VERBOSE=s.enableVerbose,d.default.ENABLE_DEBUG=s.enableDebug,d.default.ENABLE_INFO=s.enableInfo,d.default.ENABLE_WARN=s.enableWarn,d.default.ENABLE_ERROR=s.enableError,d.default.ENABLE_CALLBACK=s.enableCallback},f._notifyChange=function(){var s=f.emitter;if(s.listenerCount("change")>0){var a=f.getConfig();s.emit("change",a)}},f.registerListener=function(s){f.emitter.addListener("change",s)},f.removeListener=function(s){f.emitter.removeListener("change",s)},f.addLogListener=function(s){d.default.emitter.addListener("log",s),d.default.emitter.listenerCount("log")>0&&(d.default.ENABLE_CALLBACK=!0,f._notifyChange())},f.removeLogListener=function(s){d.default.emitter.removeListener("log",s),d.default.emitter.listenerCount("log")===0&&(d.default.ENABLE_CALLBACK=!1,f._notifyChange())},f}();o.emitter=new(c()),L.default=o},"./src/utils/polyfill.js":function(w,L,m){m.r(L);var y=function(){function c(){}return c.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,o){return d.__proto__=o,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(d),f=1;f<arguments.length;f++){var s=arguments[f];if(s!=null)for(var a in s)s.hasOwnProperty(a)&&(o[a]=s[a])}return o},typeof self.Promise!="function"&&m("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},c}();y.install(),L.default=y},"./src/utils/utf8-conv.js":function(w,L,m){m.r(L);function y(d,o,f){var s=d;if(o+f<s.length){for(;f--;)if((s[++o]&192)!==128)return!1;return!0}else return!1}function c(d){for(var o=[],f=d,s=0,a=d.length;s<a;){if(f[s]<128){o.push(String.fromCharCode(f[s])),++s;continue}else if(!(f[s]<192)){if(f[s]<224){if(y(f,s,1)){var l=(f[s]&31)<<6|f[s+1]&63;if(l>=128){o.push(String.fromCharCode(l&65535)),s+=2;continue}}}else if(f[s]<240){if(y(f,s,2)){var l=(f[s]&15)<<12|(f[s+1]&63)<<6|f[s+2]&63;if(l>=2048&&(l&63488)!==55296){o.push(String.fromCharCode(l&65535)),s+=3;continue}}}else if(f[s]<248&&y(f,s,3)){var l=(f[s]&7)<<18|(f[s+1]&63)<<12|(f[s+2]&63)<<6|f[s+3]&63;if(l>65536&&l<1114112){l-=65536,o.push(String.fromCharCode(l>>>10|55296)),o.push(String.fromCharCode(l&1023|56320)),s+=4;continue}}}o.push(String.fromCharCode(65533)),++s}return o.join("")}L.default=c}},G={};function Y(w){var L=G[w];if(L!==void 0)return L.exports;var m=G[w]={exports:{}};return X[w].call(m.exports,m,m.exports,Y),m.exports}Y.m=X,function(){Y.n=function(w){var L=w&&w.__esModule?function(){return w.default}:function(){return w};return Y.d(L,{a:L}),L}}(),function(){Y.d=function(w,L){for(var m in L)Y.o(L,m)&&!Y.o(w,m)&&Object.defineProperty(w,m,{enumerable:!0,get:L[m]})}}(),function(){Y.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){Y.o=function(w,L){return Object.prototype.hasOwnProperty.call(w,L)}}(),function(){Y.r=function(w){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})}}();var h=Y("./src/index.js");return h}()})})(Re);const st=Ie(Re.exports),at=Ve("<span></span>"),gt=()=>{var o,f,s;if(localStorage.getItem("watermarkUsername")==null){Me("");return}const{pathname:re,searchParams:ne}=De(),{proxyLink:X}=Pe(),G=ke();let Y=fe.objs.filter(a=>a.type===Ye.VIDEO);Y.length===0&&(Y=[fe.obj]);const h=()=>{const a=Y.findIndex(l=>l.name===fe.obj.name);a<Y.length-1&&G(ze(He(location.pathname),Y[a+1].name)+"?auto_fullscreen="+w.fullscreen)};let w,L={id:re(),container:"#video-player",url:fe.raw_url,title:fe.obj.name,volume:.5,autoplay:Fe("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!1,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,layers:[{html:`<style>
                .watermark {
                  position: absolute;
                  top: 60%;
                  right: 35%;
                  color: white;
                }
                .watermark .sub-text {
                  font-size: 3em;
                  opacity: 0.3;
                  line-height: 1.2;
                }
                .watermark span {
                  display: block;
                }
                .watermark_logo {
                  position: absolute;
                  bottom: 5%;
                  right: 5%;
                  opacity: 0.7;
                  max-width: 25%;
                }
              </style>
              <div class="watermark_logo">
                <img src="https://img.fdtstudio.org/FDTPlayer_logo.png" alt="Watermark">
              </div>
              <div class="watermark">
                <span class="sub-text">\u7528\u6237: ${localStorage.getItem("watermarkUsername")}</span>
              </div>
              `}],controls:[{name:"next-button",index:11,position:"left",html:'<svg fill="none" stroke-width="2" xmlns="http://www.w3.org/2000/svg" height="22" width="22" class="icon icon-tabler icon-tabler-player-track-next-filled" width="1em" height="1em" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" style="overflow: visible; color: currentcolor;"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M2 5v14c0 .86 1.012 1.318 1.659 .753l8 -7a1 1 0 0 0 0 -1.506l-8 -7c-.647 -.565 -1.659 -.106 -1.659 .753z" stroke-width="0" fill="currentColor"></path><path d="M13 5v14c0 .86 1.012 1.318 1.659 .753l8 -7a1 1 0 0 0 0 -1.506l-8 -7c-.647 -.565 -1.659 -.106 -1.659 .753z" stroke-width="0" fill="currentColor"></path></svg>',tooltip:"Next",click:function(){h()}}],quality:[],plugins:[],whitelist:[],settings:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:xe(fe.obj.name),customType:{flv:function(a,l){const r=st.createPlayer({type:"flv",url:l},{referrerPolicy:"same-origin"});r.attachMediaElement(a),r.load()},m3u8:function(a,l){const r=new Ze;r.loadSource(l),r.attachMedia(a),a.src||(a.src=l)},mpd:function(a,l){if(!window.MediaSource){console.error("MediaSource API is not available");return}const r=new MediaSource;a.src=URL.createObjectURL(r),r.addEventListener("sourceopen",t,{once:!0});function t(i){URL.revokeObjectURL(a.src);var n=i.target;const e=n.addSourceBuffer('video/mp4; codecs="avc1.64001f,mp4a.40.2"');fetch(l).then(function(u){if(u.body==null)throw new Error("Video is not found");return u.arrayBuffer()}).then(function(u){e.addEventListener("updateend",function(_){!e.updating&&n.readyState==="open"&&n.endOfStream()}),e.appendBuffer(new Uint8Array(u).map(_=>~_))}).catch(u=>{console.error("Error fetching video:",u)})}}},lang:["en","zh-cn","zh-tw"].includes(Le().toLowerCase())?Le().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const m=fe.related.filter(a=>{for(const l of[".srt",".ass",".vtt"])if(a.name.endsWith(l))return!0;return!1}),y=fe.related.find(a=>{for(const l of[".xml"])if(a.name.endsWith(l))return!0;return!1});if(m.length!=0){let t=function(i){switch(a?"ass":"webvtt"){case"ass":w.subtitle.show=!1,w.emit("artplayer-plugin-ass:visible",i);break;case"webvtt":default:w.subtitle.show=i,w.emit("artplayer-plugin-ass:visible",!1);break}},a=!1;const l=m[0];xe(l.name).toLowerCase()==="ass"?(a=!0,(o=L.plugins)==null||o.push(it({subUrl:X(l,!0)}))):L.subtitle={url:X(l,!0),type:xe(l.name)};const r=[{id:"setting_subtitle_display",html:"Display",tooltip:"Show",switch:!0,onSwitch:function(i){var e;i.tooltip=i.switch?"Hide":"Show",t(!i.switch);const n=(e=L.settings)==null?void 0:e.find(u=>u.id==="setting_subtitle");return n&&(n.tooltip=i.tooltip),!i.switch}}];m.forEach((i,n)=>{r.push({default:n===0,html:(()=>{const e=at.cloneNode(!0);return e.style.setProperty("display","inline-block"),e.style.setProperty("max-width","15em"),e.style.setProperty("text-overflow","ellipsis"),e.style.setProperty("overflow","hidden"),Be(e,()=>i.name),Ue(()=>je(e,"title",i.name)),e})(),name:i.name,url:X(i,!0)})}),(f=L.settings)==null||f.push({id:"setting_subtitle",html:"Subtitle",tooltip:"Show",icon:Xe({size:24}),selector:r,onSelect:function(i){var e,u;xe(i.name).toLowerCase()==="ass"?(a=!0,this.emit("artplayer-plugin-ass:switch",i.url),t(!0)):(a=!1,this.subtitle.switch(i.url,{name:i.name}),this.once("subtitleLoad",t.bind(this,!0)));const n=r.find(_=>_.id==="setting_subtitle_display");return n&&!n.switch&&((u=(e=n.$html)==null?void 0:e.click)==null||u.call(e)),n==null?void 0:n.tooltip}})}y&&((s=L.plugins)==null||s.push($e({danmuku:X(y,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"}))),Ne(()=>{w=new Je(L);let a;switch(ne.auto_fullscreen){case"true":a=!0;case"false":a=!1;default:a=!1}console.log(a),w.on("ready",()=>{w.fullscreen=a}),w.on("video:ended",()=>{!c()||h()});let l=document.querySelector("#video-player > div"),r=document.querySelector("#video-player > div > div.art-layers");if(r!=null&&l!=null){const t=r.innerHTML,i=setInterval(()=>{if(document.querySelector("#video-player")!=null){let n=document.querySelector("#video-player > div > div.art-layers");if(n)n.innerHTML="",n.innerHTML=t;else{let e=document.createElement("div");e.className="art-layers",e.innerHTML=t}}else clearInterval(i)},1e3)}}),We(()=>{w==null||w.destroy()});const[c,d]=Ge();return Se(Qe,{onAutoNextChange:d,get children(){return Se(Ke,{w:"$full",h:"60vh",id:"video-player"})}})};export{gt as default};
