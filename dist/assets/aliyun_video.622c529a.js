import{b as O,W as S,Q as i,as as W,cQ as y,c9 as j,aO as I,b1 as L,_ as P,ax as A,b2 as g,n as w,o as C,d as N,h as v,Y as T}from"./index.181623f1.js";import{O as q}from"./icon.da74d2b5.js";import{A as z,V as B}from"./video_box.c1de02d1.js";import{H as R,a as V}from"./hls.9fc5c30e.js";import"./index.20e42f04.js";import"./index.06e67ae7.js";import"./Layout.13c484d5.js";import"./usePath.30d641b8.js";import"./index.2a3d34d0.js";import"./FolderTree.e6ae4ac3.js";import"./index.d073d3cf.js";const Z=()=>{const{replace:_,pathname:c}=O(),{proxyLink:p}=S();let s=i.objs.filter(e=>e.type===q.VIDEO);s.length===0&&(s=[i.obj]);let a,l={id:c(),container:"#video-player",title:i.obj.name,volume:.5,autoplay:W("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:"m3u8",customType:{m3u8:function(e,n){const t=new R;t.loadSource(n),t.attachMedia(e),e.src||(e.src=n)}},lang:["en","zh-cn","zh-tw"].includes(y().toLowerCase())?y().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const u=i.related.find(e=>{for(const n of[".srt",".ass",".vtt"])if(e.name.endsWith(n))return!0;return!1}),d=i.related.find(e=>{for(const n of[".xml"])if(e.name.endsWith(n))return!0;return!1});u&&(l.subtitle={url:p(u,!0),type:j(u.name)}),d&&(l.plugins=[V({danmuku:p(d,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"})]);const[M,f]=I(()=>L.post("/fs/other",{path:c(),password:P(),method:"video_preview"}));A(async()=>{const e=await f();g(e,n=>{const t=n.video_preview_play_info.live_transcoding_task_list.filter(r=>r.url);if(t.length===0){w.error("No transcoding video found");return}l.url=t[t.length-1].url,l.quality=t.map((r,o)=>({html:r.template_id,url:r.url,default:o===t.length-1})),a=new z(l),a.on("video:ended",()=>{if(!k())return;const r=s.findIndex(o=>o.name===i.obj.name);r<s.length-1&&_(s[r+1].name)}),u&&a.on("video:play",r=>{a.subtitle.url=p(u,!0)}),m=window.setInterval(b,1e3*60*14)})});let m,h;async function b(){const e=await f();g(e,async n=>{const t=n.video_preview_play_info.live_transcoding_task_list.filter(o=>o.url);if(t.length===0){w.error("No transcoding video found");return}const r=t.map((o,F)=>({html:o.template_id,url:o.url,default:F===t.length-1}));a.quality=r,h=a.currentTime,await a.switchUrl(r[r.length-1].url),setTimeout(()=>{a.seek=h},1e3)})}C(()=>{a==null||a.destroy(),window.clearInterval(m)});const[k,x]=N();return v(B,{onAutoNextChange:x,get children(){return v(T,{w:"$full",h:"60vh",id:"video-player"})}})};export{Z as default};
